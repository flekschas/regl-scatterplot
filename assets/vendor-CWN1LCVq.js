const B1=r=>r*r*r,N1=r=>r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,G1=r=>--r*r*r+1,j1=r=>r,U1=r=>r*r,z1=r=>r<.5?2*r*r:-1+(4-2*r)*r,H1=r=>r*(2-r),K1=r=>r,q1=(r,e)=>{if(r===e)return!0;if(r.length!==e.length)return!1;const t=new Set(r),n=new Set(e);return t.size!==n.size?!1:e.every(i=>t.has(i))},X1=r=>Math.sqrt(r.reduce((e,t)=>e+t**2,0)),Y1=r=>r.reduce((e,t)=>t>e?t:e,-1/0),W1=(r,e=t=>t)=>{const t=[];for(let n=0;n<r;n++)t.push(e(n,r));return t},Z1=(r,e)=>{const t=[];return r.forEach(n=>{t[n]=!0}),e.forEach(n=>{t[n]=!0}),t.reduce((n,i,s)=>(i&&n.push(s),n),[])},$h=(r,...e)=>(e.forEach(t=>{const n=Object.keys(t).reduce((i,s)=>(i[s]=Object.getOwnPropertyDescriptor(t,s),i),{});Object.getOwnPropertySymbols(t).forEach(i=>{const s=Object.getOwnPropertyDescriptor(t,i);s.enumerable&&(n[i]=s)}),Object.defineProperties(r,n)}),r),Q1=(...r)=>e=>r.reduce((t,n)=>n(t),e),J1=r=>e=>$h({__proto__:{constructor:r}},e),eP=(r,e)=>t=>$h(t,{get[r](){return e}}),tP=(r,e,t,n)=>Math.sqrt((r-t)**2+(e-n)**2),rP=r=>new Worker(window.URL.createObjectURL(new Blob([`(${r.toString()})()`],{type:"text/javascript"}))),nP=(r=1)=>new Promise(e=>{let t=0;const n=()=>requestAnimationFrame(()=>{t++,t<r?n():e()});n()}),iP=(r,e,t=null)=>{let n,i=0;t=t===null?e:t;const s=(...y)=>{const x=()=>{i>0&&(r(...y),i=0)};clearTimeout(n),n=setTimeout(x,t)};let o=!1;const l=(...y)=>{o?(i++,s(...y)):(r(...y),s(...y),o=!0,i=0,setTimeout(()=>{o=!1},e))};return l.reset=()=>{o=!1},l.cancel=()=>{clearTimeout(n)},l.now=(...y)=>r(...y),l};var r_=1e-6,Qn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function rl(){var r=new Qn(16);return Qn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function sP(r){var e=new Qn(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Md(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],y=e[6],x=e[7],N=e[8],U=e[9],de=e[10],Se=e[11],Ce=e[12],Ie=e[13],Ge=e[14],He=e[15],nt=t*l-n*o,_e=t*y-i*o,we=t*x-s*o,$e=n*y-i*l,Ne=n*x-s*l,Mt=i*x-s*y,Ve=N*Ie-U*Ce,Ut=N*Ge-de*Ce,It=N*He-Se*Ce,Ft=U*Ge-de*Ie,ht=U*He-Se*Ie,_t=de*He-Se*Ge,je=nt*_t-_e*ht+we*Ft+$e*It-Ne*Ut+Mt*Ve;return je?(je=1/je,r[0]=(l*_t-y*ht+x*Ft)*je,r[1]=(i*ht-n*_t-s*Ft)*je,r[2]=(Ie*Mt-Ge*Ne+He*$e)*je,r[3]=(de*Ne-U*Mt-Se*$e)*je,r[4]=(y*It-o*_t-x*Ut)*je,r[5]=(t*_t-i*It+s*Ut)*je,r[6]=(Ge*we-Ce*Mt-He*_e)*je,r[7]=(N*Mt-de*we+Se*_e)*je,r[8]=(o*ht-l*It+x*Ve)*je,r[9]=(n*It-t*ht-s*Ve)*je,r[10]=(Ce*Ne-Ie*we+He*nt)*je,r[11]=(U*we-N*Ne-Se*nt)*je,r[12]=(l*Ut-o*Ft-y*Ve)*je,r[13]=(t*Ft-n*Ut+i*Ve)*je,r[14]=(Ie*_e-Ce*$e-Ge*nt)*je,r[15]=(N*$e-U*_e+de*nt)*je,r):null}function Wn(r,e,t){var n=e[0],i=e[1],s=e[2],o=e[3],l=e[4],y=e[5],x=e[6],N=e[7],U=e[8],de=e[9],Se=e[10],Ce=e[11],Ie=e[12],Ge=e[13],He=e[14],nt=e[15],_e=t[0],we=t[1],$e=t[2],Ne=t[3];return r[0]=_e*n+we*l+$e*U+Ne*Ie,r[1]=_e*i+we*y+$e*de+Ne*Ge,r[2]=_e*s+we*x+$e*Se+Ne*He,r[3]=_e*o+we*N+$e*Ce+Ne*nt,_e=t[4],we=t[5],$e=t[6],Ne=t[7],r[4]=_e*n+we*l+$e*U+Ne*Ie,r[5]=_e*i+we*y+$e*de+Ne*Ge,r[6]=_e*s+we*x+$e*Se+Ne*He,r[7]=_e*o+we*N+$e*Ce+Ne*nt,_e=t[8],we=t[9],$e=t[10],Ne=t[11],r[8]=_e*n+we*l+$e*U+Ne*Ie,r[9]=_e*i+we*y+$e*de+Ne*Ge,r[10]=_e*s+we*x+$e*Se+Ne*He,r[11]=_e*o+we*N+$e*Ce+Ne*nt,_e=t[12],we=t[13],$e=t[14],Ne=t[15],r[12]=_e*n+we*l+$e*U+Ne*Ie,r[13]=_e*i+we*y+$e*de+Ne*Ge,r[14]=_e*s+we*x+$e*Se+Ne*He,r[15]=_e*o+we*N+$e*Ce+Ne*nt,r}function Id(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function n_(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function i_(r,e,t){var n=t[0],i=t[1],s=t[2],o=Math.hypot(n,i,s),l,y,x;return o<r_?null:(o=1/o,n*=o,i*=o,s*=o,l=Math.sin(e),y=Math.cos(e),x=1-y,r[0]=n*n*x+y,r[1]=i*n*x+s*l,r[2]=s*n*x-i*l,r[3]=0,r[4]=n*i*x-s*l,r[5]=i*i*x+y,r[6]=s*i*x+n*l,r[7]=0,r[8]=n*s*x+i*l,r[9]=i*s*x-n*l,r[10]=s*s*x+y,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function s_(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function a_(r,e){var t=e[0],n=e[1],i=e[2],s=e[4],o=e[5],l=e[6],y=e[8],x=e[9],N=e[10];return r[0]=Math.hypot(t,n,i),r[1]=Math.hypot(s,o,l),r[2]=Math.hypot(y,x,N),r}function o_(){var r=new Qn(4);return Qn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function l_(r,e,t){var n=e[0],i=e[1],s=e[2],o=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*o,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*o,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*o,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*o,r}(function(){var r=o_();return function(e,t,n,i,s,o){var l,y;for(t||(t=4),n||(n=0),i?y=Math.min(i*t+n,e.length):y=e.length,l=n;l<y;l+=t)r[0]=e[l],r[1]=e[l+1],r[2]=e[l+2],r[3]=e[l+3],s(r,r,o),e[l]=r[0],e[l+1]=r[1],e[l+2]=r[2],e[l+3]=r[3];return e}})();function u_(){var r=new Qn(2);return Qn!=Float32Array&&(r[0]=0,r[1]=0),r}function c_(r,e){var t=r[0],n=r[1],i=e[0],s=e[1],o=Math.sqrt(t*t+n*n)*Math.sqrt(i*i+s*s),l=o&&(t*i+n*s)/o;return Math.acos(Math.min(Math.max(l,-1),1))}(function(){var r=u_();return function(e,t,n,i,s,o){var l,y;for(t||(t=2),n||(n=0),i?y=Math.min(i*t+n,e.length):y=e.length,l=n;l<y;l+=t)r[0]=e[l],r[1]=e[l+1],s(r,r,o),e[l]=r[0],e[l+1]=r[1];return e}})();const d_=(r=[0,0],e=1,t=0,n=[0,0],i=[[0,1/0],[0,1/0]],s=[[-1/0,1/0],[-1/0,1/0]])=>{const o=new Float32Array(16),l=new Float32Array(16),y=new Float32Array(16);let x=rl(),N=[...n.slice(0,2),0,1];const U=Array.isArray(i[0])?[...i[0]]:[...i],de=Array.isArray(i[0])?[...i[1]]:[...i],Se=Array.isArray(s[0])?[...s[0]]:[...s],Ce=Array.isArray(s[0])?[...s[1]]:[...s],Ie=()=>a_(o,x).slice(0,2),Ge=()=>{const Ae=Ie();return Math.min(Ae[0],Ae[1])},He=()=>{const Ae=Ie();return Math.max(Ae[0],Ae[1])},nt=()=>Math.acos(x[0]/He()),_e=()=>[[...U],[...de]],we=()=>[[...Se],[...Ce]],$e=()=>{const Ae=Ie();return[1/Ae[0],1/Ae[1]]},Ne=()=>1/Ge(),Mt=()=>1/He(),Ve=()=>s_(o,x).slice(0,2),Ut=()=>l_(o,N,Md(y,x)).slice(0,2),It=()=>x,Ft=()=>N.slice(0,2),ht=([Ae=0,We=0]=[],Ht=1,$t=0)=>{x=rl(),_t([-Ae,-We]),er($t),je(1/Ht)},_t=([Ae=0,We=0]=[])=>{o[0]=Ae,o[1]=We,o[2]=0;const Ht=Id(l,o);Wn(x,Ht,x)},je=(Ae,We)=>{const Ht=Array.isArray(Ae);let $t=Ht?Ae[0]:Ae,nr=Ht?Ae[1]:Ae;if($t<=0||nr<=0||$t===1&&nr===1)return;const br=Ie(),Kr=br[0]*$t,Vr=br[1]*nr;if($t=Math.max(U[0],Math.min(Kr,U[1]))/br[0],nr=Math.max(de[0],Math.min(Vr,de[1]))/br[1],$t===1&&nr===1)return;o[0]=$t,o[1]=nr,o[2]=1;const Or=n_(l,o),cn=We?[...We,0]:N,dn=Id(o,cn);Wn(x,dn,Wn(x,Or,Wn(x,Md(y,dn),x)))},er=Ae=>{const We=rl();i_(We,Ae,[0,0,1]),Wn(x,We,x)},Ar=Ae=>{const We=Array.isArray(Ae[0]);U[0]=We?Ae[0][0]:Ae[0],U[1]=We?Ae[0][1]:Ae[1],de[0]=We?Ae[1][0]:Ae[0],de[1]=We?Ae[1][1]:Ae[1]},zt=Ae=>{const We=Array.isArray(Ae[0]);Se[0]=We?Ae[0][0]:Ae[0],Se[1]=We?Ae[0][1]:Ae[1],Ce[0]=We?Ae[1][0]:Ae[0],Ce[1]=We?Ae[1][1]:Ae[1]},tr=Ae=>{!Ae||Ae.length<16||(x=Ae)},Lr=Ae=>{N=[...Ae.slice(0,2),0,1]},rr=()=>{ht(r,e,t)};return ht(r,e,t),{get translation(){return Ve()},get target(){return Ut()},get scaling(){return Ie()},get minScaling(){return Ge()},get maxScaling(){return He()},get scaleBounds(){return _e()},get translationBounds(){return we()},get distance(){return $e()},get minDistance(){return Ne()},get maxDistance(){return Mt()},get rotation(){return nt()},get view(){return It()},get viewCenter(){return Ft()},lookAt:ht,translate:_t,pan:_t,rotate:er,scale:je,zoom:je,reset:rr,set:(...Ae)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),tr(...Ae)),setScaleBounds:Ar,setTranslationBounds:zt,setView:tr,setViewCenter:Lr}},h_=["pan","rotate"],Fd={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},aP=(r,{distance:e=1,target:t=[0,0],rotation:n=0,isNdc:i=!0,isFixed:s=!1,isPan:o=!0,isPanInverted:l=[!1,!0],panSpeed:y=1,isRotate:x=!0,rotateSpeed:N=1,defaultMouseDownMoveAction:U="pan",mouseDownMoveModKey:de="alt",isZoom:Se=!0,zoomSpeed:Ce=1,viewCenter:Ie,scaleBounds:Ge,translationBounds:He,onKeyDown:nt=()=>{},onKeyUp:_e=()=>{},onMouseDown:we=()=>{},onMouseUp:$e=()=>{},onMouseMove:Ne=()=>{},onWheel:Mt=()=>{}}={})=>{let Ve=d_(t,e,n,Ie,Ge,He),Ut=0,It=0,Ft=0,ht=0,_t=0,je=0,er=!1,Ar=0,zt=1,tr=1,Lr=1,rr=!1,Ae=!1,We=!1,Ht=U==="pan",$t=o,nr=o,br=l,Kr=l,Vr=Se,Or=Se;const cn=()=>{$t=Array.isArray(o)?!!o[0]:o,nr=Array.isArray(o)?!!o[1]:o,br=Array.isArray(l)?!!l[0]:l,Kr=Array.isArray(l)?!!l[1]:l,Vr=Array.isArray(Se)?!!Se[0]:Se,Or=Array.isArray(Se)?!!Se[1]:Se};cn();const dn=i?ye=>ye/zt*2*Lr:ye=>ye,li=i?ye=>ye/tr*2:ye=>-ye,Ke=i?ye=>(-1+ye/zt*2)*Lr:ye=>ye,qe=i?ye=>1-ye/tr*2:ye=>ye,it=()=>{if(s){const ir=Ae;return Ae=!1,ir}rr=!1;const ye=Ut,Lt=It;if(($t||nr)&&er&&(Ht&&!We||!Ht&&We)){const ir=br?_t-ye:ye-_t,_r=$t?dn(y*ir):0,wr=Kr?je-Lt:Lt-je,wt=nr?li(y*wr):0;(_r!==0||wt!==0)&&(Ve.pan([_r,wt]),rr=!0)}if((Vr||Or)&&Ar){const ir=Ce*Math.exp(Ar/tr),_r=Ke(Ft),wr=qe(ht);Ve.scale([Vr?1/ir:1,Or?1/ir:1],[_r,wr]),rr=!0}if(x&&er&&(Ht&&We||!Ht&&!We)&&Math.abs(_t-ye)+Math.abs(je-Lt)>0){const ir=zt/2,_r=tr/2,wr=_t-ir,wt=_r-je,qr=ye-ir,hn=_r-Lt,In=c_([wr,wt],[qr,hn]),io=wr*hn-qr*wt;Ve.rotate(N*In*Math.sign(io)),rr=!0}Ar=0,_t=ye,je=Lt;const Mn=rr||Ae;return Ae=!1,Mn},st=({defaultMouseDownMoveAction:ye=null,isFixed:Lt=null,isPan:Mn=null,isPanInverted:ir=null,isRotate:_r=null,isZoom:wr=null,panSpeed:wt=null,rotateSpeed:qr=null,zoomSpeed:hn=null,mouseDownMoveModKey:In=null}={})=>{U=ye!==null&&h_.includes(ye)?ye:U,Ht=U==="pan",s=Lt!==null?Lt:s,o=Mn!==null?Mn:o,l=ir!==null?ir:l,x=_r!==null?_r:x,Se=wr!==null?wr:Se,y=+wt>0?wt:y,N=+qr>0?qr:N,Ce=+hn>0?hn:Ce,cn(),de=In!==null&&Object.keys(Fd).includes(In)?In:de},cr=()=>{const ye=r.getBoundingClientRect();zt=ye.width,tr=ye.height,Lr=zt/tr},at=ye=>{We=!1,_e(ye)},Rn=ye=>{We=ye[Fd[de]],nt(ye)},Dn=ye=>{er=!1,$e(ye)},Us=ye=>{er=ye.buttons===1,we(ye)},h=document.createEvent("MouseEvent").offsetX!==void 0?ye=>{Ft=ye.offsetX,ht=ye.offsetY}:ye=>{const Lt=r.getBoundingClientRect();Ft=ye.clientX-Lt.left,ht=ye.clientY-Lt.top},zs=ye=>{Ut=ye.clientX,It=ye.clientY},Hs=ye=>{zs(ye),Ne(ye)},Ks=ye=>{if((Vr||Or)&&!s){ye.preventDefault(),zs(ye),h(ye);const Lt=ye.deltaMode===1?12:1;Ar+=Lt*(ye.deltaY||ye.deltaX||0)}Mt(ye)},no=()=>{Ve=void 0,window.removeEventListener("keydown",Rn),window.removeEventListener("keyup",at),r.removeEventListener("mousedown",Us),window.removeEventListener("mouseup",Dn),window.removeEventListener("mousemove",Hs),r.removeEventListener("wheel",Ks)};window.addEventListener("keydown",Rn,{passive:!0}),window.addEventListener("keyup",at,{passive:!0}),r.addEventListener("mousedown",Us,{passive:!0}),window.addEventListener("mouseup",Dn,{passive:!0}),window.addEventListener("mousemove",Hs,{passive:!0}),r.addEventListener("wheel",Ks,{passive:!1}),Ve.config=st,Ve.dispose=no,Ve.refresh=cr,Ve.tick=it;const St=ye=>function(){ye.apply(null,arguments),Ae=!0};return Ve.lookAt=St(Ve.lookAt),Ve.translate=St(Ve.translate),Ve.pan=St(Ve.pan),Ve.rotate=St(Ve.rotate),Ve.scale=St(Ve.scale),Ve.zoom=St(Ve.zoom),Ve.reset=St(Ve.reset),Ve.set=St(Ve.set),Ve.setScaleBounds=St(Ve.setScaleBounds),Ve.setTranslationBounds=St(Ve.setTranslationBounds),Ve.setView=St(Ve.setView),Ve.setViewCenter=St(Ve.setViewCenter),cr(),Ve};function oP(r,e,t=2){const n=r.length;let i=p_(r,0,n,t,!0);const s=[];if(!i||i.next===i.prev)return s;let o,l,y;if(r.length>80*t){o=1/0,l=1/0;let x=-1/0,N=-1/0;for(let U=t;U<n;U+=t){const de=r[U],Se=r[U+1];de<o&&(o=de),Se<l&&(l=Se),de>x&&(x=de),Se>N&&(N=Se)}y=Math.max(x-o,N-l),y=y!==0?32767/y:0}return vs(i,s,t,o,l,y,0),s}function p_(r,e,t,n,i){let s;if(i===P_(r,e,t,n)>0)for(let o=e;o<t;o+=n)s=$d(o/n|0,r[o],r[o+1],s);else for(let o=t-n;o>=e;o-=n)s=$d(o/n|0,r[o],r[o+1],s);return s&&Ha(s,s.next)&&(bs(s),s=s.next),s}function ms(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(Ha(t,t.next)||At(t.prev,t,t.next)===0)){if(bs(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function vs(r,e,t,n,i,s,o){if(!r)return;!o&&s&&__(r,n,i,s);let l=r;for(;r.prev!==r.next;){const y=r.prev,x=r.next;if(s?m_(r,n,i,s):f_(r)){e.push(y.i,r.i,x.i),bs(r),r=x.next,l=x.next;continue}if(r=x,r===l){o?o===1?(r=v_(ms(r),e),vs(r,e,t,n,i,s,2)):o===2&&b_(r,e,t,n,i,s):vs(ms(r),e,t,n,i,s,1);break}}}function f_(r){const e=r.prev,t=r,n=r.next;if(At(e,t,n)>=0)return!1;const i=e.x,s=t.x,o=n.x,l=e.y,y=t.y,x=n.y,N=Math.min(i,s,o),U=Math.min(l,y,x),de=Math.max(i,s,o),Se=Math.max(l,y,x);let Ce=n.next;for(;Ce!==e;){if(Ce.x>=N&&Ce.x<=de&&Ce.y>=U&&Ce.y<=Se&&fs(i,l,s,y,o,x,Ce.x,Ce.y)&&At(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.next}return!0}function m_(r,e,t,n){const i=r.prev,s=r,o=r.next;if(At(i,s,o)>=0)return!1;const l=i.x,y=s.x,x=o.x,N=i.y,U=s.y,de=o.y,Se=Math.min(l,y,x),Ce=Math.min(N,U,de),Ie=Math.max(l,y,x),Ge=Math.max(N,U,de),He=xl(Se,Ce,e,t,n),nt=xl(Ie,Ge,e,t,n);let _e=r.prevZ,we=r.nextZ;for(;_e&&_e.z>=He&&we&&we.z<=nt;){if(_e.x>=Se&&_e.x<=Ie&&_e.y>=Ce&&_e.y<=Ge&&_e!==i&&_e!==o&&fs(l,N,y,U,x,de,_e.x,_e.y)&&At(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,we.x>=Se&&we.x<=Ie&&we.y>=Ce&&we.y<=Ge&&we!==i&&we!==o&&fs(l,N,y,U,x,de,we.x,we.y)&&At(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;_e&&_e.z>=He;){if(_e.x>=Se&&_e.x<=Ie&&_e.y>=Ce&&_e.y<=Ge&&_e!==i&&_e!==o&&fs(l,N,y,U,x,de,_e.x,_e.y)&&At(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;we&&we.z<=nt;){if(we.x>=Se&&we.x<=Ie&&we.y>=Ce&&we.y<=Ge&&we!==i&&we!==o&&fs(l,N,y,U,x,de,we.x,we.y)&&At(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function v_(r,e){let t=r;do{const n=t.prev,i=t.next.next;!Ha(n,i)&&Bh(n,t,t.next,i)&&Da(n,i)&&Da(i,n)&&(e.push(n.i,t.i,i.i),bs(t),bs(t.next),t=r=i),t=t.next}while(t!==r);return ms(t)}function b_(r,e,t,n,i,s){let o=r;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&y_(o,l)){let y=E_(o,l);o=ms(o,o.next),y=ms(y,y.next),vs(o,e,t,n,i,s,0),vs(y,e,t,n,i,s,0);return}l=l.next}o=o.next}while(o!==r)}function __(r,e,t,n){let i=r;do i.z===0&&(i.z=xl(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,w_(i)}function w_(r){let e,t=1;do{let n=r,i;r=null;let s=null;for(e=0;n;){e++;let o=n,l=0;for(let x=0;x<t&&(l++,o=o.nextZ,!!o);x++);let y=t;for(;l>0||y>0&&o;)l!==0&&(y===0||!o||n.z<=o.z)?(i=n,n=n.nextZ,l--):(i=o,o=o.nextZ,y--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;n=o}s.nextZ=null,t*=2}while(e>1);return r}function xl(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function g_(r,e,t,n,i,s,o,l){return(i-o)*(e-l)>=(r-o)*(s-l)&&(r-o)*(n-l)>=(t-o)*(e-l)&&(t-o)*(s-l)>=(i-o)*(n-l)}function fs(r,e,t,n,i,s,o,l){return!(r===o&&e===l)&&g_(r,e,t,n,i,s,o,l)}function y_(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!x_(r,e)&&(Da(r,e)&&Da(e,r)&&C_(r,e)&&(At(r.prev,r,e.prev)||At(r,e.prev,e))||Ha(r,e)&&At(r.prev,r,r.next)>0&&At(e.prev,e,e.next)>0)}function At(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Ha(r,e){return r.x===e.x&&r.y===e.y}function Bh(r,e,t,n){const i=Ea(At(r,e,t)),s=Ea(At(r,e,n)),o=Ea(At(t,n,r)),l=Ea(At(t,n,e));return!!(i!==s&&o!==l||i===0&&Ca(r,t,e)||s===0&&Ca(r,n,e)||o===0&&Ca(t,r,n)||l===0&&Ca(t,e,n))}function Ca(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Ea(r){return r>0?1:r<0?-1:0}function x_(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&Bh(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function Da(r,e){return At(r.prev,r,r.next)<0?At(r,e,r.next)>=0&&At(r,r.prev,e)>=0:At(r,e,r.prev)<0||At(r,r.next,e)<0}function C_(r,e){let t=r,n=!1;const i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function E_(r,e){const t=Cl(r.i,r.x,r.y),n=Cl(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function $d(r,e,t,n){const i=Cl(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function bs(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Cl(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function P_(r,e,t,n){let i=0;for(let s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i}const Nh=new window.BroadcastChannel("pub-sub-es"),A_=r=>typeof r=="string",$l=(r,e)=>A_(r)&&e?r.toLowerCase():r,Gh=(r,e)=>(t,n,i=Number.POSITIVE_INFINITY)=>{const s=$l(t,e==null?void 0:e.caseInsensitive),o=r[s]||[];return o.push({handler:n,times:+i||Number.POSITIVE_INFINITY}),r[s]=o,{event:s,handler:n}},S_=r=>typeof r=="object";function Bl(r,e){function t(n,i){let s,o;S_(n)?(o=n.handler,s=n.event):(s=n,o=i);const l=$l(s,e==null?void 0:e.caseInsensitive),y=r[l];if(!y)return;const x=y.findIndex(N=>N.handler===o);x===-1||x>=y.length||y.splice(x,1)}return t}const T_=r=>!!r,jh=(r,e)=>{const t=Bl(r);return(...n)=>{const[i,s,o]=n,l=$l(i,e==null?void 0:e.caseInsensitive),y=r[l];if(!T_(y))return;const x=[...y];for(const de of x)--de.times<1&&t(l,de.handler);const N=(o==null?void 0:o.async)!==void 0?o.async:e==null?void 0:e.async,U=()=>{for(const de of x)de.handler(s)};if(N?setTimeout(U,0):U(),e!=null&&e.isGlobal&&!(o!=null&&o.isNoGlobalBroadcast))try{Nh.postMessage({event:l,news:s})}catch(de){if(de instanceof Error&&de.name==="DataCloneError")console.warn(`Could not broadcast '${l.toString()}' globally. Payload is not clonable.`);else throw de}}};function k_(r){return Object.keys(r)}const Uh=r=>()=>{for(const e of k_(r))delete r[e]},zh=()=>({}),lP=r=>{const e=!!(r!=null&&r.async),t=!!(r!=null&&r.caseInsensitive),n=(r==null?void 0:r.stack)||zh();return{publish:jh(n,{async:e,caseInsensitive:t}),subscribe:Gh(n,{caseInsensitive:t}),unsubscribe:Bl(n,{caseInsensitive:t}),clear:Uh(n),stack:n}},ss=zh(),L_={publish:jh(ss,{isGlobal:!0}),subscribe:Gh(ss),unsubscribe:Bl(ss),clear:Uh(ss),stack:ss};Nh.onmessage=({data:{event:r,news:e}})=>L_.publish(r,e,{isNoGlobalBroadcast:!0});const V_=`
precision mediump float;
varying vec4 color;
void main() {
  gl_FragColor = color;
}`,O_=`
uniform mat4 projectionViewModel;
uniform float aspectRatio;

uniform sampler2D colorTex;
uniform float colorTexRes;
uniform float colorTexEps;
uniform float width;
uniform float useOpacity;
uniform float useColorOpacity;
uniform int miter;

attribute vec3 prevPosition;
attribute vec3 currPosition;
attribute vec3 nextPosition;
attribute float opacity;
attribute float offsetScale;
attribute float colorIndex;

varying vec4 color;

void main() {
  vec2 aspectVec = vec2(aspectRatio, 1.0);
  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);
  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);
  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);

  // get 2D screen space with W divide and aspect correction
  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;
  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;
  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;

  float len = width;

  // starting point uses (next - current)
  vec2 dir = vec2(0.0);
  if (currScreen == prevScreen) {
    dir = normalize(nextScreen - currScreen);
  }
  // ending point uses (current - previous)
  else if (currScreen == nextScreen) {
    dir = normalize(currScreen - prevScreen);
  }
  // somewhere in middle, needs a join
  else {
    // get directions from (C - B) and (B - A)
    vec2 dirA = normalize((currScreen - prevScreen));
    if (miter == 1) {
      vec2 dirB = normalize((nextScreen - currScreen));
      // now compute the miter join normal and length
      vec2 tangent = normalize(dirA + dirB);
      vec2 perp = vec2(-dirA.y, dirA.x);
      vec2 miter = vec2(-tangent.y, tangent.x);
      len = width / dot(miter, perp);
      dir = tangent;
    } else {
      dir = dirA;
    }
  }

  vec2 normal = vec2(-dir.y, dir.x) * len;
  normal.x /= aspectRatio;
  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);
  gl_Position = currProjected + offset;

  // Get color from texture
  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);
  vec2 colorTexIndex = vec2(
    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,
    colorRowIndex / colorTexRes + colorTexEps
  );

  color = texture2D(colorTex, colorTexIndex);
  color.a = useColorOpacity * color.a + useOpacity * opacity;
}`,nl=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Yt=Float32Array.BYTES_PER_ELEMENT,R_=r=>r!==void 0&&Number.isFinite(r),il=r=>r.length>0&&Array.isArray(r[0]),{push:Hh,splice:D_}=Array.prototype,M_=(r,e=[])=>{let t=0;for(const n of r){for(let i=0;i<n-1;i++){const s=t+i*2,o=s+1,l=s+2,y=s+3;e.push(s,o,l,l,o,y)}t+=(n+2)*2}return e};function Pa(r,e=1,t=1){const n=[],i=new Array(e*2);for(let s=0,o=r.length/e;s<o;s++){const l=s*e;for(let y=0;y<e;y++){const x=r[l+y];i[y]=x,i[y+e]=x*t}Hh.apply(n,i)}return n}function wn(r,e,t,n){const i=new Array(n),s=e*n;for(let o=0;o<n;o++)i[o]=r[s+o];return D_.call(r,t*n,0,...i),r}function I_(r,e,t,n=0){const i=[],s=new Array(t).fill(n);for(let o=0,l=r.length/e;o<l;o++){const y=o*e;for(let x=0;x<e;x++)s[x]=r[y+x];Hh.apply(i,s)}return i}const uP=(r,{projection:e=nl,model:t=nl,view:n=nl,points:i=[],colorIndices:s=[],color:o=[.8,.5,0,1],opacity:l=null,opacities:y=[],width:x=1,widths:N=[],miter:U=!0,is2d:de=!1,zPos2d:Se=0}={})=>{if(!r){console.error("Regl instance is undefined.");return}const Ce=new Float32Array(16);let Ie,Ge,He,nt,_e,we,$e,Ne,Mt,Ve,Ut,It,Ft,ht,_t,je,er,Ar,zt=de?2:3;const tr=()=>+(y.length===Ge||l!==null),Lr=()=>{Ve=r.buffer(),Ut=r.buffer(),It=r.buffer(),_t=r.buffer(),je={prevPosition:{buffer:()=>Ve,offset:0,stride:Yt*3},currPosition:{buffer:()=>Ve,offset:Yt*3*2,stride:Yt*3},nextPosition:{buffer:()=>Ve,offset:Yt*3*4,stride:Yt*3},opacity:{buffer:()=>Ut,offset:Yt*2,stride:Yt},offsetScale:{buffer:()=>It,offset:Yt*2,stride:Yt},colorIndex:{buffer:()=>_t,offset:Yt*2,stride:Yt}},er=r.elements(),Ar=r({attributes:je,depth:{enable:!de},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(Ke,qe)=>{const it=Ke.projection||qe.projection,st=Ke.model||qe.model,cr=Ke.view||qe.view;return Wn(Ce,it,Wn(Ce,cr,st))},aspectRatio:({viewportWidth:Ke,viewportHeight:qe})=>Ke/qe,colorTex:()=>Ft,colorTexRes:()=>ht,colorTexEps:()=>.5/ht,pixelRatio:({pixelRatio:Ke})=>Ke,width:({pixelRatio:Ke,viewportHeight:qe})=>x/qe*Ke,useOpacity:tr,useColorOpacity:()=>+!tr(),miter:+!!U},elements:()=>er,vert:O_,frag:V_})},rr=()=>{Ie===1&&i.length%zt>0&&console.warn(`The length of points (${Ge}) does not match the dimensions (${zt}). Incomplete points are ignored.`),nt=i.flat().slice(0,Ge*zt),de&&(nt=I_(nt,2,3,Se)),s.length!==Ge&&(s=new Array(Ge).fill(0)),N.length!==Ge&&(N=new Array(Ge).fill(1));const Ke=s.slice(),qe=y.length===Ge?y.slice():new Array(Ge).fill(l===null?1:l),it=N.slice();let st=0;for(const cr of He){const at=st+cr-1;wn(nt,at,at,3),wn(nt,st,st,3),wn(Ke,at,at,1),wn(Ke,st,st,1),wn(qe,at,at,1),wn(qe,st,st,1),wn(it,at,at,1),wn(it,st,st,1),st+=cr+2}_e=new Float32Array(Pa(nt,3)),we=Pa(Ke),$e=Pa(qe),Ne=Pa(it,1,-1),Mt=M_(He),Ve({usage:"dynamic",type:"float",length:_e.length*Yt,data:_e}),Ut({usage:"dynamic",type:"float",length:$e.length*Yt,data:$e}),It({usage:"dynamic",type:"float",length:Ne.length*Yt,data:Ne}),_t({usage:"dynamic",type:"float",length:we.length*Yt,data:we}),er({primitive:"triangles",usage:"dynamic",type:Mt.length>2**16?"uint32":"uint16",data:Mt})},Ae=()=>{We(),Lr()},We=()=>{i=[],nt=[],_e=new Float32Array,Ne=[],Mt=[],Ve.destroy(),It.destroy(),er.destroy()},Ht=({projection:Ke,model:qe,view:it}={})=>{Ke&&(e=Ke),qe&&(t=qe),it&&(n=it),i&&i.length>1&&Ar({projection:e,model:t,view:n})},$t=(Ke,qe)=>{const it=qe.flat(2);return it.length===Ge?it:it.length===Ie?He.flatMap((st,cr)=>Array(st).fill(it[cr])):Ke},nr=()=>i,br=(Ke=[],{colorIndices:qe=s,opacities:it=y,widths:st=N,is2d:cr=de}={})=>{i=Ke,de=cr,zt=de?2:3,Ie=il(i)?i.length:1,He=il(i)?i.map(at=>Math.floor(at.length/zt)):[Math.floor(i.length/zt)],Ge=He.reduce((at,Rn)=>at+Rn,0),s=$t(s,qe),y=$t(y,it),N=$t(N,st),i&&Ge>1?rr():Ae()},Kr=()=>{const Ke=il(o)?o:[o];ht=Math.max(2,Math.ceil(Math.sqrt(Ke.length)));const qe=new Uint8Array(ht**2*4);Ke.forEach((it,st)=>{qe[st*4]=Math.min(255,Math.max(0,Math.round(it[0]*255))),qe[st*4+1]=Math.min(255,Math.max(0,Math.round(it[1]*255))),qe[st*4+2]=Math.min(255,Math.max(0,Math.round(it[2]*255))),qe[st*4+3]=Number.isNaN(+it[3])?255:Math.min(255,Math.max(0,Math.round(it[3]*255)))}),Ft=r.texture({data:qe,shape:[ht,ht,4]})},Vr=(Ke,qe=l)=>{o=Ke,l=qe,Ft&&Ft.destroy(),Kr()},Or=()=>({color:o,miter:U,width:x}),cn=({color:Ke,opacity:qe,miter:it,width:st}={})=>{Ke&&Vr(Ke,qe||l),it&&(U=!!it),R_(st)&&(x=st)},dn=()=>({points:Ve,widths:It,opacities:Ut,colorIndices:_t}),li=()=>({points:_e,widths:Ne,opacities:$e,colorIndices:we});return Lr(),Kr(),i&&i.length>1&&br(i),{clear:Ae,destroy:We,draw:Ht,getPoints:nr,setPoints:br,getData:li,getBuffer:dn,getStyle:Or,setStyle:cn}};var F_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $_(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Kh={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(F_,function(){var t=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},n=function(a,c){for(var v=Object.keys(c),V=0;V<v.length;++V)a[v[V]]=c[v[V]];return a},i=`
`;function s(a){return typeof atob<"u"?atob(a):"base64:"+a}function o(a){var c=new Error("(regl) "+a);throw console.error(c),c}function l(a,c){a||o(c)}function y(a){return a?": "+a:""}function x(a,c,v){a in c||o("unknown parameter ("+a+")"+y(v)+". possible values: "+Object.keys(c).join())}function N(a,c){t(a)||o("invalid parameter type"+y(c)+". must be a typed array")}function U(a,c){switch(c){case"number":return typeof a=="number";case"object":return typeof a=="object";case"string":return typeof a=="string";case"boolean":return typeof a=="boolean";case"function":return typeof a=="function";case"undefined":return typeof a>"u";case"symbol":return typeof a=="symbol"}}function de(a,c,v){U(a,c)||o("invalid parameter type"+y(v)+". expected "+c+", got "+typeof a)}function Se(a,c){a>=0&&(a|0)===a||o("invalid parameter type, ("+a+")"+y(c)+". must be a nonnegative integer")}function Ce(a,c,v){c.indexOf(a)<0&&o("invalid value"+y(v)+". must be one of: "+c)}var Ie=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ge(a){Object.keys(a).forEach(function(c){Ie.indexOf(c)<0&&o('invalid regl constructor argument "'+c+'". must be one of '+Ie)})}function He(a,c){for(a=a+"";a.length<c;)a=" "+a;return a}function nt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function _e(a,c){this.number=a,this.line=c,this.errors=[]}function we(a,c,v){this.file=a,this.line=c,this.message=v}function $e(){var a=new Error,c=(a.stack||a).toString(),v=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(c);if(v)return v[1];var V=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(c);return V?V[1]:"unknown"}function Ne(){var a=new Error,c=(a.stack||a).toString(),v=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(c);if(v)return v[1];var V=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(c);return V?V[1]:"unknown"}function Mt(a,c){var v=a.split(`
`),V=1,I=0,L={unknown:new nt,0:new nt};L.unknown.name=L[0].name=c||$e(),L.unknown.lines.push(new _e(0,""));for(var D=0;D<v.length;++D){var j=v[D],G=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(j);if(G)switch(G[1]){case"line":var X=/(\d+)(\s+\d+)?/.exec(G[2]);X&&(V=X[1]|0,X[2]&&(I=X[2]|0,I in L||(L[I]=new nt)));break;case"define":var W=/SHADER_NAME(_B64)?\s+(.*)$/.exec(G[2]);W&&(L[I].name=W[1]?s(W[2]):W[2]);break}L[I].lines.push(new _e(V++,j))}return Object.keys(L).forEach(function(Y){var ee=L[Y];ee.lines.forEach(function(z){ee.index[z.number]=z})}),L}function Ve(a){var c=[];return a.split(`
`).forEach(function(v){if(!(v.length<5)){var V=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(v);V?c.push(new we(V[1]|0,V[2]|0,V[3].trim())):v.length>0&&c.push(new we("unknown",0,v))}}),c}function Ut(a,c){c.forEach(function(v){var V=a[v.file];if(V){var I=V.index[v.line];if(I){I.errors.push(v),V.hasErrors=!0;return}}a.unknown.hasErrors=!0,a.unknown.lines[0].errors.push(v)})}function It(a,c,v,V,I){if(!a.getShaderParameter(c,a.COMPILE_STATUS)){var L=a.getShaderInfoLog(c),D=V===a.FRAGMENT_SHADER?"fragment":"vertex";zt(v,"string",D+" shader source must be a string",I);var j=Mt(v,I),G=Ve(L);Ut(j,G),Object.keys(j).forEach(function(X){var W=j[X];if(!W.hasErrors)return;var Y=[""],ee=[""];function z(q,P){Y.push(q),ee.push(P||"")}z("file number "+X+": "+W.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),W.lines.forEach(function(q){if(q.errors.length>0){z(He(q.number,4)+"|  ","background-color:yellow; font-weight:bold"),z(q.line+i,"color:red; background-color:yellow; font-weight:bold");var P=0;q.errors.forEach(function(R){var K=R.message,ue=/^\s*'(.*)'\s*:\s*(.*)$/.exec(K);if(ue){var B=ue[1];switch(K=ue[2],B){case"assign":B="=";break}P=Math.max(q.line.indexOf(B,P),0)}else P=0;z(He("| ",6)),z(He("^^^",P+3)+i,"font-weight:bold"),z(He("| ",6)),z(K+i,"font-weight:bold")}),z(He("| ",6)+i)}else z(He(q.number,4)+"|  "),z(q.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(ee[0]=Y.join("%c"),console.log.apply(console,ee)):console.log(Y.join(""))}),l.raise("Error compiling "+D+" shader, "+j[0].name)}}function Ft(a,c,v,V,I){if(!a.getProgramParameter(c,a.LINK_STATUS)){var L=a.getProgramInfoLog(c),D=Mt(v,I),j=Mt(V,I),G='Error linking program with vertex shader, "'+j[0].name+'", and fragment shader "'+D[0].name+'"';typeof document<"u"?console.log("%c"+G+i+"%c"+L,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(G+i+L),l.raise(G)}}function ht(a){a._commandRef=$e()}function _t(a,c,v,V){ht(a);function I(G){return G?V.id(G):0}a._fragId=I(a.static.frag),a._vertId=I(a.static.vert);function L(G,X){Object.keys(X).forEach(function(W){G[V.id(W)]=!0})}var D=a._uniformSet={};L(D,c.static),L(D,c.dynamic);var j=a._attributeSet={};L(j,v.static),L(j,v.dynamic),a._hasCount="count"in a.static||"count"in a.dynamic||"elements"in a.static||"elements"in a.dynamic}function je(a,c){var v=Ne();o(a+" in command "+(c||$e())+(v==="unknown"?"":" called from "+v))}function er(a,c,v){a||je(c,v||$e())}function Ar(a,c,v,V){a in c||je("unknown parameter ("+a+")"+y(v)+". possible values: "+Object.keys(c).join(),V||$e())}function zt(a,c,v,V){U(a,c)||je("invalid parameter type"+y(v)+". expected "+c+", got "+typeof a,V||$e())}function tr(a){a()}function Lr(a,c,v){a.texture?Ce(a.texture._texture.internalformat,c,"unsupported texture format for attachment"):Ce(a.renderbuffer._renderbuffer.format,v,"unsupported renderbuffer format for attachment")}var rr=33071,Ae=9728,We=9984,Ht=9985,$t=9986,nr=9987,br=5120,Kr=5121,Vr=5122,Or=5123,cn=5124,dn=5125,li=5126,Ke=32819,qe=32820,it=33635,st=34042,cr=36193,at={};at[br]=at[Kr]=1,at[Vr]=at[Or]=at[cr]=at[it]=at[Ke]=at[qe]=2,at[cn]=at[dn]=at[li]=at[st]=4;function Rn(a,c){return a===qe||a===Ke||a===it?2:a===st?4:at[a]*c}function Dn(a){return!(a&a-1)&&!!a}function Us(a,c,v){var V,I=c.width,L=c.height,D=c.channels;l(I>0&&I<=v.maxTextureSize&&L>0&&L<=v.maxTextureSize,"invalid texture shape"),(a.wrapS!==rr||a.wrapT!==rr)&&l(Dn(I)&&Dn(L),"incompatible wrap mode for texture, both width and height must be power of 2"),c.mipmask===1?I!==1&&L!==1&&l(a.minFilter!==We&&a.minFilter!==$t&&a.minFilter!==Ht&&a.minFilter!==nr,"min filter requires mipmap"):(l(Dn(I)&&Dn(L),"texture must be a square power of 2 to support mipmapping"),l(c.mipmask===(I<<1)-1,"missing or incomplete mipmap data")),c.type===li&&(v.extensions.indexOf("oes_texture_float_linear")<0&&l(a.minFilter===Ae&&a.magFilter===Ae,"filter not supported, must enable oes_texture_float_linear"),l(!a.genMipmaps,"mipmap generation not supported with float textures"));var j=c.images;for(V=0;V<16;++V)if(j[V]){var G=I>>V,X=L>>V;l(c.mipmask&1<<V,"missing mipmap data");var W=j[V];if(l(W.width===G&&W.height===X,"invalid shape for mip images"),l(W.format===c.format&&W.internalformat===c.internalformat&&W.type===c.type,"incompatible type for mip image"),!W.compressed)if(W.data){var Y=Math.ceil(Rn(W.type,D)*G/W.unpackAlignment)*W.unpackAlignment;l(W.data.byteLength===Y*X,"invalid data for image, buffer size is inconsistent with image format")}else W.element||W.copy}else a.genMipmaps||l((c.mipmask&1<<V)===0,"extra mipmap data");c.compressed&&l(!a.genMipmaps,"mipmap generation for compressed images not supported")}function Nu(a,c,v,V){var I=a.width,L=a.height,D=a.channels;l(I>0&&I<=V.maxTextureSize&&L>0&&L<=V.maxTextureSize,"invalid texture shape"),l(I===L,"cube map must be square"),l(c.wrapS===rr&&c.wrapT===rr,"wrap mode not supported by cube map");for(var j=0;j<v.length;++j){var G=v[j];l(G.width===I&&G.height===L,"inconsistent cube map face shape"),c.genMipmaps&&(l(!G.compressed,"can not generate mipmap for compressed textures"),l(G.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var X=G.images,W=0;W<16;++W){var Y=X[W];if(Y){var ee=I>>W,z=L>>W;l(G.mipmask&1<<W,"missing mipmap data"),l(Y.width===ee&&Y.height===z,"invalid shape for mip images"),l(Y.format===a.format&&Y.internalformat===a.internalformat&&Y.type===a.type,"incompatible type for mip image"),Y.compressed||(Y.data?l(Y.data.byteLength===ee*z*Math.max(Rn(Y.type,D),Y.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Y.element||Y.copy)}}}}var h=n(l,{optional:tr,raise:o,commandRaise:je,command:er,parameter:x,commandParameter:Ar,constructor:Ge,type:de,commandType:zt,isTypedArray:N,nni:Se,oneOf:Ce,shaderError:It,linkError:Ft,callSite:Ne,saveCommandRef:ht,saveDrawInfo:_t,framebufferFormat:Lr,guessCommand:$e,texture2D:Us,textureCube:Nu}),zs=0,Hs=0,Ks=5,no=6;function St(a,c){this.id=zs++,this.type=a,this.data=c}function ye(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Lt(a){if(a.length===0)return[];var c=a.charAt(0),v=a.charAt(a.length-1);if(a.length>1&&c===v&&(c==='"'||c==="'"))return['"'+ye(a.substr(1,a.length-2))+'"'];var V=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a);if(V)return Lt(a.substr(0,V.index)).concat(Lt(V[1])).concat(Lt(a.substr(V.index+V[0].length)));var I=a.split(".");if(I.length===1)return['"'+ye(a)+'"'];for(var L=[],D=0;D<I.length;++D)L=L.concat(Lt(I[D]));return L}function Mn(a){return"["+Lt(a).join("][")+"]"}function ir(a,c){return new St(a,Mn(c+""))}function _r(a){return typeof a=="function"&&!a._reglType||a instanceof St}function wr(a,c){if(typeof a=="function")return new St(Hs,a);if(typeof a=="number"||typeof a=="boolean")return new St(Ks,a);if(Array.isArray(a))return new St(no,a.map(function(v,V){return wr(v,c+"["+V+"]")}));if(a instanceof St)return a;h(!1,"invalid option type in uniform "+c)}var wt={DynamicVariable:St,define:ir,isDynamic:_r,unbox:wr,accessor:Mn},qr={next:typeof requestAnimationFrame=="function"?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:typeof cancelAnimationFrame=="function"?function(a){return cancelAnimationFrame(a)}:clearTimeout},hn=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function In(){var a={"":0},c=[""];return{id:function(v){var V=a[v];return V||(V=a[v]=c.length,c.push(v),V)},str:function(v){return c[v]}}}function io(a,c,v){var V=document.createElement("canvas");n(V.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),a.appendChild(V),a===document.body&&(V.style.position="absolute",n(a.style,{margin:0,padding:0}));function I(){var j=window.innerWidth,G=window.innerHeight;if(a!==document.body){var X=V.getBoundingClientRect();j=X.right-X.left,G=X.bottom-X.top}V.width=v*j,V.height=v*G}var L;a!==document.body&&typeof ResizeObserver=="function"?(L=new ResizeObserver(function(){setTimeout(I)}),L.observe(a)):window.addEventListener("resize",I,!1);function D(){L?L.disconnect():window.removeEventListener("resize",I),a.removeChild(V)}return I(),{canvas:V,onDestroy:D}}function Wf(a,c){function v(V){try{return a.getContext(V,c)}catch{return null}}return v("webgl")||v("experimental-webgl")||v("webgl-experimental")}function Zf(a){return typeof a.nodeName=="string"&&typeof a.appendChild=="function"&&typeof a.getBoundingClientRect=="function"}function Qf(a){return typeof a.drawArrays=="function"||typeof a.drawElements=="function"}function Gu(a){return typeof a=="string"?a.split():(h(Array.isArray(a),"invalid extension array"),a)}function ju(a){return typeof a=="string"?(h(typeof document<"u","not supported outside of DOM"),document.querySelector(a)):a}function Jf(a){var c=a||{},v,V,I,L,D={},j=[],G=[],X=typeof window>"u"?1:window.devicePixelRatio,W=!1,Y=function(q){q&&h.raise(q)},ee=function(){};if(typeof c=="string"?(h(typeof document<"u","selector queries only supported in DOM environments"),v=document.querySelector(c),h(v,"invalid query string for element")):typeof c=="object"?Zf(c)?v=c:Qf(c)?(L=c,I=L.canvas):(h.constructor(c),"gl"in c?L=c.gl:"canvas"in c?I=ju(c.canvas):"container"in c&&(V=ju(c.container)),"attributes"in c&&(D=c.attributes,h.type(D,"object","invalid context attributes")),"extensions"in c&&(j=Gu(c.extensions)),"optionalExtensions"in c&&(G=Gu(c.optionalExtensions)),"onDone"in c&&(h.type(c.onDone,"function","invalid or missing onDone callback"),Y=c.onDone),"profile"in c&&(W=!!c.profile),"pixelRatio"in c&&(X=+c.pixelRatio,h(X>0,"invalid pixel ratio"))):h.raise("invalid arguments to regl"),v&&(v.nodeName.toLowerCase()==="canvas"?I=v:V=v),!L){if(!I){h(typeof document<"u","must manually specify webgl context outside of DOM environments");var z=io(V||document.body,Y,X);if(!z)return null;I=z.canvas,ee=z.onDestroy}D.premultipliedAlpha===void 0&&(D.premultipliedAlpha=!0),L=Wf(I,D)}return L?{gl:L,canvas:I,container:V,extensions:j,optionalExtensions:G,pixelRatio:X,profile:W,onDone:Y,onDestroy:ee}:(ee(),Y("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function em(a,c){var v={};function V(D){h.type(D,"string","extension name must be string");var j=D.toLowerCase(),G;try{G=v[j]=a.getExtension(j)}catch{}return!!G}for(var I=0;I<c.extensions.length;++I){var L=c.extensions[I];if(!V(L))return c.onDestroy(),c.onDone('"'+L+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return c.optionalExtensions.forEach(V),{extensions:v,restore:function(){Object.keys(v).forEach(function(D){if(v[D]&&!V(D))throw new Error("(regl): error restoring extension "+D)})}}}function dr(a,c){for(var v=Array(a),V=0;V<a;++V)v[V]=c(V);return v}var tm=5120,rm=5121,nm=5122,im=5123,sm=5124,am=5125,om=5126;function lm(a){for(var c=16;c<=1<<28;c*=16)if(a<=c)return c;return 0}function Uu(a){var c,v;return c=(a>65535)<<4,a>>>=c,v=(a>255)<<3,a>>>=v,c|=v,v=(a>15)<<2,a>>>=v,c|=v,v=(a>3)<<1,a>>>=v,c|=v,c|a>>1}function zu(){var a=dr(8,function(){return[]});function c(L){var D=lm(L),j=a[Uu(D)>>2];return j.length>0?j.pop():new ArrayBuffer(D)}function v(L){a[Uu(L.byteLength)>>2].push(L)}function V(L,D){var j=null;switch(L){case tm:j=new Int8Array(c(D),0,D);break;case rm:j=new Uint8Array(c(D),0,D);break;case nm:j=new Int16Array(c(2*D),0,D);break;case im:j=new Uint16Array(c(2*D),0,D);break;case sm:j=new Int32Array(c(4*D),0,D);break;case am:j=new Uint32Array(c(4*D),0,D);break;case om:j=new Float32Array(c(4*D),0,D);break;default:return null}return j.length!==D?j.subarray(0,D):j}function I(L){v(L.buffer)}return{alloc:c,free:v,allocType:V,freeType:I}}var gt=zu();gt.zero=zu();var um=3408,cm=3410,dm=3411,hm=3412,pm=3413,fm=3414,mm=3415,vm=33901,bm=33902,_m=3379,wm=3386,gm=34921,ym=36347,xm=36348,Cm=35661,Em=35660,Pm=34930,Am=36349,Sm=34076,Tm=34024,km=7936,Lm=7937,Vm=7938,Om=35724,Rm=34047,Dm=36063,Mm=34852,qs=3553,Hu=34067,Im=34069,Fm=33984,ji=6408,so=5126,Ku=5121,ao=36160,$m=36053,Bm=36064,Nm=16384,Gm=function(a,c){var v=1;c.ext_texture_filter_anisotropic&&(v=a.getParameter(Rm));var V=1,I=1;c.webgl_draw_buffers&&(V=a.getParameter(Mm),I=a.getParameter(Dm));var L=!!c.oes_texture_float;if(L){var D=a.createTexture();a.bindTexture(qs,D),a.texImage2D(qs,0,ji,1,1,0,ji,so,null);var j=a.createFramebuffer();if(a.bindFramebuffer(ao,j),a.framebufferTexture2D(ao,Bm,qs,D,0),a.bindTexture(qs,null),a.checkFramebufferStatus(ao)!==$m)L=!1;else{a.viewport(0,0,1,1),a.clearColor(1,0,0,1),a.clear(Nm);var G=gt.allocType(so,4);a.readPixels(0,0,1,1,ji,so,G),a.getError()?L=!1:(a.deleteFramebuffer(j),a.deleteTexture(D),L=G[0]===1),gt.freeType(G)}}var X=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),W=!0;if(!X){var Y=a.createTexture(),ee=gt.allocType(Ku,36);a.activeTexture(Fm),a.bindTexture(Hu,Y),a.texImage2D(Im,0,ji,3,3,0,ji,Ku,ee),gt.freeType(ee),a.bindTexture(Hu,null),a.deleteTexture(Y),W=!a.getError()}return{colorBits:[a.getParameter(cm),a.getParameter(dm),a.getParameter(hm),a.getParameter(pm)],depthBits:a.getParameter(fm),stencilBits:a.getParameter(mm),subpixelBits:a.getParameter(um),extensions:Object.keys(c).filter(function(z){return!!c[z]}),maxAnisotropic:v,maxDrawbuffers:V,maxColorAttachments:I,pointSizeDims:a.getParameter(vm),lineWidthDims:a.getParameter(bm),maxViewportDims:a.getParameter(wm),maxCombinedTextureUnits:a.getParameter(Cm),maxCubeMapSize:a.getParameter(Sm),maxRenderbufferSize:a.getParameter(Tm),maxTextureUnits:a.getParameter(Pm),maxTextureSize:a.getParameter(_m),maxAttributes:a.getParameter(gm),maxVertexUniforms:a.getParameter(ym),maxVertexTextureUnits:a.getParameter(Em),maxVaryingVectors:a.getParameter(xm),maxFragmentUniforms:a.getParameter(Am),glsl:a.getParameter(Om),renderer:a.getParameter(Lm),vendor:a.getParameter(km),version:a.getParameter(Vm),readFloat:L,npotTextureCube:W}};function Sr(a){return!!a&&typeof a=="object"&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&typeof a.offset=="number"&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||t(a.data))}var hr=function(a){return Object.keys(a).map(function(c){return a[c]})},Xs={shape:Hm,flatten:zm};function jm(a,c,v){for(var V=0;V<c;++V)v[V]=a[V]}function Um(a,c,v,V){for(var I=0,L=0;L<c;++L)for(var D=a[L],j=0;j<v;++j)V[I++]=D[j]}function qu(a,c,v,V,I,L){for(var D=L,j=0;j<c;++j)for(var G=a[j],X=0;X<v;++X)for(var W=G[X],Y=0;Y<V;++Y)I[D++]=W[Y]}function Xu(a,c,v,V,I){for(var L=1,D=v+1;D<c.length;++D)L*=c[D];var j=c[v];if(c.length-v===4){var G=c[v+1],X=c[v+2],W=c[v+3];for(D=0;D<j;++D)qu(a[D],G,X,W,V,I),I+=L}else for(D=0;D<j;++D)Xu(a[D],c,v+1,V,I),I+=L}function zm(a,c,v,V){var I=1;if(c.length)for(var L=0;L<c.length;++L)I*=c[L];else I=0;var D=V||gt.allocType(v,I);switch(c.length){case 0:break;case 1:jm(a,c[0],D);break;case 2:Um(a,c[0],c[1],D);break;case 3:qu(a,c[0],c[1],c[2],D,0);break;default:Xu(a,c,0,D,0)}return D}function Hm(a){for(var c=[],v=a;v.length;v=v[0])c.push(v.length);return c}var oo={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Km=5120,qm=5122,Xm=5124,Ym=5121,Wm=5123,Zm=5125,Qm=5126,Jm=5126,Fn={int8:Km,int16:qm,int32:Xm,uint8:Ym,uint16:Wm,uint32:Zm,float:Qm,float32:Jm},ev=35048,tv=35040,Ys={dynamic:ev,stream:tv,static:35044},lo=Xs.flatten,Yu=Xs.shape,Wu=35044,rv=35040,uo=5121,co=5126,pn=[];pn[5120]=1,pn[5122]=2,pn[5124]=4,pn[5121]=1,pn[5123]=2,pn[5125]=4,pn[5126]=4;function Ws(a){return oo[Object.prototype.toString.call(a)]|0}function Zu(a,c){for(var v=0;v<c.length;++v)a[v]=c[v]}function Qu(a,c,v,V,I,L,D){for(var j=0,G=0;G<v;++G)for(var X=0;X<V;++X)a[j++]=c[I*G+L*X+D]}function nv(a,c,v,V){var I=0,L={};function D(P){this.id=I++,this.buffer=a.createBuffer(),this.type=P,this.usage=Wu,this.byteLength=0,this.dimension=1,this.dtype=uo,this.persistentData=null,v.profile&&(this.stats={size:0})}D.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)},D.prototype.destroy=function(){ee(this)};var j=[];function G(P,R){var K=j.pop();return K||(K=new D(P)),K.bind(),Y(K,R,rv,0,1,!1),K}function X(P){j.push(P)}function W(P,R,K){P.byteLength=R.byteLength,a.bufferData(P.type,R,K)}function Y(P,R,K,ue,B,oe){var ie;if(P.usage=K,Array.isArray(R)){if(P.dtype=ue||co,R.length>0){var ge;if(Array.isArray(R[0])){ie=Yu(R);for(var F=1,M=1;M<ie.length;++M)F*=ie[M];P.dimension=F,ge=lo(R,ie,P.dtype),W(P,ge,K),oe?P.persistentData=ge:gt.freeType(ge)}else if(typeof R[0]=="number"){P.dimension=B;var pe=gt.allocType(P.dtype,R.length);Zu(pe,R),W(P,pe,K),oe?P.persistentData=pe:gt.freeType(pe)}else t(R[0])?(P.dimension=R[0].length,P.dtype=ue||Ws(R[0])||co,ge=lo(R,[R.length,R[0].length],P.dtype),W(P,ge,K),oe?P.persistentData=ge:gt.freeType(ge)):h.raise("invalid buffer data")}}else if(t(R))P.dtype=ue||Ws(R),P.dimension=B,W(P,R,K),oe&&(P.persistentData=new Uint8Array(new Uint8Array(R.buffer)));else if(Sr(R)){ie=R.shape;var te=R.stride,H=R.offset,re=0,ne=0,Le=0,Te=0;ie.length===1?(re=ie[0],ne=1,Le=te[0],Te=0):ie.length===2?(re=ie[0],ne=ie[1],Le=te[0],Te=te[1]):h.raise("invalid shape"),P.dtype=ue||Ws(R.data)||co,P.dimension=ne;var se=gt.allocType(P.dtype,re*ne);Qu(se,R.data,re,ne,Le,Te,H),W(P,se,K),oe?P.persistentData=se:gt.freeType(se)}else R instanceof ArrayBuffer?(P.dtype=uo,P.dimension=B,W(P,R,K),oe&&(P.persistentData=new Uint8Array(new Uint8Array(R)))):h.raise("invalid buffer data")}function ee(P){c.bufferCount--,V(P);var R=P.buffer;h(R,"buffer must not be deleted already"),a.deleteBuffer(R),P.buffer=null,delete L[P.id]}function z(P,R,K,ue){c.bufferCount++;var B=new D(R);L[B.id]=B;function oe(F){var M=Wu,pe=null,te=0,H=0,re=1;return Array.isArray(F)||t(F)||Sr(F)||F instanceof ArrayBuffer?pe=F:typeof F=="number"?te=F|0:F&&(h.type(F,"object","buffer arguments must be an object, a number or an array"),"data"in F&&(h(pe===null||Array.isArray(pe)||t(pe)||Sr(pe),"invalid data for buffer"),pe=F.data),"usage"in F&&(h.parameter(F.usage,Ys,"invalid buffer usage"),M=Ys[F.usage]),"type"in F&&(h.parameter(F.type,Fn,"invalid buffer type"),H=Fn[F.type]),"dimension"in F&&(h.type(F.dimension,"number","invalid dimension"),re=F.dimension|0),"length"in F&&(h.nni(te,"buffer length must be a nonnegative integer"),te=F.length|0)),B.bind(),pe?Y(B,pe,M,H,re,ue):(te&&a.bufferData(B.type,te,M),B.dtype=H||uo,B.usage=M,B.dimension=re,B.byteLength=te),v.profile&&(B.stats.size=B.byteLength*pn[B.dtype]),oe}function ie(F,M){h(M+F.byteLength<=B.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+F.byteLength+" starting from offset "+M+" to a buffer of size "+B.byteLength),a.bufferSubData(B.type,M,F)}function ge(F,M){var pe=(M||0)|0,te;if(B.bind(),t(F)||F instanceof ArrayBuffer)ie(F,pe);else if(Array.isArray(F)){if(F.length>0)if(typeof F[0]=="number"){var H=gt.allocType(B.dtype,F.length);Zu(H,F),ie(H,pe),gt.freeType(H)}else if(Array.isArray(F[0])||t(F[0])){te=Yu(F);var re=lo(F,te,B.dtype);ie(re,pe),gt.freeType(re)}else h.raise("invalid buffer data")}else if(Sr(F)){te=F.shape;var ne=F.stride,Le=0,Te=0,se=0,le=0;te.length===1?(Le=te[0],Te=1,se=ne[0],le=0):te.length===2?(Le=te[0],Te=te[1],se=ne[0],le=ne[1]):h.raise("invalid shape");var Ee=Array.isArray(F.data)?B.dtype:Ws(F.data),ke=gt.allocType(Ee,Le*Te);Qu(ke,F.data,Le,Te,se,le,F.offset),ie(ke,pe),gt.freeType(ke)}else h.raise("invalid data for buffer subdata");return oe}return K||oe(P),oe._reglType="buffer",oe._buffer=B,oe.subdata=ge,v.profile&&(oe.stats=B.stats),oe.destroy=function(){ee(B)},oe}function q(){hr(L).forEach(function(P){P.buffer=a.createBuffer(),a.bindBuffer(P.type,P.buffer),a.bufferData(P.type,P.persistentData||P.byteLength,P.usage)})}return v.profile&&(c.getTotalBufferSize=function(){var P=0;return Object.keys(L).forEach(function(R){P+=L[R].stats.size}),P}),{create:z,createStream:G,destroyStream:X,clear:function(){hr(L).forEach(ee),j.forEach(ee)},getBuffer:function(P){return P&&P._buffer instanceof D?P._buffer:null},restore:q,_initBuffer:Y}}var iv=0,sv=0,av=1,ov=1,lv=4,uv=4,fn={points:iv,point:sv,lines:av,line:ov,triangles:lv,triangle:uv,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},cv=0,dv=1,Ui=4,hv=5120,ui=5121,Ju=5122,ci=5123,ec=5124,$n=5125,ho=34963,pv=35040,fv=35044;function mv(a,c,v,V){var I={},L=0,D={uint8:ui,uint16:ci};c.oes_element_index_uint&&(D.uint32=$n);function j(q){this.id=L++,I[this.id]=this,this.buffer=q,this.primType=Ui,this.vertCount=0,this.type=0}j.prototype.bind=function(){this.buffer.bind()};var G=[];function X(q){var P=G.pop();return P||(P=new j(v.create(null,ho,!0,!1)._buffer)),Y(P,q,pv,-1,-1,0,0),P}function W(q){G.push(q)}function Y(q,P,R,K,ue,B,oe){q.buffer.bind();var ie;if(P){var ge=oe;!oe&&(!t(P)||Sr(P)&&!t(P.data))&&(ge=c.oes_element_index_uint?$n:ci),v._initBuffer(q.buffer,P,R,ge,3)}else a.bufferData(ho,B,R),q.buffer.dtype=ie||ui,q.buffer.usage=R,q.buffer.dimension=3,q.buffer.byteLength=B;if(ie=oe,!oe){switch(q.buffer.dtype){case ui:case hv:ie=ui;break;case ci:case Ju:ie=ci;break;case $n:case ec:ie=$n;break;default:h.raise("unsupported type for element array")}q.buffer.dtype=ie}q.type=ie,h(ie!==$n||!!c.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var F=ue;F<0&&(F=q.buffer.byteLength,ie===ci?F>>=1:ie===$n&&(F>>=2)),q.vertCount=F;var M=K;if(K<0){M=Ui;var pe=q.buffer.dimension;pe===1&&(M=cv),pe===2&&(M=dv),pe===3&&(M=Ui)}q.primType=M}function ee(q){V.elementsCount--,h(q.buffer!==null,"must not double destroy elements"),delete I[q.id],q.buffer.destroy(),q.buffer=null}function z(q,P){var R=v.create(null,ho,!0),K=new j(R._buffer);V.elementsCount++;function ue(B){if(!B)R(),K.primType=Ui,K.vertCount=0,K.type=ui;else if(typeof B=="number")R(B),K.primType=Ui,K.vertCount=B|0,K.type=ui;else{var oe=null,ie=fv,ge=-1,F=-1,M=0,pe=0;Array.isArray(B)||t(B)||Sr(B)?oe=B:(h.type(B,"object","invalid arguments for elements"),"data"in B&&(oe=B.data,h(Array.isArray(oe)||t(oe)||Sr(oe),"invalid data for element buffer")),"usage"in B&&(h.parameter(B.usage,Ys,"invalid element buffer usage"),ie=Ys[B.usage]),"primitive"in B&&(h.parameter(B.primitive,fn,"invalid element buffer primitive"),ge=fn[B.primitive]),"count"in B&&(h(typeof B.count=="number"&&B.count>=0,"invalid vertex count for elements"),F=B.count|0),"type"in B&&(h.parameter(B.type,D,"invalid buffer type"),pe=D[B.type]),"length"in B?M=B.length|0:(M=F,pe===ci||pe===Ju?M*=2:(pe===$n||pe===ec)&&(M*=4))),Y(K,oe,ie,ge,F,M,pe)}return ue}return ue(q),ue._reglType="elements",ue._elements=K,ue.subdata=function(B,oe){return R.subdata(B,oe),ue},ue.destroy=function(){ee(K)},ue}return{create:z,createStream:X,destroyStream:W,getElements:function(q){return typeof q=="function"&&q._elements instanceof j?q._elements:null},clear:function(){hr(I).forEach(ee)}}}var tc=new Float32Array(1),vv=new Uint32Array(tc.buffer),bv=5123;function rc(a){for(var c=gt.allocType(bv,a.length),v=0;v<a.length;++v)if(isNaN(a[v]))c[v]=65535;else if(a[v]===1/0)c[v]=31744;else if(a[v]===-1/0)c[v]=64512;else{tc[0]=a[v];var V=vv[0],I=V>>>31<<15,L=(V<<1>>>24)-127,D=V>>13&1023;if(L<-24)c[v]=I;else if(L<-14){var j=-14-L;c[v]=I+(D+1024>>j)}else L>15?c[v]=I+31744:c[v]=I+(L+15<<10)+D}return c}function pt(a){return Array.isArray(a)||t(a)}var nc=function(a){return!(a&a-1)&&!!a},_v=34467,Rr=3553,po=34067,Zs=34069,Bn=6408,fo=6406,Qs=6407,zi=6409,Js=6410,ic=32854,mo=32855,sc=36194,wv=32819,gv=32820,yv=33635,xv=34042,vo=6402,ea=34041,bo=35904,_o=35906,di=36193,wo=33776,go=33777,yo=33778,xo=33779,ac=35986,oc=35987,lc=34798,uc=35840,cc=35841,dc=35842,hc=35843,pc=36196,hi=5121,Co=5123,Eo=5125,Hi=5126,Cv=10242,Ev=10243,Pv=10497,Po=33071,Av=33648,Sv=10240,Tv=10241,Ao=9728,kv=9729,So=9984,fc=9985,mc=9986,To=9987,Lv=33170,ta=4352,Vv=4353,Ov=4354,Rv=34046,Dv=3317,Mv=37440,Iv=37441,Fv=37443,vc=37444,Ki=33984,$v=[So,mc,fc,To],ra=[0,zi,Js,Qs,Bn],gr={};gr[zi]=gr[fo]=gr[vo]=1,gr[ea]=gr[Js]=2,gr[Qs]=gr[bo]=3,gr[Bn]=gr[_o]=4;function pi(a){return"[object "+a+"]"}var bc=pi("HTMLCanvasElement"),_c=pi("OffscreenCanvas"),wc=pi("CanvasRenderingContext2D"),gc=pi("ImageBitmap"),yc=pi("HTMLImageElement"),xc=pi("HTMLVideoElement"),Bv=Object.keys(oo).concat([bc,_c,wc,gc,yc,xc]),fi=[];fi[hi]=1,fi[Hi]=4,fi[di]=2,fi[Co]=2,fi[Eo]=4;var Bt=[];Bt[ic]=2,Bt[mo]=2,Bt[sc]=2,Bt[ea]=4,Bt[wo]=.5,Bt[go]=.5,Bt[yo]=1,Bt[xo]=1,Bt[ac]=.5,Bt[oc]=1,Bt[lc]=1,Bt[uc]=.5,Bt[cc]=.25,Bt[dc]=.5,Bt[hc]=.25,Bt[pc]=.5;function Cc(a){return Array.isArray(a)&&(a.length===0||typeof a[0]=="number")}function Ec(a){if(!Array.isArray(a))return!1;var c=a.length;return!(c===0||!pt(a[0]))}function Nn(a){return Object.prototype.toString.call(a)}function Pc(a){return Nn(a)===bc}function Ac(a){return Nn(a)===_c}function Nv(a){return Nn(a)===wc}function Gv(a){return Nn(a)===gc}function jv(a){return Nn(a)===yc}function Uv(a){return Nn(a)===xc}function ko(a){if(!a)return!1;var c=Nn(a);return Bv.indexOf(c)>=0?!0:Cc(a)||Ec(a)||Sr(a)}function Sc(a){return oo[Object.prototype.toString.call(a)]|0}function zv(a,c){var v=c.length;switch(a.type){case hi:case Co:case Eo:case Hi:var V=gt.allocType(a.type,v);V.set(c),a.data=V;break;case di:a.data=rc(c);break;default:h.raise("unsupported texture type, must specify a typed array")}}function Tc(a,c){return gt.allocType(a.type===di?Hi:a.type,c)}function kc(a,c){a.type===di?(a.data=rc(c),gt.freeType(c)):a.data=c}function Hv(a,c,v,V,I,L){for(var D=a.width,j=a.height,G=a.channels,X=D*j*G,W=Tc(a,X),Y=0,ee=0;ee<j;++ee)for(var z=0;z<D;++z)for(var q=0;q<G;++q)W[Y++]=c[v*z+V*ee+I*q+L];kc(a,W)}function na(a,c,v,V,I,L){var D;if(typeof Bt[a]<"u"?D=Bt[a]:D=gr[a]*fi[c],L&&(D*=6),I){for(var j=0,G=v;G>=1;)j+=D*G*G,G/=2;return j}else return D*v*V}function Kv(a,c,v,V,I,L,D){var j={"don't care":ta,"dont care":ta,nice:Ov,fast:Vv},G={repeat:Pv,clamp:Po,mirror:Av},X={nearest:Ao,linear:kv},W=n({mipmap:To,"nearest mipmap nearest":So,"linear mipmap nearest":fc,"nearest mipmap linear":mc,"linear mipmap linear":To},X),Y={none:0,browser:vc},ee={uint8:hi,rgba4:wv,rgb565:yv,"rgb5 a1":gv},z={alpha:fo,luminance:zi,"luminance alpha":Js,rgb:Qs,rgba:Bn,rgba4:ic,"rgb5 a1":mo,rgb565:sc},q={};c.ext_srgb&&(z.srgb=bo,z.srgba=_o),c.oes_texture_float&&(ee.float32=ee.float=Hi),c.oes_texture_half_float&&(ee.float16=ee["half float"]=di),c.webgl_depth_texture&&(n(z,{depth:vo,"depth stencil":ea}),n(ee,{uint16:Co,uint32:Eo,"depth stencil":xv})),c.webgl_compressed_texture_s3tc&&n(q,{"rgb s3tc dxt1":wo,"rgba s3tc dxt1":go,"rgba s3tc dxt3":yo,"rgba s3tc dxt5":xo}),c.webgl_compressed_texture_atc&&n(q,{"rgb atc":ac,"rgba atc explicit alpha":oc,"rgba atc interpolated alpha":lc}),c.webgl_compressed_texture_pvrtc&&n(q,{"rgb pvrtc 4bppv1":uc,"rgb pvrtc 2bppv1":cc,"rgba pvrtc 4bppv1":dc,"rgba pvrtc 2bppv1":hc}),c.webgl_compressed_texture_etc1&&(q["rgb etc1"]=pc);var P=Array.prototype.slice.call(a.getParameter(_v));Object.keys(q).forEach(function(m){var O=q[m];P.indexOf(O)>=0&&(z[m]=O)});var R=Object.keys(z);v.textureFormats=R;var K=[];Object.keys(z).forEach(function(m){var O=z[m];K[O]=m});var ue=[];Object.keys(ee).forEach(function(m){var O=ee[m];ue[O]=m});var B=[];Object.keys(X).forEach(function(m){var O=X[m];B[O]=m});var oe=[];Object.keys(W).forEach(function(m){var O=W[m];oe[O]=m});var ie=[];Object.keys(G).forEach(function(m){var O=G[m];ie[O]=m});var ge=R.reduce(function(m,O){var k=z[O];return k===zi||k===fo||k===zi||k===Js||k===vo||k===ea||c.ext_srgb&&(k===bo||k===_o)?m[k]=k:k===mo||O.indexOf("rgba")>=0?m[k]=Bn:m[k]=Qs,m},{});function F(){this.internalformat=Bn,this.format=Bn,this.type=hi,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=vc,this.width=0,this.height=0,this.channels=0}function M(m,O){m.internalformat=O.internalformat,m.format=O.format,m.type=O.type,m.compressed=O.compressed,m.premultiplyAlpha=O.premultiplyAlpha,m.flipY=O.flipY,m.unpackAlignment=O.unpackAlignment,m.colorSpace=O.colorSpace,m.width=O.width,m.height=O.height,m.channels=O.channels}function pe(m,O){if(!(typeof O!="object"||!O)){if("premultiplyAlpha"in O&&(h.type(O.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),m.premultiplyAlpha=O.premultiplyAlpha),"flipY"in O&&(h.type(O.flipY,"boolean","invalid texture flip"),m.flipY=O.flipY),"alignment"in O&&(h.oneOf(O.alignment,[1,2,4,8],"invalid texture unpack alignment"),m.unpackAlignment=O.alignment),"colorSpace"in O&&(h.parameter(O.colorSpace,Y,"invalid colorSpace"),m.colorSpace=Y[O.colorSpace]),"type"in O){var k=O.type;h(c.oes_texture_float||!(k==="float"||k==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),h(c.oes_texture_half_float||!(k==="half float"||k==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),h(c.webgl_depth_texture||!(k==="uint16"||k==="uint32"||k==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),h.parameter(k,ee,"invalid texture type"),m.type=ee[k]}var he=m.width,Re=m.height,p=m.channels,u=!1;"shape"in O?(h(Array.isArray(O.shape)&&O.shape.length>=2,"shape must be an array"),he=O.shape[0],Re=O.shape[1],O.shape.length===3&&(p=O.shape[2],h(p>0&&p<=4,"invalid number of channels"),u=!0),h(he>=0&&he<=v.maxTextureSize,"invalid width"),h(Re>=0&&Re<=v.maxTextureSize,"invalid height")):("radius"in O&&(he=Re=O.radius,h(he>=0&&he<=v.maxTextureSize,"invalid radius")),"width"in O&&(he=O.width,h(he>=0&&he<=v.maxTextureSize,"invalid width")),"height"in O&&(Re=O.height,h(Re>=0&&Re<=v.maxTextureSize,"invalid height")),"channels"in O&&(p=O.channels,h(p>0&&p<=4,"invalid number of channels"),u=!0)),m.width=he|0,m.height=Re|0,m.channels=p|0;var _=!1;if("format"in O){var E=O.format;h(c.webgl_depth_texture||!(E==="depth"||E==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),h.parameter(E,z,"invalid texture format");var S=m.internalformat=z[E];m.format=ge[S],E in ee&&("type"in O||(m.type=ee[E])),E in q&&(m.compressed=!0),_=!0}!u&&_?m.channels=gr[m.format]:u&&!_?m.channels!==ra[m.format]&&(m.format=m.internalformat=ra[m.channels]):_&&u&&h(m.channels===gr[m.format],"number of channels inconsistent with specified format")}}function te(m){a.pixelStorei(Mv,m.flipY),a.pixelStorei(Iv,m.premultiplyAlpha),a.pixelStorei(Fv,m.colorSpace),a.pixelStorei(Dv,m.unpackAlignment)}function H(){F.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function re(m,O){var k=null;if(ko(O)?k=O:O&&(h.type(O,"object","invalid pixel data type"),pe(m,O),"x"in O&&(m.xOffset=O.x|0),"y"in O&&(m.yOffset=O.y|0),ko(O.data)&&(k=O.data)),h(!m.compressed||k instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),O.copy){h(!k,"can not specify copy and data field for the same texture");var he=I.viewportWidth,Re=I.viewportHeight;m.width=m.width||he-m.xOffset,m.height=m.height||Re-m.yOffset,m.needsCopy=!0,h(m.xOffset>=0&&m.xOffset<he&&m.yOffset>=0&&m.yOffset<Re&&m.width>0&&m.width<=he&&m.height>0&&m.height<=Re,"copy texture read out of bounds")}else if(!k)m.width=m.width||1,m.height=m.height||1,m.channels=m.channels||4;else if(t(k))m.channels=m.channels||4,m.data=k,!("type"in O)&&m.type===hi&&(m.type=Sc(k));else if(Cc(k))m.channels=m.channels||4,zv(m,k),m.alignment=1,m.needsFree=!0;else if(Sr(k)){var p=k.data;!Array.isArray(p)&&m.type===hi&&(m.type=Sc(p));var u=k.shape,_=k.stride,E,S,g,w,C,d;u.length===3?(g=u[2],d=_[2]):(h(u.length===2,"invalid ndarray pixel data, must be 2 or 3D"),g=1,d=1),E=u[0],S=u[1],w=_[0],C=_[1],m.alignment=1,m.width=E,m.height=S,m.channels=g,m.format=m.internalformat=ra[g],m.needsFree=!0,Hv(m,p,w,C,d,k.offset)}else if(Pc(k)||Ac(k)||Nv(k))Pc(k)||Ac(k)?m.element=k:m.element=k.canvas,m.width=m.element.width,m.height=m.element.height,m.channels=4;else if(Gv(k))m.element=k,m.width=k.width,m.height=k.height,m.channels=4;else if(jv(k))m.element=k,m.width=k.naturalWidth,m.height=k.naturalHeight,m.channels=4;else if(Uv(k))m.element=k,m.width=k.videoWidth,m.height=k.videoHeight,m.channels=4;else if(Ec(k)){var b=m.width||k[0].length,f=m.height||k.length,A=m.channels;pt(k[0][0])?A=A||k[0][0].length:A=A||1;for(var T=Xs.shape(k),$=1,Q=0;Q<T.length;++Q)$*=T[Q];var J=Tc(m,$);Xs.flatten(k,T,"",J),kc(m,J),m.alignment=1,m.width=b,m.height=f,m.channels=A,m.format=m.internalformat=ra[A],m.needsFree=!0}m.type===Hi?h(v.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):m.type===di&&h(v.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function ne(m,O,k){var he=m.element,Re=m.data,p=m.internalformat,u=m.format,_=m.type,E=m.width,S=m.height;te(m),he?a.texImage2D(O,k,u,u,_,he):m.compressed?a.compressedTexImage2D(O,k,p,E,S,0,Re):m.needsCopy?(V(),a.copyTexImage2D(O,k,u,m.xOffset,m.yOffset,E,S,0)):a.texImage2D(O,k,u,E,S,0,u,_,Re||null)}function Le(m,O,k,he,Re){var p=m.element,u=m.data,_=m.internalformat,E=m.format,S=m.type,g=m.width,w=m.height;te(m),p?a.texSubImage2D(O,Re,k,he,E,S,p):m.compressed?a.compressedTexSubImage2D(O,Re,k,he,_,g,w,u):m.needsCopy?(V(),a.copyTexSubImage2D(O,Re,k,he,m.xOffset,m.yOffset,g,w)):a.texSubImage2D(O,Re,k,he,g,w,E,S,u)}var Te=[];function se(){return Te.pop()||new H}function le(m){m.needsFree&&gt.freeType(m.data),H.call(m),Te.push(m)}function Ee(){F.call(this),this.genMipmaps=!1,this.mipmapHint=ta,this.mipmask=0,this.images=Array(16)}function ke(m,O,k){var he=m.images[0]=se();m.mipmask=1,he.width=m.width=O,he.height=m.height=k,he.channels=m.channels=4}function De(m,O){var k=null;if(ko(O))k=m.images[0]=se(),M(k,m),re(k,O),m.mipmask=1;else if(pe(m,O),Array.isArray(O.mipmap))for(var he=O.mipmap,Re=0;Re<he.length;++Re)k=m.images[Re]=se(),M(k,m),k.width>>=Re,k.height>>=Re,re(k,he[Re]),m.mipmask|=1<<Re;else k=m.images[0]=se(),M(k,m),re(k,O),m.mipmask=1;M(m,m.images[0]),m.compressed&&(m.internalformat===wo||m.internalformat===go||m.internalformat===yo||m.internalformat===xo)&&h(m.width%4===0&&m.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function lt(m,O){for(var k=m.images,he=0;he<k.length;++he){if(!k[he])return;ne(k[he],O,he)}}var ct=[];function Fe(){var m=ct.pop()||new Ee;F.call(m),m.mipmask=0;for(var O=0;O<16;++O)m.images[O]=null;return m}function Ct(m){for(var O=m.images,k=0;k<O.length;++k)O[k]&&le(O[k]),O[k]=null;ct.push(m)}function ot(){this.minFilter=Ao,this.magFilter=Ao,this.wrapS=Po,this.wrapT=Po,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ta}function xt(m,O){if("min"in O){var k=O.min;h.parameter(k,W),m.minFilter=W[k],$v.indexOf(m.minFilter)>=0&&!("faces"in O)&&(m.genMipmaps=!0)}if("mag"in O){var he=O.mag;h.parameter(he,X),m.magFilter=X[he]}var Re=m.wrapS,p=m.wrapT;if("wrap"in O){var u=O.wrap;typeof u=="string"?(h.parameter(u,G),Re=p=G[u]):Array.isArray(u)&&(h.parameter(u[0],G),h.parameter(u[1],G),Re=G[u[0]],p=G[u[1]])}else{if("wrapS"in O){var _=O.wrapS;h.parameter(_,G),Re=G[_]}if("wrapT"in O){var E=O.wrapT;h.parameter(E,G),p=G[E]}}if(m.wrapS=Re,m.wrapT=p,"anisotropic"in O){var S=O.anisotropic;h(typeof S=="number"&&S>=1&&S<=v.maxAnisotropic,"aniso samples must be between 1 and "),m.anisotropic=O.anisotropic}if("mipmap"in O){var g=!1;switch(typeof O.mipmap){case"string":h.parameter(O.mipmap,j,"invalid mipmap hint"),m.mipmapHint=j[O.mipmap],m.genMipmaps=!0,g=!0;break;case"boolean":g=m.genMipmaps=O.mipmap;break;case"object":h(Array.isArray(O.mipmap),"invalid mipmap type"),m.genMipmaps=!1,g=!0;break;default:h.raise("invalid mipmap type")}g&&!("min"in O)&&(m.minFilter=So)}}function Et(m,O){a.texParameteri(O,Tv,m.minFilter),a.texParameteri(O,Sv,m.magFilter),a.texParameteri(O,Cv,m.wrapS),a.texParameteri(O,Ev,m.wrapT),c.ext_texture_filter_anisotropic&&a.texParameteri(O,Rv,m.anisotropic),m.genMipmaps&&(a.hint(Lv,m.mipmapHint),a.generateMipmap(O))}var Pt=0,Vt={},Nt=v.maxTextureUnits,ft=Array(Nt).map(function(){return null});function Oe(m){F.call(this),this.mipmask=0,this.internalformat=Bn,this.id=Pt++,this.refCount=1,this.target=m,this.texture=a.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ot,D.profile&&(this.stats={size:0})}function Gt(m){a.activeTexture(Ki),a.bindTexture(m.target,m.texture)}function ze(){var m=ft[0];m?a.bindTexture(m.target,m.texture):a.bindTexture(Rr,null)}function xe(m){var O=m.texture;h(O,"must not double destroy texture");var k=m.unit,he=m.target;k>=0&&(a.activeTexture(Ki+k),a.bindTexture(he,null),ft[k]=null),a.deleteTexture(O),m.texture=null,m.params=null,m.pixels=null,m.refCount=0,delete Vt[m.id],L.textureCount--}n(Oe.prototype,{bind:function(){var m=this;m.bindCount+=1;var O=m.unit;if(O<0){for(var k=0;k<Nt;++k){var he=ft[k];if(he){if(he.bindCount>0)continue;he.unit=-1}ft[k]=m,O=k;break}O>=Nt&&h.raise("insufficient number of texture units"),D.profile&&L.maxTextureUnits<O+1&&(L.maxTextureUnits=O+1),m.unit=O,a.activeTexture(Ki+O),a.bindTexture(m.target,m.texture)}return O},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&xe(this)}});function Me(m,O){var k=new Oe(Rr);Vt[k.id]=k,L.textureCount++;function he(u,_){var E=k.texInfo;ot.call(E);var S=Fe();return typeof u=="number"?typeof _=="number"?ke(S,u|0,_|0):ke(S,u|0,u|0):u?(h.type(u,"object","invalid arguments to regl.texture"),xt(E,u),De(S,u)):ke(S,1,1),E.genMipmaps&&(S.mipmask=(S.width<<1)-1),k.mipmask=S.mipmask,M(k,S),h.texture2D(E,S,v),k.internalformat=S.internalformat,he.width=S.width,he.height=S.height,Gt(k),lt(S,Rr),Et(E,Rr),ze(),Ct(S),D.profile&&(k.stats.size=na(k.internalformat,k.type,S.width,S.height,E.genMipmaps,!1)),he.format=K[k.internalformat],he.type=ue[k.type],he.mag=B[E.magFilter],he.min=oe[E.minFilter],he.wrapS=ie[E.wrapS],he.wrapT=ie[E.wrapT],he}function Re(u,_,E,S){h(!!u,"must specify image data");var g=_|0,w=E|0,C=S|0,d=se();return M(d,k),d.width=0,d.height=0,re(d,u),d.width=d.width||(k.width>>C)-g,d.height=d.height||(k.height>>C)-w,h(k.type===d.type&&k.format===d.format&&k.internalformat===d.internalformat,"incompatible format for texture.subimage"),h(g>=0&&w>=0&&g+d.width<=k.width&&w+d.height<=k.height,"texture.subimage write out of bounds"),h(k.mipmask&1<<C,"missing mipmap data"),h(d.data||d.element||d.needsCopy,"missing image data"),Gt(k),Le(d,Rr,g,w,C),ze(),le(d),he}function p(u,_){var E=u|0,S=_|0||E;if(E===k.width&&S===k.height)return he;he.width=k.width=E,he.height=k.height=S,Gt(k);for(var g=0;k.mipmask>>g;++g){var w=E>>g,C=S>>g;if(!w||!C)break;a.texImage2D(Rr,g,k.format,w,C,0,k.format,k.type,null)}return ze(),D.profile&&(k.stats.size=na(k.internalformat,k.type,E,S,!1,!1)),he}return he(m,O),he.subimage=Re,he.resize=p,he._reglType="texture2d",he._texture=k,D.profile&&(he.stats=k.stats),he.destroy=function(){k.decRef()},he}function Be(m,O,k,he,Re,p){var u=new Oe(po);Vt[u.id]=u,L.cubeCount++;var _=new Array(6);function E(w,C,d,b,f,A){var T,$=u.texInfo;for(ot.call($),T=0;T<6;++T)_[T]=Fe();if(typeof w=="number"||!w){var Q=w|0||1;for(T=0;T<6;++T)ke(_[T],Q,Q)}else if(typeof w=="object")if(C)De(_[0],w),De(_[1],C),De(_[2],d),De(_[3],b),De(_[4],f),De(_[5],A);else if(xt($,w),pe(u,w),"faces"in w){var J=w.faces;for(h(Array.isArray(J)&&J.length===6,"cube faces must be a length 6 array"),T=0;T<6;++T)h(typeof J[T]=="object"&&!!J[T],"invalid input for cube map face"),M(_[T],u),De(_[T],J[T])}else for(T=0;T<6;++T)De(_[T],w);else h.raise("invalid arguments to cube map");for(M(u,_[0]),h.optional(function(){v.npotTextureCube||h(nc(u.width)&&nc(u.height),"your browser does not support non power or two texture dimensions")}),$.genMipmaps?u.mipmask=(_[0].width<<1)-1:u.mipmask=_[0].mipmask,h.textureCube(u,$,_,v),u.internalformat=_[0].internalformat,E.width=_[0].width,E.height=_[0].height,Gt(u),T=0;T<6;++T)lt(_[T],Zs+T);for(Et($,po),ze(),D.profile&&(u.stats.size=na(u.internalformat,u.type,E.width,E.height,$.genMipmaps,!0)),E.format=K[u.internalformat],E.type=ue[u.type],E.mag=B[$.magFilter],E.min=oe[$.minFilter],E.wrapS=ie[$.wrapS],E.wrapT=ie[$.wrapT],T=0;T<6;++T)Ct(_[T]);return E}function S(w,C,d,b,f){h(!!C,"must specify image data"),h(typeof w=="number"&&w===(w|0)&&w>=0&&w<6,"invalid face");var A=d|0,T=b|0,$=f|0,Q=se();return M(Q,u),Q.width=0,Q.height=0,re(Q,C),Q.width=Q.width||(u.width>>$)-A,Q.height=Q.height||(u.height>>$)-T,h(u.type===Q.type&&u.format===Q.format&&u.internalformat===Q.internalformat,"incompatible format for texture.subimage"),h(A>=0&&T>=0&&A+Q.width<=u.width&&T+Q.height<=u.height,"texture.subimage write out of bounds"),h(u.mipmask&1<<$,"missing mipmap data"),h(Q.data||Q.element||Q.needsCopy,"missing image data"),Gt(u),Le(Q,Zs+w,A,T,$),ze(),le(Q),E}function g(w){var C=w|0;if(C!==u.width){E.width=u.width=C,E.height=u.height=C,Gt(u);for(var d=0;d<6;++d)for(var b=0;u.mipmask>>b;++b)a.texImage2D(Zs+d,b,u.format,C>>b,C>>b,0,u.format,u.type,null);return ze(),D.profile&&(u.stats.size=na(u.internalformat,u.type,E.width,E.height,!1,!0)),E}}return E(m,O,k,he,Re,p),E.subimage=S,E.resize=g,E._reglType="textureCube",E._texture=u,D.profile&&(E.stats=u.stats),E.destroy=function(){u.decRef()},E}function mt(){for(var m=0;m<Nt;++m)a.activeTexture(Ki+m),a.bindTexture(Rr,null),ft[m]=null;hr(Vt).forEach(xe),L.cubeCount=0,L.textureCount=0}D.profile&&(L.getTotalTextureSize=function(){var m=0;return Object.keys(Vt).forEach(function(O){m+=Vt[O].stats.size}),m});function Mr(){for(var m=0;m<Nt;++m){var O=ft[m];O&&(O.bindCount=0,O.unit=-1,ft[m]=null)}hr(Vt).forEach(function(k){k.texture=a.createTexture(),a.bindTexture(k.target,k.texture);for(var he=0;he<32;++he)if(k.mipmask&1<<he)if(k.target===Rr)a.texImage2D(Rr,he,k.internalformat,k.width>>he,k.height>>he,0,k.internalformat,k.type,null);else for(var Re=0;Re<6;++Re)a.texImage2D(Zs+Re,he,k.internalformat,k.width>>he,k.height>>he,0,k.internalformat,k.type,null);Et(k.texInfo,k.target)})}function qn(){for(var m=0;m<Nt;++m){var O=ft[m];O&&(O.bindCount=0,O.unit=-1,ft[m]=null),a.activeTexture(Ki+m),a.bindTexture(Rr,null),a.bindTexture(po,null)}}return{create2D:Me,createCube:Be,clear:mt,getTexture:function(m){return null},restore:Mr,refresh:qn}}var mn=36161,ia=32854,Lc=32855,Vc=36194,Oc=33189,Rc=36168,Dc=34041,Mc=35907,Ic=34836,Fc=34842,$c=34843,Tr=[];Tr[ia]=2,Tr[Lc]=2,Tr[Vc]=2,Tr[Oc]=2,Tr[Rc]=1,Tr[Dc]=4,Tr[Mc]=4,Tr[Ic]=16,Tr[Fc]=8,Tr[$c]=6;function Bc(a,c,v){return Tr[a]*c*v}var qv=function(a,c,v,V,I){var L={rgba4:ia,rgb565:Vc,"rgb5 a1":Lc,depth:Oc,stencil:Rc,"depth stencil":Dc};c.ext_srgb&&(L.srgba=Mc),c.ext_color_buffer_half_float&&(L.rgba16f=Fc,L.rgb16f=$c),c.webgl_color_buffer_float&&(L.rgba32f=Ic);var D=[];Object.keys(L).forEach(function(z){var q=L[z];D[q]=z});var j=0,G={};function X(z){this.id=j++,this.refCount=1,this.renderbuffer=z,this.format=ia,this.width=0,this.height=0,I.profile&&(this.stats={size:0})}X.prototype.decRef=function(){--this.refCount<=0&&W(this)};function W(z){var q=z.renderbuffer;h(q,"must not double destroy renderbuffer"),a.bindRenderbuffer(mn,null),a.deleteRenderbuffer(q),z.renderbuffer=null,z.refCount=0,delete G[z.id],V.renderbufferCount--}function Y(z,q){var P=new X(a.createRenderbuffer());G[P.id]=P,V.renderbufferCount++;function R(ue,B){var oe=0,ie=0,ge=ia;if(typeof ue=="object"&&ue){var F=ue;if("shape"in F){var M=F.shape;h(Array.isArray(M)&&M.length>=2,"invalid renderbuffer shape"),oe=M[0]|0,ie=M[1]|0}else"radius"in F&&(oe=ie=F.radius|0),"width"in F&&(oe=F.width|0),"height"in F&&(ie=F.height|0);"format"in F&&(h.parameter(F.format,L,"invalid renderbuffer format"),ge=L[F.format])}else typeof ue=="number"?(oe=ue|0,typeof B=="number"?ie=B|0:ie=oe):ue?h.raise("invalid arguments to renderbuffer constructor"):oe=ie=1;if(h(oe>0&&ie>0&&oe<=v.maxRenderbufferSize&&ie<=v.maxRenderbufferSize,"invalid renderbuffer size"),!(oe===P.width&&ie===P.height&&ge===P.format))return R.width=P.width=oe,R.height=P.height=ie,P.format=ge,a.bindRenderbuffer(mn,P.renderbuffer),a.renderbufferStorage(mn,ge,oe,ie),h(a.getError()===0,"invalid render buffer format"),I.profile&&(P.stats.size=Bc(P.format,P.width,P.height)),R.format=D[P.format],R}function K(ue,B){var oe=ue|0,ie=B|0||oe;return oe===P.width&&ie===P.height||(h(oe>0&&ie>0&&oe<=v.maxRenderbufferSize&&ie<=v.maxRenderbufferSize,"invalid renderbuffer size"),R.width=P.width=oe,R.height=P.height=ie,a.bindRenderbuffer(mn,P.renderbuffer),a.renderbufferStorage(mn,P.format,oe,ie),h(a.getError()===0,"invalid render buffer format"),I.profile&&(P.stats.size=Bc(P.format,P.width,P.height))),R}return R(z,q),R.resize=K,R._reglType="renderbuffer",R._renderbuffer=P,I.profile&&(R.stats=P.stats),R.destroy=function(){P.decRef()},R}I.profile&&(V.getTotalRenderbufferSize=function(){var z=0;return Object.keys(G).forEach(function(q){z+=G[q].stats.size}),z});function ee(){hr(G).forEach(function(z){z.renderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(mn,z.renderbuffer),a.renderbufferStorage(mn,z.format,z.width,z.height)}),a.bindRenderbuffer(mn,null)}return{create:Y,clear:function(){hr(G).forEach(W)},restore:ee}},Xr=36160,Lo=36161,Gn=3553,sa=34069,Nc=36064,Gc=36096,jc=36128,Uc=33306,zc=36053,Xv=36054,Yv=36055,Wv=36057,Zv=36061,Qv=36193,Jv=5121,eb=5126,Hc=6407,Kc=6408,tb=6402,rb=[Hc,Kc],Vo=[];Vo[Kc]=4,Vo[Hc]=3;var aa=[];aa[Jv]=1,aa[eb]=4,aa[Qv]=2;var nb=32854,ib=32855,sb=36194,ab=33189,ob=36168,qc=34041,lb=35907,ub=34836,cb=34842,db=34843,hb=[nb,ib,sb,lb,cb,db,ub],mi={};mi[zc]="complete",mi[Xv]="incomplete attachment",mi[Wv]="incomplete dimensions",mi[Yv]="incomplete, missing attachment",mi[Zv]="unsupported";function pb(a,c,v,V,I,L){var D={cur:null,next:null,dirty:!1,setFBO:null},j=["rgba"],G=["rgba4","rgb565","rgb5 a1"];c.ext_srgb&&G.push("srgba"),c.ext_color_buffer_half_float&&G.push("rgba16f","rgb16f"),c.webgl_color_buffer_float&&G.push("rgba32f");var X=["uint8"];c.oes_texture_half_float&&X.push("half float","float16"),c.oes_texture_float&&X.push("float","float32");function W(H,re,ne){this.target=H,this.texture=re,this.renderbuffer=ne;var Le=0,Te=0;re?(Le=re.width,Te=re.height):ne&&(Le=ne.width,Te=ne.height),this.width=Le,this.height=Te}function Y(H){H&&(H.texture&&H.texture._texture.decRef(),H.renderbuffer&&H.renderbuffer._renderbuffer.decRef())}function ee(H,re,ne){if(H)if(H.texture){var Le=H.texture._texture,Te=Math.max(1,Le.width),se=Math.max(1,Le.height);h(Te===re&&se===ne,"inconsistent width/height for supplied texture"),Le.refCount+=1}else{var le=H.renderbuffer._renderbuffer;h(le.width===re&&le.height===ne,"inconsistent width/height for renderbuffer"),le.refCount+=1}}function z(H,re){re&&(re.texture?a.framebufferTexture2D(Xr,H,re.target,re.texture._texture.texture,0):a.framebufferRenderbuffer(Xr,H,Lo,re.renderbuffer._renderbuffer.renderbuffer))}function q(H){var re=Gn,ne=null,Le=null,Te=H;typeof H=="object"&&(Te=H.data,"target"in H&&(re=H.target|0)),h.type(Te,"function","invalid attachment data");var se=Te._reglType;return se==="texture2d"?(ne=Te,h(re===Gn)):se==="textureCube"?(ne=Te,h(re>=sa&&re<sa+6,"invalid cube map target")):se==="renderbuffer"?(Le=Te,re=Lo):h.raise("invalid regl object for attachment"),new W(re,ne,Le)}function P(H,re,ne,Le,Te){if(ne){var se=V.create2D({width:H,height:re,format:Le,type:Te});return se._texture.refCount=0,new W(Gn,se,null)}else{var le=I.create({width:H,height:re,format:Le});return le._renderbuffer.refCount=0,new W(Lo,null,le)}}function R(H){return H&&(H.texture||H.renderbuffer)}function K(H,re,ne){H&&(H.texture?H.texture.resize(re,ne):H.renderbuffer&&H.renderbuffer.resize(re,ne),H.width=re,H.height=ne)}var ue=0,B={};function oe(){this.id=ue++,B[this.id]=this,this.framebuffer=a.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ie(H){H.colorAttachments.forEach(Y),Y(H.depthAttachment),Y(H.stencilAttachment),Y(H.depthStencilAttachment)}function ge(H){var re=H.framebuffer;h(re,"must not double destroy framebuffer"),a.deleteFramebuffer(re),H.framebuffer=null,L.framebufferCount--,delete B[H.id]}function F(H){var re;a.bindFramebuffer(Xr,H.framebuffer);var ne=H.colorAttachments;for(re=0;re<ne.length;++re)z(Nc+re,ne[re]);for(re=ne.length;re<v.maxColorAttachments;++re)a.framebufferTexture2D(Xr,Nc+re,Gn,null,0);a.framebufferTexture2D(Xr,Uc,Gn,null,0),a.framebufferTexture2D(Xr,Gc,Gn,null,0),a.framebufferTexture2D(Xr,jc,Gn,null,0),z(Gc,H.depthAttachment),z(jc,H.stencilAttachment),z(Uc,H.depthStencilAttachment);var Le=a.checkFramebufferStatus(Xr);!a.isContextLost()&&Le!==zc&&h.raise("framebuffer configuration not supported, status = "+mi[Le]),a.bindFramebuffer(Xr,D.next?D.next.framebuffer:null),D.cur=D.next,a.getError()}function M(H,re){var ne=new oe;L.framebufferCount++;function Le(se,le){var Ee;h(D.next!==ne,"can not update framebuffer which is currently in use");var ke=0,De=0,lt=!0,ct=!0,Fe=null,Ct=!0,ot="rgba",xt="uint8",Et=1,Pt=null,Vt=null,Nt=null,ft=!1;if(typeof se=="number")ke=se|0,De=le|0||ke;else if(!se)ke=De=1;else{h.type(se,"object","invalid arguments for framebuffer");var Oe=se;if("shape"in Oe){var Gt=Oe.shape;h(Array.isArray(Gt)&&Gt.length>=2,"invalid shape for framebuffer"),ke=Gt[0],De=Gt[1]}else"radius"in Oe&&(ke=De=Oe.radius),"width"in Oe&&(ke=Oe.width),"height"in Oe&&(De=Oe.height);("color"in Oe||"colors"in Oe)&&(Fe=Oe.color||Oe.colors,Array.isArray(Fe)&&h(Fe.length===1||c.webgl_draw_buffers,"multiple render targets not supported")),Fe||("colorCount"in Oe&&(Et=Oe.colorCount|0,h(Et>0,"invalid color buffer count")),"colorTexture"in Oe&&(Ct=!!Oe.colorTexture,ot="rgba4"),"colorType"in Oe&&(xt=Oe.colorType,Ct?(h(c.oes_texture_float||!(xt==="float"||xt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),h(c.oes_texture_half_float||!(xt==="half float"||xt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):xt==="half float"||xt==="float16"?(h(c.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ot="rgba16f"):(xt==="float"||xt==="float32")&&(h(c.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ot="rgba32f"),h.oneOf(xt,X,"invalid color type")),"colorFormat"in Oe&&(ot=Oe.colorFormat,j.indexOf(ot)>=0?Ct=!0:G.indexOf(ot)>=0?Ct=!1:h.optional(function(){Ct?h.oneOf(Oe.colorFormat,j,"invalid color format for texture"):h.oneOf(Oe.colorFormat,G,"invalid color format for renderbuffer")}))),("depthTexture"in Oe||"depthStencilTexture"in Oe)&&(ft=!!(Oe.depthTexture||Oe.depthStencilTexture),h(!ft||c.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Oe&&(typeof Oe.depth=="boolean"?lt=Oe.depth:(Pt=Oe.depth,ct=!1)),"stencil"in Oe&&(typeof Oe.stencil=="boolean"?ct=Oe.stencil:(Vt=Oe.stencil,lt=!1)),"depthStencil"in Oe&&(typeof Oe.depthStencil=="boolean"?lt=ct=Oe.depthStencil:(Nt=Oe.depthStencil,lt=!1,ct=!1))}var ze=null,xe=null,Me=null,Be=null;if(Array.isArray(Fe))ze=Fe.map(q);else if(Fe)ze=[q(Fe)];else for(ze=new Array(Et),Ee=0;Ee<Et;++Ee)ze[Ee]=P(ke,De,Ct,ot,xt);h(c.webgl_draw_buffers||ze.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),h(ze.length<=v.maxColorAttachments,"too many color attachments, not supported"),ke=ke||ze[0].width,De=De||ze[0].height,Pt?xe=q(Pt):lt&&!ct&&(xe=P(ke,De,ft,"depth","uint32")),Vt?Me=q(Vt):ct&&!lt&&(Me=P(ke,De,!1,"stencil","uint8")),Nt?Be=q(Nt):!Pt&&!Vt&&ct&&lt&&(Be=P(ke,De,ft,"depth stencil","depth stencil")),h(!!Pt+!!Vt+!!Nt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var mt=null;for(Ee=0;Ee<ze.length;++Ee)if(ee(ze[Ee],ke,De),h(!ze[Ee]||ze[Ee].texture&&rb.indexOf(ze[Ee].texture._texture.format)>=0||ze[Ee].renderbuffer&&hb.indexOf(ze[Ee].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ee+" is invalid"),ze[Ee]&&ze[Ee].texture){var Mr=Vo[ze[Ee].texture._texture.format]*aa[ze[Ee].texture._texture.type];mt===null?mt=Mr:h(mt===Mr,"all color attachments much have the same number of bits per pixel.")}return ee(xe,ke,De),h(!xe||xe.texture&&xe.texture._texture.format===tb||xe.renderbuffer&&xe.renderbuffer._renderbuffer.format===ab,"invalid depth attachment for framebuffer object"),ee(Me,ke,De),h(!Me||Me.renderbuffer&&Me.renderbuffer._renderbuffer.format===ob,"invalid stencil attachment for framebuffer object"),ee(Be,ke,De),h(!Be||Be.texture&&Be.texture._texture.format===qc||Be.renderbuffer&&Be.renderbuffer._renderbuffer.format===qc,"invalid depth-stencil attachment for framebuffer object"),ie(ne),ne.width=ke,ne.height=De,ne.colorAttachments=ze,ne.depthAttachment=xe,ne.stencilAttachment=Me,ne.depthStencilAttachment=Be,Le.color=ze.map(R),Le.depth=R(xe),Le.stencil=R(Me),Le.depthStencil=R(Be),Le.width=ne.width,Le.height=ne.height,F(ne),Le}function Te(se,le){h(D.next!==ne,"can not resize a framebuffer which is currently in use");var Ee=Math.max(se|0,1),ke=Math.max(le|0||Ee,1);if(Ee===ne.width&&ke===ne.height)return Le;for(var De=ne.colorAttachments,lt=0;lt<De.length;++lt)K(De[lt],Ee,ke);return K(ne.depthAttachment,Ee,ke),K(ne.stencilAttachment,Ee,ke),K(ne.depthStencilAttachment,Ee,ke),ne.width=Le.width=Ee,ne.height=Le.height=ke,F(ne),Le}return Le(H,re),n(Le,{resize:Te,_reglType:"framebuffer",_framebuffer:ne,destroy:function(){ge(ne),ie(ne)},use:function(se){D.setFBO({framebuffer:Le},se)}})}function pe(H){var re=Array(6);function ne(Te){var se;h(re.indexOf(D.next)<0,"can not update framebuffer which is currently in use");var le={color:null},Ee=0,ke=null,De="rgba",lt="uint8",ct=1;if(typeof Te=="number")Ee=Te|0;else if(!Te)Ee=1;else{h.type(Te,"object","invalid arguments for framebuffer");var Fe=Te;if("shape"in Fe){var Ct=Fe.shape;h(Array.isArray(Ct)&&Ct.length>=2,"invalid shape for framebuffer"),h(Ct[0]===Ct[1],"cube framebuffer must be square"),Ee=Ct[0]}else"radius"in Fe&&(Ee=Fe.radius|0),"width"in Fe?(Ee=Fe.width|0,"height"in Fe&&h(Fe.height===Ee,"must be square")):"height"in Fe&&(Ee=Fe.height|0);("color"in Fe||"colors"in Fe)&&(ke=Fe.color||Fe.colors,Array.isArray(ke)&&h(ke.length===1||c.webgl_draw_buffers,"multiple render targets not supported")),ke||("colorCount"in Fe&&(ct=Fe.colorCount|0,h(ct>0,"invalid color buffer count")),"colorType"in Fe&&(h.oneOf(Fe.colorType,X,"invalid color type"),lt=Fe.colorType),"colorFormat"in Fe&&(De=Fe.colorFormat,h.oneOf(Fe.colorFormat,j,"invalid color format for texture"))),"depth"in Fe&&(le.depth=Fe.depth),"stencil"in Fe&&(le.stencil=Fe.stencil),"depthStencil"in Fe&&(le.depthStencil=Fe.depthStencil)}var ot;if(ke)if(Array.isArray(ke))for(ot=[],se=0;se<ke.length;++se)ot[se]=ke[se];else ot=[ke];else{ot=Array(ct);var xt={radius:Ee,format:De,type:lt};for(se=0;se<ct;++se)ot[se]=V.createCube(xt)}for(le.color=Array(ot.length),se=0;se<ot.length;++se){var Et=ot[se];h(typeof Et=="function"&&Et._reglType==="textureCube","invalid cube map"),Ee=Ee||Et.width,h(Et.width===Ee&&Et.height===Ee,"invalid cube map shape"),le.color[se]={target:sa,data:ot[se]}}for(se=0;se<6;++se){for(var Pt=0;Pt<ot.length;++Pt)le.color[Pt].target=sa+se;se>0&&(le.depth=re[0].depth,le.stencil=re[0].stencil,le.depthStencil=re[0].depthStencil),re[se]?re[se](le):re[se]=M(le)}return n(ne,{width:Ee,height:Ee,color:ot})}function Le(Te){var se,le=Te|0;if(h(le>0&&le<=v.maxCubeMapSize,"invalid radius for cube fbo"),le===ne.width)return ne;var Ee=ne.color;for(se=0;se<Ee.length;++se)Ee[se].resize(le);for(se=0;se<6;++se)re[se].resize(le);return ne.width=ne.height=le,ne}return ne(H),n(ne,{faces:re,resize:Le,_reglType:"framebufferCube",destroy:function(){re.forEach(function(Te){Te.destroy()})}})}function te(){D.cur=null,D.next=null,D.dirty=!0,hr(B).forEach(function(H){H.framebuffer=a.createFramebuffer(),F(H)})}return n(D,{getFramebuffer:function(H){if(typeof H=="function"&&H._reglType==="framebuffer"){var re=H._framebuffer;if(re instanceof oe)return re}return null},create:M,createCube:pe,clear:function(){hr(B).forEach(ge)},restore:te})}var fb=5126,Xc=34962,oa=34963,Yc=["attributes","elements","offset","count","primitive","instances"];function Oo(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=fb,this.offset=0,this.stride=0,this.divisor=0}function mb(a,c,v,V,I,L,D){for(var j=v.maxAttributes,G=new Array(j),X=0;X<j;++X)G[X]=new Oo;var W=0,Y={},ee={Record:Oo,scope:{},state:G,currentVAO:null,targetVAO:null,restore:q()?ie:function(){},createVAO:ge,getVAO:R,destroyBuffer:z,setVAO:q()?K:ue,clear:q()?B:function(){}};function z(F){for(var M=0;M<G.length;++M){var pe=G[M];pe.buffer===F&&(a.disableVertexAttribArray(M),pe.buffer=null)}}function q(){return c.oes_vertex_array_object}function P(){return c.angle_instanced_arrays}function R(F){return typeof F=="function"&&F._vao?F._vao:null}function K(F){if(F!==ee.currentVAO){var M=q();F?M.bindVertexArrayOES(F.vao):M.bindVertexArrayOES(null),ee.currentVAO=F}}function ue(F){if(F!==ee.currentVAO){if(F)F.bindAttrs();else{for(var M=P(),pe=0;pe<G.length;++pe){var te=G[pe];te.buffer?(a.enableVertexAttribArray(pe),te.buffer.bind(),a.vertexAttribPointer(pe,te.size,te.type,te.normalized,te.stride,te.offfset),M&&te.divisor&&M.vertexAttribDivisorANGLE(pe,te.divisor)):(a.disableVertexAttribArray(pe),a.vertexAttrib4f(pe,te.x,te.y,te.z,te.w))}D.elements?a.bindBuffer(oa,D.elements.buffer.buffer):a.bindBuffer(oa,null)}ee.currentVAO=F}}function B(){hr(Y).forEach(function(F){F.destroy()})}function oe(){this.id=++W,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var F=q();F?this.vao=F.createVertexArrayOES():this.vao=null,Y[this.id]=this,this.buffers=[]}oe.prototype.bindAttrs=function(){for(var F=P(),M=this.attributes,pe=0;pe<M.length;++pe){var te=M[pe];te.buffer?(a.enableVertexAttribArray(pe),a.bindBuffer(Xc,te.buffer.buffer),a.vertexAttribPointer(pe,te.size,te.type,te.normalized,te.stride,te.offset),F&&te.divisor&&F.vertexAttribDivisorANGLE(pe,te.divisor)):(a.disableVertexAttribArray(pe),a.vertexAttrib4f(pe,te.x,te.y,te.z,te.w))}for(var H=M.length;H<j;++H)a.disableVertexAttribArray(H);var re=L.getElements(this.elements);re?a.bindBuffer(oa,re.buffer.buffer):a.bindBuffer(oa,null)},oe.prototype.refresh=function(){var F=q();F&&(F.bindVertexArrayOES(this.vao),this.bindAttrs(),ee.currentVAO=null,F.bindVertexArrayOES(null))},oe.prototype.destroy=function(){if(this.vao){var F=q();this===ee.currentVAO&&(ee.currentVAO=null,F.bindVertexArrayOES(null)),F.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Y[this.id]&&(delete Y[this.id],V.vaoCount-=1)};function ie(){var F=q();F&&hr(Y).forEach(function(M){M.refresh()})}function ge(F){var M=new oe;V.vaoCount+=1;function pe(te){var H;if(Array.isArray(te))H=te,M.elements&&M.ownsElements&&M.elements.destroy(),M.elements=null,M.ownsElements=!1,M.offset=0,M.count=0,M.instances=-1,M.primitive=4;else{if(h(typeof te=="object","invalid arguments for create vao"),h("attributes"in te,"must specify attributes for vao"),te.elements){var re=te.elements;M.ownsElements?typeof re=="function"&&re._reglType==="elements"?(M.elements.destroy(),M.ownsElements=!1):(M.elements(re),M.ownsElements=!1):L.getElements(te.elements)?(M.elements=te.elements,M.ownsElements=!1):(M.elements=L.create(te.elements),M.ownsElements=!0)}else M.elements=null,M.ownsElements=!1;H=te.attributes,M.offset=0,M.count=-1,M.instances=-1,M.primitive=4,M.elements&&(M.count=M.elements._elements.vertCount,M.primitive=M.elements._elements.primType),"offset"in te&&(M.offset=te.offset|0),"count"in te&&(M.count=te.count|0),"instances"in te&&(M.instances=te.instances|0),"primitive"in te&&(h(te.primitive in fn,"bad primitive type: "+te.primitive),M.primitive=fn[te.primitive]),h.optional(()=>{for(var lt=Object.keys(te),ct=0;ct<lt.length;++ct)h(Yc.indexOf(lt[ct])>=0,'invalid option for vao: "'+lt[ct]+'" valid options are '+Yc)}),h(Array.isArray(H),"attributes must be an array")}h(H.length<j,"too many attributes"),h(H.length>0,"must specify at least one attribute");var ne={},Le=M.attributes;Le.length=H.length;for(var Te=0;Te<H.length;++Te){var se=H[Te],le=Le[Te]=new Oo,Ee=se.data||se;if(Array.isArray(Ee)||t(Ee)||Sr(Ee)){var ke;M.buffers[Te]&&(ke=M.buffers[Te],t(Ee)&&ke._buffer.byteLength>=Ee.byteLength?ke.subdata(Ee):(ke.destroy(),M.buffers[Te]=null)),M.buffers[Te]||(ke=M.buffers[Te]=I.create(se,Xc,!1,!0)),le.buffer=I.getBuffer(ke),le.size=le.buffer.dimension|0,le.normalized=!1,le.type=le.buffer.dtype,le.offset=0,le.stride=0,le.divisor=0,le.state=1,ne[Te]=1}else I.getBuffer(se)?(le.buffer=I.getBuffer(se),le.size=le.buffer.dimension|0,le.normalized=!1,le.type=le.buffer.dtype,le.offset=0,le.stride=0,le.divisor=0,le.state=1):I.getBuffer(se.buffer)?(le.buffer=I.getBuffer(se.buffer),le.size=(+se.size||le.buffer.dimension)|0,le.normalized=!!se.normalized||!1,"type"in se?(h.parameter(se.type,Fn,"invalid buffer type"),le.type=Fn[se.type]):le.type=le.buffer.dtype,le.offset=(se.offset||0)|0,le.stride=(se.stride||0)|0,le.divisor=(se.divisor||0)|0,le.state=1,h(le.size>=1&&le.size<=4,"size must be between 1 and 4"),h(le.offset>=0,"invalid offset"),h(le.stride>=0&&le.stride<=255,"stride must be between 0 and 255"),h(le.divisor>=0,"divisor must be positive"),h(!le.divisor||!!c.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in se?(h(Te>0,"first attribute must not be a constant"),le.x=+se.x||0,le.y=+se.y||0,le.z=+se.z||0,le.w=+se.w||0,le.state=2):h(!1,"invalid attribute spec for location "+Te)}for(var De=0;De<M.buffers.length;++De)!ne[De]&&M.buffers[De]&&(M.buffers[De].destroy(),M.buffers[De]=null);return M.refresh(),pe}return pe.destroy=function(){for(var te=0;te<M.buffers.length;++te)M.buffers[te]&&M.buffers[te].destroy();M.buffers.length=0,M.ownsElements&&(M.elements.destroy(),M.elements=null,M.ownsElements=!1),M.destroy()},pe._vao=M,pe._reglType="vao",pe(F)}return ee}var Wc=35632,vb=35633,bb=35718,_b=35721;function wb(a,c,v,V){var I={},L={};function D(P,R,K,ue){this.name=P,this.id=R,this.location=K,this.info=ue}function j(P,R){for(var K=0;K<P.length;++K)if(P[K].id===R.id){P[K].location=R.location;return}P.push(R)}function G(P,R,K){var ue=P===Wc?I:L,B=ue[R];if(!B){var oe=c.str(R);B=a.createShader(P),a.shaderSource(B,oe),a.compileShader(B),h.shaderError(a,B,oe,P,K),ue[R]=B}return B}var X={},W=[],Y=0;function ee(P,R){this.id=Y++,this.fragId=P,this.vertId=R,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,V.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function z(P,R,K){var ue,B,oe=G(Wc,P.fragId),ie=G(vb,P.vertId),ge=P.program=a.createProgram();if(a.attachShader(ge,oe),a.attachShader(ge,ie),K)for(ue=0;ue<K.length;++ue){var F=K[ue];a.bindAttribLocation(ge,F[0],F[1])}a.linkProgram(ge),h.linkError(a,ge,c.str(P.fragId),c.str(P.vertId),R);var M=a.getProgramParameter(ge,bb);V.profile&&(P.stats.uniformsCount=M);var pe=P.uniforms;for(ue=0;ue<M;++ue)if(B=a.getActiveUniform(ge,ue),B)if(B.size>1)for(var te=0;te<B.size;++te){var H=B.name.replace("[0]","["+te+"]");j(pe,new D(H,c.id(H),a.getUniformLocation(ge,H),B))}else j(pe,new D(B.name,c.id(B.name),a.getUniformLocation(ge,B.name),B));var re=a.getProgramParameter(ge,_b);V.profile&&(P.stats.attributesCount=re);var ne=P.attributes;for(ue=0;ue<re;++ue)B=a.getActiveAttrib(ge,ue),B&&j(ne,new D(B.name,c.id(B.name),a.getAttribLocation(ge,B.name),B))}V.profile&&(v.getMaxUniformsCount=function(){var P=0;return W.forEach(function(R){R.stats.uniformsCount>P&&(P=R.stats.uniformsCount)}),P},v.getMaxAttributesCount=function(){var P=0;return W.forEach(function(R){R.stats.attributesCount>P&&(P=R.stats.attributesCount)}),P});function q(){I={},L={};for(var P=0;P<W.length;++P)z(W[P],null,W[P].attributes.map(function(R){return[R.location,R.name]}))}return{clear:function(){var P=a.deleteShader.bind(a);hr(I).forEach(P),I={},hr(L).forEach(P),L={},W.forEach(function(R){a.deleteProgram(R.program)}),W.length=0,X={},v.shaderCount=0},program:function(P,R,K,ue){h.command(P>=0,"missing vertex shader",K),h.command(R>=0,"missing fragment shader",K);var B=X[R];B||(B=X[R]={});var oe=B[P];if(oe&&(oe.refCount++,!ue))return oe;var ie=new ee(R,P);return v.shaderCount++,z(ie,K,ue),oe||(B[P]=ie),W.push(ie),n(ie,{destroy:function(){if(ie.refCount--,ie.refCount<=0){a.deleteProgram(ie.program);var ge=W.indexOf(ie);W.splice(ge,1),v.shaderCount--}B[ie.vertId].refCount<=0&&(a.deleteShader(L[ie.vertId]),delete L[ie.vertId],delete X[ie.fragId][ie.vertId]),Object.keys(X[ie.fragId]).length||(a.deleteShader(I[ie.fragId]),delete I[ie.fragId],delete X[ie.fragId])}})},restore:q,shader:G,frag:-1,vert:-1}}var gb=6408,qi=5121,yb=3333,la=5126;function xb(a,c,v,V,I,L,D){function j(W){var Y;c.next===null?(h(I.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Y=qi):(h(c.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Y=c.next.colorAttachments[0].texture._texture.type,h.optional(function(){L.oes_texture_float?(h(Y===qi||Y===la,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Y===la&&h(D.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):h(Y===qi,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ee=0,z=0,q=V.framebufferWidth,P=V.framebufferHeight,R=null;t(W)?R=W:W&&(h.type(W,"object","invalid arguments to regl.read()"),ee=W.x|0,z=W.y|0,h(ee>=0&&ee<V.framebufferWidth,"invalid x offset for regl.read"),h(z>=0&&z<V.framebufferHeight,"invalid y offset for regl.read"),q=(W.width||V.framebufferWidth-ee)|0,P=(W.height||V.framebufferHeight-z)|0,R=W.data||null),R&&(Y===qi?h(R instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Y===la&&h(R instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),h(q>0&&q+ee<=V.framebufferWidth,"invalid width for read pixels"),h(P>0&&P+z<=V.framebufferHeight,"invalid height for read pixels"),v();var K=q*P*4;return R||(Y===qi?R=new Uint8Array(K):Y===la&&(R=R||new Float32Array(K))),h.isTypedArray(R,"data buffer for regl.read() must be a typedarray"),h(R.byteLength>=K,"data buffer for regl.read() too small"),a.pixelStorei(yb,4),a.readPixels(ee,z,q,P,gb,Y,R),R}function G(W){var Y;return c.setFBO({framebuffer:W.framebuffer},function(){Y=j(W)}),Y}function X(W){return!W||!("framebuffer"in W)?j(W):G(W)}return X}function vi(a){return Array.prototype.slice.call(a)}function bi(a){return vi(a).join("")}function Cb(){var a=0,c=[],v=[];function V(Y){for(var ee=0;ee<v.length;++ee)if(v[ee]===Y)return c[ee];var z="g"+a++;return c.push(z),v.push(Y),z}function I(){var Y=[];function ee(){Y.push.apply(Y,vi(arguments))}var z=[];function q(){var P="v"+a++;return z.push(P),arguments.length>0&&(Y.push(P,"="),Y.push.apply(Y,vi(arguments)),Y.push(";")),P}return n(ee,{def:q,toString:function(){return bi([z.length>0?"var "+z.join(",")+";":"",bi(Y)])}})}function L(){var Y=I(),ee=I(),z=Y.toString,q=ee.toString;function P(R,K){ee(R,K,"=",Y.def(R,K),";")}return n(function(){Y.apply(Y,vi(arguments))},{def:Y.def,entry:Y,exit:ee,save:P,set:function(R,K,ue){P(R,K),Y(R,K,"=",ue,";")},toString:function(){return z()+q()}})}function D(){var Y=bi(arguments),ee=L(),z=L(),q=ee.toString,P=z.toString;return n(ee,{then:function(){return ee.apply(ee,vi(arguments)),this},else:function(){return z.apply(z,vi(arguments)),this},toString:function(){var R=P();return R&&(R="else{"+R+"}"),bi(["if(",Y,"){",q(),"}",R])}})}var j=I(),G={};function X(Y,ee){var z=[];function q(){var B="a"+z.length;return z.push(B),B}ee=ee||0;for(var P=0;P<ee;++P)q();var R=L(),K=R.toString,ue=G[Y]=n(R,{arg:q,toString:function(){return bi(["function(",z.join(),"){",K(),"}"])}});return ue}function W(){var Y=['"use strict";',j,"return {"];Object.keys(G).forEach(function(q){Y.push('"',q,'":',G[q].toString(),",")}),Y.push("}");var ee=bi(Y).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),z=Function.apply(null,c.concat(ee));return z.apply(null,v)}return{global:j,link:V,block:I,proc:X,scope:L,cond:D,compile:W}}var _i="xyzw".split(""),Zc=5121,wi=1,Ro=2,Do=0,Mo=1,Io=2,Fo=3,ua=4,Qc=5,Jc=6,ed="dither",td="blend.enable",rd="blend.color",$o="blend.equation",Bo="blend.func",nd="depth.enable",id="depth.func",sd="depth.range",ad="depth.mask",No="colorMask",od="cull.enable",ld="cull.face",Go="frontFace",jo="lineWidth",ud="polygonOffset.enable",Uo="polygonOffset.offset",cd="sample.alpha",dd="sample.enable",zo="sample.coverage",hd="stencil.enable",pd="stencil.mask",Ho="stencil.func",Ko="stencil.opFront",Xi="stencil.opBack",fd="scissor.enable",ca="scissor.box",Yr="viewport",Yi="profile",jn="framebuffer",Wi="vert",Zi="frag",Un="elements",zn="primitive",Hn="count",da="offset",ha="instances",Qi="vao",qo="Width",Xo="Height",gi=jn+qo,yi=jn+Xo,Eb=Yr+qo,Pb=Yr+Xo,md="drawingBuffer",vd=md+qo,bd=md+Xo,Ab=[Bo,$o,Ho,Ko,Xi,zo,Yr,ca,Uo],xi=34962,Yo=34963,Sb=35632,Tb=35633,_d=3553,kb=34067,Lb=2884,Vb=3042,Ob=3024,Rb=2960,Db=2929,Mb=3089,Ib=32823,Fb=32926,$b=32928,Wo=5126,pa=35664,fa=35665,ma=35666,Zo=5124,va=35667,ba=35668,_a=35669,Qo=35670,wa=35671,ga=35672,ya=35673,Ji=35674,es=35675,ts=35676,rs=35678,ns=35680,Jo=4,is=1028,Kn=1029,wd=2304,el=2305,Bb=32775,Nb=32776,Gb=519,vn=7680,gd=0,yd=1,xd=32774,jb=513,Cd=36160,Ub=36064,Dr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ed=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ci={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},bn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Pd={frag:Sb,vert:Tb},tl={cw:wd,ccw:el};function xa(a){return Array.isArray(a)||t(a)||Sr(a)}function Ad(a){return a.sort(function(c,v){return c===Yr?-1:v===Yr?1:c<v?-1:1})}function Tt(a,c,v,V){this.thisDep=a,this.contextDep=c,this.propDep=v,this.append=V}function _n(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function yt(a){return new Tt(!1,!1,!1,a)}function sr(a,c){var v=a.type;if(v===Do){var V=a.data.length;return new Tt(!0,V>=1,V>=2,c)}else if(v===ua){var I=a.data;return new Tt(I.thisDep,I.contextDep,I.propDep,c)}else{if(v===Qc)return new Tt(!1,!1,!1,c);if(v===Jc){for(var L=!1,D=!1,j=!1,G=0;G<a.data.length;++G){var X=a.data[G];if(X.type===Mo)j=!0;else if(X.type===Io)D=!0;else if(X.type===Fo)L=!0;else if(X.type===Do){L=!0;var W=X.data;W>=1&&(D=!0),W>=2&&(j=!0)}else X.type===ua&&(L=L||X.data.thisDep,D=D||X.data.contextDep,j=j||X.data.propDep)}return new Tt(L,D,j,c)}else return new Tt(v===Fo,v===Io,v===Mo,c)}}var Sd=new Tt(!1,!1,!1,function(){});function zb(a,c,v,V,I,L,D,j,G,X,W,Y,ee,z,q){var P=X.Record,R={add:32774,subtract:32778,"reverse subtract":32779};v.ext_blend_minmax&&(R.min=Bb,R.max=Nb);var K=v.angle_instanced_arrays,ue=v.webgl_draw_buffers,B=v.oes_vertex_array_object,oe={dirty:!0,profile:q.profile},ie={},ge=[],F={},M={};function pe(p){return p.replace(".","_")}function te(p,u,_){var E=pe(p);ge.push(p),ie[E]=oe[E]=!!_,F[E]=u}function H(p,u,_){var E=pe(p);ge.push(p),Array.isArray(_)?(oe[E]=_.slice(),ie[E]=_.slice()):oe[E]=ie[E]=_,M[E]=u}te(ed,Ob),te(td,Vb),H(rd,"blendColor",[0,0,0,0]),H($o,"blendEquationSeparate",[xd,xd]),H(Bo,"blendFuncSeparate",[yd,gd,yd,gd]),te(nd,Db,!0),H(id,"depthFunc",jb),H(sd,"depthRange",[0,1]),H(ad,"depthMask",!0),H(No,No,[!0,!0,!0,!0]),te(od,Lb),H(ld,"cullFace",Kn),H(Go,Go,el),H(jo,jo,1),te(ud,Ib),H(Uo,"polygonOffset",[0,0]),te(cd,Fb),te(dd,$b),H(zo,"sampleCoverage",[1,!1]),te(hd,Rb),H(pd,"stencilMask",-1),H(Ho,"stencilFunc",[Gb,0,-1]),H(Ko,"stencilOpSeparate",[is,vn,vn,vn]),H(Xi,"stencilOpSeparate",[Kn,vn,vn,vn]),te(fd,Mb),H(ca,"scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]),H(Yr,Yr,[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var re={gl:a,context:ee,strings:c,next:ie,current:oe,draw:Y,elements:L,buffer:I,shader:W,attributes:X.state,vao:X,uniforms:G,framebuffer:j,extensions:v,timer:z,isBufferArgs:xa},ne={primTypes:fn,compareFuncs:Ci,blendFuncs:Dr,blendEquations:R,stencilOps:bn,glTypes:Fn,orientationType:tl};h.optional(function(){re.isArrayLike=pt}),ue&&(ne.backBuffer=[Kn],ne.drawBuffer=dr(V.maxDrawbuffers,function(p){return p===0?[0]:dr(p,function(u){return Ub+u})}));var Le=0;function Te(){var p=Cb(),u=p.link,_=p.global;p.id=Le++,p.batchId="0";var E=u(re),S=p.shared={props:"a0"};Object.keys(re).forEach(function(b){S[b]=_.def(E,".",b)}),h.optional(function(){p.CHECK=u(h),p.commandStr=h.guessCommand(),p.command=u(p.commandStr),p.assert=function(b,f,A){b("if(!(",f,"))",this.CHECK,".commandRaise(",u(A),",",this.command,");")},ne.invalidBlendCombinations=Ed});var g=p.next={},w=p.current={};Object.keys(M).forEach(function(b){Array.isArray(oe[b])&&(g[b]=_.def(S.next,".",b),w[b]=_.def(S.current,".",b))});var C=p.constants={};Object.keys(ne).forEach(function(b){C[b]=_.def(JSON.stringify(ne[b]))}),p.invoke=function(b,f){switch(f.type){case Do:var A=["this",S.context,S.props,p.batchId];return b.def(u(f.data),".call(",A.slice(0,Math.max(f.data.length+1,4)),")");case Mo:return b.def(S.props,f.data);case Io:return b.def(S.context,f.data);case Fo:return b.def("this",f.data);case ua:return f.data.append(p,b),f.data.ref;case Qc:return f.data.toString();case Jc:return f.data.map(function(T){return p.invoke(b,T)})}},p.attribCache={};var d={};return p.scopeAttrib=function(b){var f=c.id(b);if(f in d)return d[f];var A=X.scope[f];A||(A=X.scope[f]=new P);var T=d[f]=u(A);return T},p}function se(p){var u=p.static,_=p.dynamic,E;if(Yi in u){var S=!!u[Yi];E=yt(function(w,C){return S}),E.enable=S}else if(Yi in _){var g=_[Yi];E=sr(g,function(w,C){return w.invoke(C,g)})}return E}function le(p,u){var _=p.static,E=p.dynamic;if(jn in _){var S=_[jn];return S?(S=j.getFramebuffer(S),h.command(S,"invalid framebuffer object"),yt(function(w,C){var d=w.link(S),b=w.shared;C.set(b.framebuffer,".next",d);var f=b.context;return C.set(f,"."+gi,d+".width"),C.set(f,"."+yi,d+".height"),d})):yt(function(w,C){var d=w.shared;C.set(d.framebuffer,".next","null");var b=d.context;return C.set(b,"."+gi,b+"."+vd),C.set(b,"."+yi,b+"."+bd),"null"})}else if(jn in E){var g=E[jn];return sr(g,function(w,C){var d=w.invoke(C,g),b=w.shared,f=b.framebuffer,A=C.def(f,".getFramebuffer(",d,")");h.optional(function(){w.assert(C,"!"+d+"||"+A,"invalid framebuffer object")}),C.set(f,".next",A);var T=b.context;return C.set(T,"."+gi,A+"?"+A+".width:"+T+"."+vd),C.set(T,"."+yi,A+"?"+A+".height:"+T+"."+bd),A})}else return null}function Ee(p,u,_){var E=p.static,S=p.dynamic;function g(d){if(d in E){var b=E[d];h.commandType(b,"object","invalid "+d,_.commandStr);var f=!0,A=b.x|0,T=b.y|0,$,Q;return"width"in b?($=b.width|0,h.command($>=0,"invalid "+d,_.commandStr)):f=!1,"height"in b?(Q=b.height|0,h.command(Q>=0,"invalid "+d,_.commandStr)):f=!1,new Tt(!f&&u&&u.thisDep,!f&&u&&u.contextDep,!f&&u&&u.propDep,function(Z,ve){var ce=Z.shared.context,fe=$;"width"in b||(fe=ve.def(ce,".",gi,"-",A));var me=Q;return"height"in b||(me=ve.def(ce,".",yi,"-",T)),[A,T,fe,me]})}else if(d in S){var J=S[d],ae=sr(J,function(Z,ve){var ce=Z.invoke(ve,J);h.optional(function(){Z.assert(ve,ce+"&&typeof "+ce+'==="object"',"invalid "+d)});var fe=Z.shared.context,me=ve.def(ce,".x|0"),be=ve.def(ce,".y|0"),Pe=ve.def('"width" in ',ce,"?",ce,".width|0:","(",fe,".",gi,"-",me,")"),Je=ve.def('"height" in ',ce,"?",ce,".height|0:","(",fe,".",yi,"-",be,")");return h.optional(function(){Z.assert(ve,Pe+">=0&&"+Je+">=0","invalid "+d)}),[me,be,Pe,Je]});return u&&(ae.thisDep=ae.thisDep||u.thisDep,ae.contextDep=ae.contextDep||u.contextDep,ae.propDep=ae.propDep||u.propDep),ae}else return u?new Tt(u.thisDep,u.contextDep,u.propDep,function(Z,ve){var ce=Z.shared.context;return[0,0,ve.def(ce,".",gi),ve.def(ce,".",yi)]}):null}var w=g(Yr);if(w){var C=w;w=new Tt(w.thisDep,w.contextDep,w.propDep,function(d,b){var f=C.append(d,b),A=d.shared.context;return b.set(A,"."+Eb,f[2]),b.set(A,"."+Pb,f[3]),f})}return{viewport:w,scissor_box:g(ca)}}function ke(p,u){var _=p.static,E=typeof _[Zi]=="string"&&typeof _[Wi]=="string";if(E){if(Object.keys(u.dynamic).length>0)return null;var S=u.static,g=Object.keys(S);if(g.length>0&&typeof S[g[0]]=="number"){for(var w=[],C=0;C<g.length;++C)h(typeof S[g[C]]=="number","must specify all vertex attribute locations when using vaos"),w.push([S[g[C]]|0,g[C]]);return w}}return null}function De(p,u,_){var E=p.static,S=p.dynamic;function g(f){if(f in E){var A=c.id(E[f]);h.optional(function(){W.shader(Pd[f],A,h.guessCommand())});var T=yt(function(){return A});return T.id=A,T}else if(f in S){var $=S[f];return sr($,function(Q,J){var ae=Q.invoke(J,$),Z=J.def(Q.shared.strings,".id(",ae,")");return h.optional(function(){J(Q.shared.shader,".shader(",Pd[f],",",Z,",",Q.command,");")}),Z})}return null}var w=g(Zi),C=g(Wi),d=null,b;return _n(w)&&_n(C)?(d=W.program(C.id,w.id,null,_),b=yt(function(f,A){return f.link(d)})):b=new Tt(w&&w.thisDep||C&&C.thisDep,w&&w.contextDep||C&&C.contextDep,w&&w.propDep||C&&C.propDep,function(f,A){var T=f.shared.shader,$;w?$=w.append(f,A):$=A.def(T,".",Zi);var Q;C?Q=C.append(f,A):Q=A.def(T,".",Wi);var J=T+".program("+Q+","+$;return h.optional(function(){J+=","+f.command}),A.def(J+")")}),{frag:w,vert:C,progVar:b,program:d}}function lt(p,u){var _=p.static,E=p.dynamic,S={},g=!1;function w(){if(Qi in _){var ve=_[Qi];return ve!==null&&X.getVAO(ve)===null&&(ve=X.createVAO(ve)),g=!0,S.vao=ve,yt(function(fe){var me=X.getVAO(ve);return me?fe.link(me):"null"})}else if(Qi in E){g=!0;var ce=E[Qi];return sr(ce,function(fe,me){var be=fe.invoke(me,ce);return me.def(fe.shared.vao+".getVAO("+be+")")})}return null}var C=w(),d=!1;function b(){if(Un in _){var ve=_[Un];if(S.elements=ve,xa(ve)){var ce=S.elements=L.create(ve,!0);ve=L.getElements(ce),d=!0}else ve&&(ve=L.getElements(ve),d=!0,h.command(ve,"invalid elements",u.commandStr));var fe=yt(function(be,Pe){if(ve){var Je=be.link(ve);return be.ELEMENTS=Je,Je}return be.ELEMENTS=null,null});return fe.value=ve,fe}else if(Un in E){d=!0;var me=E[Un];return sr(me,function(be,Pe){var Je=be.shared,Ot=Je.isBufferArgs,Wr=Je.elements,Zr=be.invoke(Pe,me),Qr=Pe.def("null"),Kt=Pe.def(Ot,"(",Zr,")"),Ir=be.cond(Kt).then(Qr,"=",Wr,".createStream(",Zr,");").else(Qr,"=",Wr,".getElements(",Zr,");");return h.optional(function(){be.assert(Ir.else,"!"+Zr+"||"+Qr,"invalid elements")}),Pe.entry(Ir),Pe.exit(be.cond(Kt).then(Wr,".destroyStream(",Qr,");")),be.ELEMENTS=Qr,Qr})}else if(g)return new Tt(C.thisDep,C.contextDep,C.propDep,function(be,Pe){return Pe.def(be.shared.vao+".currentVAO?"+be.shared.elements+".getElements("+be.shared.vao+".currentVAO.elements):null")});return null}var f=b();function A(){if(zn in _){var ve=_[zn];return S.primitive=ve,h.commandParameter(ve,fn,"invalid primitve",u.commandStr),yt(function(fe,me){return fn[ve]})}else if(zn in E){var ce=E[zn];return sr(ce,function(fe,me){var be=fe.constants.primTypes,Pe=fe.invoke(me,ce);return h.optional(function(){fe.assert(me,Pe+" in "+be,"invalid primitive, must be one of "+Object.keys(fn))}),me.def(be,"[",Pe,"]")})}else{if(d)return _n(f)?f.value?yt(function(fe,me){return me.def(fe.ELEMENTS,".primType")}):yt(function(){return Jo}):new Tt(f.thisDep,f.contextDep,f.propDep,function(fe,me){var be=fe.ELEMENTS;return me.def(be,"?",be,".primType:",Jo)});if(g)return new Tt(C.thisDep,C.contextDep,C.propDep,function(fe,me){return me.def(fe.shared.vao+".currentVAO?"+fe.shared.vao+".currentVAO.primitive:"+Jo)})}return null}function T(ve,ce){if(ve in _){var fe=_[ve]|0;return ce?S.offset=fe:S.instances=fe,h.command(!ce||fe>=0,"invalid "+ve,u.commandStr),yt(function(be,Pe){return ce&&(be.OFFSET=fe),fe})}else if(ve in E){var me=E[ve];return sr(me,function(be,Pe){var Je=be.invoke(Pe,me);return ce&&(be.OFFSET=Je,h.optional(function(){be.assert(Pe,Je+">=0","invalid "+ve)})),Je})}else if(ce){if(d)return yt(function(be,Pe){return be.OFFSET=0,0});if(g)return new Tt(C.thisDep,C.contextDep,C.propDep,function(be,Pe){return Pe.def(be.shared.vao+".currentVAO?"+be.shared.vao+".currentVAO.offset:0")})}else if(g)return new Tt(C.thisDep,C.contextDep,C.propDep,function(be,Pe){return Pe.def(be.shared.vao+".currentVAO?"+be.shared.vao+".currentVAO.instances:-1")});return null}var $=T(da,!0);function Q(){if(Hn in _){var ve=_[Hn]|0;return S.count=ve,h.command(typeof ve=="number"&&ve>=0,"invalid vertex count",u.commandStr),yt(function(){return ve})}else if(Hn in E){var ce=E[Hn];return sr(ce,function(Pe,Je){var Ot=Pe.invoke(Je,ce);return h.optional(function(){Pe.assert(Je,"typeof "+Ot+'==="number"&&'+Ot+">=0&&"+Ot+"===("+Ot+"|0)","invalid vertex count")}),Ot})}else if(d)if(_n(f)){if(f)return $?new Tt($.thisDep,$.contextDep,$.propDep,function(Pe,Je){var Ot=Je.def(Pe.ELEMENTS,".vertCount-",Pe.OFFSET);return h.optional(function(){Pe.assert(Je,Ot+">=0","invalid vertex offset/element buffer too small")}),Ot}):yt(function(Pe,Je){return Je.def(Pe.ELEMENTS,".vertCount")});var fe=yt(function(){return-1});return h.optional(function(){fe.MISSING=!0}),fe}else{var me=new Tt(f.thisDep||$.thisDep,f.contextDep||$.contextDep,f.propDep||$.propDep,function(Pe,Je){var Ot=Pe.ELEMENTS;return Pe.OFFSET?Je.def(Ot,"?",Ot,".vertCount-",Pe.OFFSET,":-1"):Je.def(Ot,"?",Ot,".vertCount:-1")});return h.optional(function(){me.DYNAMIC=!0}),me}else if(g){var be=new Tt(C.thisDep,C.contextDep,C.propDep,function(Pe,Je){return Je.def(Pe.shared.vao,".currentVAO?",Pe.shared.vao,".currentVAO.count:-1")});return be}return null}var J=A(),ae=Q(),Z=T(ha,!1);return{elements:f,primitive:J,count:ae,instances:Z,offset:$,vao:C,vaoActive:g,elementsActive:d,static:S}}function ct(p,u){var _=p.static,E=p.dynamic,S={};return ge.forEach(function(g){var w=pe(g);function C(d,b){if(g in _){var f=d(_[g]);S[w]=yt(function(){return f})}else if(g in E){var A=E[g];S[w]=sr(A,function(T,$){return b(T,$,T.invoke($,A))})}}switch(g){case od:case td:case ed:case hd:case nd:case fd:case ud:case cd:case dd:case ad:return C(function(d){return h.commandType(d,"boolean",g,u.commandStr),d},function(d,b,f){return h.optional(function(){d.assert(b,"typeof "+f+'==="boolean"',"invalid flag "+g,d.commandStr)}),f});case id:return C(function(d){return h.commandParameter(d,Ci,"invalid "+g,u.commandStr),Ci[d]},function(d,b,f){var A=d.constants.compareFuncs;return h.optional(function(){d.assert(b,f+" in "+A,"invalid "+g+", must be one of "+Object.keys(Ci))}),b.def(A,"[",f,"]")});case sd:return C(function(d){return h.command(pt(d)&&d.length===2&&typeof d[0]=="number"&&typeof d[1]=="number"&&d[0]<=d[1],"depth range is 2d array",u.commandStr),d},function(d,b,f){h.optional(function(){d.assert(b,d.shared.isArrayLike+"("+f+")&&"+f+".length===2&&typeof "+f+'[0]==="number"&&typeof '+f+'[1]==="number"&&'+f+"[0]<="+f+"[1]","depth range must be a 2d array")});var A=b.def("+",f,"[0]"),T=b.def("+",f,"[1]");return[A,T]});case Bo:return C(function(d){h.commandType(d,"object","blend.func",u.commandStr);var b="srcRGB"in d?d.srcRGB:d.src,f="srcAlpha"in d?d.srcAlpha:d.src,A="dstRGB"in d?d.dstRGB:d.dst,T="dstAlpha"in d?d.dstAlpha:d.dst;return h.commandParameter(b,Dr,w+".srcRGB",u.commandStr),h.commandParameter(f,Dr,w+".srcAlpha",u.commandStr),h.commandParameter(A,Dr,w+".dstRGB",u.commandStr),h.commandParameter(T,Dr,w+".dstAlpha",u.commandStr),h.command(Ed.indexOf(b+", "+A)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+b+", "+A+")",u.commandStr),[Dr[b],Dr[A],Dr[f],Dr[T]]},function(d,b,f){var A=d.constants.blendFuncs;h.optional(function(){d.assert(b,f+"&&typeof "+f+'==="object"',"invalid blend func, must be an object")});function T(ce,fe){var me=b.def('"',ce,fe,'" in ',f,"?",f,".",ce,fe,":",f,".",ce);return h.optional(function(){d.assert(b,me+" in "+A,"invalid "+g+"."+ce+fe+", must be one of "+Object.keys(Dr))}),me}var $=T("src","RGB"),Q=T("dst","RGB");h.optional(function(){var ce=d.constants.invalidBlendCombinations;d.assert(b,ce+".indexOf("+$+'+", "+'+Q+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var J=b.def(A,"[",$,"]"),ae=b.def(A,"[",T("src","Alpha"),"]"),Z=b.def(A,"[",Q,"]"),ve=b.def(A,"[",T("dst","Alpha"),"]");return[J,Z,ae,ve]});case $o:return C(function(d){if(typeof d=="string")return h.commandParameter(d,R,"invalid "+g,u.commandStr),[R[d],R[d]];if(typeof d=="object")return h.commandParameter(d.rgb,R,g+".rgb",u.commandStr),h.commandParameter(d.alpha,R,g+".alpha",u.commandStr),[R[d.rgb],R[d.alpha]];h.commandRaise("invalid blend.equation",u.commandStr)},function(d,b,f){var A=d.constants.blendEquations,T=b.def(),$=b.def(),Q=d.cond("typeof ",f,'==="string"');return h.optional(function(){function J(ae,Z,ve){d.assert(ae,ve+" in "+A,"invalid "+Z+", must be one of "+Object.keys(R))}J(Q.then,g,f),d.assert(Q.else,f+"&&typeof "+f+'==="object"',"invalid "+g),J(Q.else,g+".rgb",f+".rgb"),J(Q.else,g+".alpha",f+".alpha")}),Q.then(T,"=",$,"=",A,"[",f,"];"),Q.else(T,"=",A,"[",f,".rgb];",$,"=",A,"[",f,".alpha];"),b(Q),[T,$]});case rd:return C(function(d){return h.command(pt(d)&&d.length===4,"blend.color must be a 4d array",u.commandStr),dr(4,function(b){return+d[b]})},function(d,b,f){return h.optional(function(){d.assert(b,d.shared.isArrayLike+"("+f+")&&"+f+".length===4","blend.color must be a 4d array")}),dr(4,function(A){return b.def("+",f,"[",A,"]")})});case pd:return C(function(d){return h.commandType(d,"number",w,u.commandStr),d|0},function(d,b,f){return h.optional(function(){d.assert(b,"typeof "+f+'==="number"',"invalid stencil.mask")}),b.def(f,"|0")});case Ho:return C(function(d){h.commandType(d,"object",w,u.commandStr);var b=d.cmp||"keep",f=d.ref||0,A="mask"in d?d.mask:-1;return h.commandParameter(b,Ci,g+".cmp",u.commandStr),h.commandType(f,"number",g+".ref",u.commandStr),h.commandType(A,"number",g+".mask",u.commandStr),[Ci[b],f,A]},function(d,b,f){var A=d.constants.compareFuncs;h.optional(function(){function J(){d.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}J(f+"&&typeof ",f,'==="object"'),J('!("cmp" in ',f,")||(",f,".cmp in ",A,")")});var T=b.def('"cmp" in ',f,"?",A,"[",f,".cmp]",":",vn),$=b.def(f,".ref|0"),Q=b.def('"mask" in ',f,"?",f,".mask|0:-1");return[T,$,Q]});case Ko:case Xi:return C(function(d){h.commandType(d,"object",w,u.commandStr);var b=d.fail||"keep",f=d.zfail||"keep",A=d.zpass||"keep";return h.commandParameter(b,bn,g+".fail",u.commandStr),h.commandParameter(f,bn,g+".zfail",u.commandStr),h.commandParameter(A,bn,g+".zpass",u.commandStr),[g===Xi?Kn:is,bn[b],bn[f],bn[A]]},function(d,b,f){var A=d.constants.stencilOps;h.optional(function(){d.assert(b,f+"&&typeof "+f+'==="object"',"invalid "+g)});function T($){return h.optional(function(){d.assert(b,'!("'+$+'" in '+f+")||("+f+"."+$+" in "+A+")","invalid "+g+"."+$+", must be one of "+Object.keys(bn))}),b.def('"',$,'" in ',f,"?",A,"[",f,".",$,"]:",vn)}return[g===Xi?Kn:is,T("fail"),T("zfail"),T("zpass")]});case Uo:return C(function(d){h.commandType(d,"object",w,u.commandStr);var b=d.factor|0,f=d.units|0;return h.commandType(b,"number",w+".factor",u.commandStr),h.commandType(f,"number",w+".units",u.commandStr),[b,f]},function(d,b,f){h.optional(function(){d.assert(b,f+"&&typeof "+f+'==="object"',"invalid "+g)});var A=b.def(f,".factor|0"),T=b.def(f,".units|0");return[A,T]});case ld:return C(function(d){var b=0;return d==="front"?b=is:d==="back"&&(b=Kn),h.command(!!b,w,u.commandStr),b},function(d,b,f){return h.optional(function(){d.assert(b,f+'==="front"||'+f+'==="back"',"invalid cull.face")}),b.def(f,'==="front"?',is,":",Kn)});case jo:return C(function(d){return h.command(typeof d=="number"&&d>=V.lineWidthDims[0]&&d<=V.lineWidthDims[1],"invalid line width, must be a positive number between "+V.lineWidthDims[0]+" and "+V.lineWidthDims[1],u.commandStr),d},function(d,b,f){return h.optional(function(){d.assert(b,"typeof "+f+'==="number"&&'+f+">="+V.lineWidthDims[0]+"&&"+f+"<="+V.lineWidthDims[1],"invalid line width")}),f});case Go:return C(function(d){return h.commandParameter(d,tl,w,u.commandStr),tl[d]},function(d,b,f){return h.optional(function(){d.assert(b,f+'==="cw"||'+f+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),b.def(f+'==="cw"?'+wd+":"+el)});case No:return C(function(d){return h.command(pt(d)&&d.length===4,"color.mask must be length 4 array",u.commandStr),d.map(function(b){return!!b})},function(d,b,f){return h.optional(function(){d.assert(b,d.shared.isArrayLike+"("+f+")&&"+f+".length===4","invalid color.mask")}),dr(4,function(A){return"!!"+f+"["+A+"]"})});case zo:return C(function(d){h.command(typeof d=="object"&&d,w,u.commandStr);var b="value"in d?d.value:1,f=!!d.invert;return h.command(typeof b=="number"&&b>=0&&b<=1,"sample.coverage.value must be a number between 0 and 1",u.commandStr),[b,f]},function(d,b,f){h.optional(function(){d.assert(b,f+"&&typeof "+f+'==="object"',"invalid sample.coverage")});var A=b.def('"value" in ',f,"?+",f,".value:1"),T=b.def("!!",f,".invert");return[A,T]})}}),S}function Fe(p,u){var _=p.static,E=p.dynamic,S={};return Object.keys(_).forEach(function(g){var w=_[g],C;if(typeof w=="number"||typeof w=="boolean")C=yt(function(){return w});else if(typeof w=="function"){var d=w._reglType;d==="texture2d"||d==="textureCube"?C=yt(function(b){return b.link(w)}):d==="framebuffer"||d==="framebufferCube"?(h.command(w.color.length>0,'missing color attachment for framebuffer sent to uniform "'+g+'"',u.commandStr),C=yt(function(b){return b.link(w.color[0])})):h.commandRaise('invalid data for uniform "'+g+'"',u.commandStr)}else pt(w)?C=yt(function(b){var f=b.global.def("[",dr(w.length,function(A){return h.command(typeof w[A]=="number"||typeof w[A]=="boolean","invalid uniform "+g,b.commandStr),w[A]}),"]");return f}):h.commandRaise('invalid or missing data for uniform "'+g+'"',u.commandStr);C.value=w,S[g]=C}),Object.keys(E).forEach(function(g){var w=E[g];S[g]=sr(w,function(C,d){return C.invoke(d,w)})}),S}function Ct(p,u){var _=p.static,E=p.dynamic,S={};return Object.keys(_).forEach(function(g){var w=_[g],C=c.id(g),d=new P;if(xa(w))d.state=wi,d.buffer=I.getBuffer(I.create(w,xi,!1,!0)),d.type=0;else{var b=I.getBuffer(w);if(b)d.state=wi,d.buffer=b,d.type=0;else if(h.command(typeof w=="object"&&w,"invalid data for attribute "+g,u.commandStr),"constant"in w){var f=w.constant;d.buffer="null",d.state=Ro,typeof f=="number"?d.x=f:(h.command(pt(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+g,u.commandStr),_i.forEach(function(Z,ve){ve<f.length&&(d[Z]=f[ve])}))}else{xa(w.buffer)?b=I.getBuffer(I.create(w.buffer,xi,!1,!0)):b=I.getBuffer(w.buffer),h.command(!!b,'missing buffer for attribute "'+g+'"',u.commandStr);var A=w.offset|0;h.command(A>=0,'invalid offset for attribute "'+g+'"',u.commandStr);var T=w.stride|0;h.command(T>=0&&T<256,'invalid stride for attribute "'+g+'", must be integer betweeen [0, 255]',u.commandStr);var $=w.size|0;h.command(!("size"in w)||$>0&&$<=4,'invalid size for attribute "'+g+'", must be 1,2,3,4',u.commandStr);var Q=!!w.normalized,J=0;"type"in w&&(h.commandParameter(w.type,Fn,"invalid type for attribute "+g,u.commandStr),J=Fn[w.type]);var ae=w.divisor|0;h.optional(function(){"divisor"in w&&(h.command(ae===0||K,'cannot specify divisor for attribute "'+g+'", instancing not supported',u.commandStr),h.command(ae>=0,'invalid divisor for attribute "'+g+'"',u.commandStr));var Z=u.commandStr,ve=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(w).forEach(function(ce){h.command(ve.indexOf(ce)>=0,'unknown parameter "'+ce+'" for attribute pointer "'+g+'" (valid parameters are '+ve+")",Z)})}),d.buffer=b,d.state=wi,d.size=$,d.normalized=Q,d.type=J||b.dtype,d.offset=A,d.stride=T,d.divisor=ae}}S[g]=yt(function(Z,ve){var ce=Z.attribCache;if(C in ce)return ce[C];var fe={isStream:!1};return Object.keys(d).forEach(function(me){fe[me]=d[me]}),d.buffer&&(fe.buffer=Z.link(d.buffer),fe.type=fe.type||fe.buffer+".dtype"),ce[C]=fe,fe})}),Object.keys(E).forEach(function(g){var w=E[g];function C(d,b){var f=d.invoke(b,w),A=d.shared,T=d.constants,$=A.isBufferArgs,Q=A.buffer;h.optional(function(){d.assert(b,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+$+"("+f+")||"+Q+".getBuffer("+f+")||"+Q+".getBuffer("+f+".buffer)||"+$+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+A.isArrayLike+"("+f+".constant))))",'invalid dynamic attribute "'+g+'"')});var J={isStream:b.def(!1)},ae=new P;ae.state=wi,Object.keys(ae).forEach(function(fe){J[fe]=b.def(""+ae[fe])});var Z=J.buffer,ve=J.type;b("if(",$,"(",f,")){",J.isStream,"=true;",Z,"=",Q,".createStream(",xi,",",f,");",ve,"=",Z,".dtype;","}else{",Z,"=",Q,".getBuffer(",f,");","if(",Z,"){",ve,"=",Z,".dtype;",'}else if("constant" in ',f,"){",J.state,"=",Ro,";","if(typeof "+f+'.constant === "number"){',J[_i[0]],"=",f,".constant;",_i.slice(1).map(function(fe){return J[fe]}).join("="),"=0;","}else{",_i.map(function(fe,me){return J[fe]+"="+f+".constant.length>"+me+"?"+f+".constant["+me+"]:0;"}).join(""),"}}else{","if(",$,"(",f,".buffer)){",Z,"=",Q,".createStream(",xi,",",f,".buffer);","}else{",Z,"=",Q,".getBuffer(",f,".buffer);","}",ve,'="type" in ',f,"?",T.glTypes,"[",f,".type]:",Z,".dtype;",J.normalized,"=!!",f,".normalized;");function ce(fe){b(J[fe],"=",f,".",fe,"|0;")}return ce("size"),ce("offset"),ce("stride"),ce("divisor"),b("}}"),b.exit("if(",J.isStream,"){",Q,".destroyStream(",Z,");","}"),J}S[g]=sr(w,C)}),S}function ot(p){var u=p.static,_=p.dynamic,E={};return Object.keys(u).forEach(function(S){var g=u[S];E[S]=yt(function(w,C){return typeof g=="number"||typeof g=="boolean"?""+g:w.link(g)})}),Object.keys(_).forEach(function(S){var g=_[S];E[S]=sr(g,function(w,C){return w.invoke(C,g)})}),E}function xt(p,u,_,E,S){var g=p.static,w=p.dynamic;h.optional(function(){var ce=[jn,Wi,Zi,Un,zn,da,Hn,ha,Yi,Qi].concat(ge);function fe(me){Object.keys(me).forEach(function(be){h.command(ce.indexOf(be)>=0,'unknown parameter "'+be+'"',S.commandStr)})}fe(g),fe(w)});var C=ke(p,u),d=le(p),b=Ee(p,d,S),f=lt(p,S),A=ct(p,S),T=De(p,S,C);function $(ce){var fe=b[ce];fe&&(A[ce]=fe)}$(Yr),$(pe(ca));var Q=Object.keys(A).length>0,J={framebuffer:d,draw:f,shader:T,state:A,dirty:Q,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(J.profile=se(p),J.uniforms=Fe(_,S),J.drawVAO=J.scopeVAO=f.vao,!J.drawVAO&&T.program&&!C&&v.angle_instanced_arrays&&f.static.elements){var ae=!0,Z=T.program.attributes.map(function(ce){var fe=u.static[ce];return ae=ae&&!!fe,fe});if(ae&&Z.length>0){var ve=X.getVAO(X.createVAO({attributes:Z,elements:f.static.elements}));J.drawVAO=new Tt(null,null,null,function(ce,fe){return ce.link(ve)}),J.useVAO=!0}}return C?J.useVAO=!0:J.attributes=Ct(u,S),J.context=ot(E),J}function Et(p,u,_){var E=p.shared,S=E.context,g=p.scope();Object.keys(_).forEach(function(w){u.save(S,"."+w);var C=_[w],d=C.append(p,u);Array.isArray(d)?g(S,".",w,"=[",d.join(),"];"):g(S,".",w,"=",d,";")}),u(g)}function Pt(p,u,_,E){var S=p.shared,g=S.gl,w=S.framebuffer,C;ue&&(C=u.def(S.extensions,".webgl_draw_buffers"));var d=p.constants,b=d.drawBuffer,f=d.backBuffer,A;_?A=_.append(p,u):A=u.def(w,".next"),E||u("if(",A,"!==",w,".cur){"),u("if(",A,"){",g,".bindFramebuffer(",Cd,",",A,".framebuffer);"),ue&&u(C,".drawBuffersWEBGL(",b,"[",A,".colorAttachments.length]);"),u("}else{",g,".bindFramebuffer(",Cd,",null);"),ue&&u(C,".drawBuffersWEBGL(",f,");"),u("}",w,".cur=",A,";"),E||u("}")}function Vt(p,u,_){var E=p.shared,S=E.gl,g=p.current,w=p.next,C=E.current,d=E.next,b=p.cond(C,".dirty");ge.forEach(function(f){var A=pe(f);if(!(A in _.state)){var T,$;if(A in w){T=w[A],$=g[A];var Q=dr(oe[A].length,function(ae){return b.def(T,"[",ae,"]")});b(p.cond(Q.map(function(ae,Z){return ae+"!=="+$+"["+Z+"]"}).join("||")).then(S,".",M[A],"(",Q,");",Q.map(function(ae,Z){return $+"["+Z+"]="+ae}).join(";"),";"))}else{T=b.def(d,".",A);var J=p.cond(T,"!==",C,".",A);b(J),A in F?J(p.cond(T).then(S,".enable(",F[A],");").else(S,".disable(",F[A],");"),C,".",A,"=",T,";"):J(S,".",M[A],"(",T,");",C,".",A,"=",T,";")}}}),Object.keys(_.state).length===0&&b(C,".dirty=false;"),u(b)}function Nt(p,u,_,E){var S=p.shared,g=p.current,w=S.current,C=S.gl;Ad(Object.keys(_)).forEach(function(d){var b=_[d];if(!(E&&!E(b))){var f=b.append(p,u);if(F[d]){var A=F[d];_n(b)?f?u(C,".enable(",A,");"):u(C,".disable(",A,");"):u(p.cond(f).then(C,".enable(",A,");").else(C,".disable(",A,");")),u(w,".",d,"=",f,";")}else if(pt(f)){var T=g[d];u(C,".",M[d],"(",f,");",f.map(function($,Q){return T+"["+Q+"]="+$}).join(";"),";")}else u(C,".",M[d],"(",f,");",w,".",d,"=",f,";")}})}function ft(p,u){K&&(p.instancing=u.def(p.shared.extensions,".angle_instanced_arrays"))}function Oe(p,u,_,E,S){var g=p.shared,w=p.stats,C=g.current,d=g.timer,b=_.profile;function f(){return typeof performance>"u"?"Date.now()":"performance.now()"}var A,T;function $(ce){A=u.def(),ce(A,"=",f(),";"),typeof S=="string"?ce(w,".count+=",S,";"):ce(w,".count++;"),z&&(E?(T=u.def(),ce(T,"=",d,".getNumPendingQueries();")):ce(d,".beginQuery(",w,");"))}function Q(ce){ce(w,".cpuTime+=",f(),"-",A,";"),z&&(E?ce(d,".pushScopeStats(",T,",",d,".getNumPendingQueries(),",w,");"):ce(d,".endQuery();"))}function J(ce){var fe=u.def(C,".profile");u(C,".profile=",ce,";"),u.exit(C,".profile=",fe,";")}var ae;if(b){if(_n(b)){b.enable?($(u),Q(u.exit),J("true")):J("false");return}ae=b.append(p,u),J(ae)}else ae=u.def(C,".profile");var Z=p.block();$(Z),u("if(",ae,"){",Z,"}");var ve=p.block();Q(ve),u.exit("if(",ae,"){",ve,"}")}function Gt(p,u,_,E,S){var g=p.shared;function w(d){switch(d){case pa:case va:case wa:return 2;case fa:case ba:case ga:return 3;case ma:case _a:case ya:return 4;default:return 1}}function C(d,b,f){var A=g.gl,T=u.def(d,".location"),$=u.def(g.attributes,"[",T,"]"),Q=f.state,J=f.buffer,ae=[f.x,f.y,f.z,f.w],Z=["buffer","normalized","offset","stride"];function ve(){u("if(!",$,".buffer){",A,".enableVertexAttribArray(",T,");}");var fe=f.type,me;if(f.size?me=u.def(f.size,"||",b):me=b,u("if(",$,".type!==",fe,"||",$,".size!==",me,"||",Z.map(function(Pe){return $+"."+Pe+"!=="+f[Pe]}).join("||"),"){",A,".bindBuffer(",xi,",",J,".buffer);",A,".vertexAttribPointer(",[T,me,fe,f.normalized,f.stride,f.offset],");",$,".type=",fe,";",$,".size=",me,";",Z.map(function(Pe){return $+"."+Pe+"="+f[Pe]+";"}).join(""),"}"),K){var be=f.divisor;u("if(",$,".divisor!==",be,"){",p.instancing,".vertexAttribDivisorANGLE(",[T,be],");",$,".divisor=",be,";}")}}function ce(){u("if(",$,".buffer){",A,".disableVertexAttribArray(",T,");",$,".buffer=null;","}if(",_i.map(function(fe,me){return $+"."+fe+"!=="+ae[me]}).join("||"),"){",A,".vertexAttrib4f(",T,",",ae,");",_i.map(function(fe,me){return $+"."+fe+"="+ae[me]+";"}).join(""),"}")}Q===wi?ve():Q===Ro?ce():(u("if(",Q,"===",wi,"){"),ve(),u("}else{"),ce(),u("}"))}E.forEach(function(d){var b=d.name,f=_.attributes[b],A;if(f){if(!S(f))return;A=f.append(p,u)}else{if(!S(Sd))return;var T=p.scopeAttrib(b);h.optional(function(){p.assert(u,T+".state","missing attribute "+b)}),A={},Object.keys(new P).forEach(function($){A[$]=u.def(T,".",$)})}C(p.link(d),w(d.info.type),A)})}function ze(p,u,_,E,S,g){for(var w=p.shared,C=w.gl,d,b=0;b<E.length;++b){var f=E[b],A=f.name,T=f.info.type,$=_.uniforms[A],Q=p.link(f),J=Q+".location",ae;if($){if(!S($))continue;if(_n($)){var Z=$.value;if(h.command(Z!==null&&typeof Z<"u",'missing uniform "'+A+'"',p.commandStr),T===rs||T===ns){h.command(typeof Z=="function"&&(T===rs&&(Z._reglType==="texture2d"||Z._reglType==="framebuffer")||T===ns&&(Z._reglType==="textureCube"||Z._reglType==="framebufferCube")),"invalid texture for uniform "+A,p.commandStr);var ve=p.link(Z._texture||Z.color[0]._texture);u(C,".uniform1i(",J,",",ve+".bind());"),u.exit(ve,".unbind();")}else if(T===Ji||T===es||T===ts){h.optional(function(){h.command(pt(Z),"invalid matrix for uniform "+A,p.commandStr),h.command(T===Ji&&Z.length===4||T===es&&Z.length===9||T===ts&&Z.length===16,"invalid length for matrix uniform "+A,p.commandStr)});var ce=p.global.def("new Float32Array(["+Array.prototype.slice.call(Z)+"])"),fe=2;T===es?fe=3:T===ts&&(fe=4),u(C,".uniformMatrix",fe,"fv(",J,",false,",ce,");")}else{switch(T){case Wo:h.commandType(Z,"number","uniform "+A,p.commandStr),d="1f";break;case pa:h.command(pt(Z)&&Z.length===2,"uniform "+A,p.commandStr),d="2f";break;case fa:h.command(pt(Z)&&Z.length===3,"uniform "+A,p.commandStr),d="3f";break;case ma:h.command(pt(Z)&&Z.length===4,"uniform "+A,p.commandStr),d="4f";break;case Qo:h.commandType(Z,"boolean","uniform "+A,p.commandStr),d="1i";break;case Zo:h.commandType(Z,"number","uniform "+A,p.commandStr),d="1i";break;case wa:h.command(pt(Z)&&Z.length===2,"uniform "+A,p.commandStr),d="2i";break;case va:h.command(pt(Z)&&Z.length===2,"uniform "+A,p.commandStr),d="2i";break;case ga:h.command(pt(Z)&&Z.length===3,"uniform "+A,p.commandStr),d="3i";break;case ba:h.command(pt(Z)&&Z.length===3,"uniform "+A,p.commandStr),d="3i";break;case ya:h.command(pt(Z)&&Z.length===4,"uniform "+A,p.commandStr),d="4i";break;case _a:h.command(pt(Z)&&Z.length===4,"uniform "+A,p.commandStr),d="4i";break}u(C,".uniform",d,"(",J,",",pt(Z)?Array.prototype.slice.call(Z):Z,");")}continue}else ae=$.append(p,u)}else{if(!S(Sd))continue;ae=u.def(w.uniforms,"[",c.id(A),"]")}T===rs?(h(!Array.isArray(ae),"must specify a scalar prop for textures"),u("if(",ae,"&&",ae,'._reglType==="framebuffer"){',ae,"=",ae,".color[0];","}")):T===ns&&(h(!Array.isArray(ae),"must specify a scalar prop for cube maps"),u("if(",ae,"&&",ae,'._reglType==="framebufferCube"){',ae,"=",ae,".color[0];","}")),h.optional(function(){function Kt(kr,Dd){p.assert(u,kr,'bad data or missing for uniform "'+A+'".  '+Dd)}function Ir(kr){h(!Array.isArray(ae),"must not specify an array type for uniform"),Kt("typeof "+ae+'==="'+kr+'"',"invalid type, expected "+kr)}function yr(kr,Dd){Array.isArray(ae)?h(ae.length===kr,"must have length "+kr):Kt(w.isArrayLike+"("+ae+")&&"+ae+".length==="+kr,"invalid vector, should have length "+kr,p.commandStr)}function Rd(kr){h(!Array.isArray(ae),"must not specify a value type"),Kt("typeof "+ae+'==="function"&&'+ae+'._reglType==="texture'+(kr===_d?"2d":"Cube")+'"',"invalid texture type",p.commandStr)}switch(T){case Zo:Ir("number");break;case va:yr(2);break;case ba:yr(3);break;case _a:yr(4);break;case Wo:Ir("number");break;case pa:yr(2);break;case fa:yr(3);break;case ma:yr(4);break;case Qo:Ir("boolean");break;case wa:yr(2);break;case ga:yr(3);break;case ya:yr(4);break;case Ji:yr(4);break;case es:yr(9);break;case ts:yr(16);break;case rs:Rd(_d);break;case ns:Rd(kb);break}});var me=1;switch(T){case rs:case ns:var be=u.def(ae,"._texture");u(C,".uniform1i(",J,",",be,".bind());"),u.exit(be,".unbind();");continue;case Zo:case Qo:d="1i";break;case va:case wa:d="2i",me=2;break;case ba:case ga:d="3i",me=3;break;case _a:case ya:d="4i",me=4;break;case Wo:d="1f";break;case pa:d="2f",me=2;break;case fa:d="3f",me=3;break;case ma:d="4f",me=4;break;case Ji:d="Matrix2fv";break;case es:d="Matrix3fv";break;case ts:d="Matrix4fv";break}if(d.charAt(0)==="M"){u(C,".uniform",d,"(",J,",");var Pe=Math.pow(T-Ji+2,2),Je=p.global.def("new Float32Array(",Pe,")");Array.isArray(ae)?u("false,(",dr(Pe,function(Kt){return Je+"["+Kt+"]="+ae[Kt]}),",",Je,")"):u("false,(Array.isArray(",ae,")||",ae," instanceof Float32Array)?",ae,":(",dr(Pe,function(Kt){return Je+"["+Kt+"]="+ae+"["+Kt+"]"}),",",Je,")"),u(");")}else if(me>1){for(var Ot=[],Wr=[],Zr=0;Zr<me;++Zr)Array.isArray(ae)?Wr.push(ae[Zr]):Wr.push(u.def(ae+"["+Zr+"]")),g&&Ot.push(u.def());g&&u("if(!",p.batchId,"||",Ot.map(function(Kt,Ir){return Kt+"!=="+Wr[Ir]}).join("||"),"){",Ot.map(function(Kt,Ir){return Kt+"="+Wr[Ir]+";"}).join("")),u(C,".uniform",d,"(",J,",",Wr.join(","),");"),g&&u("}")}else{if(h(!Array.isArray(ae),"uniform value must not be an array"),g){var Qr=u.def();u("if(!",p.batchId,"||",Qr,"!==",ae,"){",Qr,"=",ae,";")}u(C,".uniform",d,"(",J,",",ae,");"),g&&u("}")}}}function xe(p,u,_,E){var S=p.shared,g=S.gl,w=S.draw,C=E.draw;function d(){var me=C.elements,be,Pe=u;return me?((me.contextDep&&E.contextDynamic||me.propDep)&&(Pe=_),be=me.append(p,Pe),C.elementsActive&&Pe("if("+be+")"+g+".bindBuffer("+Yo+","+be+".buffer.buffer);")):(be=Pe.def(),Pe(be,"=",w,".",Un,";","if(",be,"){",g,".bindBuffer(",Yo,",",be,".buffer.buffer);}","else if(",S.vao,".currentVAO){",be,"=",p.shared.elements+".getElements("+S.vao,".currentVAO.elements);",B?"":"if("+be+")"+g+".bindBuffer("+Yo+","+be+".buffer.buffer);","}")),be}function b(){var me=C.count,be,Pe=u;return me?((me.contextDep&&E.contextDynamic||me.propDep)&&(Pe=_),be=me.append(p,Pe),h.optional(function(){me.MISSING&&p.assert(u,"false","missing vertex count"),me.DYNAMIC&&p.assert(Pe,be+">=0","missing vertex count")})):(be=Pe.def(w,".",Hn),h.optional(function(){p.assert(Pe,be+">=0","missing vertex count")})),be}var f=d();function A(me){var be=C[me];return be?be.contextDep&&E.contextDynamic||be.propDep?be.append(p,_):be.append(p,u):u.def(w,".",me)}var T=A(zn),$=A(da),Q=b();if(typeof Q=="number"){if(Q===0)return}else _("if(",Q,"){"),_.exit("}");var J,ae;K&&(J=A(ha),ae=p.instancing);var Z=f+".type",ve=C.elements&&_n(C.elements)&&!C.vaoActive;function ce(){function me(){_(ae,".drawElementsInstancedANGLE(",[T,Q,Z,$+"<<(("+Z+"-"+Zc+")>>1)",J],");")}function be(){_(ae,".drawArraysInstancedANGLE(",[T,$,Q,J],");")}f&&f!=="null"?ve?me():(_("if(",f,"){"),me(),_("}else{"),be(),_("}")):be()}function fe(){function me(){_(g+".drawElements("+[T,Q,Z,$+"<<(("+Z+"-"+Zc+")>>1)"]+");")}function be(){_(g+".drawArrays("+[T,$,Q]+");")}f&&f!=="null"?ve?me():(_("if(",f,"){"),me(),_("}else{"),be(),_("}")):be()}K&&(typeof J!="number"||J>=0)?typeof J=="string"?(_("if(",J,">0){"),ce(),_("}else if(",J,"<0){"),fe(),_("}")):ce():fe()}function Me(p,u,_,E,S){var g=Te(),w=g.proc("body",S);return h.optional(function(){g.commandStr=u.commandStr,g.command=g.link(u.commandStr)}),K&&(g.instancing=w.def(g.shared.extensions,".angle_instanced_arrays")),p(g,w,_,E),g.compile().body}function Be(p,u,_,E){ft(p,u),_.useVAO?_.drawVAO?u(p.shared.vao,".setVAO(",_.drawVAO.append(p,u),");"):u(p.shared.vao,".setVAO(",p.shared.vao,".targetVAO);"):(u(p.shared.vao,".setVAO(null);"),Gt(p,u,_,E.attributes,function(){return!0})),ze(p,u,_,E.uniforms,function(){return!0},!1),xe(p,u,u,_)}function mt(p,u){var _=p.proc("draw",1);ft(p,_),Et(p,_,u.context),Pt(p,_,u.framebuffer),Vt(p,_,u),Nt(p,_,u.state),Oe(p,_,u,!1,!0);var E=u.shader.progVar.append(p,_);if(_(p.shared.gl,".useProgram(",E,".program);"),u.shader.program)Be(p,_,u,u.shader.program);else{_(p.shared.vao,".setVAO(null);");var S=p.global.def("{}"),g=_.def(E,".id"),w=_.def(S,"[",g,"]");_(p.cond(w).then(w,".call(this,a0);").else(w,"=",S,"[",g,"]=",p.link(function(C){return Me(Be,p,u,C,1)}),"(",E,");",w,".call(this,a0);"))}Object.keys(u.state).length>0&&_(p.shared.current,".dirty=true;"),p.shared.vao&&_(p.shared.vao,".setVAO(null);")}function Mr(p,u,_,E){p.batchId="a1",ft(p,u);function S(){return!0}Gt(p,u,_,E.attributes,S),ze(p,u,_,E.uniforms,S,!1),xe(p,u,u,_)}function qn(p,u,_,E){ft(p,u);var S=_.contextDep,g=u.def(),w="a0",C="a1",d=u.def();p.shared.props=d,p.batchId=g;var b=p.scope(),f=p.scope();u(b.entry,"for(",g,"=0;",g,"<",C,";++",g,"){",d,"=",w,"[",g,"];",f,"}",b.exit);function A(Z){return Z.contextDep&&S||Z.propDep}function T(Z){return!A(Z)}if(_.needsContext&&Et(p,f,_.context),_.needsFramebuffer&&Pt(p,f,_.framebuffer),Nt(p,f,_.state,A),_.profile&&A(_.profile)&&Oe(p,f,_,!1,!0),E)_.useVAO?_.drawVAO?A(_.drawVAO)?f(p.shared.vao,".setVAO(",_.drawVAO.append(p,f),");"):b(p.shared.vao,".setVAO(",_.drawVAO.append(p,b),");"):b(p.shared.vao,".setVAO(",p.shared.vao,".targetVAO);"):(b(p.shared.vao,".setVAO(null);"),Gt(p,b,_,E.attributes,T),Gt(p,f,_,E.attributes,A)),ze(p,b,_,E.uniforms,T,!1),ze(p,f,_,E.uniforms,A,!0),xe(p,b,f,_);else{var $=p.global.def("{}"),Q=_.shader.progVar.append(p,f),J=f.def(Q,".id"),ae=f.def($,"[",J,"]");f(p.shared.gl,".useProgram(",Q,".program);","if(!",ae,"){",ae,"=",$,"[",J,"]=",p.link(function(Z){return Me(Mr,p,_,Z,2)}),"(",Q,");}",ae,".call(this,a0[",g,"],",g,");")}}function m(p,u){var _=p.proc("batch",2);p.batchId="0",ft(p,_);var E=!1,S=!0;Object.keys(u.context).forEach(function($){E=E||u.context[$].propDep}),E||(Et(p,_,u.context),S=!1);var g=u.framebuffer,w=!1;g?(g.propDep?E=w=!0:g.contextDep&&E&&(w=!0),w||Pt(p,_,g)):Pt(p,_,null),u.state.viewport&&u.state.viewport.propDep&&(E=!0);function C($){return $.contextDep&&E||$.propDep}Vt(p,_,u),Nt(p,_,u.state,function($){return!C($)}),(!u.profile||!C(u.profile))&&Oe(p,_,u,!1,"a1"),u.contextDep=E,u.needsContext=S,u.needsFramebuffer=w;var d=u.shader.progVar;if(d.contextDep&&E||d.propDep)qn(p,_,u,null);else{var b=d.append(p,_);if(_(p.shared.gl,".useProgram(",b,".program);"),u.shader.program)qn(p,_,u,u.shader.program);else{_(p.shared.vao,".setVAO(null);");var f=p.global.def("{}"),A=_.def(b,".id"),T=_.def(f,"[",A,"]");_(p.cond(T).then(T,".call(this,a0,a1);").else(T,"=",f,"[",A,"]=",p.link(function($){return Me(qn,p,u,$,2)}),"(",b,");",T,".call(this,a0,a1);"))}}Object.keys(u.state).length>0&&_(p.shared.current,".dirty=true;"),p.shared.vao&&_(p.shared.vao,".setVAO(null);")}function O(p,u){var _=p.proc("scope",3);p.batchId="a2";var E=p.shared,S=E.current;Et(p,_,u.context),u.framebuffer&&u.framebuffer.append(p,_),Ad(Object.keys(u.state)).forEach(function(w){var C=u.state[w],d=C.append(p,_);pt(d)?d.forEach(function(b,f){_.set(p.next[w],"["+f+"]",b)}):_.set(E.next,"."+w,d)}),Oe(p,_,u,!0,!0),[Un,da,Hn,ha,zn].forEach(function(w){var C=u.draw[w];C&&_.set(E.draw,"."+w,""+C.append(p,_))}),Object.keys(u.uniforms).forEach(function(w){var C=u.uniforms[w].append(p,_);Array.isArray(C)&&(C="["+C.join()+"]"),_.set(E.uniforms,"["+c.id(w)+"]",C)}),Object.keys(u.attributes).forEach(function(w){var C=u.attributes[w].append(p,_),d=p.scopeAttrib(w);Object.keys(new P).forEach(function(b){_.set(d,"."+b,C[b])})}),u.scopeVAO&&_.set(E.vao,".targetVAO",u.scopeVAO.append(p,_));function g(w){var C=u.shader[w];C&&_.set(E.shader,"."+w,C.append(p,_))}g(Wi),g(Zi),Object.keys(u.state).length>0&&(_(S,".dirty=true;"),_.exit(S,".dirty=true;")),_("a1(",p.shared.context,",a0,",p.batchId,");")}function k(p){if(!(typeof p!="object"||pt(p))){for(var u=Object.keys(p),_=0;_<u.length;++_)if(wt.isDynamic(p[u[_]]))return!0;return!1}}function he(p,u,_){var E=u.static[_];if(!E||!k(E))return;var S=p.global,g=Object.keys(E),w=!1,C=!1,d=!1,b=p.global.def("{}");g.forEach(function(A){var T=E[A];if(wt.isDynamic(T)){typeof T=="function"&&(T=E[A]=wt.unbox(T));var $=sr(T,null);w=w||$.thisDep,d=d||$.propDep,C=C||$.contextDep}else{switch(S(b,".",A,"="),typeof T){case"number":S(T);break;case"string":S('"',T,'"');break;case"object":Array.isArray(T)&&S("[",T.join(),"]");break;default:S(p.link(T));break}S(";")}});function f(A,T){g.forEach(function($){var Q=E[$];if(wt.isDynamic(Q)){var J=A.invoke(T,Q);T(b,".",$,"=",J,";")}})}u.dynamic[_]=new wt.DynamicVariable(ua,{thisDep:w,contextDep:C,propDep:d,ref:b,append:f}),delete u.static[_]}function Re(p,u,_,E,S){var g=Te();g.stats=g.link(S),Object.keys(u.static).forEach(function(C){he(g,u,C)}),Ab.forEach(function(C){he(g,p,C)});var w=xt(p,u,_,E,g);return mt(g,w),O(g,w),m(g,w),n(g.compile(),{destroy:function(){w.shader.program.destroy()}})}return{next:ie,current:oe,procs:function(){var p=Te(),u=p.proc("poll"),_=p.proc("refresh"),E=p.block();u(E),_(E);var S=p.shared,g=S.gl,w=S.next,C=S.current;E(C,".dirty=false;"),Pt(p,u),Pt(p,_,null,!0);var d;K&&(d=p.link(K)),v.oes_vertex_array_object&&_(p.link(v.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var b=0;b<V.maxAttributes;++b){var f=_.def(S.attributes,"[",b,"]"),A=p.cond(f,".buffer");A.then(g,".enableVertexAttribArray(",b,");",g,".bindBuffer(",xi,",",f,".buffer.buffer);",g,".vertexAttribPointer(",b,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(g,".disableVertexAttribArray(",b,");",g,".vertexAttrib4f(",b,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),_(A),K&&_(d,".vertexAttribDivisorANGLE(",b,",",f,".divisor);")}return _(p.shared.vao,".currentVAO=null;",p.shared.vao,".setVAO(",p.shared.vao,".targetVAO);"),Object.keys(F).forEach(function(T){var $=F[T],Q=E.def(w,".",T),J=p.block();J("if(",Q,"){",g,".enable(",$,")}else{",g,".disable(",$,")}",C,".",T,"=",Q,";"),_(J),u("if(",Q,"!==",C,".",T,"){",J,"}")}),Object.keys(M).forEach(function(T){var $=M[T],Q=oe[T],J,ae,Z=p.block();if(Z(g,".",$,"("),pt(Q)){var ve=Q.length;J=p.global.def(w,".",T),ae=p.global.def(C,".",T),Z(dr(ve,function(ce){return J+"["+ce+"]"}),");",dr(ve,function(ce){return ae+"["+ce+"]="+J+"["+ce+"];"}).join("")),u("if(",dr(ve,function(ce){return J+"["+ce+"]!=="+ae+"["+ce+"]"}).join("||"),"){",Z,"}")}else J=E.def(w,".",T),ae=E.def(C,".",T),Z(J,");",C,".",T,"=",J,";"),u("if(",J,"!==",ae,"){",Z,"}");_(Z)}),p.compile()}(),compile:Re}}function Hb(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Kb=34918,qb=34919,Td=35007,Xb=function(a,c){if(!c.ext_disjoint_timer_query)return null;var v=[];function V(){return v.pop()||c.ext_disjoint_timer_query.createQueryEXT()}function I(K){v.push(K)}var L=[];function D(K){var ue=V();c.ext_disjoint_timer_query.beginQueryEXT(Td,ue),L.push(ue),z(L.length-1,L.length,K)}function j(){c.ext_disjoint_timer_query.endQueryEXT(Td)}function G(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var X=[];function W(){return X.pop()||new G}function Y(K){X.push(K)}var ee=[];function z(K,ue,B){var oe=W();oe.startQueryIndex=K,oe.endQueryIndex=ue,oe.sum=0,oe.stats=B,ee.push(oe)}var q=[],P=[];function R(){var K,ue,B=L.length;if(B!==0){P.length=Math.max(P.length,B+1),q.length=Math.max(q.length,B+1),q[0]=0,P[0]=0;var oe=0;for(K=0,ue=0;ue<L.length;++ue){var ie=L[ue];c.ext_disjoint_timer_query.getQueryObjectEXT(ie,qb)?(oe+=c.ext_disjoint_timer_query.getQueryObjectEXT(ie,Kb),I(ie)):L[K++]=ie,q[ue+1]=oe,P[ue+1]=K}for(L.length=K,K=0,ue=0;ue<ee.length;++ue){var ge=ee[ue],F=ge.startQueryIndex,M=ge.endQueryIndex;ge.sum+=q[M]-q[F];var pe=P[F],te=P[M];te===pe?(ge.stats.gpuTime+=ge.sum/1e6,Y(ge)):(ge.startQueryIndex=pe,ge.endQueryIndex=te,ee[K++]=ge)}ee.length=K}}return{beginQuery:D,endQuery:j,pushScopeStats:z,update:R,getNumPendingQueries:function(){return L.length},clear:function(){v.push.apply(v,L);for(var K=0;K<v.length;K++)c.ext_disjoint_timer_query.deleteQueryEXT(v[K]);L.length=0,v.length=0},restore:function(){L.length=0,v.length=0}}},Yb=16384,Wb=256,Zb=1024,Qb=34962,kd="webglcontextlost",Ld="webglcontextrestored",Vd=1,Jb=2,e_=3;function Od(a,c){for(var v=0;v<a.length;++v)if(a[v]===c)return v;return-1}function t_(a){var c=Jf(a);if(!c)return null;var v=c.gl,V=v.getContextAttributes(),I=v.isContextLost(),L=em(v,c);if(!L)return null;var D=In(),j=Hb(),G=L.extensions,X=Xb(v,G),W=hn(),Y=v.drawingBufferWidth,ee=v.drawingBufferHeight,z={tick:0,time:0,viewportWidth:Y,viewportHeight:ee,framebufferWidth:Y,framebufferHeight:ee,drawingBufferWidth:Y,drawingBufferHeight:ee,pixelRatio:c.pixelRatio},q={},P={elements:null,primitive:4,count:-1,offset:0,instances:-1},R=Gm(v,G),K=nv(v,j,c,oe),ue=mv(v,G,K,j),B=mb(v,G,R,j,K,ue,P);function oe(xe){return B.destroyBuffer(xe)}var ie=wb(v,D,j,c),ge=Kv(v,G,R,function(){pe.procs.poll()},z,j,c),F=qv(v,G,R,j,c),M=pb(v,G,R,ge,F,j),pe=zb(v,D,G,R,K,ue,ge,M,q,B,ie,P,z,X,c),te=xb(v,M,pe.procs.poll,z,V,G,R),H=pe.next,re=v.canvas,ne=[],Le=[],Te=[],se=[c.onDestroy],le=null;function Ee(){if(ne.length===0){X&&X.update(),le=null;return}le=qr.next(Ee),Nt();for(var xe=ne.length-1;xe>=0;--xe){var Me=ne[xe];Me&&Me(z,null,0)}v.flush(),X&&X.update()}function ke(){!le&&ne.length>0&&(le=qr.next(Ee))}function De(){le&&(qr.cancel(Ee),le=null)}function lt(xe){xe.preventDefault(),I=!0,De(),Le.forEach(function(Me){Me()})}function ct(xe){v.getError(),I=!1,L.restore(),ie.restore(),K.restore(),ge.restore(),F.restore(),M.restore(),B.restore(),X&&X.restore(),pe.procs.refresh(),ke(),Te.forEach(function(Me){Me()})}re&&(re.addEventListener(kd,lt,!1),re.addEventListener(Ld,ct,!1));function Fe(){ne.length=0,De(),re&&(re.removeEventListener(kd,lt),re.removeEventListener(Ld,ct)),ie.clear(),M.clear(),F.clear(),B.clear(),ge.clear(),ue.clear(),K.clear(),X&&X.clear(),se.forEach(function(xe){xe()})}function Ct(xe){h(!!xe,"invalid args to regl({...})"),h.type(xe,"object","invalid args to regl({...})");function Me(S){var g=n({},S);delete g.uniforms,delete g.attributes,delete g.context,delete g.vao,"stencil"in g&&g.stencil.op&&(g.stencil.opBack=g.stencil.opFront=g.stencil.op,delete g.stencil.op);function w(C){if(C in g){var d=g[C];delete g[C],Object.keys(d).forEach(function(b){g[C+"."+b]=d[b]})}}return w("blend"),w("depth"),w("cull"),w("stencil"),w("polygonOffset"),w("scissor"),w("sample"),"vao"in S&&(g.vao=S.vao),g}function Be(S,g){var w={},C={};return Object.keys(S).forEach(function(d){var b=S[d];if(wt.isDynamic(b)){C[d]=wt.unbox(b,d);return}else if(g&&Array.isArray(b)){for(var f=0;f<b.length;++f)if(wt.isDynamic(b[f])){C[d]=wt.unbox(b,d);return}}w[d]=b}),{dynamic:C,static:w}}var mt=Be(xe.context||{},!0),Mr=Be(xe.uniforms||{},!0),qn=Be(xe.attributes||{},!1),m=Be(Me(xe),!1),O={gpuTime:0,cpuTime:0,count:0},k=pe.compile(m,qn,Mr,mt,O),he=k.draw,Re=k.batch,p=k.scope,u=[];function _(S){for(;u.length<S;)u.push(null);return u}function E(S,g){var w;if(I&&h.raise("context lost"),typeof S=="function")return p.call(this,null,S,0);if(typeof g=="function")if(typeof S=="number")for(w=0;w<S;++w)p.call(this,null,g,w);else if(Array.isArray(S))for(w=0;w<S.length;++w)p.call(this,S[w],g,w);else return p.call(this,S,g,0);else if(typeof S=="number"){if(S>0)return Re.call(this,_(S|0),S|0)}else if(Array.isArray(S)){if(S.length)return Re.call(this,S,S.length)}else return he.call(this,S)}return n(E,{stats:O,destroy:function(){k.destroy()}})}var ot=M.setFBO=Ct({framebuffer:wt.define.call(null,Vd,"framebuffer")});function xt(xe,Me){var Be=0;pe.procs.poll();var mt=Me.color;mt&&(v.clearColor(+mt[0]||0,+mt[1]||0,+mt[2]||0,+mt[3]||0),Be|=Yb),"depth"in Me&&(v.clearDepth(+Me.depth),Be|=Wb),"stencil"in Me&&(v.clearStencil(Me.stencil|0),Be|=Zb),h(!!Be,"called regl.clear with no buffer specified"),v.clear(Be)}function Et(xe){if(h(typeof xe=="object"&&xe,"regl.clear() takes an object as input"),"framebuffer"in xe)if(xe.framebuffer&&xe.framebuffer_reglType==="framebufferCube")for(var Me=0;Me<6;++Me)ot(n({framebuffer:xe.framebuffer.faces[Me]},xe),xt);else ot(xe,xt);else xt(null,xe)}function Pt(xe){h.type(xe,"function","regl.frame() callback must be a function"),ne.push(xe);function Me(){var Be=Od(ne,xe);h(Be>=0,"cannot cancel a frame twice");function mt(){var Mr=Od(ne,mt);ne[Mr]=ne[ne.length-1],ne.length-=1,ne.length<=0&&De()}ne[Be]=mt}return ke(),{cancel:Me}}function Vt(){var xe=H.viewport,Me=H.scissor_box;xe[0]=xe[1]=Me[0]=Me[1]=0,z.viewportWidth=z.framebufferWidth=z.drawingBufferWidth=xe[2]=Me[2]=v.drawingBufferWidth,z.viewportHeight=z.framebufferHeight=z.drawingBufferHeight=xe[3]=Me[3]=v.drawingBufferHeight}function Nt(){z.tick+=1,z.time=Oe(),Vt(),pe.procs.poll()}function ft(){ge.refresh(),Vt(),pe.procs.refresh(),X&&X.update()}function Oe(){return(hn()-W)/1e3}ft();function Gt(xe,Me){h.type(Me,"function","listener callback must be a function");var Be;switch(xe){case"frame":return Pt(Me);case"lost":Be=Le;break;case"restore":Be=Te;break;case"destroy":Be=se;break;default:h.raise("invalid event, must be one of frame,lost,restore,destroy")}return Be.push(Me),{cancel:function(){for(var mt=0;mt<Be.length;++mt)if(Be[mt]===Me){Be[mt]=Be[Be.length-1],Be.pop();return}}}}var ze=n(Ct,{clear:Et,prop:wt.define.bind(null,Vd),context:wt.define.bind(null,Jb),this:wt.define.bind(null,e_),draw:Ct({}),buffer:function(xe){return K.create(xe,Qb,!1,!1)},elements:function(xe){return ue.create(xe,!1)},texture:ge.create2D,cube:ge.createCube,renderbuffer:F.create,framebuffer:M.create,framebufferCube:M.createCube,vao:B.createVAO,attributes:V,frame:Pt,on:Gt,limits:R,hasExtension:function(xe){return R.extensions.indexOf(xe.toLowerCase())>=0},read:te,destroy:Fe,_gl:v,_refresh:ft,poll:function(){Nt(),X&&X.update()},now:Oe,stats:j});return c.onDone(null,ze),ze}return t_})})(Kh);var B_=Kh.exports;const cP=$_(B_);/*! Tweakpane 4.0.5 (c) 2016 cocopon, licensed under the MIT license. */function ut(r){return r==null}function Nl(r){return r!==null&&typeof r=="object"}function El(r){return r!==null&&typeof r=="object"}function N_(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Jn(r,e){return Array.from(new Set([...Object.keys(r),...Object.keys(e)])).reduce((n,i)=>{const s=r[i],o=e[i];return El(s)&&El(o)?Object.assign(Object.assign({},n),{[i]:Jn(s,o)}):Object.assign(Object.assign({},n),{[i]:i in e?o:s})},{})}function Gl(r){return Nl(r)?"target"in r:!1}const G_={alreadydisposed:()=>"View has been already disposed",invalidparams:r=>`Invalid parameters for '${r.name}'`,nomatchingcontroller:r=>`No matching controller for '${r.key}'`,nomatchingview:r=>`No matching view for '${JSON.stringify(r.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:r=>`Not compatible with  plugin '${r.id}'`,propertynotfound:r=>`Property '${r.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let qt=class Ti{static alreadyDisposed(){return new Ti({type:"alreadydisposed"})}static notBindable(){return new Ti({type:"notbindable"})}static notCompatible(e,t){return new Ti({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Ti({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Ti({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=G_[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},Bd=class qh{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!qh.isBindable(n))throw qt.notBindable();if(!(e in n))throw qt.propertyNotFound(e);n[e]=t}},kt=class{constructor(){this.observers_={}}on(e,t,n){var i;let s=this.observers_[e];return s||(s=this.observers_[e]=[]),s.push({handler:t,key:(i=n==null?void 0:n.key)!==null&&i!==void 0?i:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(i=>i.key!==t)),this}emit(e,t){const n=this.observers_[e];n&&n.forEach(i=>{i.handler(t)})}},j_=class{constructor(e,t){var n;this.constraint_=t==null?void 0:t.constraint,this.equals_=(n=t==null?void 0:t.equals)!==null&&n!==void 0?n:(i,s)=>i===s,this.emitter=new kt,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t??{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;this.equals_(s,i)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:i,sender:this}))}},U_=class{constructor(e){this.emitter=new kt,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t??{forceEmit:!1,last:!0},i=this.value_;i===e&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}},z_=class{constructor(e){this.emitter=new kt,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function dt(r,e){const t=e==null?void 0:e.constraint,n=e==null?void 0:e.equals;return!t&&!n?new U_(r):new j_(r,e)}function H_(r){return[new z_(r),(e,t)=>{r.setRawValue(e,t)}]}let Ue=class Xh{constructor(e){this.emitter=new kt,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,i)=>Object.assign(n,{[i]:dt(e[i])}),{})}static fromObject(e){const t=this.createCore(e);return new Xh(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Ts=class{constructor(e){this.values=Ue.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}},K_=class{constructor(e){this.values=Ue.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let i=e;return ut(n)||(i=Math.max(i,n)),ut(t)||(i=Math.min(i,t)),i}},q_=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,n=Math.round((e-t)/this.step);return t+n*this.step}},X_=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const Y_={"**":(r,e)=>Math.pow(r,e),"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"&":(r,e)=>r&e,"^":(r,e)=>r^e,"|":(r,e)=>r|e};let W_=class{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=Y_[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const Z_={"+":r=>r,"-":r=>-r,"~":r=>~r};let Q_=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Z_[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function jl(r){return(e,t)=>{for(let n=0;n<r.length;n++){const i=r[n](e,t);if(i!=="")return i}return""}}function _s(r,e){var t;const n=r.substr(e).match(/^\s+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function J_(r,e){const t=r.substr(e,1);return t.match(/^[1-9]$/)?t:""}function ws(r,e){var t;const n=r.substr(e).match(/^[0-9]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function ew(r,e){const t=ws(r,e);if(t!=="")return t;const n=r.substr(e,1);if(e+=1,n!=="-"&&n!=="+")return"";const i=ws(r,e);return i===""?"":n+i}function Ul(r,e){const t=r.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const n=ew(r,e);return n===""?"":t+n}function Yh(r,e){const t=r.substr(e,1);if(t==="0")return t;const n=J_(r,e);return e+=n.length,n===""?"":n+ws(r,e)}function tw(r,e){const t=Yh(r,e);if(e+=t.length,t==="")return"";const n=r.substr(e,1);if(e+=n.length,n!==".")return"";const i=ws(r,e);return e+=i.length,t+n+i+Ul(r,e)}function rw(r,e){const t=r.substr(e,1);if(e+=t.length,t!==".")return"";const n=ws(r,e);return e+=n.length,n===""?"":t+n+Ul(r,e)}function nw(r,e){const t=Yh(r,e);return e+=t.length,t===""?"":t+Ul(r,e)}const iw=jl([tw,rw,nw]);function sw(r,e){var t;const n=r.substr(e).match(/^[01]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function aw(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const n=sw(r,e);return n===""?"":t+n}function ow(r,e){var t;const n=r.substr(e).match(/^[0-7]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function lw(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const n=ow(r,e);return n===""?"":t+n}function uw(r,e){var t;const n=r.substr(e).match(/^[0-9a-f]+/i);return(t=n&&n[0])!==null&&t!==void 0?t:""}function cw(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const n=uw(r,e);return n===""?"":t+n}const dw=jl([aw,lw,cw]),hw=jl([dw,iw]);function pw(r,e){const t=hw(r,e);return e+=t.length,t===""?null:{evaluable:new X_(t),cursor:e}}function fw(r,e){const t=r.substr(e,1);if(e+=t.length,t!=="(")return null;const n=Zh(r,e);if(!n)return null;e=n.cursor,e+=_s(r,e).length;const i=r.substr(e,1);return e+=i.length,i!==")"?null:{evaluable:n.evaluable,cursor:e}}function mw(r,e){var t;return(t=pw(r,e))!==null&&t!==void 0?t:fw(r,e)}function Wh(r,e){const t=mw(r,e);if(t)return t;const n=r.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const i=Wh(r,e);return i?(e=i.cursor,{cursor:e,evaluable:new Q_(n,i.evaluable)}):null}function vw(r,e,t){t+=_s(e,t).length;const n=r.filter(i=>e.startsWith(i,t))[0];return n?(t+=n.length,t+=_s(e,t).length,{cursor:t,operator:n}):null}function bw(r,e){return(t,n)=>{const i=r(t,n);if(!i)return null;n=i.cursor;let s=i.evaluable;for(;;){const o=vw(e,t,n);if(!o)break;n=o.cursor;const l=r(t,n);if(!l)return null;n=l.cursor,s=new W_(o.operator,s,l.evaluable)}return s?{cursor:n,evaluable:s}:null}}const _w=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((r,e)=>bw(r,e),Wh);function Zh(r,e){return e+=_s(r,e).length,_w(r,e)}function ww(r){const e=Zh(r,0);return!e||e.cursor+_s(r,e.cursor).length!==r.length?null:e.evaluable}function on(r){var e;const t=ww(r);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function Qh(r){if(typeof r=="number")return r;if(typeof r=="string"){const e=on(r);if(!ut(e))return e}return 0}function gw(r){return String(r)}function lr(r){return e=>e.toFixed(Math.max(Math.min(r,20),0))}function et(r,e,t,n,i){const s=(r-e)/(t-e);return n+s*(i-n)}function Nd(r){return String(r.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Rt(r,e,t){return Math.min(Math.max(r,e),t)}function Jh(r,e){return(r%e+e)%e}function yw(r,e){return ut(r.step)?Math.max(Nd(e),2):Nd(r.step)}function ep(r){var e;return(e=r.step)!==null&&e!==void 0?e:1}function tp(r,e){var t;const n=Math.abs((t=r.step)!==null&&t!==void 0?t:e);return n===0?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}function rp(r,e){return ut(r.step)?null:new q_(r.step,e)}function np(r){return!ut(r.max)&&!ut(r.min)?new Ts({max:r.max,min:r.min}):!ut(r.max)||!ut(r.min)?new K_({max:r.max,min:r.min}):null}function ip(r,e){var t,n,i;return{formatter:(t=r.format)!==null&&t!==void 0?t:lr(yw(r,e)),keyScale:(n=r.keyScale)!==null&&n!==void 0?n:ep(r),pointerScale:(i=r.pointerScale)!==null&&i!==void 0?i:tp(r,e)}}function sp(r){return{format:r.optional.function,keyScale:r.optional.number,max:r.optional.number,min:r.optional.number,pointerScale:r.optional.number,step:r.optional.number}}function zl(r){return{constraint:r.constraint,textProps:Ue.fromObject(ip(r.params,r.initialValue))}}let ii=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Ka=class{constructor(e){this.target=e}},ks=class extends Ka{constructor(e,t,n){super(e),this.value=t,this.last=n??!0}},xw=class extends Ka{constructor(e,t){super(e),this.expanded=t}},Cw=class extends Ka{constructor(e,t){super(e),this.index=t}},Ew=class extends Ka{constructor(e,t){super(e),this.native=t}},gs=class extends ii{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new kt,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new ks(this,t.binding.target.read(),e.options.last))}};class Pw{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new kt}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function Aw(r){if(!("binding"in r))return!1;const e=r.binding;return Gl(e)&&"read"in e&&"write"in e}function Sw(r,e){const n=Object.keys(e).reduce((i,s)=>{if(i===void 0)return;const o=e[s],l=o(r[s]);return l.succeeded?Object.assign(Object.assign({},i),{[s]:l.value}):void 0},{});return n}function Tw(r,e){return r.reduce((t,n)=>{if(t===void 0)return;const i=e(n);if(!(!i.succeeded||i.value===void 0))return[...t,i.value]},[])}function kw(r){return r===null?!1:typeof r=="object"}function Jr(r){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const n=r(t);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function Gd(r){return{custom:e=>Jr(e)(r),boolean:Jr(e=>typeof e=="boolean"?e:void 0)(r),number:Jr(e=>typeof e=="number"?e:void 0)(r),string:Jr(e=>typeof e=="string"?e:void 0)(r),function:Jr(e=>typeof e=="function"?e:void 0)(r),constant:e=>Jr(t=>t===e?e:void 0)(r),raw:Jr(e=>e)(r),object:e=>Jr(t=>{if(kw(t))return Sw(t,e)})(r),array:e=>Jr(t=>{if(Array.isArray(t))return Tw(t,e)})(r)}}const Pl={optional:Gd(!0),required:Gd(!1)};function bt(r,e){const t=e(Pl),n=Pl.required.object(t)(r);return n.succeeded?n.value:void 0}function fr(r,e,t,n){if(e&&!e(r))return!1;const i=bt(r,t);return i?n(i):!1}function mr(r,e){var t;return Jn((t=r==null?void 0:r())!==null&&t!==void 0?t:{},e)}function Zn(r){return"value"in r}function ap(r){if(!Nl(r)||!("binding"in r))return!1;const e=r.binding;return Gl(e)}const $r="http://www.w3.org/2000/svg";function Ma(r){r.offsetHeight}function Lw(r,e){const t=r.style.transition;r.style.transition="none",e(),r.style.transition=t}function Hl(r){return r.ontouchstart!==void 0}function Vw(){return globalThis}function Ow(){return Vw().document}function Rw(r){const e=r.ownerDocument.defaultView;return e&&"document"in e?r.getContext("2d",{willReadFrequently:!0}):null}const Dw={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function qa(r,e){const t=r.createElementNS($r,"svg");return t.innerHTML=Dw[e],t}function op(r,e,t){r.insertBefore(e,r.children[t])}function Kl(r){r.parentElement&&r.parentElement.removeChild(r)}function lp(r){for(;r.children.length>0;)r.removeChild(r.children[0])}function Mw(r){for(;r.childNodes.length>0;)r.removeChild(r.childNodes[0])}function up(r){return r.relatedTarget?r.relatedTarget:"explicitOriginalTarget"in r?r.explicitOriginalTarget:null}function sn(r,e){r.emitter.on("change",t=>{e(t.rawValue)}),e(r.rawValue)}function Nr(r,e,t){sn(r.value(e),t)}const Iw="tp";function Xe(r){return(t,n)=>[Iw,"-",r,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}const as=Xe("lbl");function Fw(r,e){const t=r.createDocumentFragment();return e.split(`
`).map(i=>r.createTextNode(i)).forEach((i,s)=>{s>0&&t.appendChild(r.createElement("br")),t.appendChild(i)}),t}let cp=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(as()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(as("l")),Nr(t.props,"label",s=>{ut(s)?this.element.classList.add(as(void 0,"nol")):(this.element.classList.remove(as(void 0,"nol")),Mw(n),n.appendChild(Fw(e,s)))}),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("div");i.classList.add(as("v")),this.element.appendChild(i),this.valueElement=i}},dp=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new cp(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return fr(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return mr(null,{label:this.props.get("label")})}};function $w(){return["veryfirst","first","last","verylast"]}const jd=Xe(""),Ud={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Xa=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{$w().forEach(n=>{t.classList.remove(jd(void 0,Ud[n]))}),this.blade.get("positions").forEach(n=>{t.classList.add(jd(void 0,Ud[n]))})}),this.viewProps.handleDispose(()=>{Kl(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return fr(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return mr(null,Object.assign({},this.viewProps.exportState()))}};class ei extends Xa{constructor(e,t){if(t.value!==t.valueController.value)throw qt.shouldNeverHappen();const n=t.valueController.viewProps,i=new dp(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new cp(e,{props:t.props,viewProps:n}),viewProps:n})),this.labelController=i,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return fr(e,t=>{var n,i,s;return super.importState(t)&&this.labelController.importProps(t)&&((s=(i=(n=this.valueController).importProps)===null||i===void 0?void 0:i.call(n,e))!==null&&s!==void 0?s:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,n;return mr(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(n=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&n!==void 0?n:{}))}}function zd(r){const e=Object.assign({},r);return delete e.value,e}class hp extends ei{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return fr(e,t=>super.importState(zd(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return mr(()=>zd(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function Bw(r){return Zn(r)&&ap(r.value)}class Nw extends hp{importState(e){return fr(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function Gw(r){return Zn(r)&&Aw(r.value)}function pp(r,e){for(;r.length<e;)r.push(void 0)}function jw(r){const e=[];return pp(e,r),e}function Uw(r){const e=r.indexOf(void 0);return e<0?r:r.slice(0,e)}function zw(r,e){const t=[...Uw(r),e];return t.length>r.length?t.splice(0,t.length-r.length):pp(t,r.length),t}class Hw{constructor(e){this.emitter=new kt,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=dt(jw(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=zw(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function Kw(r){if(!("binding"in r))return!1;const e=r.binding;return Gl(e)&&"read"in e&&!("write"in e)}class qw extends hp{exportState(){return mr(()=>super.exportState(),{binding:{readonly:!0}})}}function Xw(r){return Zn(r)&&Kw(r.value)}let Yw=class extends ii{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,s=>{n(new Ew(this,s.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function Ww(r,e,t){t?r.classList.add(e):r.classList.remove(e)}function Ii(r,e){return t=>{Ww(r,e,t)}}function ql(r,e){sn(r,t=>{e.textContent=t??""})}const sl=Xe("btn");let Zw=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(sl()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(sl("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(sl("t")),ql(t.props.value("title"),i),this.buttonElement.appendChild(i)}},Qw=class{constructor(e,t){this.emitter=new kt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Zw(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return fr(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return mr(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},Hd=class extends Xa{constructor(e,t){const n=new Qw(e,{props:t.buttonProps,viewProps:t.viewProps}),i=new dp(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=i}importState(e){return fr(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return mr(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},fp=class{constructor(e){const[t,n]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=n??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const Fi=new fp("2.0.5");function Qt(r){return Object.assign({core:Fi},r)}const Jw=Qt({id:"button",type:"blade",accept(r){const e=bt(r,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(r){return new Hd(r.document,{blade:r.blade,buttonProps:Ue.fromObject({title:r.params.title}),labelProps:Ue.fromObject({label:r.params.label}),viewProps:r.viewProps})},api(r){return r.controller instanceof Hd?new Yw(r.controller):null}});function e0(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function t0(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function r0(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function n0(r){return Nl(r)?"refresh"in r&&typeof r.refresh=="function":!1}function i0(r,e){if(!Bd.isBindable(r))throw qt.notBindable();return new Bd(r,e)}let s0=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new kt,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,n){const i=n??{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,i0(e,t),i),l=this.pool_.createBindingApi(o);return this.add(l,i.index)}addFolder(e){return t0(this,e)}addButton(e){return e0(this,e)}addTab(e){return r0(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createApi(n);return this.add(i,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{n0(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),i=ap(t.value)?t.value.binding:null;this.emitter_.emit("change",new ks(n,i?i.target.read():t.value.rawValue,e.options.last))}},Xl=class extends ii{constructor(e,t){super(e),this.rackApi_=new s0(e.rackController,t)}refresh(){this.rackApi_.refresh()}},Yl=class extends Xa{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return fr(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((n,i)=>n.importState(t.children[i])))}exportState(){return mr(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Al(r){return"rackController"in r}let a0=class{constructor(e){this.emitter=new kt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw qt.shouldNeverHappen();const n=t!==void 0?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach(s=>{this.cache_.add(s)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach(i=>{this.cache_.delete(i)}),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function o0(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(Zn(n)&&n.value===e)return n}return null}function l0(r){return Al(r)?r.rackController.rack.bcSet_:null}let u0=class{constructor(e){var t,n;this.emitter=new kt,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(n=this.blade_)===null||n===void 0||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new a0(l0),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;(n=e.parent)===null||n===void 0||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),Zn(n))n.value.emitter.on("change",this.onChildValueChange_);else if(Al(n)){const i=n.rackController.rack;if(i){const s=i.emitter;s.on("layout",this.onRackLayout_),s.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(Zn(n))n.value.emitter.off("change",this.onChildValueChange_);else if(Al(n)){const i=n.rackController.rack;if(i){const s=i.emitter;s.off("layout",this.onRackLayout_),s.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(i=>!i.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(i=>{const s=[];i===t&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),i===n&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),i.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=o0(this.find(Zn),e.sender);if(!t)throw qt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Wl=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new u0({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let n=this.rack.children.length-1;n>=0;n--)this.rack.children[n].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&op(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Kl(e.bladeController.view.element)}};function $i(){return new Ue({positions:dt([],{equals:N_})})}let Zl=class mp extends Ue{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=Ue.createCore(t);return new mp(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!ut(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Nr(this,"expanded",n),Nr(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function c0(r,e){let t=0;return Lw(e,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),Ma(e),t=e.clientHeight,r.set("temporaryExpanded",null),Ma(e)}),t}function Kd(r,e){e.style.height=r.styleHeight}function Ql(r,e){r.value("expanded").emitter.on("beforechange",()=>{if(r.set("completed",!1),ut(r.get("expandedHeight"))){const t=c0(r,e);t>0&&r.set("expandedHeight",t)}r.set("shouldFixHeight",!0),Ma(e)}),r.emitter.on("change",()=>{Kd(r,e)}),Kd(r,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&r.cleanUpTransition()})}let vp=class extends Xl{constructor(e,t){super(e,t),this.emitter_=new kt,this.controller.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",new xw(this,n.sender.rawValue))}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const bp=Xe("cnt");let d0=class{constructor(e,t){var n;this.className_=Xe((n=t.viewName)!==null&&n!==void 0?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),bp()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Nr(this.foldable_,"completed",Ii(this.element,this.className_(void 0,"cpl")));const i=e.createElement("button");i.classList.add(this.className_("b")),Nr(t.props,"title",x=>{ut(x)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=e.createElement("div");o.classList.add(this.className_("t")),ql(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const y=e.createElement("div");y.classList.add(this.className_("c")),this.element.appendChild(y),this.containerElement=y}},Sl=class extends Yl{constructor(e,t){var n;const i=Zl.create((n=t.expanded)!==null&&n!==void 0?n:!0),s=new d0(e,{foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Wl({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,Ql(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return fr(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return mr(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};const h0=Qt({id:"folder",type:"blade",accept(r){const e=bt(r,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(r){return new Sl(r.document,{blade:r.blade,expanded:r.params.expanded,props:Ue.fromObject({title:r.params.title}),viewProps:r.viewProps})},api(r){return r.controller instanceof Sl?new vp(r.controller,r.pool):null}}),p0=Xe("");function qd(r,e){return Ii(r,p0(void 0,e))}let si=class _p extends Ue{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=H_(dt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,i;const s=e??{};return new _p(Ue.createCore({disabled:(t=s.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(n=s.hidden)!==null&&n!==void 0?n:!1,parent:(i=s.parent)!==null&&i!==void 0?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){sn(this.globalDisabled_,qd(e,"disabled")),Nr(this,"hidden",qd(e,"hidden"))}bindDisabled(e){sn(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){sn(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;n==null||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const Xd=Xe("tbp");let f0=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xd()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Xd("c")),this.element.appendChild(n),this.containerElement=n}};const os=Xe("tbi");let m0=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(os()),t.viewProps.bindClassModifiers(this.element),Nr(t.props,"selected",s=>{s?this.element.classList.add(os(void 0,"sel")):this.element.classList.remove(os(void 0,"sel"))});const n=e.createElement("button");n.classList.add(os("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(os("t")),ql(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}},v0=class{constructor(e,t){this.emitter=new kt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new m0(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Tl=class extends Yl{constructor(e,t){const n=new f0(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Wl({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new v0(e,{props:t.itemProps,viewProps:si.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Nr(this.props,"selected",i=>{this.itemController.props.set("selected",i),this.viewProps.set("hidden",!i)})}get itemController(){return this.ic_}importState(e){return fr(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return mr(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},b0=class extends Xl{constructor(e,t){super(e,t),this.emitter_=new kt,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new Tl(t,{blade:$i(),itemProps:Ue.fromObject({selected:!1,title:e.title}),props:Ue.fromObject({selected:!1}),viewProps:si.create()}),i=this.pool_.createApi(n);return this.rackApi_.add(i,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new Cw(this,e.rawValue))}},_0=class extends Xl{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}};const Yd=-1;let w0=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=dt(!0),this.selectedIndex=dt(Yd),this.items_=[]}add(e,t){const n=t??this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Yd,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,n)=>{t.rawValue=n===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(n=>n===e.sender);this.items_.forEach((n,i)=>{n.rawValue=i===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const ls=Xe("tab");let g0=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ls(),bp()),t.viewProps.bindClassModifiers(this.element),sn(t.empty,Ii(this.element,ls(void 0,"nop")));const n=e.createElement("div");n.classList.add(ls("t")),this.element.appendChild(n),this.itemsElement=n;const i=e.createElement("div");i.classList.add(ls("i")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(ls("c")),this.element.appendChild(s),this.contentsElement=s}},Wd=class extends Yl{constructor(e,t){const n=new w0,i=new g0(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Wl({blade:t.blade,element:i.contentsElement,viewProps:t.viewProps}),view:i}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;op(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Kl(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};const wp=Qt({id:"tab",type:"blade",accept(r){const e=bt(r,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(r){const e=new Wd(r.document,{blade:r.blade,viewProps:r.viewProps});return r.params.pages.forEach(t=>{const n=new Tl(r.document,{blade:$i(),itemProps:Ue.fromObject({selected:!1,title:t.title}),props:Ue.fromObject({selected:!1}),viewProps:si.create()});e.add(n)}),e},api(r){return r.controller instanceof Wd?new b0(r.controller,r.pool):r.controller instanceof Tl?new _0(r.controller,r.pool):null}});function y0(r,e){const t=r.accept(e.params);if(!t)return null;const n=bt(e.params,i=>({disabled:i.optional.boolean,hidden:i.optional.boolean}));return r.controller({blade:$i(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:n==null?void 0:n.disabled,hidden:n==null?void 0:n.hidden}),viewProps:si.create({disabled:n==null?void 0:n.disabled,hidden:n==null?void 0:n.hidden})})}let Jl=class extends gs{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}};class x0{constructor(){this.disabled=!1,this.emitter=new kt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class C0{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new kt,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}let Ls=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,n)=>n.constrain(t),e)}};function Ia(r,e){if(r instanceof e)return r;if(r instanceof Ls){const t=r.constraints.reduce((n,i)=>n||(i instanceof e?i:null),null);if(t)return t}return null}let Vs=class{constructor(e){this.values=Ue.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(i=>i.value===e).length>0?e:t[0].value}};function Os(r){var e;const t=Pl;if(Array.isArray(r))return(e=bt({items:r},n=>({items:n.required.array(n.required.object({text:n.required.string,value:n.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof r=="object")return t.required.raw(r).value}function eu(r){if(Array.isArray(r))return r;const e=[];return Object.keys(r).forEach(t=>{e.push({text:t,value:r[t]})}),e}function tu(r){return ut(r)?null:new Vs(eu(r))}const al=Xe("lst");let E0=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(al()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(al("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=e.createElement("div");i.classList.add(al("m")),i.appendChild(qa(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Nr(this.props_,"options",s=>{lp(this.selectElement),s.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Vn=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new E0(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return fr(e,null,t=>({options:t.required.custom(Os)}),t=>(this.props.set("options",eu(t.options)),!0))}exportProps(){return mr(null,{options:this.props.get("options")})}};const Zd=Xe("pop");let P0=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Zd()),t.viewProps.bindClassModifiers(this.element),sn(t.shows,Ii(this.element,Zd(void 0,"v")))}},gp=class{constructor(e,t){this.shows=dt(!1),this.viewProps=t.viewProps,this.view=new P0(e,{shows:this.shows,viewProps:this.viewProps})}};const Qd=Xe("txt");let A0=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Qd()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Qd("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},ys=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new A0(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget.value,i=this.parser_(n);ut(i)||(this.value.rawValue=i),this.view.refresh()}};function S0(r){return String(r)}function yp(r){return r==="false"?!1:!!r}function Jd(r){return S0(r)}function T0(r){return e=>r.reduce((t,n)=>t!==null?t:n(e),null)}const k0=lr(0);function Fa(r){return k0(r)+"%"}function xp(r){return String(r)}function kl(r){return r}function Bi({primary:r,secondary:e,forward:t,backward:n}){let i=!1;function s(o){i||(i=!0,o(),i=!1)}r.emitter.on("change",o=>{s(()=>{e.setRawValue(t(r.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{s(()=>{r.setRawValue(n(r.rawValue,e.rawValue),o.options)}),s(()=>{e.setRawValue(t(r.rawValue,e.rawValue),o.options)})}),s(()=>{e.setRawValue(t(r.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function ar(r,e){const t=r*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function xs(r){return{altKey:r.altKey,downKey:r.key==="ArrowDown",shiftKey:r.shiftKey,upKey:r.key==="ArrowUp"}}function ln(r){return{altKey:r.altKey,downKey:r.key==="ArrowLeft",shiftKey:r.shiftKey,upKey:r.key==="ArrowRight"}}function L0(r){return r==="ArrowUp"||r==="ArrowDown"}function Cp(r){return L0(r)||r==="ArrowLeft"||r==="ArrowRight"}function ol(r,e){var t,n;const i=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:r.pageX-(((t=i&&i.scrollX)!==null&&t!==void 0?t:0)+s.left),y:r.pageY-(((n=i&&i.scrollY)!==null&&n!==void 0?n:0)+s.top)}}let ai=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new kt,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(ol(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(ol(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(ol(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const xr=Xe("txt");let V0=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(xr(),xr(void 0,"num")),t.arrayPosition&&this.element.classList.add(xr(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(xr("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(xr()),this.inputElement.classList.add(xr("i"));const i=e.createElement("div");i.classList.add(xr("k")),this.element.appendChild(i),this.knobElement=i;const s=e.createElementNS($r,"svg");s.classList.add(xr("g")),this.knobElement.appendChild(s);const o=e.createElementNS($r,"path");o.classList.add(xr("gb")),s.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS($r,"path");l.classList.add(xr("gh")),s.appendChild(l),this.guideHeadElem_=l;const y=e.createElement("div");y.classList.add(Xe("tt")()),this.knobElement.appendChild(y),this.tooltipElem_=y,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(xr(void 0,"drg"));return}this.element.classList.add(xr(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),i=Rt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Rs=class{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(n=t.sliderProps)!==null&&n!==void 0?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=dt(null),this.view=new V0(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new ai(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const i=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),s=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("max");let o=e;return i!==void 0&&(o=Math.max(o,i)),s!==void 0&&(o=Math.min(o,s)),o}onInputChange_(e){const n=e.currentTarget.value,i=this.parser_(n);ut(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(e){const t=ar(this.props.get("keyScale"),xs(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){ar(this.props.get("keyScale"),xs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const ll=Xe("sld");let O0=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(ll()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(ll("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add(ll("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Rt(et(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},R0=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new O0(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ai(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(et(Rt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=ar(this.props.get("keyScale"),ln(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){ar(this.props.get("keyScale"),ln(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const ul=Xe("sldtxt");let D0=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ul());const n=e.createElement("div");n.classList.add(ul("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(ul("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}},$a=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new R0(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Rs(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new D0(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return fr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const n=this.sliderC_.props;return n.set("max",t.max),n.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return mr(null,{max:e.get("max"),min:e.get("min")})}};function Ep(r){return{sliderProps:new Ue({keyScale:r.keyScale,max:r.max,min:r.min}),textProps:new Ue({formatter:dt(r.formatter),keyScale:r.keyScale,pointerScale:dt(r.pointerScale)})}}const M0={containerUnitSize:"cnt-usz"};function Pp(r){return`--${M0[r]}`}function Cs(r){return sp(r)}function Sn(r){if(El(r))return bt(r,Cs)}function rn(r,e){if(!r)return;const t=[],n=rp(r,e);n&&t.push(n);const i=np(r);return i&&t.push(i),new Ls(t)}function I0(r){return r?r.major===Fi.major:!1}function Ap(r){if(r==="inline"||r==="popup")return r}function Ds(r,e){r.write(e)}const Aa=Xe("ckb");let F0=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Aa()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(Aa("l")),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("input");i.classList.add(Aa("i")),i.type="checkbox",this.labelElement.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(Aa("w")),this.labelElement.appendChild(s);const o=qa(e,"check");s.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},$0=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new F0(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function B0(r){const e=[],t=tu(r.options);return t&&e.push(t),new Ls(e)}const N0=Qt({id:"input-bool",type:"input",accept:(r,e)=>{if(typeof r!="boolean")return null;const t=bt(e,n=>({options:n.optional.custom(Os),readonly:n.optional.constant(!1)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>yp,constraint:r=>B0(r.params),writer:r=>Ds},controller:r=>{const e=r.document,t=r.value,n=r.constraint,i=n&&Ia(n,Vs);return i?new Vn(e,{props:new Ue({options:i.values.value("options")}),value:t,viewProps:r.viewProps}):new $0(e,{value:t,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="boolean"?null:r.controller.valueController instanceof Vn?new Jl(r.controller):null}}),Xn=Xe("col");let G0=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xn()),t.foldable.bindExpandedClass(this.element,Xn(void 0,"expanded")),Nr(t.foldable,"completed",Ii(this.element,Xn(void 0,"cpl")));const n=e.createElement("div");n.classList.add(Xn("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(Xn("s")),n.appendChild(i),this.swatchElement=i;const s=e.createElement("div");if(s.classList.add(Xn("t")),n.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Xn("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function j0(r,e,t){const n=Rt(r/255,0,1),i=Rt(e/255,0,1),s=Rt(t/255,0,1),o=Math.max(n,i,s),l=Math.min(n,i,s),y=o-l;let x=0,N=0;const U=(l+o)/2;return y!==0&&(N=y/(1-Math.abs(o+l-1)),n===o?x=(i-s)/y:i===o?x=2+(s-n)/y:x=4+(n-i)/y,x=x/6+(x<0?1:0)),[x*360,N*100,U*100]}function U0(r,e,t){const n=(r%360+360)%360,i=Rt(e/100,0,1),s=Rt(t/100,0,1),o=(1-Math.abs(2*s-1))*i,l=o*(1-Math.abs(n/60%2-1)),y=s-o/2;let x,N,U;return n>=0&&n<60?[x,N,U]=[o,l,0]:n>=60&&n<120?[x,N,U]=[l,o,0]:n>=120&&n<180?[x,N,U]=[0,o,l]:n>=180&&n<240?[x,N,U]=[0,l,o]:n>=240&&n<300?[x,N,U]=[l,0,o]:[x,N,U]=[o,0,l],[(x+y)*255,(N+y)*255,(U+y)*255]}function z0(r,e,t){const n=Rt(r/255,0,1),i=Rt(e/255,0,1),s=Rt(t/255,0,1),o=Math.max(n,i,s),l=Math.min(n,i,s),y=o-l;let x;y===0?x=0:o===n?x=60*(((i-s)/y%6+6)%6):o===i?x=60*((s-n)/y+2):x=60*((n-i)/y+4);const N=o===0?0:y/o,U=o;return[x,N*100,U*100]}function Sp(r,e,t){const n=Jh(r,360),i=Rt(e/100,0,1),s=Rt(t/100,0,1),o=s*i,l=o*(1-Math.abs(n/60%2-1)),y=s-o;let x,N,U;return n>=0&&n<60?[x,N,U]=[o,l,0]:n>=60&&n<120?[x,N,U]=[l,o,0]:n>=120&&n<180?[x,N,U]=[0,o,l]:n>=180&&n<240?[x,N,U]=[0,l,o]:n>=240&&n<300?[x,N,U]=[l,0,o]:[x,N,U]=[o,0,l],[(x+y)*255,(N+y)*255,(U+y)*255]}function H0(r,e,t){const n=t+e*(100-Math.abs(2*t-100))/200;return[r,n!==0?e*(100-Math.abs(2*t-100))/n:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function K0(r,e,t){const n=100-Math.abs(t*(200-e)/100-100);return[r,n!==0?e*t/n:0,t*(200-e)/(2*100)]}function Gr(r){return[r[0],r[1],r[2]]}function Ya(r,e){return[r[0],r[1],r[2],e]}const q0={hsl:{hsl:(r,e,t)=>[r,e,t],hsv:H0,rgb:U0},hsv:{hsl:K0,hsv:(r,e,t)=>[r,e,t],rgb:Sp},rgb:{hsl:j0,hsv:z0,rgb:(r,e,t)=>[r,e,t]}};function Ri(r,e){return[e==="float"?1:r==="rgb"?255:360,e==="float"?1:r==="rgb"?255:100,e==="float"?1:r==="rgb"?255:100]}function X0(r,e){return r===e?e:Jh(r,e)}function Tp(r,e,t){var n;const i=Ri(e,t);return[e==="rgb"?Rt(r[0],0,i[0]):X0(r[0],i[0]),Rt(r[1],0,i[1]),Rt(r[2],0,i[2]),Rt((n=r[3])!==null&&n!==void 0?n:1,0,1)]}function eh(r,e,t,n){const i=Ri(e,t),s=Ri(e,n);return r.map((o,l)=>o/i[l]*s[l])}function kp(r,e,t){const n=eh(r,e.mode,e.type,"int"),i=q0[e.mode][t.mode](...n);return eh(i,t.mode,"int",t.type)}let rt=class Lp{static black(){return new Lp([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=Tp(e,t,this.type)}getComponents(e){return Ya(kp(Gr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const gn=Xe("colp");let Y0=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(gn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(gn("hsv"));const i=e.createElement("div");i.classList.add(gn("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(gn("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const o=e.createElement("div");if(o.classList.add(gn("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(gn("a"));const y=e.createElement("div");y.classList.add(gn("ap")),y.appendChild(this.alphaViews_.palette.element),l.appendChild(y);const x=e.createElement("div");x.classList.add(gn("at")),x.appendChild(this.alphaViews_.text.element),l.appendChild(x),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function W0(r){return r==="int"?"int":r==="float"?"float":void 0}function ru(r){return bt(r,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(W0)}),expanded:e.optional.boolean,picker:e.optional.custom(Ap),readonly:e.optional.constant(!1)}))}function ti(r){return r?.1:1}function Vp(r){var e;return(e=r.color)===null||e===void 0?void 0:e.type}let nu=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=Tp(e,t,this.type)}getComponents(e){return Ya(kp(Gr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Z0={int:(r,e)=>new rt(r,e),float:(r,e)=>new nu(r,e)};function iu(r,e,t){return Z0[t](r,e)}function Q0(r){return r.type==="float"}function J0(r){return r.type==="int"}function eg(r){const e=r.getComponents(),t=Ri(r.mode,"int");return new rt([Math.round(et(e[0],0,1,0,t[0])),Math.round(et(e[1],0,1,0,t[1])),Math.round(et(e[2],0,1,0,t[2])),e[3]],r.mode)}function tg(r){const e=r.getComponents(),t=Ri(r.mode,"int");return new nu([et(e[0],0,t[0],0,1),et(e[1],0,t[1],0,1),et(e[2],0,t[2],0,1),e[3]],r.mode)}function Wt(r,e){if(r.type===e)return r;if(J0(r)&&e==="float")return tg(r);if(Q0(r)&&e==="int")return eg(r);throw qt.shouldNeverHappen()}function rg(r,e){return r.alpha===e.alpha&&r.mode===e.mode&&r.notation===e.notation&&r.type===e.type}function Er(r,e){const t=r.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(r),e)}const ng={deg:r=>r,grad:r=>r*360/400,rad:r=>r*360/(2*Math.PI),turn:r=>r*360};function Op(r){const e=r.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(r);const t=parseFloat(e[1]),n=e[2];return ng[n](t)}function Rp(r){const e=r.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Er(e[1],255),Er(e[2],255),Er(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function ig(r){const e=Rp(r);return e?new rt(e,"rgb"):null}function Dp(r){const e=r.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Er(e[1],255),Er(e[2],255),Er(e[3],255),Er(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function sg(r){const e=Dp(r);return e?new rt(e,"rgb"):null}function Mp(r){const e=r.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Op(e[1]),Er(e[2],100),Er(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function ag(r){const e=Mp(r);return e?new rt(e,"hsl"):null}function Ip(r){const e=r.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Op(e[1]),Er(e[2],100),Er(e[3],100),Er(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function og(r){const e=Ip(r);return e?new rt(e,"hsl"):null}function Fp(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=r.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function lg(r){const e=Fp(r);return e?new rt(e,"rgb"):null}function $p(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),et(parseInt(e[4]+e[4],16),0,255,0,1)];const t=r.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),et(parseInt(t[4],16),0,255,0,1)]:null}function ug(r){const e=$p(r);return e?new rt(e,"rgb"):null}function Bp(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function cg(r){return e=>{const t=Bp(e);return t?iu(t,"rgb",r):null}}function Np(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function dg(r){return e=>{const t=Np(e);return t?iu(t,"rgb",r):null}}const hg=[{parser:Fp,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:$p,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Rp,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Dp,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Mp,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Ip,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Bp,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Np,result:{alpha:!0,mode:"rgb",notation:"object"}}];function pg(r){return hg.reduce((e,{parser:t,result:n})=>e||(t(r)?n:null),null)}function fg(r,e="int"){const t=pg(r);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Ms(r){const e=[lg,ug,ig,sg,ag,og];e.push(cg("int"),dg("int"));const t=T0(e);return n=>{const i=t(n);return i?Wt(i,r):null}}function mg(r){const e=Ms("int");if(typeof r!="string")return rt.black();const t=e(r);return t??rt.black()}function Gp(r){const e=Rt(Math.floor(r),0,255).toString(16);return e.length===1?`0${e}`:e}function su(r,e="#"){const t=Gr(r.getComponents("rgb")).map(Gp).join("");return`${e}${t}`}function au(r,e="#"){const t=r.getComponents("rgb"),n=[t[0],t[1],t[2],t[3]*255].map(Gp).join("");return`${e}${n}`}function jp(r){const e=lr(0),t=Wt(r,"int");return`rgb(${Gr(t.getComponents("rgb")).map(i=>e(i)).join(", ")})`}function ka(r){const e=lr(2),t=lr(0);return`rgba(${Wt(r,"int").getComponents("rgb").map((s,o)=>(o===3?e:t)(s)).join(", ")})`}function vg(r){const e=[lr(0),Fa,Fa],t=Wt(r,"int");return`hsl(${Gr(t.getComponents("hsl")).map((i,s)=>e[s](i)).join(", ")})`}function bg(r){const e=[lr(0),Fa,Fa,lr(2)];return`hsla(${Wt(r,"int").getComponents("hsl").map((i,s)=>e[s](i)).join(", ")})`}function Up(r,e){const t=lr(e==="float"?2:0),n=["r","g","b"],i=Wt(r,e);return`{${Gr(i.getComponents("rgb")).map((o,l)=>`${n[l]}: ${t(o)}`).join(", ")}}`}function _g(r){return e=>Up(e,r)}function zp(r,e){const t=lr(2),n=lr(e==="float"?2:0),i=["r","g","b","a"];return`{${Wt(r,e).getComponents("rgb").map((l,y)=>{const x=y===3?t:n;return`${i[y]}: ${x(l)}`}).join(", ")}}`}function wg(r){return e=>zp(e,r)}const gg=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:su},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:au},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:jp},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:ka},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:vg},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:bg},...["int","float"].reduce((r,e)=>[...r,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:_g(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:wg(e)}],[])];function Hp(r){return gg.reduce((e,t)=>e||(rg(t.format,r)?t.stringifier:null),null)}const us=Xe("apl");let yg=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(us()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(us("b")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(us("c")),n.appendChild(i),this.colorElem_=i;const s=e.createElement("div");s.classList.add(us("m")),this.element.appendChild(s),this.markerElem_=s;const o=e.createElement("div");o.classList.add(us("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new rt([t[0],t[1],t[2],0],"rgb"),i=new rt([t[0],t[1],t[2],255],"rgb"),s=["to right",ka(n),ka(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=ka(e);const o=et(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},xg=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new yg(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ai(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,i=this.value.rawValue,[s,o,l]=i.getComponents("hsv");this.value.setRawValue(new rt([s,o,l,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=ar(ti(!0),ln(e));if(t===0)return;const n=this.value.rawValue,[i,s,o,l]=n.getComponents("hsv");this.value.setRawValue(new rt([i,s,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){ar(ti(!0),ln(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Ei=Xe("coltxt");function Cg(r){const e=r.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((n,i)=>{const s=r.createElement("option");return s.textContent=i.text,s.value=i.value,n.appendChild(s),n},r.createDocumentFragment())),e}let Eg=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ei()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Ei("m")),this.modeElem_=Cg(e),this.modeElem_.classList.add(Ei("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const i=e.createElement("div");i.classList.add(Ei("mm")),i.appendChild(qa(e,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(Ei("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),sn(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){lp(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(Ei("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)})}};function Pg(r){return lr(r==="float"?2:0)}function Ag(r,e,t){const n=Ri(r,e)[t];return new Ts({min:0,max:n})}function Sg(r,e,t){return new Rs(r,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Ue.fromObject({formatter:Pg(e.colorType),keyScale:ti(!1),pointerScale:e.colorType==="float"?.01:1}),value:dt(0,{constraint:Ag(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function Tg(r,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:on,viewProps:e.viewProps};return[0,1,2].map(n=>{const i=Sg(r,t,n);return Bi({primary:e.value,secondary:i.value,forward(s){return Wt(s,e.colorType).getComponents(e.colorMode)[n]},backward(s,o){const l=e.colorMode,x=Wt(s,e.colorType).getComponents(l);x[n]=o;const N=iu(Ya(Gr(x),x[3]),l,e.colorType);return Wt(N,"int")}}),i})}function kg(r,e){const t=new ys(r,{parser:Ms("int"),props:Ue.fromObject({formatter:su}),value:dt(rt.black()),viewProps:e.viewProps});return Bi({primary:e.value,secondary:t.value,forward:n=>new rt(Gr(n.getComponents()),n.mode),backward:(n,i)=>new rt(Ya(Gr(i.getComponents(n.mode)),n.getComponents()[3]),n.mode)}),[t]}function Lg(r){return r!=="hex"}let Vg=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=dt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Eg(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return Lg(t)?Tg(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):kg(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(n=>n.view)}};const cl=Xe("hpl");let Og=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(cl()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(cl("c")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(cl("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=jp(new rt([t,100,100],"hsv"));const n=et(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}},Rg=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Og(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ai(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=et(Rt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=this.value.rawValue,[,s,o,l]=i.getComponents("hsv");this.value.setRawValue(new rt([n,s,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=ar(ti(!1),ln(e));if(t===0)return;const n=this.value.rawValue,[i,s,o,l]=n.getComponents("hsv");this.value.setRawValue(new rt([i+t,s,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){ar(ti(!1),ln(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const dl=Xe("svp"),th=64;let Dg=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(dl()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=th,n.width=th,n.classList.add(dl("c")),this.element.appendChild(n),this.canvasElement=n;const i=e.createElement("div");i.classList.add(dl("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=Rw(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,o=e.getImageData(0,0,i,s),l=o.data;for(let N=0;N<s;N++)for(let U=0;U<i;U++){const de=et(U,0,i,0,100),Se=et(N,0,s,100,0),Ce=Sp(n[0],de,Se),Ie=(N*i+U)*4;l[Ie]=Ce[0],l[Ie+1]=Ce[1],l[Ie+2]=Ce[2],l[Ie+3]=255}e.putImageData(o,0,0);const y=et(n[1],0,100,0,100);this.markerElem_.style.left=`${y}%`;const x=et(n[2],0,100,100,0);this.markerElem_.style.top=`${x}%`}onValueChange_(){this.update_()}},Mg=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Dg(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ai(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=et(e.point.x,0,e.bounds.width,0,100),i=et(e.point.y,0,e.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new rt([s,n,i,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Cp(e.key)&&e.preventDefault();const[t,n,i,s]=this.value.rawValue.getComponents("hsv"),o=ti(!1),l=ar(o,ln(e)),y=ar(o,xs(e));l===0&&y===0||this.value.setRawValue(new rt([t,n+l,i+y,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ti(!1),n=ar(t,ln(e)),i=ar(t,xs(e));n===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Ig=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Rg(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Mg(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new xg(e,{value:this.value,viewProps:this.viewProps}),text:new Rs(e,{parser:on,props:Ue.fromObject({pointerScale:.01,keyScale:.1,formatter:lr(2)}),value:dt(0,{constraint:new Ts({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Bi({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.getComponents()[3],backward:(n,i)=>{const s=n.getComponents();return s[3]=i,new rt(s,n.mode)}}),this.textsC_=new Vg(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Y0(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const hl=Xe("colsw");let Fg=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(hl()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(hl("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=e.createElement("button");i.classList.add(hl("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=au(e)}onValueChange_(){this.update_()}},$g=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Fg(e,{value:this.value,viewProps:this.viewProps})}},ou=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Zl.create(t.expanded),this.swatchC_=new $g(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new ys(e,{parser:t.parser,props:Ue.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new G0(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new gp(e,{viewProps:this.viewProps}):null;const i=new Ig(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),Bi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ql(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=up(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!Hl(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function Bg(r){return Gr(r.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function Ng(r){return r.getComponents("rgb").reduce((e,t,n)=>{const i=Math.floor(n===3?t*255:t)&255;return e<<8|i},0)>>>0}function Gg(r){return new rt([r>>16&255,r>>8&255,r&255],"rgb")}function jg(r){return new rt([r>>24&255,r>>16&255,r>>8&255,et(r&255,0,255,0,1)],"rgb")}function Ug(r){return typeof r!="number"?rt.black():Gg(r)}function zg(r){return typeof r!="number"?rt.black():jg(r)}function La(r,e){return typeof r!="object"||ut(r)?!1:e in r&&typeof r[e]=="number"}function Kp(r){return La(r,"r")&&La(r,"g")&&La(r,"b")}function qp(r){return Kp(r)&&La(r,"a")}function Xp(r){return Kp(r)}function lu(r,e){if(r.mode!==e.mode||r.type!==e.type)return!1;const t=r.getComponents(),n=e.getComponents();for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function rh(r){return"a"in r?[r.r,r.g,r.b,r.a]:[r.r,r.g,r.b]}function Hg(r){const e=Hp(r);return e?(t,n)=>{Ds(t,e(n))}:null}function Kg(r){const e=r?Ng:Bg;return(t,n)=>{Ds(t,e(n))}}function qg(r,e,t){const i=Wt(e,t).toRgbaObject();r.writeProperty("r",i.r),r.writeProperty("g",i.g),r.writeProperty("b",i.b),r.writeProperty("a",i.a)}function Xg(r,e,t){const i=Wt(e,t).toRgbaObject();r.writeProperty("r",i.r),r.writeProperty("g",i.g),r.writeProperty("b",i.b)}function Yg(r,e){return(t,n)=>{r?qg(t,n,e):Xg(t,n,e)}}function Wg(r){var e;return!!(!((e=r==null?void 0:r.color)===null||e===void 0)&&e.alpha)}function Zg(r){return r?e=>au(e,"0x"):e=>su(e,"0x")}function Qg(r){return"color"in r||r.view==="color"}const Jg=Qt({id:"input-color-number",type:"input",accept:(r,e)=>{if(typeof r!="number"||!Qg(e))return null;const t=ru(e);return t?{initialValue:r,params:Object.assign(Object.assign({},t),{supportsAlpha:Wg(e)})}:null},binding:{reader:r=>r.params.supportsAlpha?zg:Ug,equals:lu,writer:r=>Kg(r.params.supportsAlpha)},controller:r=>{var e,t;return new ou(r.document,{colorType:"int",expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:Zg(r.params.supportsAlpha),parser:Ms("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:r.params.supportsAlpha,value:r.value,viewProps:r.viewProps})}});function ey(r,e){if(!Xp(r))return Wt(rt.black(),e);if(e==="int"){const t=rh(r);return new rt(t,"rgb")}if(e==="float"){const t=rh(r);return new nu(t,"rgb")}return Wt(rt.black(),"int")}function ty(r){return qp(r)}function ry(r){return e=>{const t=ey(e,r);return Wt(t,"int")}}function ny(r,e){return t=>r?zp(t,e):Up(t,e)}const iy=Qt({id:"input-color-object",type:"input",accept:(r,e)=>{var t;if(!Xp(r))return null;const n=ru(e);return n?{initialValue:r,params:Object.assign(Object.assign({},n),{colorType:(t=Vp(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:r=>ry(r.params.colorType),equals:lu,writer:r=>Yg(ty(r.initialValue),r.params.colorType)},controller:r=>{var e,t;const n=qp(r.initialValue);return new ou(r.document,{colorType:r.params.colorType,expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:ny(n,r.params.colorType),parser:Ms("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n,value:r.value,viewProps:r.viewProps})}}),sy=Qt({id:"input-color-string",type:"input",accept:(r,e)=>{if(typeof r!="string"||e.view==="text")return null;const t=fg(r,Vp(e));if(!t)return null;const n=Hp(t);if(!n)return null;const i=ru(e);return i?{initialValue:r,params:Object.assign(Object.assign({},i),{format:t,stringifier:n})}:null},binding:{reader:()=>mg,equals:lu,writer:r=>{const e=Hg(r.params.format);if(!e)throw qt.notBindable();return e}},controller:r=>{var e,t;return new ou(r.document,{colorType:r.params.format.type,expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:r.params.stringifier,parser:Ms("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:r.params.format.alpha,value:r.value,viewProps:r.viewProps})}});let uu=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((n,i)=>{var s,o;return(o=(s=this.components[i])===null||s===void 0?void 0:s.constrain(n))!==null&&o!==void 0?o:n});return this.asm_.fromComponents(t)}};const nh=Xe("pndtxt");let ay=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(nh()),this.textViews.forEach(n=>{const i=e.createElement("div");i.classList.add(nh("a")),i.appendChild(n.element),this.element.appendChild(i)})}};function oy(r,e,t){return new Rs(r,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:dt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let cu=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,i)=>oy(e,t,i)),this.acs_.forEach((n,i)=>{Bi({primary:this.value,secondary:n.value,forward:s=>t.assembly.toComponents(s)[i],backward:(s,o)=>{const l=t.assembly.toComponents(s);return l[i]=o,t.assembly.fromComponents(l)}})}),this.view=new ay(e,{textViews:this.acs_.map(n=>n.view)})}get textControllers(){return this.acs_}},ly=class extends gs{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function uy(r,e){const t=[],n=rp(r,e);n&&t.push(n);const i=np(r);i&&t.push(i);const s=tu(r.options);return s&&t.push(s),new Ls(t)}const cy=Qt({id:"input-number",type:"input",accept:(r,e)=>{if(typeof r!="number")return null;const t=bt(e,n=>Object.assign(Object.assign({},sp(n)),{options:n.optional.custom(Os),readonly:n.optional.constant(!1)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>Qh,constraint:r=>uy(r.params,r.initialValue),writer:r=>Ds},controller:r=>{const e=r.value,t=r.constraint,n=t&&Ia(t,Vs);if(n)return new Vn(r.document,{props:new Ue({options:n.values.value("options")}),value:e,viewProps:r.viewProps});const i=ip(r.params,e.rawValue),s=t&&Ia(t,Ts);return s?new $a(r.document,Object.assign(Object.assign({},Ep(Object.assign(Object.assign({},i),{keyScale:dt(i.keyScale),max:s.values.value("max"),min:s.values.value("min")}))),{parser:on,value:e,viewProps:r.viewProps})):new Rs(r.document,{parser:on,props:Ue.fromObject(i),value:e,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="number"?null:r.controller.valueController instanceof $a?new ly(r.controller):r.controller.valueController instanceof Vn?new Jl(r.controller):null}});let kn=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(ut(e))return!1;const t=e.x,n=e.y;return!(typeof t!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const Yp={toComponents:r=>r.getComponents(),fromComponents:r=>new kn(...r)},Pi=Xe("p2d");let dy=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Pi()),t.viewProps.bindClassModifiers(this.element),sn(t.expanded,Ii(this.element,Pi(void 0,"expanded")));const n=e.createElement("div");n.classList.add(Pi("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(Pi("b")),i.appendChild(qa(e,"p2dpad")),t.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=e.createElement("div");if(s.classList.add(Pi("t")),n.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Pi("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const yn=Xe("p2dp");let hy=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(yn()),t.layout==="popup"&&this.element.classList.add(yn(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(yn("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS($r,"svg");i.classList.add(yn("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=e.createElementNS($r,"line");s.classList.add(yn("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=e.createElementNS($r,"line");o.classList.add(yn("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS($r,"line");l.classList.add(yn("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const y=e.createElement("div");y.classList.add(yn("m")),this.padElement.appendChild(y),this.markerElem_=y,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),i=et(e,-n,+n,0,100),s=et(t,-n,+n,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function ih(r,e,t){return[ar(e[0],ln(r)),ar(e[1],xs(r))*(t?1:-1)]}let py=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new hy(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ai(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),i=et(e.point.x,0,e.bounds.width,-n,+n),s=et(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new kn(i,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Cp(e.key)&&e.preventDefault();const[t,n]=ih(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(new kn(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=ih(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},fy=class{constructor(e,t){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Zl.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new gp(e,{viewProps:this.viewProps}):null;const s=new py(e,{layout:t.pickerLayout,props:new Ue({invertsY:dt(t.invertsY),max:dt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new cu(e,{assembly:Yp,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new dy(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Bi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ql(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=up(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!Hl(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function my(r){return kn.isObject(r)?new kn(r.x,r.y):new kn}function vy(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y)}function by(r,e){return new uu({assembly:Yp,components:[rn(Object.assign(Object.assign({},r),r.x),e.x),rn(Object.assign(Object.assign({},r),r.y),e.y)]})}function sh(r,e){var t,n;if(!ut(r.min)||!ut(r.max))return Math.max(Math.abs((t=r.min)!==null&&t!==void 0?t:0),Math.abs((n=r.max)!==null&&n!==void 0?n:0));const i=ep(r);return Math.max(Math.abs(i)*10,Math.abs(e)*10)}function _y(r,e){var t,n;const i=sh(Jn(r,(t=r.x)!==null&&t!==void 0?t:{}),e.x),s=sh(Jn(r,(n=r.y)!==null&&n!==void 0?n:{}),e.y);return Math.max(i,s)}function wy(r){if(!("y"in r))return!1;const e=r.y;return e&&"inverted"in e?!!e.inverted:!1}const gy=Qt({id:"input-point2d",type:"input",accept:(r,e)=>{if(!kn.isObject(r))return null;const t=bt(e,n=>Object.assign(Object.assign({},Cs(n)),{expanded:n.optional.boolean,picker:n.optional.custom(Ap),readonly:n.optional.constant(!1),x:n.optional.custom(Sn),y:n.optional.object(Object.assign(Object.assign({},Cs(n)),{inverted:n.optional.boolean}))}));return t?{initialValue:r,params:t}:null},binding:{reader:()=>my,constraint:r=>by(r.params,r.initialValue),equals:kn.equals,writer:()=>vy},controller:r=>{var e,t;const n=r.document,i=r.value,s=r.constraint,o=[r.params.x,r.params.y];return new fy(n,{axes:i.rawValue.getComponents().map((l,y)=>{var x;return zl({constraint:s.components[y],initialValue:l,params:Jn(r.params,(x=o[y])!==null&&x!==void 0?x:{})})}),expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,invertsY:wy(r.params),max:_y(r.params,i.rawValue),parser:on,pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",value:i,viewProps:r.viewProps})}});let ki=class{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(ut(e))return!1;const t=e.x,n=e.y,i=e.z;return!(typeof t!="number"||typeof n!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const Wp={toComponents:r=>r.getComponents(),fromComponents:r=>new ki(...r)};function yy(r){return ki.isObject(r)?new ki(r.x,r.y,r.z):new ki}function xy(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z)}function Cy(r,e){return new uu({assembly:Wp,components:[rn(Object.assign(Object.assign({},r),r.x),e.x),rn(Object.assign(Object.assign({},r),r.y),e.y),rn(Object.assign(Object.assign({},r),r.z),e.z)]})}const Ey=Qt({id:"input-point3d",type:"input",accept:(r,e)=>{if(!ki.isObject(r))return null;const t=bt(e,n=>Object.assign(Object.assign({},Cs(n)),{readonly:n.optional.constant(!1),x:n.optional.custom(Sn),y:n.optional.custom(Sn),z:n.optional.custom(Sn)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>yy,constraint:r=>Cy(r.params,r.initialValue),equals:ki.equals,writer:r=>xy},controller:r=>{const e=r.value,t=r.constraint,n=[r.params.x,r.params.y,r.params.z];return new cu(r.document,{assembly:Wp,axes:e.rawValue.getComponents().map((i,s)=>{var o;return zl({constraint:t.components[s],initialValue:i,params:Jn(r.params,(o=n[s])!==null&&o!==void 0?o:{})})}),parser:on,value:e,viewProps:r.viewProps})}});let Li=class{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(ut(e))return!1;const t=e.x,n=e.y,i=e.z,s=e.w;return!(typeof t!="number"||typeof n!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const Zp={toComponents:r=>r.getComponents(),fromComponents:r=>new Li(...r)};function Py(r){return Li.isObject(r)?new Li(r.x,r.y,r.z,r.w):new Li}function Ay(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z),r.writeProperty("w",e.w)}function Sy(r,e){return new uu({assembly:Zp,components:[rn(Object.assign(Object.assign({},r),r.x),e.x),rn(Object.assign(Object.assign({},r),r.y),e.y),rn(Object.assign(Object.assign({},r),r.z),e.z),rn(Object.assign(Object.assign({},r),r.w),e.w)]})}const Ty=Qt({id:"input-point4d",type:"input",accept:(r,e)=>{if(!Li.isObject(r))return null;const t=bt(e,n=>Object.assign(Object.assign({},Cs(n)),{readonly:n.optional.constant(!1),w:n.optional.custom(Sn),x:n.optional.custom(Sn),y:n.optional.custom(Sn),z:n.optional.custom(Sn)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>Py,constraint:r=>Sy(r.params,r.initialValue),equals:Li.equals,writer:r=>Ay},controller:r=>{const e=r.value,t=r.constraint,n=[r.params.x,r.params.y,r.params.z,r.params.w];return new cu(r.document,{assembly:Zp,axes:e.rawValue.getComponents().map((i,s)=>{var o;return zl({constraint:t.components[s],initialValue:i,params:Jn(r.params,(o=n[s])!==null&&o!==void 0?o:{})})}),parser:on,value:e,viewProps:r.viewProps})}});function ky(r){const e=[],t=tu(r.options);return t&&e.push(t),new Ls(e)}const Ly=Qt({id:"input-string",type:"input",accept:(r,e)=>{if(typeof r!="string")return null;const t=bt(e,n=>({readonly:n.optional.constant(!1),options:n.optional.custom(Os)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>xp,constraint:r=>ky(r.params),writer:r=>Ds},controller:r=>{const e=r.document,t=r.value,n=r.constraint,i=n&&Ia(n,Vs);return i?new Vn(e,{props:new Ue({options:i.values.value("options")}),value:t,viewProps:r.viewProps}):new ys(e,{parser:s=>s,props:Ue.fromObject({formatter:kl}),value:t,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="string"?null:r.controller.valueController instanceof Vn?new Jl(r.controller):null}}),Is={monitor:{defaultInterval:200,defaultRows:3}},ah=Xe("mll");let Vy=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(ah()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(ah("i")),n.style.height=`calc(var(${Pp("containerUnitSize")}) * ${t.rows})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(i=>{i!==void 0&&n.push(this.formatter_(i))}),e.textContent=n.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},du=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Vy(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const oh=Xe("sgl");let Oy=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(oh()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(oh("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},hu=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Oy(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};const Ry=Qt({id:"monitor-bool",type:"monitor",accept:(r,e)=>{if(typeof r!="boolean")return null;const t=bt(e,n=>({readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>yp},controller:r=>{var e;return r.value.rawValue.length===1?new hu(r.document,{formatter:Jd,value:r.value,viewProps:r.viewProps}):new du(r.document,{formatter:Jd,rows:(e=r.params.rows)!==null&&e!==void 0?e:Is.monitor.defaultRows,value:r.value,viewProps:r.viewProps})}});let Dy=class extends gs{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const xn=Xe("grl");let My=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(xn()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS($r,"svg");n.classList.add(xn("g")),n.style.height=`calc(var(${Pp("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS($r,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=e.createElement("div");s.classList.add(xn("t"),Xe("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,n=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((U,de)=>{if(U===void 0)return;const Se=et(de,0,n,0,e),Ce=et(U,i,s,t,0);o.push([Se,Ce].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const l=this.tooltipElem_,y=this.value.rawValue[this.cursor_.rawValue];if(y===void 0){l.classList.remove(xn("t","a"));return}const x=et(this.cursor_.rawValue,0,n,0,e),N=et(y,i,s,t,0);l.style.left=`${x}px`,l.style.top=`${N}px`,l.textContent=`${this.formatter_(y)}`,l.classList.contains(xn("t","a"))||(l.classList.add(xn("t","a"),xn("t","in")),Ma(l),l.classList.remove(xn("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},Qp=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=dt(-1),this.view=new My(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Hl(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new ai(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return fr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return mr(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(et(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(et(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Ll(r){return ut(r.format)?lr(2):r.format}function Iy(r){var e;return r.value.rawValue.length===1?new hu(r.document,{formatter:Ll(r.params),value:r.value,viewProps:r.viewProps}):new du(r.document,{formatter:Ll(r.params),rows:(e=r.params.rows)!==null&&e!==void 0?e:Is.monitor.defaultRows,value:r.value,viewProps:r.viewProps})}function Fy(r){var e,t,n;return new Qp(r.document,{formatter:Ll(r.params),rows:(e=r.params.rows)!==null&&e!==void 0?e:Is.monitor.defaultRows,props:Ue.fromObject({max:(t=r.params.max)!==null&&t!==void 0?t:100,min:(n=r.params.min)!==null&&n!==void 0?n:0}),value:r.value,viewProps:r.viewProps})}function lh(r){return r.view==="graph"}const $y=Qt({id:"monitor-number",type:"monitor",accept:(r,e)=>{if(typeof r!="number")return null;const t=bt(e,n=>({format:n.optional.function,max:n.optional.number,min:n.optional.number,readonly:n.required.constant(!0),rows:n.optional.number,view:n.optional.string}));return t?{initialValue:r,params:t}:null},binding:{defaultBufferSize:r=>lh(r)?64:1,reader:r=>Qh},controller:r=>lh(r.params)?Fy(r):Iy(r),api:r=>r.controller.valueController instanceof Qp?new Dy(r.controller):null}),By=Qt({id:"monitor-string",type:"monitor",accept:(r,e)=>{if(typeof r!="string")return null;const t=bt(e,n=>({multiline:n.optional.boolean,readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>xp},controller:r=>{var e;const t=r.value;return t.rawValue.length>1||r.params.multiline?new du(r.document,{formatter:kl,rows:(e=r.params.rows)!==null&&e!==void 0?e:Is.monitor.defaultRows,value:t,viewProps:r.viewProps}):new hu(r.document,{formatter:kl,value:t,viewProps:r.viewProps})}});class Ny{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class Gy{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function jy(r,e){var t;const n=r.accept(e.target.read(),e.params);if(ut(n))return null;const i={target:e.target,initialValue:n.initialValue,params:n.params},s=bt(e.params,U=>({disabled:U.optional.boolean,hidden:U.optional.boolean,label:U.optional.string,tag:U.optional.string})),o=r.binding.reader(i),l=r.binding.constraint?r.binding.constraint(i):void 0,y=new Gy({reader:o,target:e.target,writer:r.binding.writer(i)}),x=new Pw(dt(o(n.initialValue),{constraint:l,equals:r.binding.equals}),y),N=r.controller({constraint:l,document:e.document,initialValue:n.initialValue,params:n.params,value:x,viewProps:si.create({disabled:s==null?void 0:s.disabled,hidden:s==null?void 0:s.hidden})});return new Nw(e.document,{blade:$i(),props:Ue.fromObject({label:"label"in e.params?(t=s==null?void 0:s.label)!==null&&t!==void 0?t:null:e.target.key}),tag:s==null?void 0:s.tag,value:x,valueController:N})}class Uy{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function zy(r,e){return e===0?new x0:new C0(r,e??Is.monitor.defaultInterval)}function Hy(r,e){var t,n,i;const s=r.accept(e.target.read(),e.params);if(ut(s))return null;const o={target:e.target,initialValue:s.initialValue,params:s.params},l=bt(e.params,de=>({bufferSize:de.optional.number,disabled:de.optional.boolean,hidden:de.optional.boolean,interval:de.optional.number,label:de.optional.string})),y=r.binding.reader(o),x=(n=(t=l==null?void 0:l.bufferSize)!==null&&t!==void 0?t:r.binding.defaultBufferSize&&r.binding.defaultBufferSize(s.params))!==null&&n!==void 0?n:1,N=new Hw({binding:new Uy({reader:y,target:e.target}),bufferSize:x,ticker:zy(e.document,l==null?void 0:l.interval)}),U=r.controller({document:e.document,params:s.params,value:N,viewProps:si.create({disabled:l==null?void 0:l.disabled,hidden:l==null?void 0:l.hidden})});return U.viewProps.bindDisabled(N.ticker),U.viewProps.handleDispose(()=>{N.ticker.dispose()}),new qw(e.document,{blade:$i(),props:Ue.fromObject({label:"label"in e.params?(i=l==null?void 0:l.label)!==null&&i!==void 0?i:null:e.target.key}),value:N,valueController:U})}class Ky{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!I0(t.core))throw qt.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,n){return this.pluginsMap_.inputs.reduce((i,s)=>i??jy(s,{document:e,target:t,params:n}),null)}createMonitor_(e,t,n){return this.pluginsMap_.monitors.reduce((i,s)=>i??Hy(s,{document:e,params:n,target:t}),null)}createBinding(e,t,n){const i=t.read();if(ut(i))throw new qt({context:{key:t.key},type:"nomatchingcontroller"});const s=this.createInput_(e,t,n);if(s)return s;const o=this.createMonitor_(e,t,n);if(o)return o;throw new qt({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce((i,s)=>i??y0(s,{document:e,params:t}),null);if(!n)throw new qt({type:"nomatchingview",context:{params:t}});return n}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((n,i)=>{var s,o;return n||((o=(s=i.api)===null||s===void 0?void 0:s.call(i,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new gs(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((n,i)=>{var s,o;return n||((o=(s=i.api)===null||s===void 0?void 0:s.call(i,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new gs(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(Gw(e))return this.createInputBindingApi_(e);if(Xw(e))return this.createMonitorBindingApi_(e);throw qt.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(Bw(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((n,i)=>n??i.api({controller:e,pool:this}),null);if(!t)throw qt.shouldNeverHappen();return this.apiCache_.add(e,t)}}const qy=new Ny;function Xy(){const r=new Ky(qy);return[gy,Ey,Ty,Ly,cy,sy,iy,Jg,N0,Ry,By,$y,Jw,h0,wp].forEach(e=>{r.register("core",e)}),r}class Yy extends ii{constructor(e){super(e),this.emitter_=new kt,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new ks(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class Wy extends ii{}class Zy extends ii{constructor(e){super(e),this.emitter_=new kt,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new ks(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class Qy extends ii{constructor(e){super(e),this.emitter_=new kt,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new ks(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const Jy=function(){return{id:"list",type:"blade",core:Fi,accept(r){const e=bt(r,t=>({options:t.required.custom(Os),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(r){const e=new Vs(eu(r.params.options)),t=dt(r.params.value,{constraint:e}),n=new Vn(r.document,{props:new Ue({options:e.values.value("options")}),value:t,viewProps:r.viewProps});return new ei(r.document,{blade:r.blade,props:Ue.fromObject({label:r.params.label}),value:t,valueController:n})},api(r){return!(r.controller instanceof ei)||!(r.controller.valueController instanceof Vn)?null:new Yy(r.controller)}}}();class ex extends vp{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class tx extends Sl{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const uh=Xe("spr");class rx{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(uh()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(uh("r")),this.element.appendChild(n)}}class ch extends Xa{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new rx(e,{viewProps:t.viewProps})}))}}const nx={id:"separator",type:"blade",core:Fi,accept(r){const e=bt(r,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(r){return new ch(r.document,{blade:r.blade,viewProps:r.viewProps})},api(r){return r.controller instanceof ch?new Wy(r.controller):null}},ix={id:"slider",type:"blade",core:Fi,accept(r){const e=bt(r,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(r){var e,t;const n=(e=r.params.value)!==null&&e!==void 0?e:0,i=new Ts({max:r.params.max,min:r.params.min}),s=dt(n,{constraint:i}),o=new $a(r.document,Object.assign(Object.assign({},Ep({formatter:(t=r.params.format)!==null&&t!==void 0?t:gw,keyScale:dt(1),max:i.values.value("max"),min:i.values.value("min"),pointerScale:tp(r.params,n)})),{parser:on,value:s,viewProps:r.viewProps}));return new ei(r.document,{blade:r.blade,props:Ue.fromObject({label:r.params.label}),value:s,valueController:o})},api(r){return!(r.controller instanceof ei)||!(r.controller.valueController instanceof $a)?null:new Zy(r.controller)}},sx=function(){return{id:"text",type:"blade",core:Fi,accept(r){const e=bt(r,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(r){var e;const t=dt(r.params.value),n=new ys(r.document,{parser:r.params.parse,props:Ue.fromObject({formatter:(e=r.params.format)!==null&&e!==void 0?e:i=>String(i)}),value:t,viewProps:r.viewProps});return new ei(r.document,{blade:r.blade,props:Ue.fromObject({label:r.params.label}),value:t,valueController:n})},api(r){return!(r.controller instanceof ei)||!(r.controller.valueController instanceof ys)?null:new Qy(r.controller)}}}();function ax(r){const e=r.createElement("div");return e.classList.add(Xe("dfw")()),r.body&&r.body.appendChild(e),e}function ox(r,e,t){if(r.querySelector(`style[data-tp-style=${e}]`))return;const n=r.createElement("style");n.dataset.tpStyle=e,n.textContent=t,r.head.appendChild(n)}class ZA extends ex{constructor(e){var t,n;const i=e??{},s=(t=i.document)!==null&&t!==void 0?t:Ow(),o=Xy(),l=new tx(s,{expanded:i.expanded,blade:$i(),props:Ue.fromObject({title:i.title}),viewProps:si.create()});super(l,o),this.pool_=o,this.containerElem_=(n=i.container)!==null&&n!==void 0?n:ax(s),this.containerElem_.appendChild(this.element),this.doc_=s,this.usesDefaultWrapper_=!i.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw qt.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw qt.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&ox(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(n=>{this.pool_.register(e.id,n)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[Jy,nx,ix,wp,sx]})}}new fp("4.0.5");function vt(r){return r==null}function pu(r){return r!==null&&typeof r=="object"}function Vl(r){return r!==null&&typeof r=="object"}function lx(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ri(r,e){return Array.from(new Set([...Object.keys(r),...Object.keys(e)])).reduce((n,i)=>{const s=r[i],o=e[i];return Vl(s)&&Vl(o)?Object.assign(Object.assign({},n),{[i]:ri(s,o)}):Object.assign(Object.assign({},n),{[i]:i in e?o:s})},{})}function ux(r){return pu(r)?"target"in r:!1}const cx={alreadydisposed:()=>"View has been already disposed",invalidparams:r=>`Invalid parameters for '${r.name}'`,nomatchingcontroller:r=>`No matching controller for '${r.key}'`,nomatchingview:r=>`No matching view for '${JSON.stringify(r.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:r=>`Not compatible with  plugin '${r.id}'`,propertynotfound:r=>`Property '${r.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class pr{static alreadyDisposed(){return new pr({type:"alreadydisposed"})}static notBindable(){return new pr({type:"notbindable"})}static notCompatible(e,t){return new pr({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new pr({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new pr({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=cx[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class Ba{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!Ba.isBindable(n))throw pr.notBindable();if(!(e in n))throw pr.propertyNotFound(e);n[e]=t}}class vr{constructor(){this.observers_={}}on(e,t,n){var i;let s=this.observers_[e];return s||(s=this.observers_[e]=[]),s.push({handler:t,key:(i=n==null?void 0:n.key)!==null&&i!==void 0?i:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(i=>i.key!==t)),this}emit(e,t){const n=this.observers_[e];n&&n.forEach(i=>{i.handler(t)})}}class dx{constructor(e,t){var n;this.constraint_=t==null?void 0:t.constraint,this.equals_=(n=t==null?void 0:t.equals)!==null&&n!==void 0?n:(i,s)=>i===s,this.emitter=new vr,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t??{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;this.equals_(s,i)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:i,sender:this}))}}class hx{constructor(e){this.emitter=new vr,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t??{forceEmit:!1,last:!0},i=this.value_;i===e&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}}class px{constructor(e){this.emitter=new vr,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function jt(r,e){const t=e==null?void 0:e.constraint,n=e==null?void 0:e.equals;return!t&&!n?new hx(r):new dx(r,e)}function fx(r){return[new px(r),(e,t)=>{r.setRawValue(e,t)}]}class Ze{constructor(e){this.emitter=new vr,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,i)=>Object.assign(n,{[i]:jt(e[i])}),{})}static fromObject(e){const t=this.createCore(e);return new Ze(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class Wa{constructor(e){this.values=Ze.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class mx{constructor(e){this.values=Ze.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let i=e;return vt(n)||(i=Math.max(i,n)),vt(t)||(i=Math.min(i,t)),i}}class vx{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,n=Math.round((e-t)/this.step);return t+n*this.step}}class bx{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const _x={"**":(r,e)=>Math.pow(r,e),"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"&":(r,e)=>r&e,"^":(r,e)=>r^e,"|":(r,e)=>r|e};class wx{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=_x[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const gx={"+":r=>r,"-":r=>-r,"~":r=>~r};class yx{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=gx[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function fu(r){return(e,t)=>{for(let n=0;n<r.length;n++){const i=r[n](e,t);if(i!=="")return i}return""}}function Es(r,e){var t;const n=r.substr(e).match(/^\s+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function xx(r,e){const t=r.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Ps(r,e){var t;const n=r.substr(e).match(/^[0-9]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Cx(r,e){const t=Ps(r,e);if(t!=="")return t;const n=r.substr(e,1);if(e+=1,n!=="-"&&n!=="+")return"";const i=Ps(r,e);return i===""?"":n+i}function mu(r,e){const t=r.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const n=Cx(r,e);return n===""?"":t+n}function Jp(r,e){const t=r.substr(e,1);if(t==="0")return t;const n=xx(r,e);return e+=n.length,n===""?"":n+Ps(r,e)}function Ex(r,e){const t=Jp(r,e);if(e+=t.length,t==="")return"";const n=r.substr(e,1);if(e+=n.length,n!==".")return"";const i=Ps(r,e);return e+=i.length,t+n+i+mu(r,e)}function Px(r,e){const t=r.substr(e,1);if(e+=t.length,t!==".")return"";const n=Ps(r,e);return e+=n.length,n===""?"":t+n+mu(r,e)}function Ax(r,e){const t=Jp(r,e);return e+=t.length,t===""?"":t+mu(r,e)}const Sx=fu([Ex,Px,Ax]);function Tx(r,e){var t;const n=r.substr(e).match(/^[01]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function kx(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const n=Tx(r,e);return n===""?"":t+n}function Lx(r,e){var t;const n=r.substr(e).match(/^[0-7]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Vx(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const n=Lx(r,e);return n===""?"":t+n}function Ox(r,e){var t;const n=r.substr(e).match(/^[0-9a-f]+/i);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Rx(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const n=Ox(r,e);return n===""?"":t+n}const Dx=fu([kx,Vx,Rx]),Mx=fu([Dx,Sx]);function Ix(r,e){const t=Mx(r,e);return e+=t.length,t===""?null:{evaluable:new bx(t),cursor:e}}function Fx(r,e){const t=r.substr(e,1);if(e+=t.length,t!=="(")return null;const n=tf(r,e);if(!n)return null;e=n.cursor,e+=Es(r,e).length;const i=r.substr(e,1);return e+=i.length,i!==")"?null:{evaluable:n.evaluable,cursor:e}}function $x(r,e){var t;return(t=Ix(r,e))!==null&&t!==void 0?t:Fx(r,e)}function ef(r,e){const t=$x(r,e);if(t)return t;const n=r.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const i=ef(r,e);return i?(e=i.cursor,{cursor:e,evaluable:new yx(n,i.evaluable)}):null}function Bx(r,e,t){t+=Es(e,t).length;const n=r.filter(i=>e.startsWith(i,t))[0];return n?(t+=n.length,t+=Es(e,t).length,{cursor:t,operator:n}):null}function Nx(r,e){return(t,n)=>{const i=r(t,n);if(!i)return null;n=i.cursor;let s=i.evaluable;for(;;){const o=Bx(e,t,n);if(!o)break;n=o.cursor;const l=r(t,n);if(!l)return null;n=l.cursor,s=new wx(o.operator,s,l.evaluable)}return s?{cursor:n,evaluable:s}:null}}const Gx=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((r,e)=>Nx(r,e),ef);function tf(r,e){return e+=Es(r,e).length,Gx(r,e)}function jx(r){const e=tf(r,0);return!e||e.cursor+Es(r,e.cursor).length!==r.length?null:e.evaluable}function On(r){var e;const t=jx(r);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function rf(r){if(typeof r=="number")return r;if(typeof r=="string"){const e=On(r);if(!vt(e))return e}return 0}function ur(r){return e=>e.toFixed(Math.max(Math.min(r,20),0))}function tt(r,e,t,n,i){const s=(r-e)/(t-e);return n+s*(i-n)}function dh(r){return String(r.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Dt(r,e,t){return Math.min(Math.max(r,e),t)}function nf(r,e){return(r%e+e)%e}function Ux(r,e){return vt(r.step)?Math.max(dh(e),2):dh(r.step)}function sf(r){var e;return(e=r.step)!==null&&e!==void 0?e:1}function zx(r,e){var t;const n=Math.abs((t=r.step)!==null&&t!==void 0?t:e);return n===0?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}function af(r,e){return vt(r.step)?null:new vx(r.step,e)}function of(r){return!vt(r.max)&&!vt(r.min)?new Wa({max:r.max,min:r.min}):!vt(r.max)||!vt(r.min)?new mx({max:r.max,min:r.min}):null}function lf(r,e){var t,n,i;return{formatter:(t=r.format)!==null&&t!==void 0?t:ur(Ux(r,e)),keyScale:(n=r.keyScale)!==null&&n!==void 0?n:sf(r),pointerScale:(i=r.pointerScale)!==null&&i!==void 0?i:zx(r,e)}}function uf(r){return{format:r.optional.function,keyScale:r.optional.number,max:r.optional.number,min:r.optional.number,pointerScale:r.optional.number,step:r.optional.number}}function vu(r){return{constraint:r.constraint,textProps:Ze.fromObject(lf(r.params,r.initialValue))}}class bu{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class Za{constructor(e){this.target=e}}class cf extends Za{constructor(e,t,n){super(e),this.value=t,this.last=n??!0}}class Hx extends Za{constructor(e,t){super(e),this.expanded=t}}class Kx extends Za{constructor(e,t){super(e),this.index=t}}class qx extends Za{constructor(e,t){super(e),this.native=t}}class _u extends bu{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new vr,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new cf(this,t.binding.target.read(),e.options.last))}}function Xx(r,e){const n=Object.keys(e).reduce((i,s)=>{if(i===void 0)return;const o=e[s],l=o(r[s]);return l.succeeded?Object.assign(Object.assign({},i),{[s]:l.value}):void 0},{});return n}function Yx(r,e){return r.reduce((t,n)=>{if(t===void 0)return;const i=e(n);if(!(!i.succeeded||i.value===void 0))return[...t,i.value]},[])}function Wx(r){return r===null?!1:typeof r=="object"}function en(r){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const n=r(t);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function hh(r){return{custom:e=>en(e)(r),boolean:en(e=>typeof e=="boolean"?e:void 0)(r),number:en(e=>typeof e=="number"?e:void 0)(r),string:en(e=>typeof e=="string"?e:void 0)(r),function:en(e=>typeof e=="function"?e:void 0)(r),constant:e=>en(t=>t===e?e:void 0)(r),raw:en(e=>e)(r),object:e=>en(t=>{if(Wx(t))return Xx(t,e)})(r),array:e=>en(t=>{if(Array.isArray(t))return Yx(t,e)})(r)}}const Ol={optional:hh(!0),required:hh(!1)};function Xt(r,e){const t=e(Ol),n=Ol.required.object(t)(r);return n.succeeded?n.value:void 0}function zr(r,e,t,n){if(e&&!e(r))return!1;const i=Xt(r,t);return i?n(i):!1}function Hr(r,e){var t;return ri((t=r==null?void 0:r())!==null&&t!==void 0?t:{},e)}function Va(r){return"value"in r}function Zx(r){if(!pu(r)||!("binding"in r))return!1;const e=r.binding;return ux(e)}const Br="http://www.w3.org/2000/svg";function Na(r){r.offsetHeight}function Qx(r,e){const t=r.style.transition;r.style.transition="none",e(),r.style.transition=t}function wu(r){return r.ontouchstart!==void 0}function Jx(r){const e=r.ownerDocument.defaultView;return e&&"document"in e?r.getContext("2d",{willReadFrequently:!0}):null}const eC={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Qa(r,e){const t=r.createElementNS(Br,"svg");return t.innerHTML=eC[e],t}function df(r,e,t){r.insertBefore(e,r.children[t])}function gu(r){r.parentElement&&r.parentElement.removeChild(r)}function hf(r){for(;r.children.length>0;)r.removeChild(r.children[0])}function tC(r){for(;r.childNodes.length>0;)r.removeChild(r.childNodes[0])}function pf(r){return r.relatedTarget?r.relatedTarget:"explicitOriginalTarget"in r?r.explicitOriginalTarget:null}function an(r,e){r.emitter.on("change",t=>{e(t.rawValue)}),e(r.rawValue)}function jr(r,e,t){an(r.value(e),t)}const rC="tp";function Qe(r){return(t,n)=>[rC,"-",r,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}const cs=Qe("lbl");function nC(r,e){const t=r.createDocumentFragment();return e.split(`
`).map(i=>r.createTextNode(i)).forEach((i,s)=>{s>0&&t.appendChild(r.createElement("br")),t.appendChild(i)}),t}class iC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cs()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(cs("l")),jr(t.props,"label",s=>{vt(s)?this.element.classList.add(cs(void 0,"nol")):(this.element.classList.remove(cs(void 0,"nol")),tC(n),n.appendChild(nC(e,s)))}),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("div");i.classList.add(cs("v")),this.element.appendChild(i),this.valueElement=i}}class sC{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new iC(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return zr(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Hr(null,{label:this.props.get("label")})}}function aC(){return["veryfirst","first","last","verylast"]}const ph=Qe(""),fh={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ff{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{aC().forEach(n=>{t.classList.remove(ph(void 0,fh[n]))}),this.blade.get("positions").forEach(n=>{t.classList.add(ph(void 0,fh[n]))})}),this.viewProps.handleDispose(()=>{gu(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return zr(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Hr(null,Object.assign({},this.viewProps.exportState()))}}class oC extends bu{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,s=>{n(new qx(this,s.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function lC(r,e,t){t?r.classList.add(e):r.classList.remove(e)}function Ni(r,e){return t=>{lC(r,e,t)}}function yu(r,e){an(r,t=>{e.textContent=t??""})}const pl=Qe("btn");class uC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pl()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(pl("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(pl("t")),yu(t.props.value("title"),i),this.buttonElement.appendChild(i)}}class cC{constructor(e,t){this.emitter=new vr,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new uC(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return zr(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Hr(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class mh extends ff{constructor(e,t){const n=new cC(e,{props:t.buttonProps,viewProps:t.viewProps}),i=new sC(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=i}importState(e){return zr(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Hr(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class dC{constructor(e){const[t,n]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=n??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const hC=new dC("2.0.5");function Jt(r){return Object.assign({core:hC},r)}Jt({id:"button",type:"blade",accept(r){const e=Xt(r,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(r){return new mh(r.document,{blade:r.blade,buttonProps:Ze.fromObject({title:r.params.title}),labelProps:Ze.fromObject({label:r.params.label}),viewProps:r.viewProps})},api(r){return r.controller instanceof mh?new oC(r.controller):null}});function pC(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function fC(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function mC(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function vC(r){return pu(r)?"refresh"in r&&typeof r.refresh=="function":!1}function bC(r,e){if(!Ba.isBindable(r))throw pr.notBindable();return new Ba(r,e)}class _C{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new vr,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,n){const i=n??{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,bC(e,t),i),l=this.pool_.createBindingApi(o);return this.add(l,i.index)}addFolder(e){return fC(this,e)}addButton(e){return pC(this,e)}addTab(e){return mC(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createApi(n);return this.add(i,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{vC(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),i=Zx(t.value)?t.value.binding:null;this.emitter_.emit("change",new cf(n,i?i.target.read():t.value.rawValue,e.options.last))}}class xu extends bu{constructor(e,t){super(e),this.rackApi_=new _C(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class Cu extends ff{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return zr(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((n,i)=>n.importState(t.children[i])))}exportState(){return Hr(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function Rl(r){return"rackController"in r}class wC{constructor(e){this.emitter=new vr,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw pr.shouldNeverHappen();const n=t!==void 0?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach(s=>{this.cache_.add(s)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach(i=>{this.cache_.delete(i)}),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function gC(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(Va(n)&&n.value===e)return n}return null}function yC(r){return Rl(r)?r.rackController.rack.bcSet_:null}class xC{constructor(e){var t,n;this.emitter=new vr,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(n=this.blade_)===null||n===void 0||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new wC(yC),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;(n=e.parent)===null||n===void 0||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),Va(n))n.value.emitter.on("change",this.onChildValueChange_);else if(Rl(n)){const i=n.rackController.rack;if(i){const s=i.emitter;s.on("layout",this.onRackLayout_),s.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(Va(n))n.value.emitter.off("change",this.onChildValueChange_);else if(Rl(n)){const i=n.rackController.rack;if(i){const s=i.emitter;s.off("layout",this.onRackLayout_),s.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(i=>!i.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(i=>{const s=[];i===t&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),i===n&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),i.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=gC(this.find(Va),e.sender);if(!t)throw pr.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Eu{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new xC({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let n=this.rack.children.length-1;n>=0;n--)this.rack.children[n].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&df(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&gu(e.bladeController.view.element)}}function mf(){return new Ze({positions:jt([],{equals:lx})})}class Fs extends Ze{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=Ze.createCore(t);return new Fs(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!vt(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};jr(this,"expanded",n),jr(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function CC(r,e){let t=0;return Qx(e,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),Na(e),t=e.clientHeight,r.set("temporaryExpanded",null),Na(e)}),t}function vh(r,e){e.style.height=r.styleHeight}function Pu(r,e){r.value("expanded").emitter.on("beforechange",()=>{if(r.set("completed",!1),vt(r.get("expandedHeight"))){const t=CC(r,e);t>0&&r.set("expandedHeight",t)}r.set("shouldFixHeight",!0),Na(e)}),r.emitter.on("change",()=>{vh(r,e)}),vh(r,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&r.cleanUpTransition()})}class EC extends xu{constructor(e,t){super(e,t),this.emitter_=new vr,this.controller.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",new Hx(this,n.sender.rawValue))}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const vf=Qe("cnt");class PC{constructor(e,t){var n;this.className_=Qe((n=t.viewName)!==null&&n!==void 0?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),vf()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),jr(this.foldable_,"completed",Ni(this.element,this.className_(void 0,"cpl")));const i=e.createElement("button");i.classList.add(this.className_("b")),jr(t.props,"title",x=>{vt(x)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=e.createElement("div");o.classList.add(this.className_("t")),yu(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const y=e.createElement("div");y.classList.add(this.className_("c")),this.element.appendChild(y),this.containerElement=y}}class bh extends Cu{constructor(e,t){var n;const i=Fs.create((n=t.expanded)!==null&&n!==void 0?n:!0),s=new PC(e,{foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Eu({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,Pu(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return zr(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Hr(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}Jt({id:"folder",type:"blade",accept(r){const e=Xt(r,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(r){return new bh(r.document,{blade:r.blade,expanded:r.params.expanded,props:Ze.fromObject({title:r.params.title}),viewProps:r.viewProps})},api(r){return r.controller instanceof bh?new EC(r.controller,r.pool):null}});const AC=Qe("");function _h(r,e){return Ni(r,AC(void 0,e))}class $s extends Ze{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=fx(jt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,i;const s=e??{};return new $s(Ze.createCore({disabled:(t=s.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(n=s.hidden)!==null&&n!==void 0?n:!1,parent:(i=s.parent)!==null&&i!==void 0?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){an(this.globalDisabled_,_h(e,"disabled")),jr(this,"hidden",_h(e,"hidden"))}bindDisabled(e){an(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){an(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;n==null||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const wh=Qe("tbp");class SC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wh()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(wh("c")),this.element.appendChild(n),this.containerElement=n}}const ds=Qe("tbi");class TC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ds()),t.viewProps.bindClassModifiers(this.element),jr(t.props,"selected",s=>{s?this.element.classList.add(ds(void 0,"sel")):this.element.classList.remove(ds(void 0,"sel"))});const n=e.createElement("button");n.classList.add(ds("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(ds("t")),yu(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class kC{constructor(e,t){this.emitter=new vr,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new TC(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Dl extends Cu{constructor(e,t){const n=new SC(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Eu({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new kC(e,{props:t.itemProps,viewProps:$s.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,jr(this.props,"selected",i=>{this.itemController.props.set("selected",i),this.viewProps.set("hidden",!i)})}get itemController(){return this.ic_}importState(e){return zr(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Hr(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class LC extends xu{constructor(e,t){super(e,t),this.emitter_=new vr,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new Dl(t,{blade:mf(),itemProps:Ze.fromObject({selected:!1,title:e.title}),props:Ze.fromObject({selected:!1}),viewProps:$s.create()}),i=this.pool_.createApi(n);return this.rackApi_.add(i,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,i=>{n(i)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new Kx(this,e.rawValue))}}class VC extends xu{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}const gh=-1;class OC{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=jt(!0),this.selectedIndex=jt(gh),this.items_=[]}add(e,t){const n=t??this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=gh,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,n)=>{t.rawValue=n===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(n=>n===e.sender);this.items_.forEach((n,i)=>{n.rawValue=i===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const hs=Qe("tab");class RC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hs(),vf()),t.viewProps.bindClassModifiers(this.element),an(t.empty,Ni(this.element,hs(void 0,"nop")));const n=e.createElement("div");n.classList.add(hs("t")),this.element.appendChild(n),this.itemsElement=n;const i=e.createElement("div");i.classList.add(hs("i")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(hs("c")),this.element.appendChild(s),this.contentsElement=s}}class yh extends Cu{constructor(e,t){const n=new OC,i=new RC(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Eu({blade:t.blade,element:i.contentsElement,viewProps:t.viewProps}),view:i}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;df(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;gu(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}Jt({id:"tab",type:"blade",accept(r){const e=Xt(r,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(r){const e=new yh(r.document,{blade:r.blade,viewProps:r.viewProps});return r.params.pages.forEach(t=>{const n=new Dl(r.document,{blade:mf(),itemProps:Ze.fromObject({selected:!1,title:t.title}),props:Ze.fromObject({selected:!1}),viewProps:$s.create()});e.add(n)}),e},api(r){return r.controller instanceof yh?new LC(r.controller,r.pool):r.controller instanceof Dl?new VC(r.controller,r.pool):null}});class Au extends _u{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class Bs{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,n)=>n.constrain(t),e)}}function Ga(r,e){if(r instanceof e)return r;if(r instanceof Bs){const t=r.constraints.reduce((n,i)=>n||(i instanceof e?i:null),null);if(t)return t}return null}class Ja{constructor(e){this.values=Ze.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(i=>i.value===e).length>0?e:t[0].value}}function eo(r){var e;const t=Ol;if(Array.isArray(r))return(e=Xt({items:r},n=>({items:n.required.array(n.required.object({text:n.required.string,value:n.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof r=="object")return t.required.raw(r).value}function bf(r){if(Array.isArray(r))return r;const e=[];return Object.keys(r).forEach(t=>{e.push({text:t,value:r[t]})}),e}function Su(r){return vt(r)?null:new Ja(bf(r))}const fl=Qe("lst");class DC{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(fl()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(fl("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=e.createElement("div");i.classList.add(fl("m")),i.appendChild(Qa(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,jr(this.props_,"options",s=>{hf(this.selectElement),s.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Di{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new DC(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return zr(e,null,t=>({options:t.required.custom(eo)}),t=>(this.props.set("options",bf(t.options)),!0))}exportProps(){return Hr(null,{options:this.props.get("options")})}}const xh=Qe("pop");class MC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xh()),t.viewProps.bindClassModifiers(this.element),an(t.shows,Ni(this.element,xh(void 0,"v")))}}class _f{constructor(e,t){this.shows=jt(!1),this.viewProps=t.viewProps,this.view=new MC(e,{shows:this.shows,viewProps:this.viewProps})}}const Ch=Qe("txt");class IC{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ch()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Ch("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Tu{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new IC(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget.value,i=this.parser_(n);vt(i)||(this.value.rawValue=i),this.view.refresh()}}function FC(r){return String(r)}function wf(r){return r==="false"?!1:!!r}function Eh(r){return FC(r)}function $C(r){return e=>r.reduce((t,n)=>t!==null?t:n(e),null)}const BC=ur(0);function ja(r){return BC(r)+"%"}function gf(r){return String(r)}function Ml(r){return r}function Gi({primary:r,secondary:e,forward:t,backward:n}){let i=!1;function s(o){i||(i=!0,o(),i=!1)}r.emitter.on("change",o=>{s(()=>{e.setRawValue(t(r.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{s(()=>{r.setRawValue(n(r.rawValue,e.rawValue),o.options)}),s(()=>{e.setRawValue(t(r.rawValue,e.rawValue),o.options)})}),s(()=>{e.setRawValue(t(r.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function or(r,e){const t=r*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function As(r){return{altKey:r.altKey,downKey:r.key==="ArrowDown",shiftKey:r.shiftKey,upKey:r.key==="ArrowUp"}}function un(r){return{altKey:r.altKey,downKey:r.key==="ArrowLeft",shiftKey:r.shiftKey,upKey:r.key==="ArrowRight"}}function NC(r){return r==="ArrowUp"||r==="ArrowDown"}function yf(r){return NC(r)||r==="ArrowLeft"||r==="ArrowRight"}function ml(r,e){var t,n;const i=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:r.pageX-(((t=i&&i.scrollX)!==null&&t!==void 0?t:0)+s.left),y:r.pageY-(((n=i&&i.scrollY)!==null&&n!==void 0?n:0)+s.top)}}class oi{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new vr,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(ml(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(ml(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(ml(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const Cr=Qe("txt");class GC{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Cr(),Cr(void 0,"num")),t.arrayPosition&&this.element.classList.add(Cr(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Cr("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Cr()),this.inputElement.classList.add(Cr("i"));const i=e.createElement("div");i.classList.add(Cr("k")),this.element.appendChild(i),this.knobElement=i;const s=e.createElementNS(Br,"svg");s.classList.add(Cr("g")),this.knobElement.appendChild(s);const o=e.createElementNS(Br,"path");o.classList.add(Cr("gb")),s.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(Br,"path");l.classList.add(Cr("gh")),s.appendChild(l),this.guideHeadElem_=l;const y=e.createElement("div");y.classList.add(Qe("tt")()),this.knobElement.appendChild(y),this.tooltipElem_=y,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Cr(void 0,"drg"));return}this.element.classList.add(Cr(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),i=Dt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Ns{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(n=t.sliderProps)!==null&&n!==void 0?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=jt(null),this.view=new GC(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new oi(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const i=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),s=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("max");let o=e;return i!==void 0&&(o=Math.max(o,i)),s!==void 0&&(o=Math.min(o,s)),o}onInputChange_(e){const n=e.currentTarget.value,i=this.parser_(n);vt(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(e){const t=or(this.props.get("keyScale"),As(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){or(this.props.get("keyScale"),As(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const vl=Qe("sld");class jC{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(vl()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(vl("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add(vl("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Dt(tt(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class UC{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new jC(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oi(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(tt(Dt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=or(this.props.get("keyScale"),un(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){or(this.props.get("keyScale"),un(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const bl=Qe("sldtxt");class zC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(bl());const n=e.createElement("div");n.classList.add(bl("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(bl("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class Ph{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new UC(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ns(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new zC(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return zr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const n=this.sliderC_.props;return n.set("max",t.max),n.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Hr(null,{max:e.get("max"),min:e.get("min")})}}function HC(r){return{sliderProps:new Ze({keyScale:r.keyScale,max:r.max,min:r.min}),textProps:new Ze({formatter:jt(r.formatter),keyScale:r.keyScale,pointerScale:jt(r.pointerScale)})}}const KC={containerUnitSize:"cnt-usz"};function xf(r){return`--${KC[r]}`}function Ss(r){return uf(r)}function Tn(r){if(Vl(r))return Xt(r,Ss)}function nn(r,e){if(!r)return;const t=[],n=af(r,e);n&&t.push(n);const i=of(r);return i&&t.push(i),new Bs(t)}function Cf(r){if(r==="inline"||r==="popup")return r}function Gs(r,e){r.write(e)}const Sa=Qe("ckb");class qC{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Sa()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(Sa("l")),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("input");i.classList.add(Sa("i")),i.type="checkbox",this.labelElement.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(Sa("w")),this.labelElement.appendChild(s);const o=Qa(e,"check");s.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class XC{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new qC(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function YC(r){const e=[],t=Su(r.options);return t&&e.push(t),new Bs(e)}Jt({id:"input-bool",type:"input",accept:(r,e)=>{if(typeof r!="boolean")return null;const t=Xt(e,n=>({options:n.optional.custom(eo),readonly:n.optional.constant(!1)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>wf,constraint:r=>YC(r.params),writer:r=>Gs},controller:r=>{const e=r.document,t=r.value,n=r.constraint,i=n&&Ga(n,Ja);return i?new Di(e,{props:new Ze({options:i.values.value("options")}),value:t,viewProps:r.viewProps}):new XC(e,{value:t,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="boolean"?null:r.controller.valueController instanceof Di?new Au(r.controller):null}});const Yn=Qe("col");class WC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Yn()),t.foldable.bindExpandedClass(this.element,Yn(void 0,"expanded")),jr(t.foldable,"completed",Ni(this.element,Yn(void 0,"cpl")));const n=e.createElement("div");n.classList.add(Yn("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(Yn("s")),n.appendChild(i),this.swatchElement=i;const s=e.createElement("div");if(s.classList.add(Yn("t")),n.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Yn("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function ZC(r,e,t){const n=Dt(r/255,0,1),i=Dt(e/255,0,1),s=Dt(t/255,0,1),o=Math.max(n,i,s),l=Math.min(n,i,s),y=o-l;let x=0,N=0;const U=(l+o)/2;return y!==0&&(N=y/(1-Math.abs(o+l-1)),n===o?x=(i-s)/y:i===o?x=2+(s-n)/y:x=4+(n-i)/y,x=x/6+(x<0?1:0)),[x*360,N*100,U*100]}function QC(r,e,t){const n=(r%360+360)%360,i=Dt(e/100,0,1),s=Dt(t/100,0,1),o=(1-Math.abs(2*s-1))*i,l=o*(1-Math.abs(n/60%2-1)),y=s-o/2;let x,N,U;return n>=0&&n<60?[x,N,U]=[o,l,0]:n>=60&&n<120?[x,N,U]=[l,o,0]:n>=120&&n<180?[x,N,U]=[0,o,l]:n>=180&&n<240?[x,N,U]=[0,l,o]:n>=240&&n<300?[x,N,U]=[l,0,o]:[x,N,U]=[o,0,l],[(x+y)*255,(N+y)*255,(U+y)*255]}function JC(r,e,t){const n=Dt(r/255,0,1),i=Dt(e/255,0,1),s=Dt(t/255,0,1),o=Math.max(n,i,s),l=Math.min(n,i,s),y=o-l;let x;y===0?x=0:o===n?x=60*(((i-s)/y%6+6)%6):o===i?x=60*((s-n)/y+2):x=60*((n-i)/y+4);const N=o===0?0:y/o,U=o;return[x,N*100,U*100]}function Ef(r,e,t){const n=nf(r,360),i=Dt(e/100,0,1),s=Dt(t/100,0,1),o=s*i,l=o*(1-Math.abs(n/60%2-1)),y=s-o;let x,N,U;return n>=0&&n<60?[x,N,U]=[o,l,0]:n>=60&&n<120?[x,N,U]=[l,o,0]:n>=120&&n<180?[x,N,U]=[0,o,l]:n>=180&&n<240?[x,N,U]=[0,l,o]:n>=240&&n<300?[x,N,U]=[l,0,o]:[x,N,U]=[o,0,l],[(x+y)*255,(N+y)*255,(U+y)*255]}function eE(r,e,t){const n=t+e*(100-Math.abs(2*t-100))/200;return[r,n!==0?e*(100-Math.abs(2*t-100))/n:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function tE(r,e,t){const n=100-Math.abs(t*(200-e)/100-100);return[r,n!==0?e*t/n:0,t*(200-e)/(2*100)]}function Ur(r){return[r[0],r[1],r[2]]}function to(r,e){return[r[0],r[1],r[2],e]}const rE={hsl:{hsl:(r,e,t)=>[r,e,t],hsv:eE,rgb:QC},hsv:{hsl:tE,hsv:(r,e,t)=>[r,e,t],rgb:Ef},rgb:{hsl:ZC,hsv:JC,rgb:(r,e,t)=>[r,e,t]}};function Mi(r,e){return[e==="float"?1:r==="rgb"?255:360,e==="float"?1:r==="rgb"?255:100,e==="float"?1:r==="rgb"?255:100]}function nE(r,e){return r===e?e:nf(r,e)}function Pf(r,e,t){var n;const i=Mi(e,t);return[e==="rgb"?Dt(r[0],0,i[0]):nE(r[0],i[0]),Dt(r[1],0,i[1]),Dt(r[2],0,i[2]),Dt((n=r[3])!==null&&n!==void 0?n:1,0,1)]}function Ah(r,e,t,n){const i=Mi(e,t),s=Mi(e,n);return r.map((o,l)=>o/i[l]*s[l])}function Af(r,e,t){const n=Ah(r,e.mode,e.type,"int"),i=rE[e.mode][t.mode](...n);return Ah(i,t.mode,"int",t.type)}class Ye{static black(){return new Ye([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=Pf(e,t,this.type)}getComponents(e){return to(Af(Ur(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Cn=Qe("colp");class iE{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Cn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Cn("hsv"));const i=e.createElement("div");i.classList.add(Cn("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(Cn("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const o=e.createElement("div");if(o.classList.add(Cn("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Cn("a"));const y=e.createElement("div");y.classList.add(Cn("ap")),y.appendChild(this.alphaViews_.palette.element),l.appendChild(y);const x=e.createElement("div");x.classList.add(Cn("at")),x.appendChild(this.alphaViews_.text.element),l.appendChild(x),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function sE(r){return r==="int"?"int":r==="float"?"float":void 0}function ku(r){return Xt(r,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(sE)}),expanded:e.optional.boolean,picker:e.optional.custom(Cf),readonly:e.optional.constant(!1)}))}function ni(r){return r?.1:1}function Sf(r){var e;return(e=r.color)===null||e===void 0?void 0:e.type}class Lu{constructor(e,t){this.type="float",this.mode=t,this.comps_=Pf(e,t,this.type)}getComponents(e){return to(Af(Ur(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const aE={int:(r,e)=>new Ye(r,e),float:(r,e)=>new Lu(r,e)};function Vu(r,e,t){return aE[t](r,e)}function oE(r){return r.type==="float"}function lE(r){return r.type==="int"}function uE(r){const e=r.getComponents(),t=Mi(r.mode,"int");return new Ye([Math.round(tt(e[0],0,1,0,t[0])),Math.round(tt(e[1],0,1,0,t[1])),Math.round(tt(e[2],0,1,0,t[2])),e[3]],r.mode)}function cE(r){const e=r.getComponents(),t=Mi(r.mode,"int");return new Lu([tt(e[0],0,t[0],0,1),tt(e[1],0,t[1],0,1),tt(e[2],0,t[2],0,1),e[3]],r.mode)}function Zt(r,e){if(r.type===e)return r;if(lE(r)&&e==="float")return cE(r);if(oE(r)&&e==="int")return uE(r);throw pr.shouldNeverHappen()}function dE(r,e){return r.alpha===e.alpha&&r.mode===e.mode&&r.notation===e.notation&&r.type===e.type}function Pr(r,e){const t=r.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(r),e)}const hE={deg:r=>r,grad:r=>r*360/400,rad:r=>r*360/(2*Math.PI),turn:r=>r*360};function Tf(r){const e=r.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(r);const t=parseFloat(e[1]),n=e[2];return hE[n](t)}function kf(r){const e=r.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Pr(e[1],255),Pr(e[2],255),Pr(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function pE(r){const e=kf(r);return e?new Ye(e,"rgb"):null}function Lf(r){const e=r.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Pr(e[1],255),Pr(e[2],255),Pr(e[3],255),Pr(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function fE(r){const e=Lf(r);return e?new Ye(e,"rgb"):null}function Vf(r){const e=r.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Tf(e[1]),Pr(e[2],100),Pr(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function mE(r){const e=Vf(r);return e?new Ye(e,"hsl"):null}function Of(r){const e=r.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Tf(e[1]),Pr(e[2],100),Pr(e[3],100),Pr(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function vE(r){const e=Of(r);return e?new Ye(e,"hsl"):null}function Rf(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=r.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function bE(r){const e=Rf(r);return e?new Ye(e,"rgb"):null}function Df(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),tt(parseInt(e[4]+e[4],16),0,255,0,1)];const t=r.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),tt(parseInt(t[4],16),0,255,0,1)]:null}function _E(r){const e=Df(r);return e?new Ye(e,"rgb"):null}function Mf(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function wE(r){return e=>{const t=Mf(e);return t?Vu(t,"rgb",r):null}}function If(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function gE(r){return e=>{const t=If(e);return t?Vu(t,"rgb",r):null}}const yE=[{parser:Rf,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Df,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:kf,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Lf,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Vf,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Of,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Mf,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:If,result:{alpha:!0,mode:"rgb",notation:"object"}}];function xE(r){return yE.reduce((e,{parser:t,result:n})=>e||(t(r)?n:null),null)}function CE(r,e="int"){const t=xE(r);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function js(r){const e=[bE,_E,pE,fE,mE,vE];e.push(wE("int"),gE("int"));const t=$C(e);return n=>{const i=t(n);return i?Zt(i,r):null}}function EE(r){const e=js("int");if(typeof r!="string")return Ye.black();const t=e(r);return t??Ye.black()}function Ff(r){const e=Dt(Math.floor(r),0,255).toString(16);return e.length===1?`0${e}`:e}function Ou(r,e="#"){const t=Ur(r.getComponents("rgb")).map(Ff).join("");return`${e}${t}`}function Ru(r,e="#"){const t=r.getComponents("rgb"),n=[t[0],t[1],t[2],t[3]*255].map(Ff).join("");return`${e}${n}`}function $f(r){const e=ur(0),t=Zt(r,"int");return`rgb(${Ur(t.getComponents("rgb")).map(i=>e(i)).join(", ")})`}function Oa(r){const e=ur(2),t=ur(0);return`rgba(${Zt(r,"int").getComponents("rgb").map((s,o)=>(o===3?e:t)(s)).join(", ")})`}function PE(r){const e=[ur(0),ja,ja],t=Zt(r,"int");return`hsl(${Ur(t.getComponents("hsl")).map((i,s)=>e[s](i)).join(", ")})`}function AE(r){const e=[ur(0),ja,ja,ur(2)];return`hsla(${Zt(r,"int").getComponents("hsl").map((i,s)=>e[s](i)).join(", ")})`}function Bf(r,e){const t=ur(e==="float"?2:0),n=["r","g","b"],i=Zt(r,e);return`{${Ur(i.getComponents("rgb")).map((o,l)=>`${n[l]}: ${t(o)}`).join(", ")}}`}function SE(r){return e=>Bf(e,r)}function Nf(r,e){const t=ur(2),n=ur(e==="float"?2:0),i=["r","g","b","a"];return`{${Zt(r,e).getComponents("rgb").map((l,y)=>{const x=y===3?t:n;return`${i[y]}: ${x(l)}`}).join(", ")}}`}function TE(r){return e=>Nf(e,r)}const kE=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Ou},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ru},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:$f},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Oa},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:PE},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:AE},...["int","float"].reduce((r,e)=>[...r,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:SE(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:TE(e)}],[])];function Gf(r){return kE.reduce((e,t)=>e||(dE(t.format,r)?t.stringifier:null),null)}const ps=Qe("apl");class LE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ps()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(ps("b")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(ps("c")),n.appendChild(i),this.colorElem_=i;const s=e.createElement("div");s.classList.add(ps("m")),this.element.appendChild(s),this.markerElem_=s;const o=e.createElement("div");o.classList.add(ps("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Ye([t[0],t[1],t[2],0],"rgb"),i=new Ye([t[0],t[1],t[2],255],"rgb"),s=["to right",Oa(n),Oa(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=Oa(e);const o=tt(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class VE{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new LE(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oi(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,i=this.value.rawValue,[s,o,l]=i.getComponents("hsv");this.value.setRawValue(new Ye([s,o,l,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=or(ni(!0),un(e));if(t===0)return;const n=this.value.rawValue,[i,s,o,l]=n.getComponents("hsv");this.value.setRawValue(new Ye([i,s,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){or(ni(!0),un(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ai=Qe("coltxt");function OE(r){const e=r.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((n,i)=>{const s=r.createElement("option");return s.textContent=i.text,s.value=i.value,n.appendChild(s),n},r.createDocumentFragment())),e}class RE{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ai()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Ai("m")),this.modeElem_=OE(e),this.modeElem_.classList.add(Ai("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const i=e.createElement("div");i.classList.add(Ai("mm")),i.appendChild(Qa(e,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(Ai("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),an(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){hf(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(Ai("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)})}}function DE(r){return ur(r==="float"?2:0)}function ME(r,e,t){const n=Mi(r,e)[t];return new Wa({min:0,max:n})}function IE(r,e,t){return new Ns(r,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Ze.fromObject({formatter:DE(e.colorType),keyScale:ni(!1),pointerScale:e.colorType==="float"?.01:1}),value:jt(0,{constraint:ME(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function FE(r,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:On,viewProps:e.viewProps};return[0,1,2].map(n=>{const i=IE(r,t,n);return Gi({primary:e.value,secondary:i.value,forward(s){return Zt(s,e.colorType).getComponents(e.colorMode)[n]},backward(s,o){const l=e.colorMode,x=Zt(s,e.colorType).getComponents(l);x[n]=o;const N=Vu(to(Ur(x),x[3]),l,e.colorType);return Zt(N,"int")}}),i})}function $E(r,e){const t=new Tu(r,{parser:js("int"),props:Ze.fromObject({formatter:Ou}),value:jt(Ye.black()),viewProps:e.viewProps});return Gi({primary:e.value,secondary:t.value,forward:n=>new Ye(Ur(n.getComponents()),n.mode),backward:(n,i)=>new Ye(to(Ur(i.getComponents(n.mode)),n.getComponents()[3]),n.mode)}),[t]}function BE(r){return r!=="hex"}class NE{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=jt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new RE(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return BE(t)?FE(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):$E(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(n=>n.view)}}const _l=Qe("hpl");class GE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(_l()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(_l("c")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(_l("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=$f(new Ye([t,100,100],"hsv"));const n=tt(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class jE{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new GE(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oi(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=tt(Dt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=this.value.rawValue,[,s,o,l]=i.getComponents("hsv");this.value.setRawValue(new Ye([n,s,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=or(ni(!1),un(e));if(t===0)return;const n=this.value.rawValue,[i,s,o,l]=n.getComponents("hsv");this.value.setRawValue(new Ye([i+t,s,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){or(ni(!1),un(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const wl=Qe("svp"),Sh=64;class UE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(wl()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=Sh,n.width=Sh,n.classList.add(wl("c")),this.element.appendChild(n),this.canvasElement=n;const i=e.createElement("div");i.classList.add(wl("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=Jx(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,s=this.canvasElement.height,o=e.getImageData(0,0,i,s),l=o.data;for(let N=0;N<s;N++)for(let U=0;U<i;U++){const de=tt(U,0,i,0,100),Se=tt(N,0,s,100,0),Ce=Ef(n[0],de,Se),Ie=(N*i+U)*4;l[Ie]=Ce[0],l[Ie+1]=Ce[1],l[Ie+2]=Ce[2],l[Ie+3]=255}e.putImageData(o,0,0);const y=tt(n[1],0,100,0,100);this.markerElem_.style.left=`${y}%`;const x=tt(n[2],0,100,100,0);this.markerElem_.style.top=`${x}%`}onValueChange_(){this.update_()}}class zE{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new UE(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oi(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=tt(e.point.x,0,e.bounds.width,0,100),i=tt(e.point.y,0,e.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Ye([s,n,i,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){yf(e.key)&&e.preventDefault();const[t,n,i,s]=this.value.rawValue.getComponents("hsv"),o=ni(!1),l=or(o,un(e)),y=or(o,As(e));l===0&&y===0||this.value.setRawValue(new Ye([t,n+l,i+y,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ni(!1),n=or(t,un(e)),i=or(t,As(e));n===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class HE{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new jE(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new zE(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new VE(e,{value:this.value,viewProps:this.viewProps}),text:new Ns(e,{parser:On,props:Ze.fromObject({pointerScale:.01,keyScale:.1,formatter:ur(2)}),value:jt(0,{constraint:new Wa({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Gi({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.getComponents()[3],backward:(n,i)=>{const s=n.getComponents();return s[3]=i,new Ye(s,n.mode)}}),this.textsC_=new NE(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new iE(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const gl=Qe("colsw");class KE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(gl()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(gl("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=e.createElement("button");i.classList.add(gl("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ru(e)}onValueChange_(){this.update_()}}class qE{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new KE(e,{value:this.value,viewProps:this.viewProps})}}class Du{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Fs.create(t.expanded),this.swatchC_=new qE(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Tu(e,{parser:t.parser,props:Ze.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new WC(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new _f(e,{viewProps:this.viewProps}):null;const i=new HE(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),Gi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Pu(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=pf(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!wu(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function XE(r){return Ur(r.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function YE(r){return r.getComponents("rgb").reduce((e,t,n)=>{const i=Math.floor(n===3?t*255:t)&255;return e<<8|i},0)>>>0}function WE(r){return new Ye([r>>16&255,r>>8&255,r&255],"rgb")}function ZE(r){return new Ye([r>>24&255,r>>16&255,r>>8&255,tt(r&255,0,255,0,1)],"rgb")}function QE(r){return typeof r!="number"?Ye.black():WE(r)}function JE(r){return typeof r!="number"?Ye.black():ZE(r)}function Ra(r,e){return typeof r!="object"||vt(r)?!1:e in r&&typeof r[e]=="number"}function jf(r){return Ra(r,"r")&&Ra(r,"g")&&Ra(r,"b")}function Uf(r){return jf(r)&&Ra(r,"a")}function zf(r){return jf(r)}function Mu(r,e){if(r.mode!==e.mode||r.type!==e.type)return!1;const t=r.getComponents(),n=e.getComponents();for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function Th(r){return"a"in r?[r.r,r.g,r.b,r.a]:[r.r,r.g,r.b]}function e1(r){const e=Gf(r);return e?(t,n)=>{Gs(t,e(n))}:null}function t1(r){const e=r?YE:XE;return(t,n)=>{Gs(t,e(n))}}function r1(r,e,t){const i=Zt(e,t).toRgbaObject();r.writeProperty("r",i.r),r.writeProperty("g",i.g),r.writeProperty("b",i.b),r.writeProperty("a",i.a)}function n1(r,e,t){const i=Zt(e,t).toRgbaObject();r.writeProperty("r",i.r),r.writeProperty("g",i.g),r.writeProperty("b",i.b)}function i1(r,e){return(t,n)=>{r?r1(t,n,e):n1(t,n,e)}}function s1(r){var e;return!!(!((e=r==null?void 0:r.color)===null||e===void 0)&&e.alpha)}function a1(r){return r?e=>Ru(e,"0x"):e=>Ou(e,"0x")}function o1(r){return"color"in r||r.view==="color"}Jt({id:"input-color-number",type:"input",accept:(r,e)=>{if(typeof r!="number"||!o1(e))return null;const t=ku(e);return t?{initialValue:r,params:Object.assign(Object.assign({},t),{supportsAlpha:s1(e)})}:null},binding:{reader:r=>r.params.supportsAlpha?JE:QE,equals:Mu,writer:r=>t1(r.params.supportsAlpha)},controller:r=>{var e,t;return new Du(r.document,{colorType:"int",expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:a1(r.params.supportsAlpha),parser:js("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:r.params.supportsAlpha,value:r.value,viewProps:r.viewProps})}});function l1(r,e){if(!zf(r))return Zt(Ye.black(),e);if(e==="int"){const t=Th(r);return new Ye(t,"rgb")}if(e==="float"){const t=Th(r);return new Lu(t,"rgb")}return Zt(Ye.black(),"int")}function u1(r){return Uf(r)}function c1(r){return e=>{const t=l1(e,r);return Zt(t,"int")}}function d1(r,e){return t=>r?Nf(t,e):Bf(t,e)}Jt({id:"input-color-object",type:"input",accept:(r,e)=>{var t;if(!zf(r))return null;const n=ku(e);return n?{initialValue:r,params:Object.assign(Object.assign({},n),{colorType:(t=Sf(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:r=>c1(r.params.colorType),equals:Mu,writer:r=>i1(u1(r.initialValue),r.params.colorType)},controller:r=>{var e,t;const n=Uf(r.initialValue);return new Du(r.document,{colorType:r.params.colorType,expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:d1(n,r.params.colorType),parser:js("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n,value:r.value,viewProps:r.viewProps})}});Jt({id:"input-color-string",type:"input",accept:(r,e)=>{if(typeof r!="string"||e.view==="text")return null;const t=CE(r,Sf(e));if(!t)return null;const n=Gf(t);if(!n)return null;const i=ku(e);return i?{initialValue:r,params:Object.assign(Object.assign({},i),{format:t,stringifier:n})}:null},binding:{reader:()=>EE,equals:Mu,writer:r=>{const e=e1(r.params.format);if(!e)throw pr.notBindable();return e}},controller:r=>{var e,t;return new Du(r.document,{colorType:r.params.format.type,expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:r.params.stringifier,parser:js("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:r.params.format.alpha,value:r.value,viewProps:r.viewProps})}});class Iu{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((n,i)=>{var s,o;return(o=(s=this.components[i])===null||s===void 0?void 0:s.constrain(n))!==null&&o!==void 0?o:n});return this.asm_.fromComponents(t)}}const kh=Qe("pndtxt");class h1{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(kh()),this.textViews.forEach(n=>{const i=e.createElement("div");i.classList.add(kh("a")),i.appendChild(n.element),this.element.appendChild(i)})}}function p1(r,e,t){return new Ns(r,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:jt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class Fu{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,i)=>p1(e,t,i)),this.acs_.forEach((n,i)=>{Gi({primary:this.value,secondary:n.value,forward:s=>t.assembly.toComponents(s)[i],backward:(s,o)=>{const l=t.assembly.toComponents(s);return l[i]=o,t.assembly.fromComponents(l)}})}),this.view=new h1(e,{textViews:this.acs_.map(n=>n.view)})}get textControllers(){return this.acs_}}class f1 extends _u{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function m1(r,e){const t=[],n=af(r,e);n&&t.push(n);const i=of(r);i&&t.push(i);const s=Su(r.options);return s&&t.push(s),new Bs(t)}Jt({id:"input-number",type:"input",accept:(r,e)=>{if(typeof r!="number")return null;const t=Xt(e,n=>Object.assign(Object.assign({},uf(n)),{options:n.optional.custom(eo),readonly:n.optional.constant(!1)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>rf,constraint:r=>m1(r.params,r.initialValue),writer:r=>Gs},controller:r=>{const e=r.value,t=r.constraint,n=t&&Ga(t,Ja);if(n)return new Di(r.document,{props:new Ze({options:n.values.value("options")}),value:e,viewProps:r.viewProps});const i=lf(r.params,e.rawValue),s=t&&Ga(t,Wa);return s?new Ph(r.document,Object.assign(Object.assign({},HC(Object.assign(Object.assign({},i),{keyScale:jt(i.keyScale),max:s.values.value("max"),min:s.values.value("min")}))),{parser:On,value:e,viewProps:r.viewProps})):new Ns(r.document,{parser:On,props:Ze.fromObject(i),value:e,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="number"?null:r.controller.valueController instanceof Ph?new f1(r.controller):r.controller.valueController instanceof Di?new Au(r.controller):null}});class Ln{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(vt(e))return!1;const t=e.x,n=e.y;return!(typeof t!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const Hf={toComponents:r=>r.getComponents(),fromComponents:r=>new Ln(...r)},Si=Qe("p2d");class v1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Si()),t.viewProps.bindClassModifiers(this.element),an(t.expanded,Ni(this.element,Si(void 0,"expanded")));const n=e.createElement("div");n.classList.add(Si("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(Si("b")),i.appendChild(Qa(e,"p2dpad")),t.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=e.createElement("div");if(s.classList.add(Si("t")),n.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Si("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const En=Qe("p2dp");class b1{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(En()),t.layout==="popup"&&this.element.classList.add(En(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(En("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS(Br,"svg");i.classList.add(En("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=e.createElementNS(Br,"line");s.classList.add(En("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=e.createElementNS(Br,"line");o.classList.add(En("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(Br,"line");l.classList.add(En("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const y=e.createElement("div");y.classList.add(En("m")),this.padElement.appendChild(y),this.markerElem_=y,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),i=tt(e,-n,+n,0,100),s=tt(t,-n,+n,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Lh(r,e,t){return[or(e[0],un(r)),or(e[1],As(r))*(t?1:-1)]}class _1{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new b1(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oi(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),i=tt(e.point.x,0,e.bounds.width,-n,+n),s=tt(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new Ln(i,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){yf(e.key)&&e.preventDefault();const[t,n]=Lh(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(new Ln(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=Lh(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class w1{constructor(e,t){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Fs.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new _f(e,{viewProps:this.viewProps}):null;const s=new _1(e,{layout:t.pickerLayout,props:new Ze({invertsY:jt(t.invertsY),max:jt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new Fu(e,{assembly:Hf,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new v1(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Gi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Pu(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=pf(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!wu(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function g1(r){return Ln.isObject(r)?new Ln(r.x,r.y):new Ln}function y1(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y)}function x1(r,e){return new Iu({assembly:Hf,components:[nn(Object.assign(Object.assign({},r),r.x),e.x),nn(Object.assign(Object.assign({},r),r.y),e.y)]})}function Vh(r,e){var t,n;if(!vt(r.min)||!vt(r.max))return Math.max(Math.abs((t=r.min)!==null&&t!==void 0?t:0),Math.abs((n=r.max)!==null&&n!==void 0?n:0));const i=sf(r);return Math.max(Math.abs(i)*10,Math.abs(e)*10)}function C1(r,e){var t,n;const i=Vh(ri(r,(t=r.x)!==null&&t!==void 0?t:{}),e.x),s=Vh(ri(r,(n=r.y)!==null&&n!==void 0?n:{}),e.y);return Math.max(i,s)}function E1(r){if(!("y"in r))return!1;const e=r.y;return e&&"inverted"in e?!!e.inverted:!1}Jt({id:"input-point2d",type:"input",accept:(r,e)=>{if(!Ln.isObject(r))return null;const t=Xt(e,n=>Object.assign(Object.assign({},Ss(n)),{expanded:n.optional.boolean,picker:n.optional.custom(Cf),readonly:n.optional.constant(!1),x:n.optional.custom(Tn),y:n.optional.object(Object.assign(Object.assign({},Ss(n)),{inverted:n.optional.boolean}))}));return t?{initialValue:r,params:t}:null},binding:{reader:()=>g1,constraint:r=>x1(r.params,r.initialValue),equals:Ln.equals,writer:()=>y1},controller:r=>{var e,t;const n=r.document,i=r.value,s=r.constraint,o=[r.params.x,r.params.y];return new w1(n,{axes:i.rawValue.getComponents().map((l,y)=>{var x;return vu({constraint:s.components[y],initialValue:l,params:ri(r.params,(x=o[y])!==null&&x!==void 0?x:{})})}),expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,invertsY:E1(r.params),max:C1(r.params,i.rawValue),parser:On,pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",value:i,viewProps:r.viewProps})}});class Vi{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(vt(e))return!1;const t=e.x,n=e.y,i=e.z;return!(typeof t!="number"||typeof n!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Kf={toComponents:r=>r.getComponents(),fromComponents:r=>new Vi(...r)};function P1(r){return Vi.isObject(r)?new Vi(r.x,r.y,r.z):new Vi}function A1(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z)}function S1(r,e){return new Iu({assembly:Kf,components:[nn(Object.assign(Object.assign({},r),r.x),e.x),nn(Object.assign(Object.assign({},r),r.y),e.y),nn(Object.assign(Object.assign({},r),r.z),e.z)]})}Jt({id:"input-point3d",type:"input",accept:(r,e)=>{if(!Vi.isObject(r))return null;const t=Xt(e,n=>Object.assign(Object.assign({},Ss(n)),{readonly:n.optional.constant(!1),x:n.optional.custom(Tn),y:n.optional.custom(Tn),z:n.optional.custom(Tn)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>P1,constraint:r=>S1(r.params,r.initialValue),equals:Vi.equals,writer:r=>A1},controller:r=>{const e=r.value,t=r.constraint,n=[r.params.x,r.params.y,r.params.z];return new Fu(r.document,{assembly:Kf,axes:e.rawValue.getComponents().map((i,s)=>{var o;return vu({constraint:t.components[s],initialValue:i,params:ri(r.params,(o=n[s])!==null&&o!==void 0?o:{})})}),parser:On,value:e,viewProps:r.viewProps})}});class Oi{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(vt(e))return!1;const t=e.x,n=e.y,i=e.z,s=e.w;return!(typeof t!="number"||typeof n!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const qf={toComponents:r=>r.getComponents(),fromComponents:r=>new Oi(...r)};function T1(r){return Oi.isObject(r)?new Oi(r.x,r.y,r.z,r.w):new Oi}function k1(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z),r.writeProperty("w",e.w)}function L1(r,e){return new Iu({assembly:qf,components:[nn(Object.assign(Object.assign({},r),r.x),e.x),nn(Object.assign(Object.assign({},r),r.y),e.y),nn(Object.assign(Object.assign({},r),r.z),e.z),nn(Object.assign(Object.assign({},r),r.w),e.w)]})}Jt({id:"input-point4d",type:"input",accept:(r,e)=>{if(!Oi.isObject(r))return null;const t=Xt(e,n=>Object.assign(Object.assign({},Ss(n)),{readonly:n.optional.constant(!1),w:n.optional.custom(Tn),x:n.optional.custom(Tn),y:n.optional.custom(Tn),z:n.optional.custom(Tn)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>T1,constraint:r=>L1(r.params,r.initialValue),equals:Oi.equals,writer:r=>k1},controller:r=>{const e=r.value,t=r.constraint,n=[r.params.x,r.params.y,r.params.z,r.params.w];return new Fu(r.document,{assembly:qf,axes:e.rawValue.getComponents().map((i,s)=>{var o;return vu({constraint:t.components[s],initialValue:i,params:ri(r.params,(o=n[s])!==null&&o!==void 0?o:{})})}),parser:On,value:e,viewProps:r.viewProps})}});function V1(r){const e=[],t=Su(r.options);return t&&e.push(t),new Bs(e)}Jt({id:"input-string",type:"input",accept:(r,e)=>{if(typeof r!="string")return null;const t=Xt(e,n=>({readonly:n.optional.constant(!1),options:n.optional.custom(eo)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>gf,constraint:r=>V1(r.params),writer:r=>Gs},controller:r=>{const e=r.document,t=r.value,n=r.constraint,i=n&&Ga(n,Ja);return i?new Di(e,{props:new Ze({options:i.values.value("options")}),value:t,viewProps:r.viewProps}):new Tu(e,{parser:s=>s,props:Ze.fromObject({formatter:Ml}),value:t,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="string"?null:r.controller.valueController instanceof Di?new Au(r.controller):null}});const ro={monitor:{defaultInterval:200,defaultRows:3}},Oh=Qe("mll");class O1{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Oh()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(Oh("i")),n.style.height=`calc(var(${xf("containerUnitSize")}) * ${t.rows})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(i=>{i!==void 0&&n.push(this.formatter_(i))}),e.textContent=n.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class $u{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new O1(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const Rh=Qe("sgl");class R1{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Rh()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Rh("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Bu{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new R1(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}Jt({id:"monitor-bool",type:"monitor",accept:(r,e)=>{if(typeof r!="boolean")return null;const t=Xt(e,n=>({readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>wf},controller:r=>{var e;return r.value.rawValue.length===1?new Bu(r.document,{formatter:Eh,value:r.value,viewProps:r.viewProps}):new $u(r.document,{formatter:Eh,rows:(e=r.params.rows)!==null&&e!==void 0?e:ro.monitor.defaultRows,value:r.value,viewProps:r.viewProps})}});class D1 extends _u{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const Pn=Qe("grl");class M1{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Pn()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(Br,"svg");n.classList.add(Pn("g")),n.style.height=`calc(var(${xf("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS(Br,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=e.createElement("div");s.classList.add(Pn("t"),Qe("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,n=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((U,de)=>{if(U===void 0)return;const Se=tt(de,0,n,0,e),Ce=tt(U,i,s,t,0);o.push([Se,Ce].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const l=this.tooltipElem_,y=this.value.rawValue[this.cursor_.rawValue];if(y===void 0){l.classList.remove(Pn("t","a"));return}const x=tt(this.cursor_.rawValue,0,n,0,e),N=tt(y,i,s,t,0);l.style.left=`${x}px`,l.style.top=`${N}px`,l.textContent=`${this.formatter_(y)}`,l.classList.contains(Pn("t","a"))||(l.classList.add(Pn("t","a"),Pn("t","in")),Na(l),l.classList.remove(Pn("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Xf{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=jt(-1),this.view=new M1(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!wu(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new oi(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return zr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Hr(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(tt(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(tt(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Il(r){return vt(r.format)?ur(2):r.format}function I1(r){var e;return r.value.rawValue.length===1?new Bu(r.document,{formatter:Il(r.params),value:r.value,viewProps:r.viewProps}):new $u(r.document,{formatter:Il(r.params),rows:(e=r.params.rows)!==null&&e!==void 0?e:ro.monitor.defaultRows,value:r.value,viewProps:r.viewProps})}function F1(r){var e,t,n;return new Xf(r.document,{formatter:Il(r.params),rows:(e=r.params.rows)!==null&&e!==void 0?e:ro.monitor.defaultRows,props:Ze.fromObject({max:(t=r.params.max)!==null&&t!==void 0?t:100,min:(n=r.params.min)!==null&&n!==void 0?n:0}),value:r.value,viewProps:r.viewProps})}function Dh(r){return r.view==="graph"}Jt({id:"monitor-number",type:"monitor",accept:(r,e)=>{if(typeof r!="number")return null;const t=Xt(e,n=>({format:n.optional.function,max:n.optional.number,min:n.optional.number,readonly:n.required.constant(!0),rows:n.optional.number,view:n.optional.string}));return t?{initialValue:r,params:t}:null},binding:{defaultBufferSize:r=>Dh(r)?64:1,reader:r=>rf},controller:r=>Dh(r.params)?F1(r):I1(r),api:r=>r.controller.valueController instanceof Xf?new D1(r.controller):null});Jt({id:"monitor-string",type:"monitor",accept:(r,e)=>{if(typeof r!="string")return null;const t=Xt(e,n=>({multiline:n.optional.boolean,readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>gf},controller:r=>{var e;const t=r.value;return t.rawValue.length>1||r.params.multiline?new $u(r.document,{formatter:Ml,rows:(e=r.params.rows)!==null&&e!==void 0?e:ro.monitor.defaultRows,value:t,viewProps:r.viewProps}):new Bu(r.document,{formatter:Ml,value:t,viewProps:r.viewProps})}});function QA(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function l(N){try{x(n.next(N))}catch(U){o(U)}}function y(N){try{x(n.throw(N))}catch(U){o(U)}}function x(N){N.done?s(N.value):i(N.value).then(l,y)}x((n=n.apply(r,e||[])).next())})}function Mh(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ua(r){return this instanceof Ua?(this.v=r,this):new Ua(r)}function JA(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(de){n[de]&&(i[de]=function(Se){return new Promise(function(Ce,Ie){s.push([de,Se,Ce,Ie])>1||l(de,Se)})})}function l(de,Se){try{y(n[de](Se))}catch(Ce){U(s[0][3],Ce)}}function y(de){de.value instanceof Ua?Promise.resolve(de.value.v).then(x,N):U(s[0][2],de)}function x(de){l("next",de)}function N(de){l("throw",de)}function U(de,Se){de(Se),s.shift(),s.length&&l(s[0][0],s[0][1])}}function eS(r){var e,t;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=r[i]?function(o){return(t=!t)?{value:Ua(r[i](o)),done:!1}:s?s(o):o}:s}}function tS(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Mh=="function"?Mh(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(l,y){o=r[s](o),i(l,y,o.done,o.value)})}}function i(s,o,l,y){Promise.resolve(y).then(function(x){s({value:x,done:l})},o)}}const yl=2,Fr=4,tn=4,$1=4,An=new Int32Array(2),Ih=new Float32Array(An.buffer),Fh=new Float64Array(An.buffer),Ta=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Fl;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(Fl||(Fl={}));class za{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new za(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return An[0]=this.readInt32(e),Ih[0]}readFloat64(e){return An[Ta?0:1]=this.readInt32(e),An[Ta?1:0]=this.readInt32(e+4),Fh[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Ih[0]=t,this.writeInt32(e,An[0])}writeFloat64(e,t){Fh[0]=t,this.writeInt32(e,An[Ta?0:1]),this.writeInt32(e+4,An[Ta?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Fr+tn)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<tn;t++)e+=String.fromCharCode(this.readInt8(this.position_+Fr+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=Fr;const i=this.bytes_.subarray(e,e+n);return t===Fl.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Fr}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=tn)throw new Error("FlatBuffers: file identifier must be length "+tn);for(let t=0;t<tn;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Fr+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}class Yf{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let t;e?t=e:t=1024,this.bb=za.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const n=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<n+e+t;){const i=this.bb.capacity();this.bb=Yf.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,n){(this.force_defaults||t!==n)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,n){t!=n&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=t<<1,i=za.allocate(n);return i.setPosition(n-t),i.bytes().set(e.bytes(),n-t),i}addOffset(e){this.prep(Fr,0),this.writeInt32(this.offset()-e+Fr)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const n=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const i=2;this.addInt16(e-this.object_start);const s=(n+i)*yl;this.addInt16(s);let o=0;const l=this.space;e:for(t=0;t<this.vtables.length;t++){const y=this.bb.capacity()-this.vtables[t];if(s==this.bb.readInt16(y)){for(let x=yl;x<s;x+=yl)if(this.bb.readInt16(l+x)!=this.bb.readInt16(y+x))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,n){const i=n?$1:0;if(t){const s=t;if(this.prep(this.minalign,Fr+tn+i),s.length!=tn)throw new TypeError("FlatBuffers: file identifier must be length "+tn);for(let o=tn-1;o>=0;o--)this.writeInt8(s.charCodeAt(o))}this.prep(this.minalign,Fr+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const n=this.bb.capacity()-e,i=n-this.bb.readInt32(n);if(!(t<this.bb.readInt16(i)&&this.bb.readInt16(i+t)!=0))throw new TypeError("FlatBuffers: field "+t+" must be set")}startVector(e,t,n){this.notNested(),this.vector_num_elems=t,this.prep(Fr,e*t),this.prep(n,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(e==null)return 0;let t;return e instanceof Uint8Array?t=e:t=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector()}createByteVector(e){return e==null?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let n=0;n<e.length;++n){const i=e[n];if(i!==null)t.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}}export{q1 as A,Yf as B,Wn as C,l_ as D,uP as E,Md as F,n_ as G,Y1 as H,aP as I,sP as J,W1 as K,Jt as L,Xt as M,ff as N,an as O,bu as P,ZA as Q,$1 as S,Ze as V,JA as _,Ua as a,eS as b,tS as c,QA as d,za as e,rP as f,N1 as g,B1 as h,G1 as i,z1 as j,H1 as k,j1 as l,K1 as m,eP as n,$h as o,Q1 as p,U1 as q,nP as r,tP as s,iP as t,X1 as u,cP as v,J1 as w,lP as x,oP as y,Z1 as z};
