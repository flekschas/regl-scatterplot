import{b as u,e as L,c as k,d as F}from"./utils.10233b37.js";import{t as q}from"./apache-arrow.3ccd3ece.js";import"./vendor.cfd24b35.js";const m=2,A=2,z=3,M=.66,T=["T-shirt/top","Trouser","Pullover","Dress","Coat","Sandal","Shirt","Sneaker","Bag","Ankle boot"],p=["#FFFF00","#1CE6FF","#FF34FF","#FF4A46","#008941","#006FA6","#A30059","#FFDBE5","#7A4900","#0000A6"],N=fetch("https://storage.googleapis.com/flekschas/regl-scatterplot/fashion-mnist-embeddings.arrow");u("Loading...");const w=document.querySelector("#footer");w.classList.remove("hidden");const x=document.querySelector("#info-content");x.innerHTML=`
<p><a href="https://github.com/zalandoresearch/fashion-mnist" target="_blank">Fashion MNIST</a> embedding using four different techniques: PCA, t-SNE, UMAP, and a convolutional autoencoder.</p>
<p> Select a point so see the corresponding image.</p>
`;const i=document.querySelector("#parent-wrapper"),c=document.createElement("div");c.id="note";c.style.opacity=0;i.appendChild(c);const H=(e,t)=>{c.style.opacity=1,c.style.background=t,c.textContent=e},O=()=>{c.style.opacity=0},a=document.createElement("div");a.id="center-note";a.style.opacity=0;const l=document.createElement("div");l.style.width="56px";l.style.height="56px";l.style.backgroundColor="black";l.style.backgroundSize="cover";l.style.backgroundRepeat="no-repeat";a.appendChild(l);i.appendChild(a);const _=(e,t)=>String(e).padStart(t,"0"),D=(e,t)=>{const r=new Image,s=`https://storage.googleapis.com/flekschas/regl-scatterplot/fashion-mnist-images/${_(e,5)}.png`;r.onload=()=>{a.style.opacity=1,a.style.transform="translate(-50%, -50%) scale(1)",l.style.backgroundImage=`url("${s}")`,a.style.background=p[t]},r.src=s},P=()=>{a.style.opacity=0,a.style.transform="translate(-50%, -50%) scale(0)"};i.style.display="grid";i.style.gridTemplateColumns=`repeat(${m}, minmax(0, 1fr))`;i.style.gridTemplateRows="repeat(2, minmax(0, 1fr))";i.style.gap="1rem";const g=document.querySelector("#canvas"),y=document.querySelector("#canvas-wrapper");y.style.position="relative";const h=[g];for(let e=0;e<m*A-1;e++){const t=g.cloneNode(),r=y.cloneNode();r.appendChild(t),i.appendChild(r),h.push(t)}const R=document.querySelector("#num-points"),U=document.querySelector("#num-points-value"),S=document.querySelector("#point-size"),W=document.querySelector("#point-size-value"),f=document.querySelector("#opacity"),B=document.querySelector("#opacity-value"),v=document.querySelector("#click-lasso-initiator"),V=document.querySelector("#reset"),E=document.querySelector("#example-multiple-instances");E.setAttribute("class","active");E.removeAttribute("href");const b=L();b.isSupported||u("Unfortunately, your browser does not support all WebGL extensions required by regl-scatterplot",!0);const n=h.map(e=>k({renderer:b,canvas:e,pointSize:z,opacity:M,lassoOnLongPress:!0}));console.log(`Scatterplot v${n[0].get("version")}`);R.disabled=!0;const C=e=>{S.value=e,W.innerHTML=e,n.forEach(t=>t.set({pointSize:e}))},$=e=>C(+e.target.value);S.addEventListener("input",$);C(n[0].get("pointSize"));const I=e=>{f.value=e,B.innerHTML=e,n.forEach(t=>t.set({opacity:e}))},G=e=>I(+e.target.value);f.addEventListener("input",G);I(n[0].get("opacity"));const Y=e=>{n.forEach(t=>t.set({lassoInitiator:e.target.checked}))};v.addEventListener("change",Y);v.checked=n[0].get("lassoInitiator");const Z=()=>{n.forEach(e=>e.reset())};V.addEventListener("click",Z);const j=(e,t,r)=>{n.filter(s=>s!==e).forEach(s=>{s.select(t,{preventEvent:!0})}),n.forEach(s=>{s.zoomToPoints(t,{padding:.2,transition:!0,transitionDuration:1500})});const o=t[Math.floor(Math.random()*(t.length-1))];D(o,r[o])},J=e=>{n.filter(t=>t!==e).forEach(t=>{t.deselect({preventEvent:!0})}),n.forEach(t=>{t.zoomToOrigin({transition:!0,transitionDuration:1500})}),P()};N.then(e=>q(e)).then(e=>{F();const t=e.data[0].children.map(o=>o.values),r=t[t.length-1];U.innerHTML=e.numRows,n.forEach((o,s)=>{o.draw({x:t[s*2],y:t[s*2+1],z:r}),o.set({colorBy:"z",pointColor:p}),o.subscribe("pointover",d=>{H(T[r[d]],p[r[d]])}),o.subscribe("pointout",O),o.subscribe("select",({points:d})=>j(o,d,r)),o.subscribe("deselect",()=>J(o))})}).catch(e=>{u("Could not load embedding... Damn...",!0),console.error(e)});
