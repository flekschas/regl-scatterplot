var Cc=1e-6,kt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,r=arguments.length;r--;)n+=arguments[r]*arguments[r];return Math.sqrt(n)});function fi(){var n=new kt(16);return kt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function al(n){var r=new kt(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}function uo(n,r){var s=r[0],b=r[1],L=r[2],P=r[3],B=r[4],U=r[5],fe=r[6],ce=r[7],Oe=r[8],Pe=r[9],xe=r[10],Me=r[11],Ye=r[12],Ke=r[13],ur=r[14],qe=r[15],$e=s*U-b*B,ke=s*fe-L*B,Be=s*ce-P*B,Fe=b*fe-L*U,Ue=b*ce-P*U,_r=L*ce-P*fe,we=Oe*Ke-Pe*Ye,Sr=Oe*ur-xe*Ye,hr=Oe*qe-Me*Ye,Er=Pe*ur-xe*Ke,nr=Pe*qe-Me*Ke,ar=xe*qe-Me*ur,Ge=$e*ar-ke*nr+Be*Er+Fe*hr-Ue*Sr+_r*we;return Ge?(Ge=1/Ge,n[0]=(U*ar-fe*nr+ce*Er)*Ge,n[1]=(L*nr-b*ar-P*Er)*Ge,n[2]=(Ke*_r-ur*Ue+qe*Fe)*Ge,n[3]=(xe*Ue-Pe*_r-Me*Fe)*Ge,n[4]=(fe*hr-B*ar-ce*Sr)*Ge,n[5]=(s*ar-L*hr+P*Sr)*Ge,n[6]=(ur*Be-Ye*_r-qe*ke)*Ge,n[7]=(Oe*_r-xe*Be+Me*ke)*Ge,n[8]=(B*nr-U*hr+ce*we)*Ge,n[9]=(b*hr-s*nr-P*we)*Ge,n[10]=(Ye*Ue-Ke*Be+qe*$e)*Ge,n[11]=(Pe*Be-Oe*Ue-Me*$e)*Ge,n[12]=(U*Sr-B*Er-fe*we)*Ge,n[13]=(s*Er-b*Sr+L*we)*Ge,n[14]=(Ke*ke-Ye*Fe-ur*$e)*Ge,n[15]=(Oe*Fe-Pe*ke+xe*$e)*Ge,n):null}function Pt(n,r,s){var b=r[0],L=r[1],P=r[2],B=r[3],U=r[4],fe=r[5],ce=r[6],Oe=r[7],Pe=r[8],xe=r[9],Me=r[10],Ye=r[11],Ke=r[12],ur=r[13],qe=r[14],$e=r[15],ke=s[0],Be=s[1],Fe=s[2],Ue=s[3];return n[0]=ke*b+Be*U+Fe*Pe+Ue*Ke,n[1]=ke*L+Be*fe+Fe*xe+Ue*ur,n[2]=ke*P+Be*ce+Fe*Me+Ue*qe,n[3]=ke*B+Be*Oe+Fe*Ye+Ue*$e,ke=s[4],Be=s[5],Fe=s[6],Ue=s[7],n[4]=ke*b+Be*U+Fe*Pe+Ue*Ke,n[5]=ke*L+Be*fe+Fe*xe+Ue*ur,n[6]=ke*P+Be*ce+Fe*Me+Ue*qe,n[7]=ke*B+Be*Oe+Fe*Ye+Ue*$e,ke=s[8],Be=s[9],Fe=s[10],Ue=s[11],n[8]=ke*b+Be*U+Fe*Pe+Ue*Ke,n[9]=ke*L+Be*fe+Fe*xe+Ue*ur,n[10]=ke*P+Be*ce+Fe*Me+Ue*qe,n[11]=ke*B+Be*Oe+Fe*Ye+Ue*$e,ke=s[12],Be=s[13],Fe=s[14],Ue=s[15],n[12]=ke*b+Be*U+Fe*Pe+Ue*Ke,n[13]=ke*L+Be*fe+Fe*xe+Ue*ur,n[14]=ke*P+Be*ce+Fe*Me+Ue*qe,n[15]=ke*B+Be*Oe+Fe*Ye+Ue*$e,n}function co(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function Fc(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Gc(n,r,s){var b=s[0],L=s[1],P=s[2],B=Math.hypot(b,L,P),U,fe,ce;return B<Cc?null:(B=1/B,b*=B,L*=B,P*=B,U=Math.sin(r),fe=Math.cos(r),ce=1-fe,n[0]=b*b*ce+fe,n[1]=L*b*ce+P*U,n[2]=P*b*ce-L*U,n[3]=0,n[4]=b*L*ce-P*U,n[5]=L*L*ce+fe,n[6]=P*L*ce+b*U,n[7]=0,n[8]=b*P*ce+L*U,n[9]=L*P*ce-b*U,n[10]=P*P*ce+fe,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Dc(n,r){return n[0]=r[12],n[1]=r[13],n[2]=r[14],n}function Bc(n,r){var s=r[0],b=r[1],L=r[2],P=r[4],B=r[5],U=r[6],fe=r[8],ce=r[9],Oe=r[10];return n[0]=Math.hypot(s,b,L),n[1]=Math.hypot(P,B,U),n[2]=Math.hypot(fe,ce,Oe),n}function Nc(){var n=new kt(4);return kt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Pc(n,r,s){var b=r[0],L=r[1],P=r[2],B=r[3];return n[0]=s[0]*b+s[4]*L+s[8]*P+s[12]*B,n[1]=s[1]*b+s[5]*L+s[9]*P+s[13]*B,n[2]=s[2]*b+s[6]*L+s[10]*P+s[14]*B,n[3]=s[3]*b+s[7]*L+s[11]*P+s[15]*B,n}(function(){var n=Nc();return function(r,s,b,L,P,B){var U,fe;for(s||(s=4),b||(b=0),L?fe=Math.min(L*s+b,r.length):fe=r.length,U=b;U<fe;U+=s)n[0]=r[U],n[1]=r[U+1],n[2]=r[U+2],n[3]=r[U+3],P(n,n,B),r[U]=n[0],r[U+1]=n[1],r[U+2]=n[2],r[U+3]=n[3];return r}})();function kc(){var n=new kt(2);return kt!=Float32Array&&(n[0]=0,n[1]=0),n}function Mc(n,r){var s=n[0],b=n[1],L=r[0],P=r[1],B=Math.sqrt(s*s+b*b)*Math.sqrt(L*L+P*P),U=B&&(s*L+b*P)/B;return Math.acos(Math.min(Math.max(U,-1),1))}(function(){var n=kc();return function(r,s,b,L,P,B){var U,fe;for(s||(s=2),b||(b=0),L?fe=Math.min(L*s+b,r.length):fe=r.length,U=b;U<fe;U+=s)n[0]=r[U],n[1]=r[U+1],P(n,n,B),r[U]=n[0],r[U+1]=n[1];return r}})();const Uc=(n=[0,0],r=1,s=0,b=[0,0],L=[[0,1/0],[0,1/0]],P=[[-1/0,1/0],[-1/0,1/0]])=>{const B=new Float32Array(16),U=new Float32Array(16),fe=new Float32Array(16);let ce=fi(),Oe=[...b.slice(0,2),0,1];const Pe=Array.isArray(L[0])?[...L[0]]:[...L],xe=Array.isArray(L[0])?[...L[1]]:[...L],Me=Array.isArray(P[0])?[...P[0]]:[...P],Ye=Array.isArray(P[0])?[...P[1]]:[...P],Ke=()=>Bc(B,ce).slice(0,2),ur=()=>{const _e=Ke();return Math.min(_e[0],_e[1])},qe=()=>{const _e=Ke();return Math.max(_e[0],_e[1])},$e=()=>Math.acos(ce[0]/qe()),ke=()=>[[...Pe],[...xe]],Be=()=>[[...Me],[...Ye]],Fe=()=>{const _e=Ke();return[1/_e[0],1/_e[1]]},Ue=()=>1/ur(),_r=()=>1/qe(),we=()=>Dc(B,ce).slice(0,2),Sr=()=>Pc(B,Oe,uo(fe,ce)).slice(0,2),hr=()=>ce,Er=()=>Oe.slice(0,2),nr=([_e=0,ze=0]=[],wr=1,Lr=0)=>{ce=fi(),ar([-_e,-ze]),Cr(Lr),Ge(1/wr)},ar=([_e=0,ze=0]=[])=>{B[0]=_e,B[1]=ze,B[2]=0;const wr=co(U,B);Pt(ce,wr,ce)},Ge=(_e,ze)=>{const wr=Array.isArray(_e);let Lr=wr?_e[0]:_e,Dr=wr?_e[1]:_e;if(Lr<=0||Dr<=0||Lr===1&&Dr===1)return;const Mr=Ke(),st=Mr[0]*Lr,Wr=Mr[1]*Dr;if(Lr=Math.max(Pe[0],Math.min(st,Pe[1]))/Mr[0],Dr=Math.max(xe[0],Math.min(Wr,xe[1]))/Mr[1],Lr===1&&Dr===1)return;B[0]=Lr,B[1]=Dr,B[2]=1;const qr=Fc(U,B),ut=ze?[...ze,0]:Oe,ct=co(B,ut);Pt(ce,ct,Pt(ce,qr,Pt(ce,uo(fe,ct),ce)))},Cr=_e=>{const ze=fi();Gc(ze,_e,[0,0,1]),Pt(ce,ze,ce)},Yr=_e=>{const ze=Array.isArray(_e[0]);Pe[0]=ze?_e[0][0]:_e[0],Pe[1]=ze?_e[0][1]:_e[1],xe[0]=ze?_e[1][0]:_e[0],xe[1]=ze?_e[1][1]:_e[1]},Or=_e=>{const ze=Array.isArray(_e[0]);Me[0]=ze?_e[0][0]:_e[0],Me[1]=ze?_e[0][1]:_e[1],Ye[0]=ze?_e[1][0]:_e[0],Ye[1]=ze?_e[1][1]:_e[1]},Fr=_e=>{!_e||_e.length<16||(ce=_e)},Gr=_e=>{Oe=[..._e.slice(0,2),0,1]},Rr=()=>{nr(n,r,s)};return nr(n,r,s),{get translation(){return we()},get target(){return Sr()},get scaling(){return Ke()},get minScaling(){return ur()},get maxScaling(){return qe()},get scaleBounds(){return ke()},get translationBounds(){return Be()},get distance(){return Fe()},get minDistance(){return Ue()},get maxDistance(){return _r()},get rotation(){return $e()},get view(){return hr()},get viewCenter(){return Er()},lookAt:nr,translate:ar,pan:ar,rotate:Cr,scale:Ge,zoom:Ge,reset:Rr,set:(..._e)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),Fr(..._e)),setScaleBounds:Yr,setTranslationBounds:Or,setView:Fr,setViewCenter:Gr}},jc=["pan","rotate"],lo={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},il=(n,{distance:r=1,target:s=[0,0],rotation:b=0,isNdc:L=!0,isFixed:P=!1,isPan:B=!0,isPanInverted:U=[!1,!0],panSpeed:fe=1,isRotate:ce=!0,rotateSpeed:Oe=1,defaultMouseDownMoveAction:Pe="pan",mouseDownMoveModKey:xe="alt",isZoom:Me=!0,zoomSpeed:Ye=1,viewCenter:Ke,scaleBounds:ur,translationBounds:qe,onKeyDown:$e=()=>{},onKeyUp:ke=()=>{},onMouseDown:Be=()=>{},onMouseUp:Fe=()=>{},onMouseMove:Ue=()=>{},onWheel:_r=()=>{}}={})=>{let we=Uc(s,r,b,Ke,ur,qe),Sr=0,hr=0,Er=0,nr=0,ar=0,Ge=0,Cr=!1,Yr=0,Or=1,Fr=1,Gr=1,Rr=!1,_e=!1,ze=!1,wr=Pe==="pan",Lr=B,Dr=B,Mr=U,st=U,Wr=Me,qr=Me;const ut=()=>{Lr=Array.isArray(B)?!!B[0]:B,Dr=Array.isArray(B)?!!B[1]:B,Mr=Array.isArray(U)?!!U[0]:U,st=Array.isArray(U)?!!U[1]:U,Wr=Array.isArray(Me)?!!Me[0]:Me,qr=Array.isArray(Me)?!!Me[1]:Me};ut();const ct=L?ve=>ve/Or*2*Gr:ve=>ve,Mt=L?ve=>ve/Fr*2:ve=>-ve,Ut=L?ve=>(-1+ve/Or*2)*Gr:ve=>ve,jt=L?ve=>1-ve/Fr*2:ve=>ve,Xe=()=>{if(P){const Nr=_e;return _e=!1,Nr}Rr=!1;const ve=Sr,br=hr;if((Lr||Dr)&&Cr&&(wr&&!ze||!wr&&ze)){const Nr=Mr?ar-ve:ve-ar,Xr=Lr?ct(fe*Nr):0,Hr=st?Ge-br:br-Ge,ir=Dr?Mt(fe*Hr):0;(Xr!==0||ir!==0)&&(we.pan([Xr,ir]),Rr=!0)}if((Wr||qr)&&Yr){const Nr=Ye*Math.exp(Yr/Fr),Xr=Ut(Er),Hr=jt(nr);we.scale([Wr?1/Nr:1,qr?1/Nr:1],[Xr,Hr]),Rr=!0}if(ce&&Cr&&(wr&&ze||!wr&&!ze)&&Math.abs(ar-ve)+Math.abs(Ge-br)>0){const Nr=Or/2,Xr=Fr/2,Hr=ar-Nr,ir=Xr-Ge,nt=ve-Nr,lt=Xr-br,xt=Mc([Hr,ir],[nt,lt]),ua=Hr*lt-nt*ir;we.rotate(Oe*xt*Math.sign(ua)),Rr=!0}Yr=0,ar=ve,Ge=br;const At=Rr||_e;return _e=!1,At},He=({defaultMouseDownMoveAction:ve=null,isFixed:br=null,isPan:At=null,isPanInverted:Nr=null,isRotate:Xr=null,isZoom:Hr=null,panSpeed:ir=null,rotateSpeed:nt=null,zoomSpeed:lt=null,mouseDownMoveModKey:xt=null}={})=>{Pe=ve!==null&&jc.includes(ve)?ve:Pe,wr=Pe==="pan",P=br!==null?br:P,B=At!==null?At:B,U=Nr!==null?Nr:U,ce=Xr!==null?Xr:ce,Me=Hr!==null?Hr:Me,fe=+ir>0?ir:fe,Oe=+nt>0?nt:Oe,Ye=+lt>0?lt:Ye,ut(),xe=xt!==null&&Object.keys(lo).includes(xt)?xt:xe},We=()=>{const ve=n.getBoundingClientRect();Or=ve.width,Fr=ve.height,Gr=Or/Fr},De=ve=>{ze=!1,ke(ve)},Br=ve=>{ze=ve[lo[xe]],$e(ve)},mr=ve=>{Cr=!1,Fe(ve)},Vt=ve=>{Cr=ve.buttons===1,Be(ve)},i=document.createEvent("MouseEvent").offsetX!==void 0?ve=>{Er=ve.offsetX,nr=ve.offsetY}:ve=>{const br=n.getBoundingClientRect();Er=ve.clientX-br.left,nr=ve.clientY-br.top},gn=ve=>{Sr=ve.clientX,hr=ve.clientY},Tn=ve=>{gn(ve),Ue(ve)},Sn=ve=>{if(Wr||qr){ve.preventDefault(),gn(ve),i(ve);const br=ve.deltaMode===1?12:1;Yr+=br*(ve.deltaY||ve.deltaX||0)}_r(ve)},sa=()=>{we=void 0,window.removeEventListener("keydown",Br),window.removeEventListener("keyup",De),n.removeEventListener("mousedown",Vt),window.removeEventListener("mouseup",mr),window.removeEventListener("mousemove",Tn),n.removeEventListener("wheel",Sn)};window.addEventListener("keydown",Br,{passive:!0}),window.addEventListener("keyup",De,{passive:!0}),n.addEventListener("mousedown",Vt,{passive:!0}),window.addEventListener("mouseup",mr,{passive:!0}),window.addEventListener("mousemove",Tn,{passive:!0}),n.addEventListener("wheel",Sn,{passive:!1}),we.config=He,we.dispose=sa,we.refresh=We,we.tick=Xe;const vr=ve=>function(){ve.apply(null,arguments),_e=!0};return we.lookAt=vr(we.lookAt),we.translate=vr(we.translate),we.pan=vr(we.pan),we.rotate=vr(we.rotate),we.scale=vr(we.scale),we.zoom=vr(we.zoom),we.reset=vr(we.reset),we.set=vr(we.set),we.setScaleBounds=vr(we.setScaleBounds),we.setTranslationBounds=vr(we.setTranslationBounds),we.setView=vr(we.setView),we.setViewCenter=vr(we.setViewCenter),We(),we},po=new window.BroadcastChannel("pub-sub-es"),Vc=n=>typeof n=="string",li=(n,r)=>Vc(n)&&r?n.toLowerCase():n,bo=(n,r)=>(s,b,L=Number.POSITIVE_INFINITY)=>{const P=li(s,r==null?void 0:r.caseInsensitive),B=n[P]||[];return B.push({handler:b,times:+L||Number.POSITIVE_INFINITY}),n[P]=B,{event:P,handler:b}},Xc=n=>typeof n=="object";function di(n,r){function s(b,L){let P,B;Xc(b)?(B=b.handler,P=b.event):(P=b,B=L);const U=li(P,r==null?void 0:r.caseInsensitive),fe=n[U];if(!fe)return;const ce=fe.findIndex(Oe=>Oe.handler===B);ce===-1||ce>=fe.length||fe.splice(ce,1)}return s}const Hc=n=>!!n,yo=(n,r)=>{const s=di(n);return(...b)=>{const[L,P,B]=b,U=li(L,r==null?void 0:r.caseInsensitive),fe=n[U];if(!Hc(fe))return;const ce=[...fe];for(const xe of ce)--xe.times<1&&s(U,xe.handler);const Oe=(B==null?void 0:B.async)!==void 0?B.async:r==null?void 0:r.async,Pe=()=>{for(const xe of ce)xe.handler(P)};if(Oe?setTimeout(Pe,0):Pe(),r!=null&&r.isGlobal&&!(B!=null&&B.isNoGlobalBroadcast))try{po.postMessage({event:U,news:P})}catch(xe){if(xe instanceof Error&&xe.name==="DataCloneError")console.warn(`Could not broadcast '${U.toString()}' globally. Payload is not clonable.`);else throw xe}}};function $c(n){return Object.keys(n)}const _o=n=>()=>{for(const r of $c(n))delete n[r]},Eo=()=>({}),fl=n=>{const r=!!(n!=null&&n.async),s=!!(n!=null&&n.caseInsensitive),b=(n==null?void 0:n.stack)||Eo();return{publish:yo(b,{async:r,caseInsensitive:s}),subscribe:bo(b,{caseInsensitive:s}),unsubscribe:di(b,{caseInsensitive:s}),clear:_o(b),stack:b}},xn=Eo(),zc={publish:yo(xn,{isGlobal:!0}),subscribe:bo(xn),unsubscribe:di(xn),clear:_o(xn),stack:xn};po.onmessage=({data:{event:n,news:r}})=>zc.publish(n,r,{isNoGlobalBroadcast:!0});const Yc=`
precision mediump float;
varying vec4 color;
void main() {
  gl_FragColor = color;
}`,Wc=(n,r)=>`
uniform mat4 projectionViewModel;
uniform float aspectRatio;

uniform sampler2D colorTex;
uniform float colorTexRes;
uniform float colorTexEps;
uniform float width;
uniform float useOpacity;
uniform float useColorOpacity;
uniform int miter;

attribute vec3 prevPosition;
attribute vec3 currPosition;
attribute vec3 nextPosition;
attribute float opacity;
attribute float offsetScale;
attribute float colorIndex;

varying vec4 color;

void main() {
  vec2 aspectVec = vec2(aspectRatio, 1.0);
  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);
  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);
  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);

  ${n?"prevProjected.x = prevPosition.x; currProjected.x = currPosition.x; nextProjected.x = nextPosition.x;":""}
  ${r?"prevProjected.y = prevPosition.y; currProjected.y = currPosition.y; nextProjected.y = nextPosition.y;":""}

  // get 2D screen space with W divide and aspect correction
  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;
  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;
  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;

  float len = width;

  // starting point uses (next - current)
  vec2 dir = vec2(0.0);
  if (currScreen == prevScreen) {
    dir = normalize(nextScreen - currScreen);
  }
  // ending point uses (current - previous)
  else if (currScreen == nextScreen) {
    dir = normalize(currScreen - prevScreen);
  }
  // somewhere in middle, needs a join
  else {
    // get directions from (C - B) and (B - A)
    vec2 dirA = normalize((currScreen - prevScreen));
    if (miter == 1) {
      vec2 dirB = normalize((nextScreen - currScreen));
      // now compute the miter join normal and length
      vec2 tangent = normalize(dirA + dirB);
      vec2 perp = vec2(-dirA.y, dirA.x);
      vec2 miter = vec2(-tangent.y, tangent.x);
      len = width / dot(miter, perp);
      dir = tangent;
    } else {
      dir = dirA;
    }
  }

  vec2 normal = vec2(-dir.y, dir.x) * len;
  normal.x /= aspectRatio;
  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);
  gl_Position = currProjected + offset;

  // Get color from texture
  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);
  vec2 colorTexIndex = vec2(
    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,
    colorRowIndex / colorTexRes + colorTexEps
  );

  color = texture2D(colorTex, colorTexIndex);
  color.a = useColorOpacity * color.a + useOpacity * opacity;
}`,oi=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ir=Float32Array.BYTES_PER_ELEMENT,qc=n=>n!==void 0&&Number.isFinite(n),si=n=>n.length>0&&Array.isArray(n[0]),{push:Ao,splice:Qc}=Array.prototype,Kc=(n,r=[])=>{let s=0;for(const b of n){for(let L=0;L<b-1;L++){const P=s+L*2,B=P+1,U=P+2,fe=P+3;r.push(P,B,U,U,B,fe)}s+=(b+2)*2}return r};function aa(n,r=1,s=1){const b=[],L=new Array(r*2);for(let P=0,B=n.length/r;P<B;P++){const U=P*r;for(let fe=0;fe<r;fe++){const ce=n[U+fe];L[fe]=ce,L[fe+r]=ce*s}Ao.apply(b,L)}return b}function _t(n,r,s,b){const L=new Array(b),P=r*b;for(let B=0;B<b;B++)L[B]=n[P+B];return Qc.call(n,s*b,0,...L),n}function Zc(n,r,s,b=0){const L=[],P=new Array(s).fill(b);for(let B=0,U=n.length/r;B<U;B++){const fe=B*r;for(let ce=0;ce<r;ce++)P[ce]=n[fe+ce];Ao.apply(L,P)}return L}const Jc=(n,{projection:r=oi,model:s=oi,view:b=oi,points:L=[],colorIndices:P=[],color:B=[.8,.5,0,1],opacity:U=null,opacities:fe=[],width:ce=1,widths:Oe=[],miter:Pe=!0,is2d:xe=!1,zPos2d:Me=0,isXUnprojected:Ye=!1,isYUnprojected:Ke=!1}={})=>{if(!n){console.error("Regl instance is undefined.");return}const ur=new Float32Array(16);let qe,$e,ke,Be,Fe,Ue,_r,we,Sr,hr,Er,nr,ar,Ge,Cr,Yr,Or,Fr,Gr=xe?2:3;const Rr=()=>+(fe.length===$e||U!==null),_e=()=>{hr=n.buffer(),Er=n.buffer(),nr=n.buffer(),Cr=n.buffer(),Yr={prevPosition:{buffer:()=>hr,offset:0,stride:Ir*3},currPosition:{buffer:()=>hr,offset:Ir*3*2,stride:Ir*3},nextPosition:{buffer:()=>hr,offset:Ir*3*4,stride:Ir*3},opacity:{buffer:()=>Er,offset:Ir*2,stride:Ir},offsetScale:{buffer:()=>nr,offset:Ir*2,stride:Ir},colorIndex:{buffer:()=>Cr,offset:Ir*2,stride:Ir}},Or=n.elements(),Fr=n({attributes:Yr,depth:{enable:!xe},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(Xe,He)=>{const We=Xe.projection||He.projection,De=Xe.model||He.model,Br=Xe.view||He.view;return Pt(ur,We,Pt(ur,Br,De))},aspectRatio:({viewportWidth:Xe,viewportHeight:He})=>Xe/He,colorTex:()=>ar,colorTexRes:()=>Ge,colorTexEps:()=>.5/Ge,pixelRatio:({pixelRatio:Xe})=>Xe,width:({pixelRatio:Xe,viewportHeight:He})=>ce/He*Xe,useOpacity:Rr,useColorOpacity:()=>+!Rr(),miter:+!!Pe},elements:()=>Or,vert:Wc(Ye,Ke),frag:Yc})},ze=()=>{qe===1&&L.length%Gr>0&&console.warn(`The length of points (${$e}) does not match the dimensions (${Gr}). Incomplete points are ignored.`),Be=L.flat().slice(0,$e*Gr),xe&&(Be=Zc(Be,2,3,Me)),P.length!==$e&&(P=new Array($e).fill(0)),Oe.length!==$e&&(Oe=new Array($e).fill(1));const Xe=P.slice(),He=fe.length===$e?fe.slice():new Array($e).fill(U===null?1:U),We=Oe.slice();let De=0;for(const Br of ke){const mr=De+Br-1;_t(Be,mr,mr,3),_t(Be,De,De,3),_t(Xe,mr,mr,1),_t(Xe,De,De,1),_t(He,mr,mr,1),_t(He,De,De,1),_t(We,mr,mr,1),_t(We,De,De,1),De+=Br+2}Fe=new Float32Array(aa(Be,3)),Ue=aa(Xe),_r=aa(He),we=aa(We,1,-1),Sr=Kc(ke),hr({usage:"dynamic",type:"float",length:Fe.length*Ir,data:Fe}),Er({usage:"dynamic",type:"float",length:_r.length*Ir,data:_r}),nr({usage:"dynamic",type:"float",length:we.length*Ir,data:we}),Cr({usage:"dynamic",type:"float",length:Ue.length*Ir,data:Ue}),Or({primitive:"triangles",usage:"dynamic",type:Sr.length>2**16?"uint32":"uint16",data:Sr})},wr=()=>{Lr(),_e()},Lr=()=>{L=[],Be=[],Fe=new Float32Array,we=[],Sr=[],hr.destroy(),nr.destroy(),Or.destroy()},Dr=({projection:Xe,model:He,view:We}={})=>{Xe&&(r=Xe),He&&(s=He),We&&(b=We),L&&L.length>1&&Fr({projection:r,model:s,view:b})},Mr=(Xe,He)=>{const We=He.flat(2);return We.length===$e?We:We.length===qe?ke.flatMap((De,Br)=>Array(De).fill(We[Br])):Xe},st=()=>L,Wr=(Xe=[],{colorIndices:He=P,opacities:We=fe,widths:De=Oe,is2d:Br=xe}={})=>{L=Xe,xe=Br,Gr=xe?2:3,qe=si(L)?L.length:1,ke=si(L)?L.map(mr=>Math.floor(mr.length/Gr)):[Math.floor(L.length/Gr)],$e=ke.reduce((mr,Vt)=>mr+Vt,0),P=Mr(P,He),fe=Mr(fe,We),Oe=Mr(Oe,De),L&&$e>1?ze():wr()},qr=()=>{const Xe=si(B)?B:[B];Ge=Math.max(2,Math.ceil(Math.sqrt(Xe.length)));const He=new Uint8Array(Ge**2*4);Xe.forEach((We,De)=>{He[De*4]=Math.min(255,Math.max(0,Math.round(We[0]*255))),He[De*4+1]=Math.min(255,Math.max(0,Math.round(We[1]*255))),He[De*4+2]=Math.min(255,Math.max(0,Math.round(We[2]*255))),He[De*4+3]=Number.isNaN(+We[3])?255:Math.min(255,Math.max(0,Math.round(We[3]*255)))}),ar=n.texture({data:He,shape:[Ge,Ge,4]})},ut=(Xe,He=U)=>{B=Xe,U=He,ar&&ar.destroy(),qr()},ct=()=>({color:B,miter:Pe,width:ce}),Mt=({color:Xe,opacity:He,miter:We,width:De}={})=>{Xe&&ut(Xe,He||U),We&&(Pe=!!We),qc(De)&&(ce=De)},Ut=()=>({points:hr,widths:nr,opacities:Er,colorIndices:Cr}),jt=()=>({points:Fe,widths:we,opacities:_r,colorIndices:Ue});return _e(),qr(),L&&L.length>1&&Wr(L),{clear:wr,destroy:Lr,draw:Dr,getPoints:st,setPoints:Wr,getData:jt,getBuffer:Ut,getStyle:ct,setStyle:Mt}},ol=Jc,sl=n=>n*n*n,ul=n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,cl=n=>--n*n*n+1,ll=n=>n,dl=n=>n*n,hl=n=>n<.5?2*n*n:-1+(4-2*n)*n,ml=n=>n*(2-n),vl=n=>n,pl=(n,r)=>{if(n===r)return!0;if(n.length!==r.length)return!1;const s=new Set(n),b=new Set(r);return s.size!==b.size?!1:r.every(L=>s.has(L))},bl=n=>n.reduce((r,s)=>s>r?s:r,-1/0),yl=(n,r=s=>s)=>{const s=[];for(let b=0;b<n;b++)s.push(r(b,n));return s},_l=(n,r)=>{const s=[];return n.forEach(b=>{s[b]=!0}),r.forEach(b=>{s[b]=!0}),s.reduce((b,L,P)=>(L&&b.push(P),b),[])},xo=(n,...r)=>(r.forEach(s=>{const b=Object.keys(s).reduce((L,P)=>(L[P]=Object.getOwnPropertyDescriptor(s,P),L),{});Object.getOwnPropertySymbols(s).forEach(L=>{const P=Object.getOwnPropertyDescriptor(s,L);P.enumerable&&(b[L]=P)}),Object.defineProperties(n,b)}),n),El=(...n)=>r=>n.reduce((s,b)=>b(s),r),Al=n=>r=>xo({__proto__:{constructor:n}},r),xl=(n,r)=>s=>xo(s,{get[n](){return r}}),gl=(n,r,s,b)=>Math.sqrt((n-s)**2+(r-b)**2),Tl=n=>new Worker(window.URL.createObjectURL(new Blob([`(${n.toString()})()`],{type:"text/javascript"}))),Sl=(n=1)=>new Promise(r=>{let s=0;const b=()=>requestAnimationFrame(()=>{s++,s<n?b():r()});b()}),wl=(n,r,s=null)=>{let b,L=0;s=s===null?r:s;const P=(...fe)=>{const ce=()=>{L>0&&(n(...fe),L=0)};clearTimeout(b),b=setTimeout(ce,s)};let B=!1;const U=(...fe)=>{B?(L++,P(...fe)):(n(...fe),P(...fe),B=!0,L=0,setTimeout(()=>{B=!1},r))};return U.reset=()=>{B=!1},U.cancel=()=>{clearTimeout(b)},U.now=(...fe)=>n(...fe),U};var el=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var go={exports:{}};(function(n,r){(function(s,b){n.exports=b()})(el,function(){var s=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},b=function(e,a){for(var d=Object.keys(a),S=0;S<d.length;++S)e[d[S]]=a[d[S]];return e},L=`
`;function P(e){return typeof atob<"u"?atob(e):"base64:"+e}function B(e){var a=new Error("(regl) "+e);throw console.error(a),a}function U(e,a){e||B(a)}function fe(e){return e?": "+e:""}function ce(e,a,d){e in a||B("unknown parameter ("+e+")"+fe(d)+". possible values: "+Object.keys(a).join())}function Oe(e,a){s(e)||B("invalid parameter type"+fe(a)+". must be a typed array")}function Pe(e,a){switch(a){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e>"u";case"symbol":return typeof e=="symbol"}}function xe(e,a,d){Pe(e,a)||B("invalid parameter type"+fe(d)+". expected "+a+", got "+typeof e)}function Me(e,a){e>=0&&(e|0)===e||B("invalid parameter type, ("+e+")"+fe(a)+". must be a nonnegative integer")}function Ye(e,a,d){a.indexOf(e)<0&&B("invalid value"+fe(d)+". must be one of: "+a)}var Ke=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ur(e){Object.keys(e).forEach(function(a){Ke.indexOf(a)<0&&B('invalid regl constructor argument "'+a+'". must be one of '+Ke)})}function qe(e,a){for(e=e+"";e.length<a;)e=" "+e;return e}function $e(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ke(e,a){this.number=e,this.line=a,this.errors=[]}function Be(e,a,d){this.file=e,this.line=a,this.message=d}function Fe(){var e=new Error,a=(e.stack||e).toString(),d=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);if(d)return d[1];var S=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a);return S?S[1]:"unknown"}function Ue(){var e=new Error,a=(e.stack||e).toString(),d=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);if(d)return d[1];var S=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a);return S?S[1]:"unknown"}function _r(e,a){var d=e.split(`
`),S=1,G=0,T={unknown:new $e,0:new $e};T.unknown.name=T[0].name=a||Fe(),T.unknown.lines.push(new ke(0,""));for(var R=0;R<d.length;++R){var V=d[R],j=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(V);if(j)switch(j[1]){case"line":var Y=/(\d+)(\s+\d+)?/.exec(j[2]);Y&&(S=Y[1]|0,Y[2]&&(G=Y[2]|0,G in T||(T[G]=new $e)));break;case"define":var q=/SHADER_NAME(_B64)?\s+(.*)$/.exec(j[2]);q&&(T[G].name=q[1]?P(q[2]):q[2]);break}T[G].lines.push(new ke(S++,V))}return Object.keys(T).forEach(function(W){var K=T[W];K.lines.forEach(function(X){K.index[X.number]=X})}),T}function we(e){var a=[];return e.split(`
`).forEach(function(d){if(!(d.length<5)){var S=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(d);S?a.push(new Be(S[1]|0,S[2]|0,S[3].trim())):d.length>0&&a.push(new Be("unknown",0,d))}}),a}function Sr(e,a){a.forEach(function(d){var S=e[d.file];if(S){var G=S.index[d.line];if(G){G.errors.push(d),S.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(d)})}function hr(e,a,d,S,G){if(!e.getShaderParameter(a,e.COMPILE_STATUS)){var T=e.getShaderInfoLog(a),R=S===e.FRAGMENT_SHADER?"fragment":"vertex";Or(d,"string",R+" shader source must be a string",G);var V=_r(d,G),j=we(T);Sr(V,j),Object.keys(V).forEach(function(Y){var q=V[Y];if(!q.hasErrors)return;var W=[""],K=[""];function X(z,_){W.push(z),K.push(_||"")}X("file number "+Y+": "+q.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),q.lines.forEach(function(z){if(z.errors.length>0){X(qe(z.number,4)+"|  ","background-color:yellow; font-weight:bold"),X(z.line+L,"color:red; background-color:yellow; font-weight:bold");var _=0;z.errors.forEach(function(O){var $=O.message,ie=/^\s*'(.*)'\s*:\s*(.*)$/.exec($);if(ie){var M=ie[1];switch($=ie[2],M){case"assign":M="=";break}_=Math.max(z.line.indexOf(M,_),0)}else _=0;X(qe("| ",6)),X(qe("^^^",_+3)+L,"font-weight:bold"),X(qe("| ",6)),X($+L,"font-weight:bold")}),X(qe("| ",6)+L)}else X(qe(z.number,4)+"|  "),X(z.line+L,"color:red")}),typeof document<"u"&&!window.chrome?(K[0]=W.join("%c"),console.log.apply(console,K)):console.log(W.join(""))}),U.raise("Error compiling "+R+" shader, "+V[0].name)}}function Er(e,a,d,S,G){if(!e.getProgramParameter(a,e.LINK_STATUS)){var T=e.getProgramInfoLog(a),R=_r(d,G),V=_r(S,G),j='Error linking program with vertex shader, "'+V[0].name+'", and fragment shader "'+R[0].name+'"';typeof document<"u"?console.log("%c"+j+L+"%c"+T,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(j+L+T),U.raise(j)}}function nr(e){e._commandRef=Fe()}function ar(e,a,d,S){nr(e);function G(j){return j?S.id(j):0}e._fragId=G(e.static.frag),e._vertId=G(e.static.vert);function T(j,Y){Object.keys(Y).forEach(function(q){j[S.id(q)]=!0})}var R=e._uniformSet={};T(R,a.static),T(R,a.dynamic);var V=e._attributeSet={};T(V,d.static),T(V,d.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function Ge(e,a){var d=Ue();B(e+" in command "+(a||Fe())+(d==="unknown"?"":" called from "+d))}function Cr(e,a,d){e||Ge(a,d||Fe())}function Yr(e,a,d,S){e in a||Ge("unknown parameter ("+e+")"+fe(d)+". possible values: "+Object.keys(a).join(),S||Fe())}function Or(e,a,d,S){Pe(e,a)||Ge("invalid parameter type"+fe(d)+". expected "+a+", got "+typeof e,S||Fe())}function Fr(e){e()}function Gr(e,a,d){e.texture?Ye(e.texture._texture.internalformat,a,"unsupported texture format for attachment"):Ye(e.renderbuffer._renderbuffer.format,d,"unsupported renderbuffer format for attachment")}var Rr=33071,_e=9728,ze=9984,wr=9985,Lr=9986,Dr=9987,Mr=5120,st=5121,Wr=5122,qr=5123,ut=5124,ct=5125,Mt=5126,Ut=32819,jt=32820,Xe=33635,He=34042,We=36193,De={};De[Mr]=De[st]=1,De[Wr]=De[qr]=De[We]=De[Xe]=De[Ut]=De[jt]=2,De[ut]=De[ct]=De[Mt]=De[He]=4;function Br(e,a){return e===jt||e===Ut||e===Xe?2:e===He?4:De[e]*a}function mr(e){return!(e&e-1)&&!!e}function Vt(e,a,d){var S,G=a.width,T=a.height,R=a.channels;U(G>0&&G<=d.maxTextureSize&&T>0&&T<=d.maxTextureSize,"invalid texture shape"),(e.wrapS!==Rr||e.wrapT!==Rr)&&U(mr(G)&&mr(T),"incompatible wrap mode for texture, both width and height must be power of 2"),a.mipmask===1?G!==1&&T!==1&&U(e.minFilter!==ze&&e.minFilter!==Lr&&e.minFilter!==wr&&e.minFilter!==Dr,"min filter requires mipmap"):(U(mr(G)&&mr(T),"texture must be a square power of 2 to support mipmapping"),U(a.mipmask===(G<<1)-1,"missing or incomplete mipmap data")),a.type===Mt&&(d.extensions.indexOf("oes_texture_float_linear")<0&&U(e.minFilter===_e&&e.magFilter===_e,"filter not supported, must enable oes_texture_float_linear"),U(!e.genMipmaps,"mipmap generation not supported with float textures"));var V=a.images;for(S=0;S<16;++S)if(V[S]){var j=G>>S,Y=T>>S;U(a.mipmask&1<<S,"missing mipmap data");var q=V[S];if(U(q.width===j&&q.height===Y,"invalid shape for mip images"),U(q.format===a.format&&q.internalformat===a.internalformat&&q.type===a.type,"incompatible type for mip image"),!q.compressed)if(q.data){var W=Math.ceil(Br(q.type,R)*j/q.unpackAlignment)*q.unpackAlignment;U(q.data.byteLength===W*Y,"invalid data for image, buffer size is inconsistent with image format")}else q.element||q.copy}else e.genMipmaps||U((a.mipmask&1<<S)===0,"extra mipmap data");a.compressed&&U(!e.genMipmaps,"mipmap generation for compressed images not supported")}function hi(e,a,d,S){var G=e.width,T=e.height,R=e.channels;U(G>0&&G<=S.maxTextureSize&&T>0&&T<=S.maxTextureSize,"invalid texture shape"),U(G===T,"cube map must be square"),U(a.wrapS===Rr&&a.wrapT===Rr,"wrap mode not supported by cube map");for(var V=0;V<d.length;++V){var j=d[V];U(j.width===G&&j.height===T,"inconsistent cube map face shape"),a.genMipmaps&&(U(!j.compressed,"can not generate mipmap for compressed textures"),U(j.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Y=j.images,q=0;q<16;++q){var W=Y[q];if(W){var K=G>>q,X=T>>q;U(j.mipmask&1<<q,"missing mipmap data"),U(W.width===K&&W.height===X,"invalid shape for mip images"),U(W.format===e.format&&W.internalformat===e.internalformat&&W.type===e.type,"incompatible type for mip image"),W.compressed||(W.data?U(W.data.byteLength===K*X*Math.max(Br(W.type,R),W.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):W.element||W.copy)}}}}var i=b(U,{optional:Fr,raise:B,commandRaise:Ge,command:Cr,parameter:ce,commandParameter:Yr,constructor:ur,type:xe,commandType:Or,isTypedArray:Oe,nni:Me,oneOf:Ye,shaderError:hr,linkError:Er,callSite:Ue,saveCommandRef:nr,saveDrawInfo:ar,framebufferFormat:Gr,guessCommand:Fe,texture2D:Vt,textureCube:hi}),gn=0,Tn=0,Sn=5,sa=6;function vr(e,a){this.id=gn++,this.type=e,this.data=a}function ve(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function br(e){if(e.length===0)return[];var a=e.charAt(0),d=e.charAt(e.length-1);if(e.length>1&&a===d&&(a==='"'||a==="'"))return['"'+ve(e.substr(1,e.length-2))+'"'];var S=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(S)return br(e.substr(0,S.index)).concat(br(S[1])).concat(br(e.substr(S.index+S[0].length)));var G=e.split(".");if(G.length===1)return['"'+ve(e)+'"'];for(var T=[],R=0;R<G.length;++R)T=T.concat(br(G[R]));return T}function At(e){return"["+br(e).join("][")+"]"}function Nr(e,a){return new vr(e,At(a+""))}function Xr(e){return typeof e=="function"&&!e._reglType||e instanceof vr}function Hr(e,a){if(typeof e=="function")return new vr(Tn,e);if(typeof e=="number"||typeof e=="boolean")return new vr(Sn,e);if(Array.isArray(e))return new vr(sa,e.map(function(d,S){return Hr(d,a+"["+S+"]")}));if(e instanceof vr)return e;i(!1,"invalid option type in uniform "+a)}var ir={DynamicVariable:vr,define:Nr,isDynamic:Xr,unbox:Hr,accessor:At},nt={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},lt=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function xt(){var e={"":0},a=[""];return{id:function(d){var S=e[d];return S||(S=e[d]=a.length,a.push(d),S)},str:function(d){return a[d]}}}function ua(e,a,d){var S=document.createElement("canvas");b(S.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(S),e===document.body&&(S.style.position="absolute",b(e.style,{margin:0,padding:0}));function G(){var V=window.innerWidth,j=window.innerHeight;if(e!==document.body){var Y=S.getBoundingClientRect();V=Y.right-Y.left,j=Y.bottom-Y.top}S.width=d*V,S.height=d*j}var T;e!==document.body&&typeof ResizeObserver=="function"?(T=new ResizeObserver(function(){setTimeout(G)}),T.observe(e)):window.addEventListener("resize",G,!1);function R(){T?T.disconnect():window.removeEventListener("resize",G),e.removeChild(S)}return G(),{canvas:S,onDestroy:R}}function So(e,a){function d(S){try{return e.getContext(S,a)}catch{return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function wo(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function Lo(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function mi(e){return typeof e=="string"?e.split():(i(Array.isArray(e),"invalid extension array"),e)}function vi(e){return typeof e=="string"?(i(typeof document<"u","not supported outside of DOM"),document.querySelector(e)):e}function Oo(e){var a=e||{},d,S,G,T,R={},V=[],j=[],Y=typeof window>"u"?1:window.devicePixelRatio,q=!1,W=function(z){z&&i.raise(z)},K=function(){};if(typeof a=="string"?(i(typeof document<"u","selector queries only supported in DOM enviroments"),d=document.querySelector(a),i(d,"invalid query string for element")):typeof a=="object"?wo(a)?d=a:Lo(a)?(T=a,G=T.canvas):(i.constructor(a),"gl"in a?T=a.gl:"canvas"in a?G=vi(a.canvas):"container"in a&&(S=vi(a.container)),"attributes"in a&&(R=a.attributes,i.type(R,"object","invalid context attributes")),"extensions"in a&&(V=mi(a.extensions)),"optionalExtensions"in a&&(j=mi(a.optionalExtensions)),"onDone"in a&&(i.type(a.onDone,"function","invalid or missing onDone callback"),W=a.onDone),"profile"in a&&(q=!!a.profile),"pixelRatio"in a&&(Y=+a.pixelRatio,i(Y>0,"invalid pixel ratio"))):i.raise("invalid arguments to regl"),d&&(d.nodeName.toLowerCase()==="canvas"?G=d:S=d),!T){if(!G){i(typeof document<"u","must manually specify webgl context outside of DOM environments");var X=ua(S||document.body,W,Y);if(!X)return null;G=X.canvas,K=X.onDestroy}R.premultipliedAlpha===void 0&&(R.premultipliedAlpha=!0),T=So(G,R)}return T?{gl:T,canvas:G,container:S,extensions:V,optionalExtensions:j,pixelRatio:Y,profile:q,onDone:W,onDestroy:K}:(K(),W("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ro(e,a){var d={};function S(R){i.type(R,"string","extension name must be string");var V=R.toLowerCase(),j;try{j=d[V]=e.getExtension(V)}catch{}return!!j}for(var G=0;G<a.extensions.length;++G){var T=a.extensions[G];if(!S(T))return a.onDestroy(),a.onDone('"'+T+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return a.optionalExtensions.forEach(S),{extensions:d,restore:function(){Object.keys(d).forEach(function(R){if(d[R]&&!S(R))throw new Error("(regl): error restoring extension "+R)})}}}function Ur(e,a){for(var d=Array(e),S=0;S<e;++S)d[S]=a(S);return d}var Io=5120,Co=5121,Fo=5122,Go=5123,Do=5124,Bo=5125,No=5126;function Po(e){for(var a=16;a<=1<<28;a*=16)if(e<=a)return a;return 0}function pi(e){var a,d;return a=(e>65535)<<4,e>>>=a,d=(e>255)<<3,e>>>=d,a|=d,d=(e>15)<<2,e>>>=d,a|=d,d=(e>3)<<1,e>>>=d,a|=d,a|e>>1}function bi(){var e=Ur(8,function(){return[]});function a(T){var R=Po(T),V=e[pi(R)>>2];return V.length>0?V.pop():new ArrayBuffer(R)}function d(T){e[pi(T.byteLength)>>2].push(T)}function S(T,R){var V=null;switch(T){case Io:V=new Int8Array(a(R),0,R);break;case Co:V=new Uint8Array(a(R),0,R);break;case Fo:V=new Int16Array(a(2*R),0,R);break;case Go:V=new Uint16Array(a(2*R),0,R);break;case Do:V=new Int32Array(a(4*R),0,R);break;case Bo:V=new Uint32Array(a(4*R),0,R);break;case No:V=new Float32Array(a(4*R),0,R);break;default:return null}return V.length!==R?V.subarray(0,R):V}function G(T){d(T.buffer)}return{alloc:a,free:d,allocType:S,freeType:G}}var fr=bi();fr.zero=bi();var ko=3408,Mo=3410,Uo=3411,jo=3412,Vo=3413,Xo=3414,Ho=3415,$o=33901,zo=33902,Yo=3379,Wo=3386,qo=34921,Qo=36347,Ko=36348,Zo=35661,Jo=35660,es=34930,rs=36349,ts=34076,ns=34024,as=7936,is=7937,fs=7938,os=35724,ss=34047,us=36063,cs=34852,wn=3553,yi=34067,ls=34069,ds=33984,an=6408,ca=5126,_i=5121,la=36160,hs=36053,ms=36064,vs=16384,ps=function(e,a){var d=1;a.ext_texture_filter_anisotropic&&(d=e.getParameter(ss));var S=1,G=1;a.webgl_draw_buffers&&(S=e.getParameter(cs),G=e.getParameter(us));var T=!!a.oes_texture_float;if(T){var R=e.createTexture();e.bindTexture(wn,R),e.texImage2D(wn,0,an,1,1,0,an,ca,null);var V=e.createFramebuffer();if(e.bindFramebuffer(la,V),e.framebufferTexture2D(la,ms,wn,R,0),e.bindTexture(wn,null),e.checkFramebufferStatus(la)!==hs)T=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(vs);var j=fr.allocType(ca,4);e.readPixels(0,0,1,1,an,ca,j),e.getError()?T=!1:(e.deleteFramebuffer(V),e.deleteTexture(R),T=j[0]===1),fr.freeType(j)}}var Y=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),q=!0;if(!Y){var W=e.createTexture(),K=fr.allocType(_i,36);e.activeTexture(ds),e.bindTexture(yi,W),e.texImage2D(ls,0,an,3,3,0,an,_i,K),fr.freeType(K),e.bindTexture(yi,null),e.deleteTexture(W),q=!e.getError()}return{colorBits:[e.getParameter(Mo),e.getParameter(Uo),e.getParameter(jo),e.getParameter(Vo)],depthBits:e.getParameter(Xo),stencilBits:e.getParameter(Ho),subpixelBits:e.getParameter(ko),extensions:Object.keys(a).filter(function(X){return!!a[X]}),maxAnisotropic:d,maxDrawbuffers:S,maxColorAttachments:G,pointSizeDims:e.getParameter($o),lineWidthDims:e.getParameter(zo),maxViewportDims:e.getParameter(Wo),maxCombinedTextureUnits:e.getParameter(Zo),maxCubeMapSize:e.getParameter(ts),maxRenderbufferSize:e.getParameter(ns),maxTextureUnits:e.getParameter(es),maxTextureSize:e.getParameter(Yo),maxAttributes:e.getParameter(qo),maxVertexUniforms:e.getParameter(Qo),maxVertexTextureUnits:e.getParameter(Jo),maxVaryingVectors:e.getParameter(Ko),maxFragmentUniforms:e.getParameter(rs),glsl:e.getParameter(os),renderer:e.getParameter(is),vendor:e.getParameter(as),version:e.getParameter(fs),readFloat:T,npotTextureCube:q}};function Qr(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||s(e.data))}var jr=function(e){return Object.keys(e).map(function(a){return e[a]})},Ln={shape:Es,flatten:_s};function bs(e,a,d){for(var S=0;S<a;++S)d[S]=e[S]}function ys(e,a,d,S){for(var G=0,T=0;T<a;++T)for(var R=e[T],V=0;V<d;++V)S[G++]=R[V]}function Ei(e,a,d,S,G,T){for(var R=T,V=0;V<a;++V)for(var j=e[V],Y=0;Y<d;++Y)for(var q=j[Y],W=0;W<S;++W)G[R++]=q[W]}function Ai(e,a,d,S,G){for(var T=1,R=d+1;R<a.length;++R)T*=a[R];var V=a[d];if(a.length-d===4){var j=a[d+1],Y=a[d+2],q=a[d+3];for(R=0;R<V;++R)Ei(e[R],j,Y,q,S,G),G+=T}else for(R=0;R<V;++R)Ai(e[R],a,d+1,S,G),G+=T}function _s(e,a,d,S){var G=1;if(a.length)for(var T=0;T<a.length;++T)G*=a[T];else G=0;var R=S||fr.allocType(d,G);switch(a.length){case 0:break;case 1:bs(e,a[0],R);break;case 2:ys(e,a[0],a[1],R);break;case 3:Ei(e,a[0],a[1],a[2],R,0);break;default:Ai(e,a,0,R,0)}return R}function Es(e){for(var a=[],d=e;d.length;d=d[0])a.push(d.length);return a}var da={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},As=5120,xs=5122,gs=5124,Ts=5121,Ss=5123,ws=5125,Ls=5126,Os=5126,gt={int8:As,int16:xs,int32:gs,uint8:Ts,uint16:Ss,uint32:ws,float:Ls,float32:Os},Rs=35048,Is=35040,On={dynamic:Rs,stream:Is,static:35044},ha=Ln.flatten,xi=Ln.shape,gi=35044,Cs=35040,ma=5121,va=5126,dt=[];dt[5120]=1,dt[5122]=2,dt[5124]=4,dt[5121]=1,dt[5123]=2,dt[5125]=4,dt[5126]=4;function Rn(e){return da[Object.prototype.toString.call(e)]|0}function Ti(e,a){for(var d=0;d<a.length;++d)e[d]=a[d]}function Si(e,a,d,S,G,T,R){for(var V=0,j=0;j<d;++j)for(var Y=0;Y<S;++Y)e[V++]=a[G*j+T*Y+R]}function Fs(e,a,d,S){var G=0,T={};function R(_){this.id=G++,this.buffer=e.createBuffer(),this.type=_,this.usage=gi,this.byteLength=0,this.dimension=1,this.dtype=ma,this.persistentData=null,d.profile&&(this.stats={size:0})}R.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},R.prototype.destroy=function(){K(this)};var V=[];function j(_,O){var $=V.pop();return $||($=new R(_)),$.bind(),W($,O,Cs,0,1,!1),$}function Y(_){V.push(_)}function q(_,O,$){_.byteLength=O.byteLength,e.bufferData(_.type,O,$)}function W(_,O,$,ie,M,ne){var re;if(_.usage=$,Array.isArray(O)){if(_.dtype=ie||va,O.length>0){var me;if(Array.isArray(O[0])){re=xi(O);for(var D=1,F=1;F<re.length;++F)D*=re[F];_.dimension=D,me=ha(O,re,_.dtype),q(_,me,$),ne?_.persistentData=me:fr.freeType(me)}else if(typeof O[0]=="number"){_.dimension=M;var ue=fr.allocType(_.dtype,O.length);Ti(ue,O),q(_,ue,$),ne?_.persistentData=ue:fr.freeType(ue)}else s(O[0])?(_.dimension=O[0].length,_.dtype=ie||Rn(O[0])||va,me=ha(O,[O.length,O[0].length],_.dtype),q(_,me,$),ne?_.persistentData=me:fr.freeType(me)):i.raise("invalid buffer data")}}else if(s(O))_.dtype=ie||Rn(O),_.dimension=M,q(_,O,$),ne&&(_.persistentData=new Uint8Array(new Uint8Array(O.buffer)));else if(Qr(O)){re=O.shape;var Z=O.stride,H=O.offset,J=0,ee=0,ge=0,Ae=0;re.length===1?(J=re[0],ee=1,ge=Z[0],Ae=0):re.length===2?(J=re[0],ee=re[1],ge=Z[0],Ae=Z[1]):i.raise("invalid shape"),_.dtype=ie||Rn(O.data)||va,_.dimension=ee;var te=fr.allocType(_.dtype,J*ee);Si(te,O.data,J,ee,ge,Ae,H),q(_,te,$),ne?_.persistentData=te:fr.freeType(te)}else O instanceof ArrayBuffer?(_.dtype=ma,_.dimension=M,q(_,O,$),ne&&(_.persistentData=new Uint8Array(new Uint8Array(O)))):i.raise("invalid buffer data")}function K(_){a.bufferCount--,S(_);var O=_.buffer;i(O,"buffer must not be deleted already"),e.deleteBuffer(O),_.buffer=null,delete T[_.id]}function X(_,O,$,ie){a.bufferCount++;var M=new R(O);T[M.id]=M;function ne(D){var F=gi,ue=null,Z=0,H=0,J=1;return Array.isArray(D)||s(D)||Qr(D)||D instanceof ArrayBuffer?ue=D:typeof D=="number"?Z=D|0:D&&(i.type(D,"object","buffer arguments must be an object, a number or an array"),"data"in D&&(i(ue===null||Array.isArray(ue)||s(ue)||Qr(ue),"invalid data for buffer"),ue=D.data),"usage"in D&&(i.parameter(D.usage,On,"invalid buffer usage"),F=On[D.usage]),"type"in D&&(i.parameter(D.type,gt,"invalid buffer type"),H=gt[D.type]),"dimension"in D&&(i.type(D.dimension,"number","invalid dimension"),J=D.dimension|0),"length"in D&&(i.nni(Z,"buffer length must be a nonnegative integer"),Z=D.length|0)),M.bind(),ue?W(M,ue,F,H,J,ie):(Z&&e.bufferData(M.type,Z,F),M.dtype=H||ma,M.usage=F,M.dimension=J,M.byteLength=Z),d.profile&&(M.stats.size=M.byteLength*dt[M.dtype]),ne}function re(D,F){i(F+D.byteLength<=M.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+D.byteLength+" starting from offset "+F+" to a buffer of size "+M.byteLength),e.bufferSubData(M.type,F,D)}function me(D,F){var ue=(F||0)|0,Z;if(M.bind(),s(D)||D instanceof ArrayBuffer)re(D,ue);else if(Array.isArray(D)){if(D.length>0)if(typeof D[0]=="number"){var H=fr.allocType(M.dtype,D.length);Ti(H,D),re(H,ue),fr.freeType(H)}else if(Array.isArray(D[0])||s(D[0])){Z=xi(D);var J=ha(D,Z,M.dtype);re(J,ue),fr.freeType(J)}else i.raise("invalid buffer data")}else if(Qr(D)){Z=D.shape;var ee=D.stride,ge=0,Ae=0,te=0,ae=0;Z.length===1?(ge=Z[0],Ae=1,te=ee[0],ae=0):Z.length===2?(ge=Z[0],Ae=Z[1],te=ee[0],ae=ee[1]):i.raise("invalid shape");var be=Array.isArray(D.data)?M.dtype:Rn(D.data),Te=fr.allocType(be,ge*Ae);Si(Te,D.data,ge,Ae,te,ae,D.offset),re(Te,ue),fr.freeType(Te)}else i.raise("invalid data for buffer subdata");return ne}return $||ne(_),ne._reglType="buffer",ne._buffer=M,ne.subdata=me,d.profile&&(ne.stats=M.stats),ne.destroy=function(){K(M)},ne}function z(){jr(T).forEach(function(_){_.buffer=e.createBuffer(),e.bindBuffer(_.type,_.buffer),e.bufferData(_.type,_.persistentData||_.byteLength,_.usage)})}return d.profile&&(a.getTotalBufferSize=function(){var _=0;return Object.keys(T).forEach(function(O){_+=T[O].stats.size}),_}),{create:X,createStream:j,destroyStream:Y,clear:function(){jr(T).forEach(K),V.forEach(K)},getBuffer:function(_){return _&&_._buffer instanceof R?_._buffer:null},restore:z,_initBuffer:W}}var Gs=0,Ds=0,Bs=1,Ns=1,Ps=4,ks=4,ht={points:Gs,point:Ds,lines:Bs,line:Ns,triangles:Ps,triangle:ks,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ms=0,Us=1,fn=4,js=5120,Xt=5121,wi=5122,Ht=5123,Li=5124,Tt=5125,pa=34963,Vs=35040,Xs=35044;function Hs(e,a,d,S){var G={},T=0,R={uint8:Xt,uint16:Ht};a.oes_element_index_uint&&(R.uint32=Tt);function V(z){this.id=T++,G[this.id]=this,this.buffer=z,this.primType=fn,this.vertCount=0,this.type=0}V.prototype.bind=function(){this.buffer.bind()};var j=[];function Y(z){var _=j.pop();return _||(_=new V(d.create(null,pa,!0,!1)._buffer)),W(_,z,Vs,-1,-1,0,0),_}function q(z){j.push(z)}function W(z,_,O,$,ie,M,ne){z.buffer.bind();var re;if(_){var me=ne;!ne&&(!s(_)||Qr(_)&&!s(_.data))&&(me=a.oes_element_index_uint?Tt:Ht),d._initBuffer(z.buffer,_,O,me,3)}else e.bufferData(pa,M,O),z.buffer.dtype=re||Xt,z.buffer.usage=O,z.buffer.dimension=3,z.buffer.byteLength=M;if(re=ne,!ne){switch(z.buffer.dtype){case Xt:case js:re=Xt;break;case Ht:case wi:re=Ht;break;case Tt:case Li:re=Tt;break;default:i.raise("unsupported type for element array")}z.buffer.dtype=re}z.type=re,i(re!==Tt||!!a.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var D=ie;D<0&&(D=z.buffer.byteLength,re===Ht?D>>=1:re===Tt&&(D>>=2)),z.vertCount=D;var F=$;if($<0){F=fn;var ue=z.buffer.dimension;ue===1&&(F=Ms),ue===2&&(F=Us),ue===3&&(F=fn)}z.primType=F}function K(z){S.elementsCount--,i(z.buffer!==null,"must not double destroy elements"),delete G[z.id],z.buffer.destroy(),z.buffer=null}function X(z,_){var O=d.create(null,pa,!0),$=new V(O._buffer);S.elementsCount++;function ie(M){if(!M)O(),$.primType=fn,$.vertCount=0,$.type=Xt;else if(typeof M=="number")O(M),$.primType=fn,$.vertCount=M|0,$.type=Xt;else{var ne=null,re=Xs,me=-1,D=-1,F=0,ue=0;Array.isArray(M)||s(M)||Qr(M)?ne=M:(i.type(M,"object","invalid arguments for elements"),"data"in M&&(ne=M.data,i(Array.isArray(ne)||s(ne)||Qr(ne),"invalid data for element buffer")),"usage"in M&&(i.parameter(M.usage,On,"invalid element buffer usage"),re=On[M.usage]),"primitive"in M&&(i.parameter(M.primitive,ht,"invalid element buffer primitive"),me=ht[M.primitive]),"count"in M&&(i(typeof M.count=="number"&&M.count>=0,"invalid vertex count for elements"),D=M.count|0),"type"in M&&(i.parameter(M.type,R,"invalid buffer type"),ue=R[M.type]),"length"in M?F=M.length|0:(F=D,ue===Ht||ue===wi?F*=2:(ue===Tt||ue===Li)&&(F*=4))),W($,ne,re,me,D,F,ue)}return ie}return ie(z),ie._reglType="elements",ie._elements=$,ie.subdata=function(M,ne){return O.subdata(M,ne),ie},ie.destroy=function(){K($)},ie}return{create:X,createStream:Y,destroyStream:q,getElements:function(z){return typeof z=="function"&&z._elements instanceof V?z._elements:null},clear:function(){jr(G).forEach(K)}}}var Oi=new Float32Array(1),$s=new Uint32Array(Oi.buffer),zs=5123;function Ri(e){for(var a=fr.allocType(zs,e.length),d=0;d<e.length;++d)if(isNaN(e[d]))a[d]=65535;else if(e[d]===1/0)a[d]=31744;else if(e[d]===-1/0)a[d]=64512;else{Oi[0]=e[d];var S=$s[0],G=S>>>31<<15,T=(S<<1>>>24)-127,R=S>>13&1024-1;if(T<-24)a[d]=G;else if(T<-14){var V=-14-T;a[d]=G+(R+1024>>V)}else T>15?a[d]=G+31744:a[d]=G+(T+15<<10)+R}return a}function Ze(e){return Array.isArray(e)||s(e)}var Ii=function(e){return!(e&e-1)&&!!e},Ys=34467,Zr=3553,ba=34067,In=34069,St=6408,ya=6406,Cn=6407,on=6409,Fn=6410,Ci=32854,_a=32855,Fi=36194,Ws=32819,qs=32820,Qs=33635,Ks=34042,Ea=6402,Gn=34041,Aa=35904,xa=35906,$t=36193,ga=33776,Ta=33777,Sa=33778,wa=33779,Gi=35986,Di=35987,Bi=34798,Ni=35840,Pi=35841,ki=35842,Mi=35843,Ui=36196,zt=5121,La=5123,Oa=5125,sn=5126,Zs=10242,Js=10243,eu=10497,Ra=33071,ru=33648,tu=10240,nu=10241,Ia=9728,au=9729,Ca=9984,ji=9985,Vi=9986,Fa=9987,iu=33170,Dn=4352,fu=4353,ou=4354,su=34046,uu=3317,cu=37440,lu=37441,du=37443,Xi=37444,un=33984,hu=[Ca,Vi,ji,Fa],Bn=[0,on,Fn,Cn,St],$r={};$r[on]=$r[ya]=$r[Ea]=1,$r[Gn]=$r[Fn]=2,$r[Cn]=$r[Aa]=3,$r[St]=$r[xa]=4;function Yt(e){return"[object "+e+"]"}var Hi=Yt("HTMLCanvasElement"),$i=Yt("OffscreenCanvas"),zi=Yt("CanvasRenderingContext2D"),Yi=Yt("ImageBitmap"),Wi=Yt("HTMLImageElement"),qi=Yt("HTMLVideoElement"),mu=Object.keys(da).concat([Hi,$i,zi,Yi,Wi,qi]),Wt=[];Wt[zt]=1,Wt[sn]=4,Wt[$t]=2,Wt[La]=2,Wt[Oa]=4;var Ar=[];Ar[Ci]=2,Ar[_a]=2,Ar[Fi]=2,Ar[Gn]=4,Ar[ga]=.5,Ar[Ta]=.5,Ar[Sa]=1,Ar[wa]=1,Ar[Gi]=.5,Ar[Di]=1,Ar[Bi]=1,Ar[Ni]=.5,Ar[Pi]=.25,Ar[ki]=.5,Ar[Mi]=.25,Ar[Ui]=.5;function Qi(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function Ki(e){if(!Array.isArray(e))return!1;var a=e.length;return!(a===0||!Ze(e[0]))}function wt(e){return Object.prototype.toString.call(e)}function Zi(e){return wt(e)===Hi}function Ji(e){return wt(e)===$i}function vu(e){return wt(e)===zi}function pu(e){return wt(e)===Yi}function bu(e){return wt(e)===Wi}function yu(e){return wt(e)===qi}function Ga(e){if(!e)return!1;var a=wt(e);return mu.indexOf(a)>=0?!0:Qi(e)||Ki(e)||Qr(e)}function ef(e){return da[Object.prototype.toString.call(e)]|0}function _u(e,a){var d=a.length;switch(e.type){case zt:case La:case Oa:case sn:var S=fr.allocType(e.type,d);S.set(a),e.data=S;break;case $t:e.data=Ri(a);break;default:i.raise("unsupported texture type, must specify a typed array")}}function rf(e,a){return fr.allocType(e.type===$t?sn:e.type,a)}function tf(e,a){e.type===$t?(e.data=Ri(a),fr.freeType(a)):e.data=a}function Eu(e,a,d,S,G,T){for(var R=e.width,V=e.height,j=e.channels,Y=R*V*j,q=rf(e,Y),W=0,K=0;K<V;++K)for(var X=0;X<R;++X)for(var z=0;z<j;++z)q[W++]=a[d*X+S*K+G*z+T];tf(e,q)}function Nn(e,a,d,S,G,T){var R;if(typeof Ar[e]<"u"?R=Ar[e]:R=$r[e]*Wt[a],T&&(R*=6),G){for(var V=0,j=d;j>=1;)V+=R*j*j,j/=2;return V}else return R*d*S}function Au(e,a,d,S,G,T,R){var V={"don't care":Dn,"dont care":Dn,nice:ou,fast:fu},j={repeat:eu,clamp:Ra,mirror:ru},Y={nearest:Ia,linear:au},q=b({mipmap:Fa,"nearest mipmap nearest":Ca,"linear mipmap nearest":ji,"nearest mipmap linear":Vi,"linear mipmap linear":Fa},Y),W={none:0,browser:Xi},K={uint8:zt,rgba4:Ws,rgb565:Qs,"rgb5 a1":qs},X={alpha:ya,luminance:on,"luminance alpha":Fn,rgb:Cn,rgba:St,rgba4:Ci,"rgb5 a1":_a,rgb565:Fi},z={};a.ext_srgb&&(X.srgb=Aa,X.srgba=xa),a.oes_texture_float&&(K.float32=K.float=sn),a.oes_texture_half_float&&(K.float16=K["half float"]=$t),a.webgl_depth_texture&&(b(X,{depth:Ea,"depth stencil":Gn}),b(K,{uint16:La,uint32:Oa,"depth stencil":Ks})),a.webgl_compressed_texture_s3tc&&b(z,{"rgb s3tc dxt1":ga,"rgba s3tc dxt1":Ta,"rgba s3tc dxt3":Sa,"rgba s3tc dxt5":wa}),a.webgl_compressed_texture_atc&&b(z,{"rgb atc":Gi,"rgba atc explicit alpha":Di,"rgba atc interpolated alpha":Bi}),a.webgl_compressed_texture_pvrtc&&b(z,{"rgb pvrtc 4bppv1":Ni,"rgb pvrtc 2bppv1":Pi,"rgba pvrtc 4bppv1":ki,"rgba pvrtc 2bppv1":Mi}),a.webgl_compressed_texture_etc1&&(z["rgb etc1"]=Ui);var _=Array.prototype.slice.call(e.getParameter(Ys));Object.keys(z).forEach(function(c){var w=z[c];_.indexOf(w)>=0&&(X[c]=w)});var O=Object.keys(X);d.textureFormats=O;var $=[];Object.keys(X).forEach(function(c){var w=X[c];$[w]=c});var ie=[];Object.keys(K).forEach(function(c){var w=K[c];ie[w]=c});var M=[];Object.keys(Y).forEach(function(c){var w=Y[c];M[w]=c});var ne=[];Object.keys(q).forEach(function(c){var w=q[c];ne[w]=c});var re=[];Object.keys(j).forEach(function(c){var w=j[c];re[w]=c});var me=O.reduce(function(c,w){var g=X[w];return g===on||g===ya||g===on||g===Fn||g===Ea||g===Gn||a.ext_srgb&&(g===Aa||g===xa)?c[g]=g:g===_a||w.indexOf("rgba")>=0?c[g]=St:c[g]=Cn,c},{});function D(){this.internalformat=St,this.format=St,this.type=zt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Xi,this.width=0,this.height=0,this.channels=0}function F(c,w){c.internalformat=w.internalformat,c.format=w.format,c.type=w.type,c.compressed=w.compressed,c.premultiplyAlpha=w.premultiplyAlpha,c.flipY=w.flipY,c.unpackAlignment=w.unpackAlignment,c.colorSpace=w.colorSpace,c.width=w.width,c.height=w.height,c.channels=w.channels}function ue(c,w){if(!(typeof w!="object"||!w)){if("premultiplyAlpha"in w&&(i.type(w.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),c.premultiplyAlpha=w.premultiplyAlpha),"flipY"in w&&(i.type(w.flipY,"boolean","invalid texture flip"),c.flipY=w.flipY),"alignment"in w&&(i.oneOf(w.alignment,[1,2,4,8],"invalid texture unpack alignment"),c.unpackAlignment=w.alignment),"colorSpace"in w&&(i.parameter(w.colorSpace,W,"invalid colorSpace"),c.colorSpace=W[w.colorSpace]),"type"in w){var g=w.type;i(a.oes_texture_float||!(g==="float"||g==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),i(a.oes_texture_half_float||!(g==="half float"||g==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),i(a.webgl_depth_texture||!(g==="uint16"||g==="uint32"||g==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),i.parameter(g,K,"invalid texture type"),c.type=K[g]}var se=c.width,Le=c.height,f=c.channels,t=!1;"shape"in w?(i(Array.isArray(w.shape)&&w.shape.length>=2,"shape must be an array"),se=w.shape[0],Le=w.shape[1],w.shape.length===3&&(f=w.shape[2],i(f>0&&f<=4,"invalid number of channels"),t=!0),i(se>=0&&se<=d.maxTextureSize,"invalid width"),i(Le>=0&&Le<=d.maxTextureSize,"invalid height")):("radius"in w&&(se=Le=w.radius,i(se>=0&&se<=d.maxTextureSize,"invalid radius")),"width"in w&&(se=w.width,i(se>=0&&se<=d.maxTextureSize,"invalid width")),"height"in w&&(Le=w.height,i(Le>=0&&Le<=d.maxTextureSize,"invalid height")),"channels"in w&&(f=w.channels,i(f>0&&f<=4,"invalid number of channels"),t=!0)),c.width=se|0,c.height=Le|0,c.channels=f|0;var h=!1;if("format"in w){var y=w.format;i(a.webgl_depth_texture||!(y==="depth"||y==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),i.parameter(y,X,"invalid texture format");var E=c.internalformat=X[y];c.format=me[E],y in K&&("type"in w||(c.type=K[y])),y in z&&(c.compressed=!0),h=!0}!t&&h?c.channels=$r[c.format]:t&&!h?c.channels!==Bn[c.format]&&(c.format=c.internalformat=Bn[c.channels]):h&&t&&i(c.channels===$r[c.format],"number of channels inconsistent with specified format")}}function Z(c){e.pixelStorei(cu,c.flipY),e.pixelStorei(lu,c.premultiplyAlpha),e.pixelStorei(du,c.colorSpace),e.pixelStorei(uu,c.unpackAlignment)}function H(){D.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function J(c,w){var g=null;if(Ga(w)?g=w:w&&(i.type(w,"object","invalid pixel data type"),ue(c,w),"x"in w&&(c.xOffset=w.x|0),"y"in w&&(c.yOffset=w.y|0),Ga(w.data)&&(g=w.data)),i(!c.compressed||g instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),w.copy){i(!g,"can not specify copy and data field for the same texture");var se=G.viewportWidth,Le=G.viewportHeight;c.width=c.width||se-c.xOffset,c.height=c.height||Le-c.yOffset,c.needsCopy=!0,i(c.xOffset>=0&&c.xOffset<se&&c.yOffset>=0&&c.yOffset<Le&&c.width>0&&c.width<=se&&c.height>0&&c.height<=Le,"copy texture read out of bounds")}else if(!g)c.width=c.width||1,c.height=c.height||1,c.channels=c.channels||4;else if(s(g))c.channels=c.channels||4,c.data=g,!("type"in w)&&c.type===zt&&(c.type=ef(g));else if(Qi(g))c.channels=c.channels||4,_u(c,g),c.alignment=1,c.needsFree=!0;else if(Qr(g)){var f=g.data;!Array.isArray(f)&&c.type===zt&&(c.type=ef(f));var t=g.shape,h=g.stride,y,E,v,m,p,o;t.length===3?(v=t[2],o=h[2]):(i(t.length===2,"invalid ndarray pixel data, must be 2 or 3D"),v=1,o=1),y=t[0],E=t[1],m=h[0],p=h[1],c.alignment=1,c.width=y,c.height=E,c.channels=v,c.format=c.internalformat=Bn[v],c.needsFree=!0,Eu(c,f,m,p,o,g.offset)}else if(Zi(g)||Ji(g)||vu(g))Zi(g)||Ji(g)?c.element=g:c.element=g.canvas,c.width=c.element.width,c.height=c.element.height,c.channels=4;else if(pu(g))c.element=g,c.width=g.width,c.height=g.height,c.channels=4;else if(bu(g))c.element=g,c.width=g.naturalWidth,c.height=g.naturalHeight,c.channels=4;else if(yu(g))c.element=g,c.width=g.videoWidth,c.height=g.videoHeight,c.channels=4;else if(Ki(g)){var l=c.width||g[0].length,u=c.height||g.length,x=c.channels;Ze(g[0][0])?x=x||g[0][0].length:x=x||1;for(var A=Ln.shape(g),C=1,N=0;N<A.length;++N)C*=A[N];var Q=rf(c,C);Ln.flatten(g,A,"",Q),tf(c,Q),c.alignment=1,c.width=l,c.height=u,c.channels=x,c.format=c.internalformat=Bn[x],c.needsFree=!0}c.type===sn?i(d.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):c.type===$t&&i(d.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function ee(c,w,g){var se=c.element,Le=c.data,f=c.internalformat,t=c.format,h=c.type,y=c.width,E=c.height;Z(c),se?e.texImage2D(w,g,t,t,h,se):c.compressed?e.compressedTexImage2D(w,g,f,y,E,0,Le):c.needsCopy?(S(),e.copyTexImage2D(w,g,t,c.xOffset,c.yOffset,y,E,0)):e.texImage2D(w,g,t,y,E,0,t,h,Le||null)}function ge(c,w,g,se,Le){var f=c.element,t=c.data,h=c.internalformat,y=c.format,E=c.type,v=c.width,m=c.height;Z(c),f?e.texSubImage2D(w,Le,g,se,y,E,f):c.compressed?e.compressedTexSubImage2D(w,Le,g,se,h,v,m,t):c.needsCopy?(S(),e.copyTexSubImage2D(w,Le,g,se,c.xOffset,c.yOffset,v,m)):e.texSubImage2D(w,Le,g,se,v,m,y,E,t)}var Ae=[];function te(){return Ae.pop()||new H}function ae(c){c.needsFree&&fr.freeType(c.data),H.call(c),Ae.push(c)}function be(){D.call(this),this.genMipmaps=!1,this.mipmapHint=Dn,this.mipmask=0,this.images=Array(16)}function Te(c,w,g){var se=c.images[0]=te();c.mipmask=1,se.width=c.width=w,se.height=c.height=g,se.channels=c.channels=4}function Re(c,w){var g=null;if(Ga(w))g=c.images[0]=te(),F(g,c),J(g,w),c.mipmask=1;else if(ue(c,w),Array.isArray(w.mipmap))for(var se=w.mipmap,Le=0;Le<se.length;++Le)g=c.images[Le]=te(),F(g,c),g.width>>=Le,g.height>>=Le,J(g,se[Le]),c.mipmask|=1<<Le;else g=c.images[0]=te(),F(g,c),J(g,w),c.mipmask=1;F(c,c.images[0]),c.compressed&&(c.internalformat===ga||c.internalformat===Ta||c.internalformat===Sa||c.internalformat===wa)&&i(c.width%4===0&&c.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Je(c,w){for(var g=c.images,se=0;se<g.length;++se){if(!g[se])return;ee(g[se],w,se)}}var er=[];function Ce(){var c=er.pop()||new be;D.call(c),c.mipmask=0;for(var w=0;w<16;++w)c.images[w]=null;return c}function cr(c){for(var w=c.images,g=0;g<w.length;++g)w[g]&&ae(w[g]),w[g]=null;er.push(c)}function Qe(){this.minFilter=Ia,this.magFilter=Ia,this.wrapS=Ra,this.wrapT=Ra,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Dn}function sr(c,w){if("min"in w){var g=w.min;i.parameter(g,q),c.minFilter=q[g],hu.indexOf(c.minFilter)>=0&&!("faces"in w)&&(c.genMipmaps=!0)}if("mag"in w){var se=w.mag;i.parameter(se,Y),c.magFilter=Y[se]}var Le=c.wrapS,f=c.wrapT;if("wrap"in w){var t=w.wrap;typeof t=="string"?(i.parameter(t,j),Le=f=j[t]):Array.isArray(t)&&(i.parameter(t[0],j),i.parameter(t[1],j),Le=j[t[0]],f=j[t[1]])}else{if("wrapS"in w){var h=w.wrapS;i.parameter(h,j),Le=j[h]}if("wrapT"in w){var y=w.wrapT;i.parameter(y,j),f=j[y]}}if(c.wrapS=Le,c.wrapT=f,"anisotropic"in w){var E=w.anisotropic;i(typeof E=="number"&&E>=1&&E<=d.maxAnisotropic,"aniso samples must be between 1 and "),c.anisotropic=w.anisotropic}if("mipmap"in w){var v=!1;switch(typeof w.mipmap){case"string":i.parameter(w.mipmap,V,"invalid mipmap hint"),c.mipmapHint=V[w.mipmap],c.genMipmaps=!0,v=!0;break;case"boolean":v=c.genMipmaps=w.mipmap;break;case"object":i(Array.isArray(w.mipmap),"invalid mipmap type"),c.genMipmaps=!1,v=!0;break;default:i.raise("invalid mipmap type")}v&&!("min"in w)&&(c.minFilter=Ca)}}function lr(c,w){e.texParameteri(w,nu,c.minFilter),e.texParameteri(w,tu,c.magFilter),e.texParameteri(w,Zs,c.wrapS),e.texParameteri(w,Js,c.wrapT),a.ext_texture_filter_anisotropic&&e.texParameteri(w,su,c.anisotropic),c.genMipmaps&&(e.hint(iu,c.mipmapHint),e.generateMipmap(w))}var dr=0,yr={},xr=d.maxTextureUnits,rr=Array(xr).map(function(){return null});function Se(c){D.call(this),this.mipmask=0,this.internalformat=St,this.id=dr++,this.refCount=1,this.target=c,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Qe,R.profile&&(this.stats={size:0})}function gr(c){e.activeTexture(un),e.bindTexture(c.target,c.texture)}function je(){var c=rr[0];c?e.bindTexture(c.target,c.texture):e.bindTexture(Zr,null)}function pe(c){var w=c.texture;i(w,"must not double destroy texture");var g=c.unit,se=c.target;g>=0&&(e.activeTexture(un+g),e.bindTexture(se,null),rr[g]=null),e.deleteTexture(w),c.texture=null,c.params=null,c.pixels=null,c.refCount=0,delete yr[c.id],T.textureCount--}b(Se.prototype,{bind:function(){var c=this;c.bindCount+=1;var w=c.unit;if(w<0){for(var g=0;g<xr;++g){var se=rr[g];if(se){if(se.bindCount>0)continue;se.unit=-1}rr[g]=c,w=g;break}w>=xr&&i.raise("insufficient number of texture units"),R.profile&&T.maxTextureUnits<w+1&&(T.maxTextureUnits=w+1),c.unit=w,e.activeTexture(un+w),e.bindTexture(c.target,c.texture)}return w},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&pe(this)}});function Ie(c,w){var g=new Se(Zr);yr[g.id]=g,T.textureCount++;function se(t,h){var y=g.texInfo;Qe.call(y);var E=Ce();return typeof t=="number"?typeof h=="number"?Te(E,t|0,h|0):Te(E,t|0,t|0):t?(i.type(t,"object","invalid arguments to regl.texture"),sr(y,t),Re(E,t)):Te(E,1,1),y.genMipmaps&&(E.mipmask=(E.width<<1)-1),g.mipmask=E.mipmask,F(g,E),i.texture2D(y,E,d),g.internalformat=E.internalformat,se.width=E.width,se.height=E.height,gr(g),Je(E,Zr),lr(y,Zr),je(),cr(E),R.profile&&(g.stats.size=Nn(g.internalformat,g.type,E.width,E.height,y.genMipmaps,!1)),se.format=$[g.internalformat],se.type=ie[g.type],se.mag=M[y.magFilter],se.min=ne[y.minFilter],se.wrapS=re[y.wrapS],se.wrapT=re[y.wrapT],se}function Le(t,h,y,E){i(!!t,"must specify image data");var v=h|0,m=y|0,p=E|0,o=te();return F(o,g),o.width=0,o.height=0,J(o,t),o.width=o.width||(g.width>>p)-v,o.height=o.height||(g.height>>p)-m,i(g.type===o.type&&g.format===o.format&&g.internalformat===o.internalformat,"incompatible format for texture.subimage"),i(v>=0&&m>=0&&v+o.width<=g.width&&m+o.height<=g.height,"texture.subimage write out of bounds"),i(g.mipmask&1<<p,"missing mipmap data"),i(o.data||o.element||o.needsCopy,"missing image data"),gr(g),ge(o,Zr,v,m,p),je(),ae(o),se}function f(t,h){var y=t|0,E=h|0||y;if(y===g.width&&E===g.height)return se;se.width=g.width=y,se.height=g.height=E,gr(g);for(var v=0;g.mipmask>>v;++v){var m=y>>v,p=E>>v;if(!m||!p)break;e.texImage2D(Zr,v,g.format,m,p,0,g.format,g.type,null)}return je(),R.profile&&(g.stats.size=Nn(g.internalformat,g.type,y,E,!1,!1)),se}return se(c,w),se.subimage=Le,se.resize=f,se._reglType="texture2d",se._texture=g,R.profile&&(se.stats=g.stats),se.destroy=function(){g.decRef()},se}function Ne(c,w,g,se,Le,f){var t=new Se(ba);yr[t.id]=t,T.cubeCount++;var h=new Array(6);function y(m,p,o,l,u,x){var A,C=t.texInfo;for(Qe.call(C),A=0;A<6;++A)h[A]=Ce();if(typeof m=="number"||!m){var N=m|0||1;for(A=0;A<6;++A)Te(h[A],N,N)}else if(typeof m=="object")if(p)Re(h[0],m),Re(h[1],p),Re(h[2],o),Re(h[3],l),Re(h[4],u),Re(h[5],x);else if(sr(C,m),ue(t,m),"faces"in m){var Q=m.faces;for(i(Array.isArray(Q)&&Q.length===6,"cube faces must be a length 6 array"),A=0;A<6;++A)i(typeof Q[A]=="object"&&!!Q[A],"invalid input for cube map face"),F(h[A],t),Re(h[A],Q[A])}else for(A=0;A<6;++A)Re(h[A],m);else i.raise("invalid arguments to cube map");for(F(t,h[0]),i.optional(function(){d.npotTextureCube||i(Ii(t.width)&&Ii(t.height),"your browser does not support non power or two texture dimensions")}),C.genMipmaps?t.mipmask=(h[0].width<<1)-1:t.mipmask=h[0].mipmask,i.textureCube(t,C,h,d),t.internalformat=h[0].internalformat,y.width=h[0].width,y.height=h[0].height,gr(t),A=0;A<6;++A)Je(h[A],In+A);for(lr(C,ba),je(),R.profile&&(t.stats.size=Nn(t.internalformat,t.type,y.width,y.height,C.genMipmaps,!0)),y.format=$[t.internalformat],y.type=ie[t.type],y.mag=M[C.magFilter],y.min=ne[C.minFilter],y.wrapS=re[C.wrapS],y.wrapT=re[C.wrapT],A=0;A<6;++A)cr(h[A]);return y}function E(m,p,o,l,u){i(!!p,"must specify image data"),i(typeof m=="number"&&m===(m|0)&&m>=0&&m<6,"invalid face");var x=o|0,A=l|0,C=u|0,N=te();return F(N,t),N.width=0,N.height=0,J(N,p),N.width=N.width||(t.width>>C)-x,N.height=N.height||(t.height>>C)-A,i(t.type===N.type&&t.format===N.format&&t.internalformat===N.internalformat,"incompatible format for texture.subimage"),i(x>=0&&A>=0&&x+N.width<=t.width&&A+N.height<=t.height,"texture.subimage write out of bounds"),i(t.mipmask&1<<C,"missing mipmap data"),i(N.data||N.element||N.needsCopy,"missing image data"),gr(t),ge(N,In+m,x,A,C),je(),ae(N),y}function v(m){var p=m|0;if(p!==t.width){y.width=t.width=p,y.height=t.height=p,gr(t);for(var o=0;o<6;++o)for(var l=0;t.mipmask>>l;++l)e.texImage2D(In+o,l,t.format,p>>l,p>>l,0,t.format,t.type,null);return je(),R.profile&&(t.stats.size=Nn(t.internalformat,t.type,y.width,y.height,!1,!0)),y}}return y(c,w,g,se,Le,f),y.subimage=E,y.resize=v,y._reglType="textureCube",y._texture=t,R.profile&&(y.stats=t.stats),y.destroy=function(){t.decRef()},y}function tr(){for(var c=0;c<xr;++c)e.activeTexture(un+c),e.bindTexture(Zr,null),rr[c]=null;jr(yr).forEach(pe),T.cubeCount=0,T.textureCount=0}R.profile&&(T.getTotalTextureSize=function(){var c=0;return Object.keys(yr).forEach(function(w){c+=yr[w].stats.size}),c});function et(){for(var c=0;c<xr;++c){var w=rr[c];w&&(w.bindCount=0,w.unit=-1,rr[c]=null)}jr(yr).forEach(function(g){g.texture=e.createTexture(),e.bindTexture(g.target,g.texture);for(var se=0;se<32;++se)if(g.mipmask&1<<se)if(g.target===Zr)e.texImage2D(Zr,se,g.internalformat,g.width>>se,g.height>>se,0,g.internalformat,g.type,null);else for(var Le=0;Le<6;++Le)e.texImage2D(In+Le,se,g.internalformat,g.width>>se,g.height>>se,0,g.internalformat,g.type,null);lr(g.texInfo,g.target)})}function Gt(){for(var c=0;c<xr;++c){var w=rr[c];w&&(w.bindCount=0,w.unit=-1,rr[c]=null),e.activeTexture(un+c),e.bindTexture(Zr,null),e.bindTexture(ba,null)}}return{create2D:Ie,createCube:Ne,clear:tr,getTexture:function(c){return null},restore:et,refresh:Gt}}var mt=36161,Pn=32854,nf=32855,af=36194,ff=33189,of=36168,sf=34041,uf=35907,cf=34836,lf=34842,df=34843,Kr=[];Kr[Pn]=2,Kr[nf]=2,Kr[af]=2,Kr[ff]=2,Kr[of]=1,Kr[sf]=4,Kr[uf]=4,Kr[cf]=16,Kr[lf]=8,Kr[df]=6;function hf(e,a,d){return Kr[e]*a*d}var xu=function(e,a,d,S,G){var T={rgba4:Pn,rgb565:af,"rgb5 a1":nf,depth:ff,stencil:of,"depth stencil":sf};a.ext_srgb&&(T.srgba=uf),a.ext_color_buffer_half_float&&(T.rgba16f=lf,T.rgb16f=df),a.webgl_color_buffer_float&&(T.rgba32f=cf);var R=[];Object.keys(T).forEach(function(X){var z=T[X];R[z]=X});var V=0,j={};function Y(X){this.id=V++,this.refCount=1,this.renderbuffer=X,this.format=Pn,this.width=0,this.height=0,G.profile&&(this.stats={size:0})}Y.prototype.decRef=function(){--this.refCount<=0&&q(this)};function q(X){var z=X.renderbuffer;i(z,"must not double destroy renderbuffer"),e.bindRenderbuffer(mt,null),e.deleteRenderbuffer(z),X.renderbuffer=null,X.refCount=0,delete j[X.id],S.renderbufferCount--}function W(X,z){var _=new Y(e.createRenderbuffer());j[_.id]=_,S.renderbufferCount++;function O(ie,M){var ne=0,re=0,me=Pn;if(typeof ie=="object"&&ie){var D=ie;if("shape"in D){var F=D.shape;i(Array.isArray(F)&&F.length>=2,"invalid renderbuffer shape"),ne=F[0]|0,re=F[1]|0}else"radius"in D&&(ne=re=D.radius|0),"width"in D&&(ne=D.width|0),"height"in D&&(re=D.height|0);"format"in D&&(i.parameter(D.format,T,"invalid renderbuffer format"),me=T[D.format])}else typeof ie=="number"?(ne=ie|0,typeof M=="number"?re=M|0:re=ne):ie?i.raise("invalid arguments to renderbuffer constructor"):ne=re=1;if(i(ne>0&&re>0&&ne<=d.maxRenderbufferSize&&re<=d.maxRenderbufferSize,"invalid renderbuffer size"),!(ne===_.width&&re===_.height&&me===_.format))return O.width=_.width=ne,O.height=_.height=re,_.format=me,e.bindRenderbuffer(mt,_.renderbuffer),e.renderbufferStorage(mt,me,ne,re),i(e.getError()===0,"invalid render buffer format"),G.profile&&(_.stats.size=hf(_.format,_.width,_.height)),O.format=R[_.format],O}function $(ie,M){var ne=ie|0,re=M|0||ne;return ne===_.width&&re===_.height||(i(ne>0&&re>0&&ne<=d.maxRenderbufferSize&&re<=d.maxRenderbufferSize,"invalid renderbuffer size"),O.width=_.width=ne,O.height=_.height=re,e.bindRenderbuffer(mt,_.renderbuffer),e.renderbufferStorage(mt,_.format,ne,re),i(e.getError()===0,"invalid render buffer format"),G.profile&&(_.stats.size=hf(_.format,_.width,_.height))),O}return O(X,z),O.resize=$,O._reglType="renderbuffer",O._renderbuffer=_,G.profile&&(O.stats=_.stats),O.destroy=function(){_.decRef()},O}G.profile&&(S.getTotalRenderbufferSize=function(){var X=0;return Object.keys(j).forEach(function(z){X+=j[z].stats.size}),X});function K(){jr(j).forEach(function(X){X.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(mt,X.renderbuffer),e.renderbufferStorage(mt,X.format,X.width,X.height)}),e.bindRenderbuffer(mt,null)}return{create:W,clear:function(){jr(j).forEach(q)},restore:K}},at=36160,Da=36161,Lt=3553,kn=34069,mf=36064,vf=36096,pf=36128,bf=33306,yf=36053,gu=36054,Tu=36055,Su=36057,wu=36061,Lu=36193,Ou=5121,Ru=5126,_f=6407,Ef=6408,Iu=6402,Cu=[_f,Ef],Ba=[];Ba[Ef]=4,Ba[_f]=3;var Mn=[];Mn[Ou]=1,Mn[Ru]=4,Mn[Lu]=2;var Fu=32854,Gu=32855,Du=36194,Bu=33189,Nu=36168,Af=34041,Pu=35907,ku=34836,Mu=34842,Uu=34843,ju=[Fu,Gu,Du,Pu,Mu,Uu,ku],qt={};qt[yf]="complete",qt[gu]="incomplete attachment",qt[Su]="incomplete dimensions",qt[Tu]="incomplete, missing attachment",qt[wu]="unsupported";function Vu(e,a,d,S,G,T){var R={cur:null,next:null,dirty:!1,setFBO:null},V=["rgba"],j=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&j.push("srgba"),a.ext_color_buffer_half_float&&j.push("rgba16f","rgb16f"),a.webgl_color_buffer_float&&j.push("rgba32f");var Y=["uint8"];a.oes_texture_half_float&&Y.push("half float","float16"),a.oes_texture_float&&Y.push("float","float32");function q(H,J,ee){this.target=H,this.texture=J,this.renderbuffer=ee;var ge=0,Ae=0;J?(ge=J.width,Ae=J.height):ee&&(ge=ee.width,Ae=ee.height),this.width=ge,this.height=Ae}function W(H){H&&(H.texture&&H.texture._texture.decRef(),H.renderbuffer&&H.renderbuffer._renderbuffer.decRef())}function K(H,J,ee){if(H)if(H.texture){var ge=H.texture._texture,Ae=Math.max(1,ge.width),te=Math.max(1,ge.height);i(Ae===J&&te===ee,"inconsistent width/height for supplied texture"),ge.refCount+=1}else{var ae=H.renderbuffer._renderbuffer;i(ae.width===J&&ae.height===ee,"inconsistent width/height for renderbuffer"),ae.refCount+=1}}function X(H,J){J&&(J.texture?e.framebufferTexture2D(at,H,J.target,J.texture._texture.texture,0):e.framebufferRenderbuffer(at,H,Da,J.renderbuffer._renderbuffer.renderbuffer))}function z(H){var J=Lt,ee=null,ge=null,Ae=H;typeof H=="object"&&(Ae=H.data,"target"in H&&(J=H.target|0)),i.type(Ae,"function","invalid attachment data");var te=Ae._reglType;return te==="texture2d"?(ee=Ae,i(J===Lt)):te==="textureCube"?(ee=Ae,i(J>=kn&&J<kn+6,"invalid cube map target")):te==="renderbuffer"?(ge=Ae,J=Da):i.raise("invalid regl object for attachment"),new q(J,ee,ge)}function _(H,J,ee,ge,Ae){if(ee){var te=S.create2D({width:H,height:J,format:ge,type:Ae});return te._texture.refCount=0,new q(Lt,te,null)}else{var ae=G.create({width:H,height:J,format:ge});return ae._renderbuffer.refCount=0,new q(Da,null,ae)}}function O(H){return H&&(H.texture||H.renderbuffer)}function $(H,J,ee){H&&(H.texture?H.texture.resize(J,ee):H.renderbuffer&&H.renderbuffer.resize(J,ee),H.width=J,H.height=ee)}var ie=0,M={};function ne(){this.id=ie++,M[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function re(H){H.colorAttachments.forEach(W),W(H.depthAttachment),W(H.stencilAttachment),W(H.depthStencilAttachment)}function me(H){var J=H.framebuffer;i(J,"must not double destroy framebuffer"),e.deleteFramebuffer(J),H.framebuffer=null,T.framebufferCount--,delete M[H.id]}function D(H){var J;e.bindFramebuffer(at,H.framebuffer);var ee=H.colorAttachments;for(J=0;J<ee.length;++J)X(mf+J,ee[J]);for(J=ee.length;J<d.maxColorAttachments;++J)e.framebufferTexture2D(at,mf+J,Lt,null,0);e.framebufferTexture2D(at,bf,Lt,null,0),e.framebufferTexture2D(at,vf,Lt,null,0),e.framebufferTexture2D(at,pf,Lt,null,0),X(vf,H.depthAttachment),X(pf,H.stencilAttachment),X(bf,H.depthStencilAttachment);var ge=e.checkFramebufferStatus(at);!e.isContextLost()&&ge!==yf&&i.raise("framebuffer configuration not supported, status = "+qt[ge]),e.bindFramebuffer(at,R.next?R.next.framebuffer:null),R.cur=R.next,e.getError()}function F(H,J){var ee=new ne;T.framebufferCount++;function ge(te,ae){var be;i(R.next!==ee,"can not update framebuffer which is currently in use");var Te=0,Re=0,Je=!0,er=!0,Ce=null,cr=!0,Qe="rgba",sr="uint8",lr=1,dr=null,yr=null,xr=null,rr=!1;if(typeof te=="number")Te=te|0,Re=ae|0||Te;else if(!te)Te=Re=1;else{i.type(te,"object","invalid arguments for framebuffer");var Se=te;if("shape"in Se){var gr=Se.shape;i(Array.isArray(gr)&&gr.length>=2,"invalid shape for framebuffer"),Te=gr[0],Re=gr[1]}else"radius"in Se&&(Te=Re=Se.radius),"width"in Se&&(Te=Se.width),"height"in Se&&(Re=Se.height);("color"in Se||"colors"in Se)&&(Ce=Se.color||Se.colors,Array.isArray(Ce)&&i(Ce.length===1||a.webgl_draw_buffers,"multiple render targets not supported")),Ce||("colorCount"in Se&&(lr=Se.colorCount|0,i(lr>0,"invalid color buffer count")),"colorTexture"in Se&&(cr=!!Se.colorTexture,Qe="rgba4"),"colorType"in Se&&(sr=Se.colorType,cr?(i(a.oes_texture_float||!(sr==="float"||sr==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),i(a.oes_texture_half_float||!(sr==="half float"||sr==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):sr==="half float"||sr==="float16"?(i(a.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Qe="rgba16f"):(sr==="float"||sr==="float32")&&(i(a.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Qe="rgba32f"),i.oneOf(sr,Y,"invalid color type")),"colorFormat"in Se&&(Qe=Se.colorFormat,V.indexOf(Qe)>=0?cr=!0:j.indexOf(Qe)>=0?cr=!1:i.optional(function(){cr?i.oneOf(Se.colorFormat,V,"invalid color format for texture"):i.oneOf(Se.colorFormat,j,"invalid color format for renderbuffer")}))),("depthTexture"in Se||"depthStencilTexture"in Se)&&(rr=!!(Se.depthTexture||Se.depthStencilTexture),i(!rr||a.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Se&&(typeof Se.depth=="boolean"?Je=Se.depth:(dr=Se.depth,er=!1)),"stencil"in Se&&(typeof Se.stencil=="boolean"?er=Se.stencil:(yr=Se.stencil,Je=!1)),"depthStencil"in Se&&(typeof Se.depthStencil=="boolean"?Je=er=Se.depthStencil:(xr=Se.depthStencil,Je=!1,er=!1))}var je=null,pe=null,Ie=null,Ne=null;if(Array.isArray(Ce))je=Ce.map(z);else if(Ce)je=[z(Ce)];else for(je=new Array(lr),be=0;be<lr;++be)je[be]=_(Te,Re,cr,Qe,sr);i(a.webgl_draw_buffers||je.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),i(je.length<=d.maxColorAttachments,"too many color attachments, not supported"),Te=Te||je[0].width,Re=Re||je[0].height,dr?pe=z(dr):Je&&!er&&(pe=_(Te,Re,rr,"depth","uint32")),yr?Ie=z(yr):er&&!Je&&(Ie=_(Te,Re,!1,"stencil","uint8")),xr?Ne=z(xr):!dr&&!yr&&er&&Je&&(Ne=_(Te,Re,rr,"depth stencil","depth stencil")),i(!!dr+!!yr+!!xr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var tr=null;for(be=0;be<je.length;++be)if(K(je[be],Te,Re),i(!je[be]||je[be].texture&&Cu.indexOf(je[be].texture._texture.format)>=0||je[be].renderbuffer&&ju.indexOf(je[be].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+be+" is invalid"),je[be]&&je[be].texture){var et=Ba[je[be].texture._texture.format]*Mn[je[be].texture._texture.type];tr===null?tr=et:i(tr===et,"all color attachments much have the same number of bits per pixel.")}return K(pe,Te,Re),i(!pe||pe.texture&&pe.texture._texture.format===Iu||pe.renderbuffer&&pe.renderbuffer._renderbuffer.format===Bu,"invalid depth attachment for framebuffer object"),K(Ie,Te,Re),i(!Ie||Ie.renderbuffer&&Ie.renderbuffer._renderbuffer.format===Nu,"invalid stencil attachment for framebuffer object"),K(Ne,Te,Re),i(!Ne||Ne.texture&&Ne.texture._texture.format===Af||Ne.renderbuffer&&Ne.renderbuffer._renderbuffer.format===Af,"invalid depth-stencil attachment for framebuffer object"),re(ee),ee.width=Te,ee.height=Re,ee.colorAttachments=je,ee.depthAttachment=pe,ee.stencilAttachment=Ie,ee.depthStencilAttachment=Ne,ge.color=je.map(O),ge.depth=O(pe),ge.stencil=O(Ie),ge.depthStencil=O(Ne),ge.width=ee.width,ge.height=ee.height,D(ee),ge}function Ae(te,ae){i(R.next!==ee,"can not resize a framebuffer which is currently in use");var be=Math.max(te|0,1),Te=Math.max(ae|0||be,1);if(be===ee.width&&Te===ee.height)return ge;for(var Re=ee.colorAttachments,Je=0;Je<Re.length;++Je)$(Re[Je],be,Te);return $(ee.depthAttachment,be,Te),$(ee.stencilAttachment,be,Te),$(ee.depthStencilAttachment,be,Te),ee.width=ge.width=be,ee.height=ge.height=Te,D(ee),ge}return ge(H,J),b(ge,{resize:Ae,_reglType:"framebuffer",_framebuffer:ee,destroy:function(){me(ee),re(ee)},use:function(te){R.setFBO({framebuffer:ge},te)}})}function ue(H){var J=Array(6);function ee(Ae){var te;i(J.indexOf(R.next)<0,"can not update framebuffer which is currently in use");var ae={color:null},be=0,Te=null,Re="rgba",Je="uint8",er=1;if(typeof Ae=="number")be=Ae|0;else if(!Ae)be=1;else{i.type(Ae,"object","invalid arguments for framebuffer");var Ce=Ae;if("shape"in Ce){var cr=Ce.shape;i(Array.isArray(cr)&&cr.length>=2,"invalid shape for framebuffer"),i(cr[0]===cr[1],"cube framebuffer must be square"),be=cr[0]}else"radius"in Ce&&(be=Ce.radius|0),"width"in Ce?(be=Ce.width|0,"height"in Ce&&i(Ce.height===be,"must be square")):"height"in Ce&&(be=Ce.height|0);("color"in Ce||"colors"in Ce)&&(Te=Ce.color||Ce.colors,Array.isArray(Te)&&i(Te.length===1||a.webgl_draw_buffers,"multiple render targets not supported")),Te||("colorCount"in Ce&&(er=Ce.colorCount|0,i(er>0,"invalid color buffer count")),"colorType"in Ce&&(i.oneOf(Ce.colorType,Y,"invalid color type"),Je=Ce.colorType),"colorFormat"in Ce&&(Re=Ce.colorFormat,i.oneOf(Ce.colorFormat,V,"invalid color format for texture"))),"depth"in Ce&&(ae.depth=Ce.depth),"stencil"in Ce&&(ae.stencil=Ce.stencil),"depthStencil"in Ce&&(ae.depthStencil=Ce.depthStencil)}var Qe;if(Te)if(Array.isArray(Te))for(Qe=[],te=0;te<Te.length;++te)Qe[te]=Te[te];else Qe=[Te];else{Qe=Array(er);var sr={radius:be,format:Re,type:Je};for(te=0;te<er;++te)Qe[te]=S.createCube(sr)}for(ae.color=Array(Qe.length),te=0;te<Qe.length;++te){var lr=Qe[te];i(typeof lr=="function"&&lr._reglType==="textureCube","invalid cube map"),be=be||lr.width,i(lr.width===be&&lr.height===be,"invalid cube map shape"),ae.color[te]={target:kn,data:Qe[te]}}for(te=0;te<6;++te){for(var dr=0;dr<Qe.length;++dr)ae.color[dr].target=kn+te;te>0&&(ae.depth=J[0].depth,ae.stencil=J[0].stencil,ae.depthStencil=J[0].depthStencil),J[te]?J[te](ae):J[te]=F(ae)}return b(ee,{width:be,height:be,color:Qe})}function ge(Ae){var te,ae=Ae|0;if(i(ae>0&&ae<=d.maxCubeMapSize,"invalid radius for cube fbo"),ae===ee.width)return ee;var be=ee.color;for(te=0;te<be.length;++te)be[te].resize(ae);for(te=0;te<6;++te)J[te].resize(ae);return ee.width=ee.height=ae,ee}return ee(H),b(ee,{faces:J,resize:ge,_reglType:"framebufferCube",destroy:function(){J.forEach(function(Ae){Ae.destroy()})}})}function Z(){R.cur=null,R.next=null,R.dirty=!0,jr(M).forEach(function(H){H.framebuffer=e.createFramebuffer(),D(H)})}return b(R,{getFramebuffer:function(H){if(typeof H=="function"&&H._reglType==="framebuffer"){var J=H._framebuffer;if(J instanceof ne)return J}return null},create:F,createCube:ue,clear:function(){jr(M).forEach(me)},restore:Z})}var Xu=5126,xf=34962,Un=34963,gf=["attributes","elements","offset","count","primitive","instances"];function Na(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Xu,this.offset=0,this.stride=0,this.divisor=0}function Hu(e,a,d,S,G,T,R){for(var V=d.maxAttributes,j=new Array(V),Y=0;Y<V;++Y)j[Y]=new Na;var q=0,W={},K={Record:Na,scope:{},state:j,currentVAO:null,targetVAO:null,restore:z()?re:function(){},createVAO:me,getVAO:O,destroyBuffer:X,setVAO:z()?$:ie,clear:z()?M:function(){}};function X(D){for(var F=0;F<j.length;++F){var ue=j[F];ue.buffer===D&&(e.disableVertexAttribArray(F),ue.buffer=null)}}function z(){return a.oes_vertex_array_object}function _(){return a.angle_instanced_arrays}function O(D){return typeof D=="function"&&D._vao?D._vao:null}function $(D){if(D!==K.currentVAO){var F=z();D?F.bindVertexArrayOES(D.vao):F.bindVertexArrayOES(null),K.currentVAO=D}}function ie(D){if(D!==K.currentVAO){if(D)D.bindAttrs();else{for(var F=_(),ue=0;ue<j.length;++ue){var Z=j[ue];Z.buffer?(e.enableVertexAttribArray(ue),Z.buffer.bind(),e.vertexAttribPointer(ue,Z.size,Z.type,Z.normalized,Z.stride,Z.offfset),F&&Z.divisor&&F.vertexAttribDivisorANGLE(ue,Z.divisor)):(e.disableVertexAttribArray(ue),e.vertexAttrib4f(ue,Z.x,Z.y,Z.z,Z.w))}R.elements?e.bindBuffer(Un,R.elements.buffer.buffer):e.bindBuffer(Un,null)}K.currentVAO=D}}function M(){jr(W).forEach(function(D){D.destroy()})}function ne(){this.id=++q,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var D=z();D?this.vao=D.createVertexArrayOES():this.vao=null,W[this.id]=this,this.buffers=[]}ne.prototype.bindAttrs=function(){for(var D=_(),F=this.attributes,ue=0;ue<F.length;++ue){var Z=F[ue];Z.buffer?(e.enableVertexAttribArray(ue),e.bindBuffer(xf,Z.buffer.buffer),e.vertexAttribPointer(ue,Z.size,Z.type,Z.normalized,Z.stride,Z.offset),D&&Z.divisor&&D.vertexAttribDivisorANGLE(ue,Z.divisor)):(e.disableVertexAttribArray(ue),e.vertexAttrib4f(ue,Z.x,Z.y,Z.z,Z.w))}for(var H=F.length;H<V;++H)e.disableVertexAttribArray(H);var J=T.getElements(this.elements);J?e.bindBuffer(Un,J.buffer.buffer):e.bindBuffer(Un,null)},ne.prototype.refresh=function(){var D=z();D&&(D.bindVertexArrayOES(this.vao),this.bindAttrs(),K.currentVAO=null,D.bindVertexArrayOES(null))},ne.prototype.destroy=function(){if(this.vao){var D=z();this===K.currentVAO&&(K.currentVAO=null,D.bindVertexArrayOES(null)),D.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),W[this.id]&&(delete W[this.id],S.vaoCount-=1)};function re(){var D=z();D&&jr(W).forEach(function(F){F.refresh()})}function me(D){var F=new ne;S.vaoCount+=1;function ue(Z){var H;if(Array.isArray(Z))H=Z,F.elements&&F.ownsElements&&F.elements.destroy(),F.elements=null,F.ownsElements=!1,F.offset=0,F.count=0,F.instances=-1,F.primitive=4;else{if(i(typeof Z=="object","invalid arguments for create vao"),i("attributes"in Z,"must specify attributes for vao"),Z.elements){var J=Z.elements;F.ownsElements?typeof J=="function"&&J._reglType==="elements"?(F.elements.destroy(),F.ownsElements=!1):(F.elements(J),F.ownsElements=!1):T.getElements(Z.elements)?(F.elements=Z.elements,F.ownsElements=!1):(F.elements=T.create(Z.elements),F.ownsElements=!0)}else F.elements=null,F.ownsElements=!1;H=Z.attributes,F.offset=0,F.count=-1,F.instances=-1,F.primitive=4,F.elements&&(F.count=F.elements._elements.vertCount,F.primitive=F.elements._elements.primType),"offset"in Z&&(F.offset=Z.offset|0),"count"in Z&&(F.count=Z.count|0),"instances"in Z&&(F.instances=Z.instances|0),"primitive"in Z&&(i(Z.primitive in ht,"bad primitive type: "+Z.primitive),F.primitive=ht[Z.primitive]),i.optional(()=>{for(var Je=Object.keys(Z),er=0;er<Je.length;++er)i(gf.indexOf(Je[er])>=0,'invalid option for vao: "'+Je[er]+'" valid options are '+gf)}),i(Array.isArray(H),"attributes must be an array")}i(H.length<V,"too many attributes"),i(H.length>0,"must specify at least one attribute");var ee={},ge=F.attributes;ge.length=H.length;for(var Ae=0;Ae<H.length;++Ae){var te=H[Ae],ae=ge[Ae]=new Na,be=te.data||te;if(Array.isArray(be)||s(be)||Qr(be)){var Te;F.buffers[Ae]&&(Te=F.buffers[Ae],s(be)&&Te._buffer.byteLength>=be.byteLength?Te.subdata(be):(Te.destroy(),F.buffers[Ae]=null)),F.buffers[Ae]||(Te=F.buffers[Ae]=G.create(te,xf,!1,!0)),ae.buffer=G.getBuffer(Te),ae.size=ae.buffer.dimension|0,ae.normalized=!1,ae.type=ae.buffer.dtype,ae.offset=0,ae.stride=0,ae.divisor=0,ae.state=1,ee[Ae]=1}else G.getBuffer(te)?(ae.buffer=G.getBuffer(te),ae.size=ae.buffer.dimension|0,ae.normalized=!1,ae.type=ae.buffer.dtype,ae.offset=0,ae.stride=0,ae.divisor=0,ae.state=1):G.getBuffer(te.buffer)?(ae.buffer=G.getBuffer(te.buffer),ae.size=(+te.size||ae.buffer.dimension)|0,ae.normalized=!!te.normalized||!1,"type"in te?(i.parameter(te.type,gt,"invalid buffer type"),ae.type=gt[te.type]):ae.type=ae.buffer.dtype,ae.offset=(te.offset||0)|0,ae.stride=(te.stride||0)|0,ae.divisor=(te.divisor||0)|0,ae.state=1,i(ae.size>=1&&ae.size<=4,"size must be between 1 and 4"),i(ae.offset>=0,"invalid offset"),i(ae.stride>=0&&ae.stride<=255,"stride must be between 0 and 255"),i(ae.divisor>=0,"divisor must be positive"),i(!ae.divisor||!!a.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in te?(i(Ae>0,"first attribute must not be a constant"),ae.x=+te.x||0,ae.y=+te.y||0,ae.z=+te.z||0,ae.w=+te.w||0,ae.state=2):i(!1,"invalid attribute spec for location "+Ae)}for(var Re=0;Re<F.buffers.length;++Re)!ee[Re]&&F.buffers[Re]&&(F.buffers[Re].destroy(),F.buffers[Re]=null);return F.refresh(),ue}return ue.destroy=function(){for(var Z=0;Z<F.buffers.length;++Z)F.buffers[Z]&&F.buffers[Z].destroy();F.buffers.length=0,F.ownsElements&&(F.elements.destroy(),F.elements=null,F.ownsElements=!1),F.destroy()},ue._vao=F,ue._reglType="vao",ue(D)}return K}var Tf=35632,$u=35633,zu=35718,Yu=35721;function Wu(e,a,d,S){var G={},T={};function R(_,O,$,ie){this.name=_,this.id=O,this.location=$,this.info=ie}function V(_,O){for(var $=0;$<_.length;++$)if(_[$].id===O.id){_[$].location=O.location;return}_.push(O)}function j(_,O,$){var ie=_===Tf?G:T,M=ie[O];if(!M){var ne=a.str(O);M=e.createShader(_),e.shaderSource(M,ne),e.compileShader(M),i.shaderError(e,M,ne,_,$),ie[O]=M}return M}var Y={},q=[],W=0;function K(_,O){this.id=W++,this.fragId=_,this.vertId=O,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,S.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function X(_,O,$){var ie,M,ne=j(Tf,_.fragId),re=j($u,_.vertId),me=_.program=e.createProgram();if(e.attachShader(me,ne),e.attachShader(me,re),$)for(ie=0;ie<$.length;++ie){var D=$[ie];e.bindAttribLocation(me,D[0],D[1])}e.linkProgram(me),i.linkError(e,me,a.str(_.fragId),a.str(_.vertId),O);var F=e.getProgramParameter(me,zu);S.profile&&(_.stats.uniformsCount=F);var ue=_.uniforms;for(ie=0;ie<F;++ie)if(M=e.getActiveUniform(me,ie),M){if(M.size>1)for(var Z=0;Z<M.size;++Z){var H=M.name.replace("[0]","["+Z+"]");V(ue,new R(H,a.id(H),e.getUniformLocation(me,H),M))}var J=M.name;M.size>1&&(J=J.replace("[0]","")),V(ue,new R(J,a.id(J),e.getUniformLocation(me,J),M))}var ee=e.getProgramParameter(me,Yu);S.profile&&(_.stats.attributesCount=ee);var ge=_.attributes;for(ie=0;ie<ee;++ie)M=e.getActiveAttrib(me,ie),M&&V(ge,new R(M.name,a.id(M.name),e.getAttribLocation(me,M.name),M))}S.profile&&(d.getMaxUniformsCount=function(){var _=0;return q.forEach(function(O){O.stats.uniformsCount>_&&(_=O.stats.uniformsCount)}),_},d.getMaxAttributesCount=function(){var _=0;return q.forEach(function(O){O.stats.attributesCount>_&&(_=O.stats.attributesCount)}),_});function z(){G={},T={};for(var _=0;_<q.length;++_)X(q[_],null,q[_].attributes.map(function(O){return[O.location,O.name]}))}return{clear:function(){var _=e.deleteShader.bind(e);jr(G).forEach(_),G={},jr(T).forEach(_),T={},q.forEach(function(O){e.deleteProgram(O.program)}),q.length=0,Y={},d.shaderCount=0},program:function(_,O,$,ie){i.command(_>=0,"missing vertex shader",$),i.command(O>=0,"missing fragment shader",$);var M=Y[O];M||(M=Y[O]={});var ne=M[_];if(ne&&(ne.refCount++,!ie))return ne;var re=new K(O,_);return d.shaderCount++,X(re,$,ie),ne||(M[_]=re),q.push(re),b(re,{destroy:function(){if(re.refCount--,re.refCount<=0){e.deleteProgram(re.program);var me=q.indexOf(re);q.splice(me,1),d.shaderCount--}M[re.vertId].refCount<=0&&(e.deleteShader(T[re.vertId]),delete T[re.vertId],delete Y[re.fragId][re.vertId]),Object.keys(Y[re.fragId]).length||(e.deleteShader(G[re.fragId]),delete G[re.fragId],delete Y[re.fragId])}})},restore:z,shader:j,frag:-1,vert:-1}}var qu=6408,cn=5121,Qu=3333,jn=5126;function Ku(e,a,d,S,G,T,R){function V(q){var W;a.next===null?(i(G.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),W=cn):(i(a.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),W=a.next.colorAttachments[0].texture._texture.type,i.optional(function(){T.oes_texture_float?(i(W===cn||W===jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),W===jn&&i(R.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):i(W===cn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var K=0,X=0,z=S.framebufferWidth,_=S.framebufferHeight,O=null;s(q)?O=q:q&&(i.type(q,"object","invalid arguments to regl.read()"),K=q.x|0,X=q.y|0,i(K>=0&&K<S.framebufferWidth,"invalid x offset for regl.read"),i(X>=0&&X<S.framebufferHeight,"invalid y offset for regl.read"),z=(q.width||S.framebufferWidth-K)|0,_=(q.height||S.framebufferHeight-X)|0,O=q.data||null),O&&(W===cn?i(O instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):W===jn&&i(O instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),i(z>0&&z+K<=S.framebufferWidth,"invalid width for read pixels"),i(_>0&&_+X<=S.framebufferHeight,"invalid height for read pixels"),d();var $=z*_*4;return O||(W===cn?O=new Uint8Array($):W===jn&&(O=O||new Float32Array($))),i.isTypedArray(O,"data buffer for regl.read() must be a typedarray"),i(O.byteLength>=$,"data buffer for regl.read() too small"),e.pixelStorei(Qu,4),e.readPixels(K,X,z,_,qu,W,O),O}function j(q){var W;return a.setFBO({framebuffer:q.framebuffer},function(){W=V(q)}),W}function Y(q){return!q||!("framebuffer"in q)?V(q):j(q)}return Y}function Qt(e){return Array.prototype.slice.call(e)}function Kt(e){return Qt(e).join("")}function Zu(){var e=0,a=[],d=[];function S(W){for(var K=0;K<d.length;++K)if(d[K]===W)return a[K];var X="g"+e++;return a.push(X),d.push(W),X}function G(){var W=[];function K(){W.push.apply(W,Qt(arguments))}var X=[];function z(){var _="v"+e++;return X.push(_),arguments.length>0&&(W.push(_,"="),W.push.apply(W,Qt(arguments)),W.push(";")),_}return b(K,{def:z,toString:function(){return Kt([X.length>0?"var "+X.join(",")+";":"",Kt(W)])}})}function T(){var W=G(),K=G(),X=W.toString,z=K.toString;function _(O,$){K(O,$,"=",W.def(O,$),";")}return b(function(){W.apply(W,Qt(arguments))},{def:W.def,entry:W,exit:K,save:_,set:function(O,$,ie){_(O,$),W(O,$,"=",ie,";")},toString:function(){return X()+z()}})}function R(){var W=Kt(arguments),K=T(),X=T(),z=K.toString,_=X.toString;return b(K,{then:function(){return K.apply(K,Qt(arguments)),this},else:function(){return X.apply(X,Qt(arguments)),this},toString:function(){var O=_();return O&&(O="else{"+O+"}"),Kt(["if(",W,"){",z(),"}",O])}})}var V=G(),j={};function Y(W,K){var X=[];function z(){var M="a"+X.length;return X.push(M),M}K=K||0;for(var _=0;_<K;++_)z();var O=T(),$=O.toString,ie=j[W]=b(O,{arg:z,toString:function(){return Kt(["function(",X.join(),"){",$(),"}"])}});return ie}function q(){var W=['"use strict";',V,"return {"];Object.keys(j).forEach(function(z){W.push('"',z,'":',j[z].toString(),",")}),W.push("}");var K=Kt(W).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),X=Function.apply(null,a.concat(K));return X.apply(null,d)}return{global:V,link:S,block:G,proc:Y,scope:T,cond:R,compile:q}}var Zt="xyzw".split(""),Sf=5121,Jt=1,Pa=2,ka=0,Ma=1,Ua=2,ja=3,Vn=4,wf=5,Lf=6,Of="dither",Rf="blend.enable",If="blend.color",Va="blend.equation",Xa="blend.func",Cf="depth.enable",Ff="depth.func",Gf="depth.range",Df="depth.mask",Ha="colorMask",Bf="cull.enable",Nf="cull.face",$a="frontFace",za="lineWidth",Pf="polygonOffset.enable",Ya="polygonOffset.offset",kf="sample.alpha",Mf="sample.enable",Wa="sample.coverage",Uf="stencil.enable",jf="stencil.mask",qa="stencil.func",Qa="stencil.opFront",ln="stencil.opBack",Vf="scissor.enable",Xn="scissor.box",it="viewport",dn="profile",Ot="framebuffer",hn="vert",mn="frag",Rt="elements",It="primitive",Ct="count",Hn="offset",$n="instances",vn="vao",Ka="Width",Za="Height",en=Ot+Ka,rn=Ot+Za,Ju=it+Ka,ec=it+Za,Xf="drawingBuffer",Hf=Xf+Ka,$f=Xf+Za,rc=[Xa,Va,qa,Qa,ln,Wa,it,Xn,Ya],tn=34962,Ja=34963,tc=35632,nc=35633,zf=3553,ac=34067,ic=2884,fc=3042,oc=3024,sc=2960,uc=2929,cc=3089,lc=32823,dc=32926,hc=32928,ei=5126,zn=35664,Yn=35665,Wn=35666,ri=5124,qn=35667,Qn=35668,Kn=35669,ti=35670,Zn=35671,Jn=35672,ea=35673,pn=35674,bn=35675,yn=35676,_n=35678,En=35680,ni=4,An=1028,Ft=1029,Yf=2304,ai=2305,mc=32775,vc=32776,pc=519,vt=7680,Wf=0,qf=1,Qf=32774,bc=513,Kf=36160,yc=36064,Jr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Zf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],nn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},pt={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Jf={frag:tc,vert:nc},ii={cw:Yf,ccw:ai};function ra(e){return Array.isArray(e)||s(e)||Qr(e)}function eo(e){return e.sort(function(a,d){return a===it?-1:d===it?1:a<d?-1:1})}function pr(e,a,d,S){this.thisDep=e,this.contextDep=a,this.propDep=d,this.append=S}function bt(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function or(e){return new pr(!1,!1,!1,e)}function Pr(e,a){var d=e.type;if(d===ka){var S=e.data.length;return new pr(!0,S>=1,S>=2,a)}else if(d===Vn){var G=e.data;return new pr(G.thisDep,G.contextDep,G.propDep,a)}else{if(d===wf)return new pr(!1,!1,!1,a);if(d===Lf){for(var T=!1,R=!1,V=!1,j=0;j<e.data.length;++j){var Y=e.data[j];if(Y.type===Ma)V=!0;else if(Y.type===Ua)R=!0;else if(Y.type===ja)T=!0;else if(Y.type===ka){T=!0;var q=Y.data;q>=1&&(R=!0),q>=2&&(V=!0)}else Y.type===Vn&&(T=T||Y.data.thisDep,R=R||Y.data.contextDep,V=V||Y.data.propDep)}return new pr(T,R,V,a)}else return new pr(d===ja,d===Ua,d===Ma,a)}}var ro=new pr(!1,!1,!1,function(){});function _c(e,a,d,S,G,T,R,V,j,Y,q,W,K,X,z){var _=Y.Record,O={add:32774,subtract:32778,"reverse subtract":32779};d.ext_blend_minmax&&(O.min=mc,O.max=vc);var $=d.angle_instanced_arrays,ie=d.webgl_draw_buffers,M=d.oes_vertex_array_object,ne={dirty:!0,profile:z.profile},re={},me=[],D={},F={};function ue(f){return f.replace(".","_")}function Z(f,t,h){var y=ue(f);me.push(f),re[y]=ne[y]=!!h,D[y]=t}function H(f,t,h){var y=ue(f);me.push(f),Array.isArray(h)?(ne[y]=h.slice(),re[y]=h.slice()):ne[y]=re[y]=h,F[y]=t}Z(Of,oc),Z(Rf,fc),H(If,"blendColor",[0,0,0,0]),H(Va,"blendEquationSeparate",[Qf,Qf]),H(Xa,"blendFuncSeparate",[qf,Wf,qf,Wf]),Z(Cf,uc,!0),H(Ff,"depthFunc",bc),H(Gf,"depthRange",[0,1]),H(Df,"depthMask",!0),H(Ha,Ha,[!0,!0,!0,!0]),Z(Bf,ic),H(Nf,"cullFace",Ft),H($a,$a,ai),H(za,za,1),Z(Pf,lc),H(Ya,"polygonOffset",[0,0]),Z(kf,dc),Z(Mf,hc),H(Wa,"sampleCoverage",[1,!1]),Z(Uf,sc),H(jf,"stencilMask",-1),H(qa,"stencilFunc",[pc,0,-1]),H(Qa,"stencilOpSeparate",[An,vt,vt,vt]),H(ln,"stencilOpSeparate",[Ft,vt,vt,vt]),Z(Vf,cc),H(Xn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),H(it,it,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var J={gl:e,context:K,strings:a,next:re,current:ne,draw:W,elements:T,buffer:G,shader:q,attributes:Y.state,vao:Y,uniforms:j,framebuffer:V,extensions:d,timer:X,isBufferArgs:ra},ee={primTypes:ht,compareFuncs:nn,blendFuncs:Jr,blendEquations:O,stencilOps:pt,glTypes:gt,orientationType:ii};i.optional(function(){J.isArrayLike=Ze}),ie&&(ee.backBuffer=[Ft],ee.drawBuffer=Ur(S.maxDrawbuffers,function(f){return f===0?[0]:Ur(f,function(t){return yc+t})}));var ge=0;function Ae(){var f=Zu(),t=f.link,h=f.global;f.id=ge++,f.batchId="0";var y=t(J),E=f.shared={props:"a0"};Object.keys(J).forEach(function(l){E[l]=h.def(y,".",l)}),i.optional(function(){f.CHECK=t(i),f.commandStr=i.guessCommand(),f.command=t(f.commandStr),f.assert=function(l,u,x){l("if(!(",u,"))",this.CHECK,".commandRaise(",t(x),",",this.command,");")},ee.invalidBlendCombinations=Zf});var v=f.next={},m=f.current={};Object.keys(F).forEach(function(l){Array.isArray(ne[l])&&(v[l]=h.def(E.next,".",l),m[l]=h.def(E.current,".",l))});var p=f.constants={};Object.keys(ee).forEach(function(l){p[l]=h.def(JSON.stringify(ee[l]))}),f.invoke=function(l,u){switch(u.type){case ka:var x=["this",E.context,E.props,f.batchId];return l.def(t(u.data),".call(",x.slice(0,Math.max(u.data.length+1,4)),")");case Ma:return l.def(E.props,u.data);case Ua:return l.def(E.context,u.data);case ja:return l.def("this",u.data);case Vn:return u.data.append(f,l),u.data.ref;case wf:return u.data.toString();case Lf:return u.data.map(function(A){return f.invoke(l,A)})}},f.attribCache={};var o={};return f.scopeAttrib=function(l){var u=a.id(l);if(u in o)return o[u];var x=Y.scope[u];x||(x=Y.scope[u]=new _);var A=o[u]=t(x);return A},f}function te(f){var t=f.static,h=f.dynamic,y;if(dn in t){var E=!!t[dn];y=or(function(m,p){return E}),y.enable=E}else if(dn in h){var v=h[dn];y=Pr(v,function(m,p){return m.invoke(p,v)})}return y}function ae(f,t){var h=f.static,y=f.dynamic;if(Ot in h){var E=h[Ot];return E?(E=V.getFramebuffer(E),i.command(E,"invalid framebuffer object"),or(function(m,p){var o=m.link(E),l=m.shared;p.set(l.framebuffer,".next",o);var u=l.context;return p.set(u,"."+en,o+".width"),p.set(u,"."+rn,o+".height"),o})):or(function(m,p){var o=m.shared;p.set(o.framebuffer,".next","null");var l=o.context;return p.set(l,"."+en,l+"."+Hf),p.set(l,"."+rn,l+"."+$f),"null"})}else if(Ot in y){var v=y[Ot];return Pr(v,function(m,p){var o=m.invoke(p,v),l=m.shared,u=l.framebuffer,x=p.def(u,".getFramebuffer(",o,")");i.optional(function(){m.assert(p,"!"+o+"||"+x,"invalid framebuffer object")}),p.set(u,".next",x);var A=l.context;return p.set(A,"."+en,x+"?"+x+".width:"+A+"."+Hf),p.set(A,"."+rn,x+"?"+x+".height:"+A+"."+$f),x})}else return null}function be(f,t,h){var y=f.static,E=f.dynamic;function v(o){if(o in y){var l=y[o];i.commandType(l,"object","invalid "+o,h.commandStr);var u=!0,x=l.x|0,A=l.y|0,C,N;return"width"in l?(C=l.width|0,i.command(C>=0,"invalid "+o,h.commandStr)):u=!1,"height"in l?(N=l.height|0,i.command(N>=0,"invalid "+o,h.commandStr)):u=!1,new pr(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,function(he,oe){var k=he.shared.context,I=C;"width"in l||(I=oe.def(k,".",en,"-",x));var de=N;return"height"in l||(de=oe.def(k,".",rn,"-",A)),[x,A,I,de]})}else if(o in E){var Q=E[o],Ee=Pr(Q,function(he,oe){var k=he.invoke(oe,Q);i.optional(function(){he.assert(oe,k+"&&typeof "+k+'==="object"',"invalid "+o)});var I=he.shared.context,de=oe.def(k,".x|0"),le=oe.def(k,".y|0"),ye=oe.def('"width" in ',k,"?",k,".width|0:","(",I,".",en,"-",de,")"),Ve=oe.def('"height" in ',k,"?",k,".height|0:","(",I,".",rn,"-",le,")");return i.optional(function(){he.assert(oe,ye+">=0&&"+Ve+">=0","invalid "+o)}),[de,le,ye,Ve]});return t&&(Ee.thisDep=Ee.thisDep||t.thisDep,Ee.contextDep=Ee.contextDep||t.contextDep,Ee.propDep=Ee.propDep||t.propDep),Ee}else return t?new pr(t.thisDep,t.contextDep,t.propDep,function(he,oe){var k=he.shared.context;return[0,0,oe.def(k,".",en),oe.def(k,".",rn)]}):null}var m=v(it);if(m){var p=m;m=new pr(m.thisDep,m.contextDep,m.propDep,function(o,l){var u=p.append(o,l),x=o.shared.context;return l.set(x,"."+Ju,u[2]),l.set(x,"."+ec,u[3]),u})}return{viewport:m,scissor_box:v(Xn)}}function Te(f,t){var h=f.static,y=typeof h[mn]=="string"&&typeof h[hn]=="string";if(y){if(Object.keys(t.dynamic).length>0)return null;var E=t.static,v=Object.keys(E);if(v.length>0&&typeof E[v[0]]=="number"){for(var m=[],p=0;p<v.length;++p)i(typeof E[v[p]]=="number","must specify all vertex attribute locations when using vaos"),m.push([E[v[p]]|0,v[p]]);return m}}return null}function Re(f,t,h){var y=f.static,E=f.dynamic;function v(u){if(u in y){var x=a.id(y[u]);i.optional(function(){q.shader(Jf[u],x,i.guessCommand())});var A=or(function(){return x});return A.id=x,A}else if(u in E){var C=E[u];return Pr(C,function(N,Q){var Ee=N.invoke(Q,C),he=Q.def(N.shared.strings,".id(",Ee,")");return i.optional(function(){Q(N.shared.shader,".shader(",Jf[u],",",he,",",N.command,");")}),he})}return null}var m=v(mn),p=v(hn),o=null,l;return bt(m)&&bt(p)?(o=q.program(p.id,m.id,null,h),l=or(function(u,x){return u.link(o)})):l=new pr(m&&m.thisDep||p&&p.thisDep,m&&m.contextDep||p&&p.contextDep,m&&m.propDep||p&&p.propDep,function(u,x){var A=u.shared.shader,C;m?C=m.append(u,x):C=x.def(A,".",mn);var N;p?N=p.append(u,x):N=x.def(A,".",hn);var Q=A+".program("+N+","+C;return i.optional(function(){Q+=","+u.command}),x.def(Q+")")}),{frag:m,vert:p,progVar:l,program:o}}function Je(f,t){var h=f.static,y=f.dynamic,E={},v=!1;function m(){if(vn in h){var oe=h[vn];return oe!==null&&Y.getVAO(oe)===null&&(oe=Y.createVAO(oe)),v=!0,E.vao=oe,or(function(I){var de=Y.getVAO(oe);return de?I.link(de):"null"})}else if(vn in y){v=!0;var k=y[vn];return Pr(k,function(I,de){var le=I.invoke(de,k);return de.def(I.shared.vao+".getVAO("+le+")")})}return null}var p=m(),o=!1;function l(){if(Rt in h){var oe=h[Rt];if(E.elements=oe,ra(oe)){var k=E.elements=T.create(oe,!0);oe=T.getElements(k),o=!0}else oe&&(oe=T.getElements(oe),o=!0,i.command(oe,"invalid elements",t.commandStr));var I=or(function(le,ye){if(oe){var Ve=le.link(oe);return le.ELEMENTS=Ve,Ve}return le.ELEMENTS=null,null});return I.value=oe,I}else if(Rt in y){o=!0;var de=y[Rt];return Pr(de,function(le,ye){var Ve=le.shared,Tr=Ve.isBufferArgs,Dt=Ve.elements,ft=le.invoke(ye,de),rt=ye.def("null"),yt=ye.def(Tr,"(",ft,")"),Bt=le.cond(yt).then(rt,"=",Dt,".createStream(",ft,");").else(rt,"=",Dt,".getElements(",ft,");");return i.optional(function(){le.assert(Bt.else,"!"+ft+"||"+rt,"invalid elements")}),ye.entry(Bt),ye.exit(le.cond(yt).then(Dt,".destroyStream(",rt,");")),le.ELEMENTS=rt,rt})}else if(v)return new pr(p.thisDep,p.contextDep,p.propDep,function(le,ye){return ye.def(le.shared.vao+".currentVAO?"+le.shared.elements+".getElements("+le.shared.vao+".currentVAO.elements):null")});return null}var u=l();function x(){if(It in h){var oe=h[It];return E.primitive=oe,i.commandParameter(oe,ht,"invalid primitve",t.commandStr),or(function(I,de){return ht[oe]})}else if(It in y){var k=y[It];return Pr(k,function(I,de){var le=I.constants.primTypes,ye=I.invoke(de,k);return i.optional(function(){I.assert(de,ye+" in "+le,"invalid primitive, must be one of "+Object.keys(ht))}),de.def(le,"[",ye,"]")})}else{if(o)return bt(u)?u.value?or(function(I,de){return de.def(I.ELEMENTS,".primType")}):or(function(){return ni}):new pr(u.thisDep,u.contextDep,u.propDep,function(I,de){var le=I.ELEMENTS;return de.def(le,"?",le,".primType:",ni)});if(v)return new pr(p.thisDep,p.contextDep,p.propDep,function(I,de){return de.def(I.shared.vao+".currentVAO?"+I.shared.vao+".currentVAO.primitive:"+ni)})}return null}function A(oe,k){if(oe in h){var I=h[oe]|0;return k?E.offset=I:E.instances=I,i.command(!k||I>=0,"invalid "+oe,t.commandStr),or(function(le,ye){return k&&(le.OFFSET=I),I})}else if(oe in y){var de=y[oe];return Pr(de,function(le,ye){var Ve=le.invoke(ye,de);return k&&(le.OFFSET=Ve,i.optional(function(){le.assert(ye,Ve+">=0","invalid "+oe)})),Ve})}else if(k){if(o)return or(function(le,ye){return le.OFFSET=0,0});if(v)return new pr(p.thisDep,p.contextDep,p.propDep,function(le,ye){return ye.def(le.shared.vao+".currentVAO?"+le.shared.vao+".currentVAO.offset:0")})}else if(v)return new pr(p.thisDep,p.contextDep,p.propDep,function(le,ye){return ye.def(le.shared.vao+".currentVAO?"+le.shared.vao+".currentVAO.instances:-1")});return null}var C=A(Hn,!0);function N(){if(Ct in h){var oe=h[Ct]|0;return E.count=oe,i.command(typeof oe=="number"&&oe>=0,"invalid vertex count",t.commandStr),or(function(){return oe})}else if(Ct in y){var k=y[Ct];return Pr(k,function(ye,Ve){var Tr=ye.invoke(Ve,k);return i.optional(function(){ye.assert(Ve,"typeof "+Tr+'==="number"&&'+Tr+">=0&&"+Tr+"===("+Tr+"|0)","invalid vertex count")}),Tr})}else if(o)if(bt(u)){if(u)return C?new pr(C.thisDep,C.contextDep,C.propDep,function(ye,Ve){var Tr=Ve.def(ye.ELEMENTS,".vertCount-",ye.OFFSET);return i.optional(function(){ye.assert(Ve,Tr+">=0","invalid vertex offset/element buffer too small")}),Tr}):or(function(ye,Ve){return Ve.def(ye.ELEMENTS,".vertCount")});var I=or(function(){return-1});return i.optional(function(){I.MISSING=!0}),I}else{var de=new pr(u.thisDep||C.thisDep,u.contextDep||C.contextDep,u.propDep||C.propDep,function(ye,Ve){var Tr=ye.ELEMENTS;return ye.OFFSET?Ve.def(Tr,"?",Tr,".vertCount-",ye.OFFSET,":-1"):Ve.def(Tr,"?",Tr,".vertCount:-1")});return i.optional(function(){de.DYNAMIC=!0}),de}else if(v){var le=new pr(p.thisDep,p.contextDep,p.propDep,function(ye,Ve){return Ve.def(ye.shared.vao,".currentVAO?",ye.shared.vao,".currentVAO.count:-1")});return le}return null}var Q=x(),Ee=N(),he=A($n,!1);return{elements:u,primitive:Q,count:Ee,instances:he,offset:C,vao:p,vaoActive:v,elementsActive:o,static:E}}function er(f,t){var h=f.static,y=f.dynamic,E={};return me.forEach(function(v){var m=ue(v);function p(o,l){if(v in h){var u=o(h[v]);E[m]=or(function(){return u})}else if(v in y){var x=y[v];E[m]=Pr(x,function(A,C){return l(A,C,A.invoke(C,x))})}}switch(v){case Bf:case Rf:case Of:case Uf:case Cf:case Vf:case Pf:case kf:case Mf:case Df:return p(function(o){return i.commandType(o,"boolean",v,t.commandStr),o},function(o,l,u){return i.optional(function(){o.assert(l,"typeof "+u+'==="boolean"',"invalid flag "+v,o.commandStr)}),u});case Ff:return p(function(o){return i.commandParameter(o,nn,"invalid "+v,t.commandStr),nn[o]},function(o,l,u){var x=o.constants.compareFuncs;return i.optional(function(){o.assert(l,u+" in "+x,"invalid "+v+", must be one of "+Object.keys(nn))}),l.def(x,"[",u,"]")});case Gf:return p(function(o){return i.command(Ze(o)&&o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number"&&o[0]<=o[1],"depth range is 2d array",t.commandStr),o},function(o,l,u){i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+u+")&&"+u+".length===2&&typeof "+u+'[0]==="number"&&typeof '+u+'[1]==="number"&&'+u+"[0]<="+u+"[1]","depth range must be a 2d array")});var x=l.def("+",u,"[0]"),A=l.def("+",u,"[1]");return[x,A]});case Xa:return p(function(o){i.commandType(o,"object","blend.func",t.commandStr);var l="srcRGB"in o?o.srcRGB:o.src,u="srcAlpha"in o?o.srcAlpha:o.src,x="dstRGB"in o?o.dstRGB:o.dst,A="dstAlpha"in o?o.dstAlpha:o.dst;return i.commandParameter(l,Jr,m+".srcRGB",t.commandStr),i.commandParameter(u,Jr,m+".srcAlpha",t.commandStr),i.commandParameter(x,Jr,m+".dstRGB",t.commandStr),i.commandParameter(A,Jr,m+".dstAlpha",t.commandStr),i.command(Zf.indexOf(l+", "+x)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+l+", "+x+")",t.commandStr),[Jr[l],Jr[x],Jr[u],Jr[A]]},function(o,l,u){var x=o.constants.blendFuncs;i.optional(function(){o.assert(l,u+"&&typeof "+u+'==="object"',"invalid blend func, must be an object")});function A(k,I){var de=l.def('"',k,I,'" in ',u,"?",u,".",k,I,":",u,".",k);return i.optional(function(){o.assert(l,de+" in "+x,"invalid "+v+"."+k+I+", must be one of "+Object.keys(Jr))}),de}var C=A("src","RGB"),N=A("dst","RGB");i.optional(function(){var k=o.constants.invalidBlendCombinations;o.assert(l,k+".indexOf("+C+'+", "+'+N+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Q=l.def(x,"[",C,"]"),Ee=l.def(x,"[",A("src","Alpha"),"]"),he=l.def(x,"[",N,"]"),oe=l.def(x,"[",A("dst","Alpha"),"]");return[Q,he,Ee,oe]});case Va:return p(function(o){if(typeof o=="string")return i.commandParameter(o,O,"invalid "+v,t.commandStr),[O[o],O[o]];if(typeof o=="object")return i.commandParameter(o.rgb,O,v+".rgb",t.commandStr),i.commandParameter(o.alpha,O,v+".alpha",t.commandStr),[O[o.rgb],O[o.alpha]];i.commandRaise("invalid blend.equation",t.commandStr)},function(o,l,u){var x=o.constants.blendEquations,A=l.def(),C=l.def(),N=o.cond("typeof ",u,'==="string"');return i.optional(function(){function Q(Ee,he,oe){o.assert(Ee,oe+" in "+x,"invalid "+he+", must be one of "+Object.keys(O))}Q(N.then,v,u),o.assert(N.else,u+"&&typeof "+u+'==="object"',"invalid "+v),Q(N.else,v+".rgb",u+".rgb"),Q(N.else,v+".alpha",u+".alpha")}),N.then(A,"=",C,"=",x,"[",u,"];"),N.else(A,"=",x,"[",u,".rgb];",C,"=",x,"[",u,".alpha];"),l(N),[A,C]});case If:return p(function(o){return i.command(Ze(o)&&o.length===4,"blend.color must be a 4d array",t.commandStr),Ur(4,function(l){return+o[l]})},function(o,l,u){return i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+u+")&&"+u+".length===4","blend.color must be a 4d array")}),Ur(4,function(x){return l.def("+",u,"[",x,"]")})});case jf:return p(function(o){return i.commandType(o,"number",m,t.commandStr),o|0},function(o,l,u){return i.optional(function(){o.assert(l,"typeof "+u+'==="number"',"invalid stencil.mask")}),l.def(u,"|0")});case qa:return p(function(o){i.commandType(o,"object",m,t.commandStr);var l=o.cmp||"keep",u=o.ref||0,x="mask"in o?o.mask:-1;return i.commandParameter(l,nn,v+".cmp",t.commandStr),i.commandType(u,"number",v+".ref",t.commandStr),i.commandType(x,"number",v+".mask",t.commandStr),[nn[l],u,x]},function(o,l,u){var x=o.constants.compareFuncs;i.optional(function(){function Q(){o.assert(l,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Q(u+"&&typeof ",u,'==="object"'),Q('!("cmp" in ',u,")||(",u,".cmp in ",x,")")});var A=l.def('"cmp" in ',u,"?",x,"[",u,".cmp]",":",vt),C=l.def(u,".ref|0"),N=l.def('"mask" in ',u,"?",u,".mask|0:-1");return[A,C,N]});case Qa:case ln:return p(function(o){i.commandType(o,"object",m,t.commandStr);var l=o.fail||"keep",u=o.zfail||"keep",x=o.zpass||"keep";return i.commandParameter(l,pt,v+".fail",t.commandStr),i.commandParameter(u,pt,v+".zfail",t.commandStr),i.commandParameter(x,pt,v+".zpass",t.commandStr),[v===ln?Ft:An,pt[l],pt[u],pt[x]]},function(o,l,u){var x=o.constants.stencilOps;i.optional(function(){o.assert(l,u+"&&typeof "+u+'==="object"',"invalid "+v)});function A(C){return i.optional(function(){o.assert(l,'!("'+C+'" in '+u+")||("+u+"."+C+" in "+x+")","invalid "+v+"."+C+", must be one of "+Object.keys(pt))}),l.def('"',C,'" in ',u,"?",x,"[",u,".",C,"]:",vt)}return[v===ln?Ft:An,A("fail"),A("zfail"),A("zpass")]});case Ya:return p(function(o){i.commandType(o,"object",m,t.commandStr);var l=o.factor|0,u=o.units|0;return i.commandType(l,"number",m+".factor",t.commandStr),i.commandType(u,"number",m+".units",t.commandStr),[l,u]},function(o,l,u){i.optional(function(){o.assert(l,u+"&&typeof "+u+'==="object"',"invalid "+v)});var x=l.def(u,".factor|0"),A=l.def(u,".units|0");return[x,A]});case Nf:return p(function(o){var l=0;return o==="front"?l=An:o==="back"&&(l=Ft),i.command(!!l,m,t.commandStr),l},function(o,l,u){return i.optional(function(){o.assert(l,u+'==="front"||'+u+'==="back"',"invalid cull.face")}),l.def(u,'==="front"?',An,":",Ft)});case za:return p(function(o){return i.command(typeof o=="number"&&o>=S.lineWidthDims[0]&&o<=S.lineWidthDims[1],"invalid line width, must be a positive number between "+S.lineWidthDims[0]+" and "+S.lineWidthDims[1],t.commandStr),o},function(o,l,u){return i.optional(function(){o.assert(l,"typeof "+u+'==="number"&&'+u+">="+S.lineWidthDims[0]+"&&"+u+"<="+S.lineWidthDims[1],"invalid line width")}),u});case $a:return p(function(o){return i.commandParameter(o,ii,m,t.commandStr),ii[o]},function(o,l,u){return i.optional(function(){o.assert(l,u+'==="cw"||'+u+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),l.def(u+'==="cw"?'+Yf+":"+ai)});case Ha:return p(function(o){return i.command(Ze(o)&&o.length===4,"color.mask must be length 4 array",t.commandStr),o.map(function(l){return!!l})},function(o,l,u){return i.optional(function(){o.assert(l,o.shared.isArrayLike+"("+u+")&&"+u+".length===4","invalid color.mask")}),Ur(4,function(x){return"!!"+u+"["+x+"]"})});case Wa:return p(function(o){i.command(typeof o=="object"&&o,m,t.commandStr);var l="value"in o?o.value:1,u=!!o.invert;return i.command(typeof l=="number"&&l>=0&&l<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[l,u]},function(o,l,u){i.optional(function(){o.assert(l,u+"&&typeof "+u+'==="object"',"invalid sample.coverage")});var x=l.def('"value" in ',u,"?+",u,".value:1"),A=l.def("!!",u,".invert");return[x,A]})}}),E}function Ce(f,t){var h=f.static,y=f.dynamic,E={};return Object.keys(h).forEach(function(v){var m=h[v],p;if(typeof m=="number"||typeof m=="boolean")p=or(function(){return m});else if(typeof m=="function"){var o=m._reglType;o==="texture2d"||o==="textureCube"?p=or(function(l){return l.link(m)}):o==="framebuffer"||o==="framebufferCube"?(i.command(m.color.length>0,'missing color attachment for framebuffer sent to uniform "'+v+'"',t.commandStr),p=or(function(l){return l.link(m.color[0])})):i.commandRaise('invalid data for uniform "'+v+'"',t.commandStr)}else Ze(m)?p=or(function(l){var u=l.global.def("[",Ur(m.length,function(x){return i.command(typeof m[x]=="number"||typeof m[x]=="boolean","invalid uniform "+v,l.commandStr),m[x]}),"]");return u}):i.commandRaise('invalid or missing data for uniform "'+v+'"',t.commandStr);p.value=m,E[v]=p}),Object.keys(y).forEach(function(v){var m=y[v];E[v]=Pr(m,function(p,o){return p.invoke(o,m)})}),E}function cr(f,t){var h=f.static,y=f.dynamic,E={};return Object.keys(h).forEach(function(v){var m=h[v],p=a.id(v),o=new _;if(ra(m))o.state=Jt,o.buffer=G.getBuffer(G.create(m,tn,!1,!0)),o.type=0;else{var l=G.getBuffer(m);if(l)o.state=Jt,o.buffer=l,o.type=0;else if(i.command(typeof m=="object"&&m,"invalid data for attribute "+v,t.commandStr),"constant"in m){var u=m.constant;o.buffer="null",o.state=Pa,typeof u=="number"?o.x=u:(i.command(Ze(u)&&u.length>0&&u.length<=4,"invalid constant for attribute "+v,t.commandStr),Zt.forEach(function(he,oe){oe<u.length&&(o[he]=u[oe])}))}else{ra(m.buffer)?l=G.getBuffer(G.create(m.buffer,tn,!1,!0)):l=G.getBuffer(m.buffer),i.command(!!l,'missing buffer for attribute "'+v+'"',t.commandStr);var x=m.offset|0;i.command(x>=0,'invalid offset for attribute "'+v+'"',t.commandStr);var A=m.stride|0;i.command(A>=0&&A<256,'invalid stride for attribute "'+v+'", must be integer betweeen [0, 255]',t.commandStr);var C=m.size|0;i.command(!("size"in m)||C>0&&C<=4,'invalid size for attribute "'+v+'", must be 1,2,3,4',t.commandStr);var N=!!m.normalized,Q=0;"type"in m&&(i.commandParameter(m.type,gt,"invalid type for attribute "+v,t.commandStr),Q=gt[m.type]);var Ee=m.divisor|0;i.optional(function(){"divisor"in m&&(i.command(Ee===0||$,'cannot specify divisor for attribute "'+v+'", instancing not supported',t.commandStr),i.command(Ee>=0,'invalid divisor for attribute "'+v+'"',t.commandStr));var he=t.commandStr,oe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(m).forEach(function(k){i.command(oe.indexOf(k)>=0,'unknown parameter "'+k+'" for attribute pointer "'+v+'" (valid parameters are '+oe+")",he)})}),o.buffer=l,o.state=Jt,o.size=C,o.normalized=N,o.type=Q||l.dtype,o.offset=x,o.stride=A,o.divisor=Ee}}E[v]=or(function(he,oe){var k=he.attribCache;if(p in k)return k[p];var I={isStream:!1};return Object.keys(o).forEach(function(de){I[de]=o[de]}),o.buffer&&(I.buffer=he.link(o.buffer),I.type=I.type||I.buffer+".dtype"),k[p]=I,I})}),Object.keys(y).forEach(function(v){var m=y[v];function p(o,l){var u=o.invoke(l,m),x=o.shared,A=o.constants,C=x.isBufferArgs,N=x.buffer;i.optional(function(){o.assert(l,u+"&&(typeof "+u+'==="object"||typeof '+u+'==="function")&&('+C+"("+u+")||"+N+".getBuffer("+u+")||"+N+".getBuffer("+u+".buffer)||"+C+"("+u+'.buffer)||("constant" in '+u+"&&(typeof "+u+'.constant==="number"||'+x.isArrayLike+"("+u+".constant))))",'invalid dynamic attribute "'+v+'"')});var Q={isStream:l.def(!1)},Ee=new _;Ee.state=Jt,Object.keys(Ee).forEach(function(I){Q[I]=l.def(""+Ee[I])});var he=Q.buffer,oe=Q.type;l("if(",C,"(",u,")){",Q.isStream,"=true;",he,"=",N,".createStream(",tn,",",u,");",oe,"=",he,".dtype;","}else{",he,"=",N,".getBuffer(",u,");","if(",he,"){",oe,"=",he,".dtype;",'}else if("constant" in ',u,"){",Q.state,"=",Pa,";","if(typeof "+u+'.constant === "number"){',Q[Zt[0]],"=",u,".constant;",Zt.slice(1).map(function(I){return Q[I]}).join("="),"=0;","}else{",Zt.map(function(I,de){return Q[I]+"="+u+".constant.length>"+de+"?"+u+".constant["+de+"]:0;"}).join(""),"}}else{","if(",C,"(",u,".buffer)){",he,"=",N,".createStream(",tn,",",u,".buffer);","}else{",he,"=",N,".getBuffer(",u,".buffer);","}",oe,'="type" in ',u,"?",A.glTypes,"[",u,".type]:",he,".dtype;",Q.normalized,"=!!",u,".normalized;");function k(I){l(Q[I],"=",u,".",I,"|0;")}return k("size"),k("offset"),k("stride"),k("divisor"),l("}}"),l.exit("if(",Q.isStream,"){",N,".destroyStream(",he,");","}"),Q}E[v]=Pr(m,p)}),E}function Qe(f){var t=f.static,h=f.dynamic,y={};return Object.keys(t).forEach(function(E){var v=t[E];y[E]=or(function(m,p){return typeof v=="number"||typeof v=="boolean"?""+v:m.link(v)})}),Object.keys(h).forEach(function(E){var v=h[E];y[E]=Pr(v,function(m,p){return m.invoke(p,v)})}),y}function sr(f,t,h,y,E){var v=f.static,m=f.dynamic;i.optional(function(){var k=[Ot,hn,mn,Rt,It,Hn,Ct,$n,dn,vn].concat(me);function I(de){Object.keys(de).forEach(function(le){i.command(k.indexOf(le)>=0,'unknown parameter "'+le+'"',E.commandStr)})}I(v),I(m)});var p=Te(f,t),o=ae(f),l=be(f,o,E),u=Je(f,E),x=er(f,E),A=Re(f,E,p);function C(k){var I=l[k];I&&(x[k]=I)}C(it),C(ue(Xn));var N=Object.keys(x).length>0,Q={framebuffer:o,draw:u,shader:A,state:x,dirty:N,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Q.profile=te(f),Q.uniforms=Ce(h,E),Q.drawVAO=Q.scopeVAO=u.vao,!Q.drawVAO&&A.program&&!p&&d.angle_instanced_arrays&&u.static.elements){var Ee=!0,he=A.program.attributes.map(function(k){var I=t.static[k];return Ee=Ee&&!!I,I});if(Ee&&he.length>0){var oe=Y.getVAO(Y.createVAO({attributes:he,elements:u.static.elements}));Q.drawVAO=new pr(null,null,null,function(k,I){return k.link(oe)}),Q.useVAO=!0}}return p?Q.useVAO=!0:Q.attributes=cr(t,E),Q.context=Qe(y),Q}function lr(f,t,h){var y=f.shared,E=y.context,v=f.scope();Object.keys(h).forEach(function(m){t.save(E,"."+m);var p=h[m],o=p.append(f,t);Array.isArray(o)?v(E,".",m,"=[",o.join(),"];"):v(E,".",m,"=",o,";")}),t(v)}function dr(f,t,h,y){var E=f.shared,v=E.gl,m=E.framebuffer,p;ie&&(p=t.def(E.extensions,".webgl_draw_buffers"));var o=f.constants,l=o.drawBuffer,u=o.backBuffer,x;h?x=h.append(f,t):x=t.def(m,".next"),y||t("if(",x,"!==",m,".cur){"),t("if(",x,"){",v,".bindFramebuffer(",Kf,",",x,".framebuffer);"),ie&&t(p,".drawBuffersWEBGL(",l,"[",x,".colorAttachments.length]);"),t("}else{",v,".bindFramebuffer(",Kf,",null);"),ie&&t(p,".drawBuffersWEBGL(",u,");"),t("}",m,".cur=",x,";"),y||t("}")}function yr(f,t,h){var y=f.shared,E=y.gl,v=f.current,m=f.next,p=y.current,o=y.next,l=f.cond(p,".dirty");me.forEach(function(u){var x=ue(u);if(!(x in h.state)){var A,C;if(x in m){A=m[x],C=v[x];var N=Ur(ne[x].length,function(Ee){return l.def(A,"[",Ee,"]")});l(f.cond(N.map(function(Ee,he){return Ee+"!=="+C+"["+he+"]"}).join("||")).then(E,".",F[x],"(",N,");",N.map(function(Ee,he){return C+"["+he+"]="+Ee}).join(";"),";"))}else{A=l.def(o,".",x);var Q=f.cond(A,"!==",p,".",x);l(Q),x in D?Q(f.cond(A).then(E,".enable(",D[x],");").else(E,".disable(",D[x],");"),p,".",x,"=",A,";"):Q(E,".",F[x],"(",A,");",p,".",x,"=",A,";")}}}),Object.keys(h.state).length===0&&l(p,".dirty=false;"),t(l)}function xr(f,t,h,y){var E=f.shared,v=f.current,m=E.current,p=E.gl;eo(Object.keys(h)).forEach(function(o){var l=h[o];if(!(y&&!y(l))){var u=l.append(f,t);if(D[o]){var x=D[o];bt(l)?u?t(p,".enable(",x,");"):t(p,".disable(",x,");"):t(f.cond(u).then(p,".enable(",x,");").else(p,".disable(",x,");")),t(m,".",o,"=",u,";")}else if(Ze(u)){var A=v[o];t(p,".",F[o],"(",u,");",u.map(function(C,N){return A+"["+N+"]="+C}).join(";"),";")}else t(p,".",F[o],"(",u,");",m,".",o,"=",u,";")}})}function rr(f,t){$&&(f.instancing=t.def(f.shared.extensions,".angle_instanced_arrays"))}function Se(f,t,h,y,E){var v=f.shared,m=f.stats,p=v.current,o=v.timer,l=h.profile;function u(){return typeof performance>"u"?"Date.now()":"performance.now()"}var x,A;function C(k){x=t.def(),k(x,"=",u(),";"),typeof E=="string"?k(m,".count+=",E,";"):k(m,".count++;"),X&&(y?(A=t.def(),k(A,"=",o,".getNumPendingQueries();")):k(o,".beginQuery(",m,");"))}function N(k){k(m,".cpuTime+=",u(),"-",x,";"),X&&(y?k(o,".pushScopeStats(",A,",",o,".getNumPendingQueries(),",m,");"):k(o,".endQuery();"))}function Q(k){var I=t.def(p,".profile");t(p,".profile=",k,";"),t.exit(p,".profile=",I,";")}var Ee;if(l){if(bt(l)){l.enable?(C(t),N(t.exit),Q("true")):Q("false");return}Ee=l.append(f,t),Q(Ee)}else Ee=t.def(p,".profile");var he=f.block();C(he),t("if(",Ee,"){",he,"}");var oe=f.block();N(oe),t.exit("if(",Ee,"){",oe,"}")}function gr(f,t,h,y,E){var v=f.shared;function m(o){switch(o){case zn:case qn:case Zn:return 2;case Yn:case Qn:case Jn:return 3;case Wn:case Kn:case ea:return 4;default:return 1}}function p(o,l,u){var x=v.gl,A=t.def(o,".location"),C=t.def(v.attributes,"[",A,"]"),N=u.state,Q=u.buffer,Ee=[u.x,u.y,u.z,u.w],he=["buffer","normalized","offset","stride"];function oe(){t("if(!",C,".buffer){",x,".enableVertexAttribArray(",A,");}");var I=u.type,de;if(u.size?de=t.def(u.size,"||",l):de=l,t("if(",C,".type!==",I,"||",C,".size!==",de,"||",he.map(function(ye){return C+"."+ye+"!=="+u[ye]}).join("||"),"){",x,".bindBuffer(",tn,",",Q,".buffer);",x,".vertexAttribPointer(",[A,de,I,u.normalized,u.stride,u.offset],");",C,".type=",I,";",C,".size=",de,";",he.map(function(ye){return C+"."+ye+"="+u[ye]+";"}).join(""),"}"),$){var le=u.divisor;t("if(",C,".divisor!==",le,"){",f.instancing,".vertexAttribDivisorANGLE(",[A,le],");",C,".divisor=",le,";}")}}function k(){t("if(",C,".buffer){",x,".disableVertexAttribArray(",A,");",C,".buffer=null;","}if(",Zt.map(function(I,de){return C+"."+I+"!=="+Ee[de]}).join("||"),"){",x,".vertexAttrib4f(",A,",",Ee,");",Zt.map(function(I,de){return C+"."+I+"="+Ee[de]+";"}).join(""),"}")}N===Jt?oe():N===Pa?k():(t("if(",N,"===",Jt,"){"),oe(),t("}else{"),k(),t("}"))}y.forEach(function(o){var l=o.name,u=h.attributes[l],x;if(u){if(!E(u))return;x=u.append(f,t)}else{if(!E(ro))return;var A=f.scopeAttrib(l);i.optional(function(){f.assert(t,A+".state","missing attribute "+l)}),x={},Object.keys(new _).forEach(function(C){x[C]=t.def(A,".",C)})}p(f.link(o),m(o.info.type),x)})}function je(f,t,h,y,E,v){for(var m=f.shared,p=m.gl,o={},l,u=0;u<y.length;++u){var x=y[u],A=x.name,C=x.info.type,N=x.info.size,Q=h.uniforms[A];if(N>1){if(!Q)continue;var Ee=A.replace("[0]","");if(o[Ee])continue;o[Ee]=1}var he=f.link(x),oe=he+".location",k;if(Q){if(!E(Q))continue;if(bt(Q)){var I=Q.value;if(i.command(I!==null&&typeof I<"u",'missing uniform "'+A+'"',f.commandStr),C===_n||C===En){i.command(typeof I=="function"&&(C===_n&&(I._reglType==="texture2d"||I._reglType==="framebuffer")||C===En&&(I._reglType==="textureCube"||I._reglType==="framebufferCube")),"invalid texture for uniform "+A,f.commandStr);var de=f.link(I._texture||I.color[0]._texture);t(p,".uniform1i(",oe,",",de+".bind());"),t.exit(de,".unbind();")}else if(C===pn||C===bn||C===yn){i.optional(function(){i.command(Ze(I),"invalid matrix for uniform "+A,f.commandStr),i.command(C===pn&&I.length===4||C===bn&&I.length===9||C===yn&&I.length===16,"invalid length for matrix uniform "+A,f.commandStr)});var le=f.global.def("new Float32Array(["+Array.prototype.slice.call(I)+"])"),ye=2;C===bn?ye=3:C===yn&&(ye=4),t(p,".uniformMatrix",ye,"fv(",oe,",false,",le,");")}else{switch(C){case ei:N===1?i.commandType(I,"number","uniform "+A,f.commandStr):i.command(Ze(I)&&I.length===N,"uniform "+A,f.commandStr),l="1f";break;case zn:i.command(Ze(I)&&I.length&&I.length%2===0&&I.length<=N*2,"uniform "+A,f.commandStr),l="2f";break;case Yn:i.command(Ze(I)&&I.length&&I.length%3===0&&I.length<=N*3,"uniform "+A,f.commandStr),l="3f";break;case Wn:i.command(Ze(I)&&I.length&&I.length%4===0&&I.length<=N*4,"uniform "+A,f.commandStr),l="4f";break;case ti:N===1?i.commandType(I,"boolean","uniform "+A,f.commandStr):i.command(Ze(I)&&I.length===N,"uniform "+A,f.commandStr),l="1i";break;case ri:N===1?i.commandType(I,"number","uniform "+A,f.commandStr):i.command(Ze(I)&&I.length===N,"uniform "+A,f.commandStr),l="1i";break;case Zn:i.command(Ze(I)&&I.length&&I.length%2===0&&I.length<=N*2,"uniform "+A,f.commandStr),l="2i";break;case qn:i.command(Ze(I)&&I.length&&I.length%2===0&&I.length<=N*2,"uniform "+A,f.commandStr),l="2i";break;case Jn:i.command(Ze(I)&&I.length&&I.length%3===0&&I.length<=N*3,"uniform "+A,f.commandStr),l="3i";break;case Qn:i.command(Ze(I)&&I.length&&I.length%3===0&&I.length<=N*3,"uniform "+A,f.commandStr),l="3i";break;case ea:i.command(Ze(I)&&I.length&&I.length%4===0&&I.length<=N*4,"uniform "+A,f.commandStr),l="4i";break;case Kn:i.command(Ze(I)&&I.length&&I.length%4===0&&I.length<=N*4,"uniform "+A,f.commandStr),l="4i";break}N>1?(l+="v",I=f.global.def("["+Array.prototype.slice.call(I)+"]")):I=Ze(I)?Array.prototype.slice.call(I):I,t(p,".uniform",l,"(",oe,",",I,");")}continue}else k=Q.append(f,t)}else{if(!E(ro))continue;k=t.def(m.uniforms,"[",a.id(A),"]")}C===_n?(i(!Array.isArray(k),"must specify a scalar prop for textures"),t("if(",k,"&&",k,'._reglType==="framebuffer"){',k,"=",k,".color[0];","}")):C===En&&(i(!Array.isArray(k),"must specify a scalar prop for cube maps"),t("if(",k,"&&",k,'._reglType==="framebufferCube"){',k,"=",k,".color[0];","}")),i.optional(function(){function Vr(kr,ta){f.assert(t,kr,'bad data or missing for uniform "'+A+'".  '+ta)}function Nt(kr,ta){ta===1&&i(!Array.isArray(k),"must not specify an array type for uniform"),Vr("Array.isArray("+k+") && typeof "+k+'[0]===" '+kr+'" || typeof '+k+'==="'+kr+'"',"invalid type, expected "+kr)}function zr(kr,ta,na){Array.isArray(k)?i(k.length&&k.length%kr===0&&k.length<=kr*na,"must have length of "+(na===1?"":"n * ")+kr):Vr(m.isArrayLike+"("+k+")&&"+k+".length && "+k+".length % "+kr+" === 0 && "+k+".length<="+kr*na,"invalid vector, should have length of "+(na===1?"":"n * ")+kr,f.commandStr)}function so(kr){i(!Array.isArray(k),"must not specify a value type"),Vr("typeof "+k+'==="function"&&'+k+'._reglType==="texture'+(kr===zf?"2d":"Cube")+'"',"invalid texture type",f.commandStr)}switch(C){case ri:Nt("number",N);break;case qn:zr(2,"number",N);break;case Qn:zr(3,"number",N);break;case Kn:zr(4,"number",N);break;case ei:Nt("number",N);break;case zn:zr(2,"number",N);break;case Yn:zr(3,"number",N);break;case Wn:zr(4,"number",N);break;case ti:Nt("boolean",N);break;case Zn:zr(2,"boolean",N);break;case Jn:zr(3,"boolean",N);break;case ea:zr(4,"boolean",N);break;case pn:zr(4,"number",N);break;case bn:zr(9,"number",N);break;case yn:zr(16,"number",N);break;case _n:so(zf);break;case En:so(ac);break}});var Ve=1;switch(C){case _n:case En:var Tr=t.def(k,"._texture");t(p,".uniform1i(",oe,",",Tr,".bind());"),t.exit(Tr,".unbind();");continue;case ri:case ti:l="1i";break;case qn:case Zn:l="2i",Ve=2;break;case Qn:case Jn:l="3i",Ve=3;break;case Kn:case ea:l="4i",Ve=4;break;case ei:l="1f";break;case zn:l="2f",Ve=2;break;case Yn:l="3f",Ve=3;break;case Wn:l="4f",Ve=4;break;case pn:l="Matrix2fv";break;case bn:l="Matrix3fv";break;case yn:l="Matrix4fv";break}if(l.indexOf("Matrix")===-1&&N>1&&(l+="v",Ve=1),l.charAt(0)==="M"){t(p,".uniform",l,"(",oe,",");var Dt=Math.pow(C-pn+2,2),ft=f.global.def("new Float32Array(",Dt,")");Array.isArray(k)?t("false,(",Ur(Dt,function(Vr){return ft+"["+Vr+"]="+k[Vr]}),",",ft,")"):t("false,(Array.isArray(",k,")||",k," instanceof Float32Array)?",k,":(",Ur(Dt,function(Vr){return ft+"["+Vr+"]="+k+"["+Vr+"]"}),",",ft,")"),t(");")}else if(Ve>1){for(var rt=[],yt=[],Bt=0;Bt<Ve;++Bt)Array.isArray(k)?yt.push(k[Bt]):yt.push(t.def(k+"["+Bt+"]")),v&&rt.push(t.def());v&&t("if(!",f.batchId,"||",rt.map(function(Vr,Nt){return Vr+"!=="+yt[Nt]}).join("||"),"){",rt.map(function(Vr,Nt){return Vr+"="+yt[Nt]+";"}).join("")),t(p,".uniform",l,"(",oe,",",yt.join(","),");"),v&&t("}")}else{if(i(!Array.isArray(k),"uniform value must not be an array"),v){var oo=t.def();t("if(!",f.batchId,"||",oo,"!==",k,"){",oo,"=",k,";")}t(p,".uniform",l,"(",oe,",",k,");"),v&&t("}")}}}function pe(f,t,h,y){var E=f.shared,v=E.gl,m=E.draw,p=y.draw;function o(){var de=p.elements,le,ye=t;return de?((de.contextDep&&y.contextDynamic||de.propDep)&&(ye=h),le=de.append(f,ye),p.elementsActive&&ye("if("+le+")"+v+".bindBuffer("+Ja+","+le+".buffer.buffer);")):(le=ye.def(),ye(le,"=",m,".",Rt,";","if(",le,"){",v,".bindBuffer(",Ja,",",le,".buffer.buffer);}","else if(",E.vao,".currentVAO){",le,"=",f.shared.elements+".getElements("+E.vao,".currentVAO.elements);",M?"":"if("+le+")"+v+".bindBuffer("+Ja+","+le+".buffer.buffer);","}")),le}function l(){var de=p.count,le,ye=t;return de?((de.contextDep&&y.contextDynamic||de.propDep)&&(ye=h),le=de.append(f,ye),i.optional(function(){de.MISSING&&f.assert(t,"false","missing vertex count"),de.DYNAMIC&&f.assert(ye,le+">=0","missing vertex count")})):(le=ye.def(m,".",Ct),i.optional(function(){f.assert(ye,le+">=0","missing vertex count")})),le}var u=o();function x(de){var le=p[de];return le?le.contextDep&&y.contextDynamic||le.propDep?le.append(f,h):le.append(f,t):t.def(m,".",de)}var A=x(It),C=x(Hn),N=l();if(typeof N=="number"){if(N===0)return}else h("if(",N,"){"),h.exit("}");var Q,Ee;$&&(Q=x($n),Ee=f.instancing);var he=u+".type",oe=p.elements&&bt(p.elements)&&!p.vaoActive;function k(){function de(){h(Ee,".drawElementsInstancedANGLE(",[A,N,he,C+"<<(("+he+"-"+Sf+")>>1)",Q],");")}function le(){h(Ee,".drawArraysInstancedANGLE(",[A,C,N,Q],");")}u&&u!=="null"?oe?de():(h("if(",u,"){"),de(),h("}else{"),le(),h("}")):le()}function I(){function de(){h(v+".drawElements("+[A,N,he,C+"<<(("+he+"-"+Sf+")>>1)"]+");")}function le(){h(v+".drawArrays("+[A,C,N]+");")}u&&u!=="null"?oe?de():(h("if(",u,"){"),de(),h("}else{"),le(),h("}")):le()}$&&(typeof Q!="number"||Q>=0)?typeof Q=="string"?(h("if(",Q,">0){"),k(),h("}else if(",Q,"<0){"),I(),h("}")):k():I()}function Ie(f,t,h,y,E){var v=Ae(),m=v.proc("body",E);return i.optional(function(){v.commandStr=t.commandStr,v.command=v.link(t.commandStr)}),$&&(v.instancing=m.def(v.shared.extensions,".angle_instanced_arrays")),f(v,m,h,y),v.compile().body}function Ne(f,t,h,y){rr(f,t),h.useVAO?h.drawVAO?t(f.shared.vao,".setVAO(",h.drawVAO.append(f,t),");"):t(f.shared.vao,".setVAO(",f.shared.vao,".targetVAO);"):(t(f.shared.vao,".setVAO(null);"),gr(f,t,h,y.attributes,function(){return!0})),je(f,t,h,y.uniforms,function(){return!0},!1),pe(f,t,t,h)}function tr(f,t){var h=f.proc("draw",1);rr(f,h),lr(f,h,t.context),dr(f,h,t.framebuffer),yr(f,h,t),xr(f,h,t.state),Se(f,h,t,!1,!0);var y=t.shader.progVar.append(f,h);if(h(f.shared.gl,".useProgram(",y,".program);"),t.shader.program)Ne(f,h,t,t.shader.program);else{h(f.shared.vao,".setVAO(null);");var E=f.global.def("{}"),v=h.def(y,".id"),m=h.def(E,"[",v,"]");h(f.cond(m).then(m,".call(this,a0);").else(m,"=",E,"[",v,"]=",f.link(function(p){return Ie(Ne,f,t,p,1)}),"(",y,");",m,".call(this,a0);"))}Object.keys(t.state).length>0&&h(f.shared.current,".dirty=true;"),f.shared.vao&&h(f.shared.vao,".setVAO(null);")}function et(f,t,h,y){f.batchId="a1",rr(f,t);function E(){return!0}gr(f,t,h,y.attributes,E),je(f,t,h,y.uniforms,E,!1),pe(f,t,t,h)}function Gt(f,t,h,y){rr(f,t);var E=h.contextDep,v=t.def(),m="a0",p="a1",o=t.def();f.shared.props=o,f.batchId=v;var l=f.scope(),u=f.scope();t(l.entry,"for(",v,"=0;",v,"<",p,";++",v,"){",o,"=",m,"[",v,"];",u,"}",l.exit);function x(he){return he.contextDep&&E||he.propDep}function A(he){return!x(he)}if(h.needsContext&&lr(f,u,h.context),h.needsFramebuffer&&dr(f,u,h.framebuffer),xr(f,u,h.state,x),h.profile&&x(h.profile)&&Se(f,u,h,!1,!0),y)h.useVAO?h.drawVAO?x(h.drawVAO)?u(f.shared.vao,".setVAO(",h.drawVAO.append(f,u),");"):l(f.shared.vao,".setVAO(",h.drawVAO.append(f,l),");"):l(f.shared.vao,".setVAO(",f.shared.vao,".targetVAO);"):(l(f.shared.vao,".setVAO(null);"),gr(f,l,h,y.attributes,A),gr(f,u,h,y.attributes,x)),je(f,l,h,y.uniforms,A,!1),je(f,u,h,y.uniforms,x,!0),pe(f,l,u,h);else{var C=f.global.def("{}"),N=h.shader.progVar.append(f,u),Q=u.def(N,".id"),Ee=u.def(C,"[",Q,"]");u(f.shared.gl,".useProgram(",N,".program);","if(!",Ee,"){",Ee,"=",C,"[",Q,"]=",f.link(function(he){return Ie(et,f,h,he,2)}),"(",N,");}",Ee,".call(this,a0[",v,"],",v,");")}}function c(f,t){var h=f.proc("batch",2);f.batchId="0",rr(f,h);var y=!1,E=!0;Object.keys(t.context).forEach(function(C){y=y||t.context[C].propDep}),y||(lr(f,h,t.context),E=!1);var v=t.framebuffer,m=!1;v?(v.propDep?y=m=!0:v.contextDep&&y&&(m=!0),m||dr(f,h,v)):dr(f,h,null),t.state.viewport&&t.state.viewport.propDep&&(y=!0);function p(C){return C.contextDep&&y||C.propDep}yr(f,h,t),xr(f,h,t.state,function(C){return!p(C)}),(!t.profile||!p(t.profile))&&Se(f,h,t,!1,"a1"),t.contextDep=y,t.needsContext=E,t.needsFramebuffer=m;var o=t.shader.progVar;if(o.contextDep&&y||o.propDep)Gt(f,h,t,null);else{var l=o.append(f,h);if(h(f.shared.gl,".useProgram(",l,".program);"),t.shader.program)Gt(f,h,t,t.shader.program);else{h(f.shared.vao,".setVAO(null);");var u=f.global.def("{}"),x=h.def(l,".id"),A=h.def(u,"[",x,"]");h(f.cond(A).then(A,".call(this,a0,a1);").else(A,"=",u,"[",x,"]=",f.link(function(C){return Ie(Gt,f,t,C,2)}),"(",l,");",A,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&h(f.shared.current,".dirty=true;"),f.shared.vao&&h(f.shared.vao,".setVAO(null);")}function w(f,t){var h=f.proc("scope",3);f.batchId="a2";var y=f.shared,E=y.current;lr(f,h,t.context),t.framebuffer&&t.framebuffer.append(f,h),eo(Object.keys(t.state)).forEach(function(m){var p=t.state[m],o=p.append(f,h);Ze(o)?o.forEach(function(l,u){h.set(f.next[m],"["+u+"]",l)}):h.set(y.next,"."+m,o)}),Se(f,h,t,!0,!0),[Rt,Hn,Ct,$n,It].forEach(function(m){var p=t.draw[m];p&&h.set(y.draw,"."+m,""+p.append(f,h))}),Object.keys(t.uniforms).forEach(function(m){var p=t.uniforms[m].append(f,h);Array.isArray(p)&&(p="["+p.join()+"]"),h.set(y.uniforms,"["+a.id(m)+"]",p)}),Object.keys(t.attributes).forEach(function(m){var p=t.attributes[m].append(f,h),o=f.scopeAttrib(m);Object.keys(new _).forEach(function(l){h.set(o,"."+l,p[l])})}),t.scopeVAO&&h.set(y.vao,".targetVAO",t.scopeVAO.append(f,h));function v(m){var p=t.shader[m];p&&h.set(y.shader,"."+m,p.append(f,h))}v(hn),v(mn),Object.keys(t.state).length>0&&(h(E,".dirty=true;"),h.exit(E,".dirty=true;")),h("a1(",f.shared.context,",a0,",f.batchId,");")}function g(f){if(!(typeof f!="object"||Ze(f))){for(var t=Object.keys(f),h=0;h<t.length;++h)if(ir.isDynamic(f[t[h]]))return!0;return!1}}function se(f,t,h){var y=t.static[h];if(!y||!g(y))return;var E=f.global,v=Object.keys(y),m=!1,p=!1,o=!1,l=f.global.def("{}");v.forEach(function(x){var A=y[x];if(ir.isDynamic(A)){typeof A=="function"&&(A=y[x]=ir.unbox(A));var C=Pr(A,null);m=m||C.thisDep,o=o||C.propDep,p=p||C.contextDep}else{switch(E(l,".",x,"="),typeof A){case"number":E(A);break;case"string":E('"',A,'"');break;case"object":Array.isArray(A)&&E("[",A.join(),"]");break;default:E(f.link(A));break}E(";")}});function u(x,A){v.forEach(function(C){var N=y[C];if(ir.isDynamic(N)){var Q=x.invoke(A,N);A(l,".",C,"=",Q,";")}})}t.dynamic[h]=new ir.DynamicVariable(Vn,{thisDep:m,contextDep:p,propDep:o,ref:l,append:u}),delete t.static[h]}function Le(f,t,h,y,E){var v=Ae();v.stats=v.link(E),Object.keys(t.static).forEach(function(p){se(v,t,p)}),rc.forEach(function(p){se(v,f,p)});var m=sr(f,t,h,y,v);return tr(v,m),w(v,m),c(v,m),b(v.compile(),{destroy:function(){m.shader.program.destroy()}})}return{next:re,current:ne,procs:function(){var f=Ae(),t=f.proc("poll"),h=f.proc("refresh"),y=f.block();t(y),h(y);var E=f.shared,v=E.gl,m=E.next,p=E.current;y(p,".dirty=false;"),dr(f,t),dr(f,h,null,!0);var o;$&&(o=f.link($)),d.oes_vertex_array_object&&h(f.link(d.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<S.maxAttributes;++l){var u=h.def(E.attributes,"[",l,"]"),x=f.cond(u,".buffer");x.then(v,".enableVertexAttribArray(",l,");",v,".bindBuffer(",tn,",",u,".buffer.buffer);",v,".vertexAttribPointer(",l,",",u,".size,",u,".type,",u,".normalized,",u,".stride,",u,".offset);").else(v,".disableVertexAttribArray(",l,");",v,".vertexAttrib4f(",l,",",u,".x,",u,".y,",u,".z,",u,".w);",u,".buffer=null;"),h(x),$&&h(o,".vertexAttribDivisorANGLE(",l,",",u,".divisor);")}return h(f.shared.vao,".currentVAO=null;",f.shared.vao,".setVAO(",f.shared.vao,".targetVAO);"),Object.keys(D).forEach(function(A){var C=D[A],N=y.def(m,".",A),Q=f.block();Q("if(",N,"){",v,".enable(",C,")}else{",v,".disable(",C,")}",p,".",A,"=",N,";"),h(Q),t("if(",N,"!==",p,".",A,"){",Q,"}")}),Object.keys(F).forEach(function(A){var C=F[A],N=ne[A],Q,Ee,he=f.block();if(he(v,".",C,"("),Ze(N)){var oe=N.length;Q=f.global.def(m,".",A),Ee=f.global.def(p,".",A),he(Ur(oe,function(k){return Q+"["+k+"]"}),");",Ur(oe,function(k){return Ee+"["+k+"]="+Q+"["+k+"];"}).join("")),t("if(",Ur(oe,function(k){return Q+"["+k+"]!=="+Ee+"["+k+"]"}).join("||"),"){",he,"}")}else Q=y.def(m,".",A),Ee=y.def(p,".",A),he(Q,");",p,".",A,"=",Q,";"),t("if(",Q,"!==",Ee,"){",he,"}");h(he)}),f.compile()}(),compile:Le}}function Ec(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ac=34918,xc=34919,to=35007,gc=function(e,a){if(!a.ext_disjoint_timer_query)return null;var d=[];function S(){return d.pop()||a.ext_disjoint_timer_query.createQueryEXT()}function G($){d.push($)}var T=[];function R($){var ie=S();a.ext_disjoint_timer_query.beginQueryEXT(to,ie),T.push(ie),X(T.length-1,T.length,$)}function V(){a.ext_disjoint_timer_query.endQueryEXT(to)}function j(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Y=[];function q(){return Y.pop()||new j}function W($){Y.push($)}var K=[];function X($,ie,M){var ne=q();ne.startQueryIndex=$,ne.endQueryIndex=ie,ne.sum=0,ne.stats=M,K.push(ne)}var z=[],_=[];function O(){var $,ie,M=T.length;if(M!==0){_.length=Math.max(_.length,M+1),z.length=Math.max(z.length,M+1),z[0]=0,_[0]=0;var ne=0;for($=0,ie=0;ie<T.length;++ie){var re=T[ie];a.ext_disjoint_timer_query.getQueryObjectEXT(re,xc)?(ne+=a.ext_disjoint_timer_query.getQueryObjectEXT(re,Ac),G(re)):T[$++]=re,z[ie+1]=ne,_[ie+1]=$}for(T.length=$,$=0,ie=0;ie<K.length;++ie){var me=K[ie],D=me.startQueryIndex,F=me.endQueryIndex;me.sum+=z[F]-z[D];var ue=_[D],Z=_[F];Z===ue?(me.stats.gpuTime+=me.sum/1e6,W(me)):(me.startQueryIndex=ue,me.endQueryIndex=Z,K[$++]=me)}K.length=$}}return{beginQuery:R,endQuery:V,pushScopeStats:X,update:O,getNumPendingQueries:function(){return T.length},clear:function(){d.push.apply(d,T);for(var $=0;$<d.length;$++)a.ext_disjoint_timer_query.deleteQueryEXT(d[$]);T.length=0,d.length=0},restore:function(){T.length=0,d.length=0}}},Tc=16384,Sc=256,wc=1024,Lc=34962,no="webglcontextlost",ao="webglcontextrestored",io=1,Oc=2,Rc=3;function fo(e,a){for(var d=0;d<e.length;++d)if(e[d]===a)return d;return-1}function Ic(e){var a=Oo(e);if(!a)return null;var d=a.gl,S=d.getContextAttributes(),G=d.isContextLost(),T=Ro(d,a);if(!T)return null;var R=xt(),V=Ec(),j=T.extensions,Y=gc(d,j),q=lt(),W=d.drawingBufferWidth,K=d.drawingBufferHeight,X={tick:0,time:0,viewportWidth:W,viewportHeight:K,framebufferWidth:W,framebufferHeight:K,drawingBufferWidth:W,drawingBufferHeight:K,pixelRatio:a.pixelRatio},z={},_={elements:null,primitive:4,count:-1,offset:0,instances:-1},O=ps(d,j),$=Fs(d,V,a,ne),ie=Hs(d,j,$,V),M=Hu(d,j,O,V,$,ie,_);function ne(pe){return M.destroyBuffer(pe)}var re=Wu(d,R,V,a),me=Au(d,j,O,function(){ue.procs.poll()},X,V,a),D=xu(d,j,O,V,a),F=Vu(d,j,O,me,D,V),ue=_c(d,R,j,O,$,ie,me,F,z,M,re,_,X,Y,a),Z=Ku(d,F,ue.procs.poll,X,S,j,O),H=ue.next,J=d.canvas,ee=[],ge=[],Ae=[],te=[a.onDestroy],ae=null;function be(){if(ee.length===0){Y&&Y.update(),ae=null;return}ae=nt.next(be),xr();for(var pe=ee.length-1;pe>=0;--pe){var Ie=ee[pe];Ie&&Ie(X,null,0)}d.flush(),Y&&Y.update()}function Te(){!ae&&ee.length>0&&(ae=nt.next(be))}function Re(){ae&&(nt.cancel(be),ae=null)}function Je(pe){pe.preventDefault(),G=!0,Re(),ge.forEach(function(Ie){Ie()})}function er(pe){d.getError(),G=!1,T.restore(),re.restore(),$.restore(),me.restore(),D.restore(),F.restore(),M.restore(),Y&&Y.restore(),ue.procs.refresh(),Te(),Ae.forEach(function(Ie){Ie()})}J&&(J.addEventListener(no,Je,!1),J.addEventListener(ao,er,!1));function Ce(){ee.length=0,Re(),J&&(J.removeEventListener(no,Je),J.removeEventListener(ao,er)),re.clear(),F.clear(),D.clear(),M.clear(),me.clear(),ie.clear(),$.clear(),Y&&Y.clear(),te.forEach(function(pe){pe()})}function cr(pe){i(!!pe,"invalid args to regl({...})"),i.type(pe,"object","invalid args to regl({...})");function Ie(E){var v=b({},E);delete v.uniforms,delete v.attributes,delete v.context,delete v.vao,"stencil"in v&&v.stencil.op&&(v.stencil.opBack=v.stencil.opFront=v.stencil.op,delete v.stencil.op);function m(p){if(p in v){var o=v[p];delete v[p],Object.keys(o).forEach(function(l){v[p+"."+l]=o[l]})}}return m("blend"),m("depth"),m("cull"),m("stencil"),m("polygonOffset"),m("scissor"),m("sample"),"vao"in E&&(v.vao=E.vao),v}function Ne(E,v){var m={},p={};return Object.keys(E).forEach(function(o){var l=E[o];if(ir.isDynamic(l)){p[o]=ir.unbox(l,o);return}else if(v&&Array.isArray(l)){for(var u=0;u<l.length;++u)if(ir.isDynamic(l[u])){p[o]=ir.unbox(l,o);return}}m[o]=l}),{dynamic:p,static:m}}var tr=Ne(pe.context||{},!0),et=Ne(pe.uniforms||{},!0),Gt=Ne(pe.attributes||{},!1),c=Ne(Ie(pe),!1),w={gpuTime:0,cpuTime:0,count:0},g=ue.compile(c,Gt,et,tr,w),se=g.draw,Le=g.batch,f=g.scope,t=[];function h(E){for(;t.length<E;)t.push(null);return t}function y(E,v){var m;if(G&&i.raise("context lost"),typeof E=="function")return f.call(this,null,E,0);if(typeof v=="function")if(typeof E=="number")for(m=0;m<E;++m)f.call(this,null,v,m);else if(Array.isArray(E))for(m=0;m<E.length;++m)f.call(this,E[m],v,m);else return f.call(this,E,v,0);else if(typeof E=="number"){if(E>0)return Le.call(this,h(E|0),E|0)}else if(Array.isArray(E)){if(E.length)return Le.call(this,E,E.length)}else return se.call(this,E)}return b(y,{stats:w,destroy:function(){g.destroy()}})}var Qe=F.setFBO=cr({framebuffer:ir.define.call(null,io,"framebuffer")});function sr(pe,Ie){var Ne=0;ue.procs.poll();var tr=Ie.color;tr&&(d.clearColor(+tr[0]||0,+tr[1]||0,+tr[2]||0,+tr[3]||0),Ne|=Tc),"depth"in Ie&&(d.clearDepth(+Ie.depth),Ne|=Sc),"stencil"in Ie&&(d.clearStencil(Ie.stencil|0),Ne|=wc),i(!!Ne,"called regl.clear with no buffer specified"),d.clear(Ne)}function lr(pe){if(i(typeof pe=="object"&&pe,"regl.clear() takes an object as input"),"framebuffer"in pe)if(pe.framebuffer&&pe.framebuffer_reglType==="framebufferCube")for(var Ie=0;Ie<6;++Ie)Qe(b({framebuffer:pe.framebuffer.faces[Ie]},pe),sr);else Qe(pe,sr);else sr(null,pe)}function dr(pe){i.type(pe,"function","regl.frame() callback must be a function"),ee.push(pe);function Ie(){var Ne=fo(ee,pe);i(Ne>=0,"cannot cancel a frame twice");function tr(){var et=fo(ee,tr);ee[et]=ee[ee.length-1],ee.length-=1,ee.length<=0&&Re()}ee[Ne]=tr}return Te(),{cancel:Ie}}function yr(){var pe=H.viewport,Ie=H.scissor_box;pe[0]=pe[1]=Ie[0]=Ie[1]=0,X.viewportWidth=X.framebufferWidth=X.drawingBufferWidth=pe[2]=Ie[2]=d.drawingBufferWidth,X.viewportHeight=X.framebufferHeight=X.drawingBufferHeight=pe[3]=Ie[3]=d.drawingBufferHeight}function xr(){X.tick+=1,X.time=Se(),yr(),ue.procs.poll()}function rr(){me.refresh(),yr(),ue.procs.refresh(),Y&&Y.update()}function Se(){return(lt()-q)/1e3}rr();function gr(pe,Ie){i.type(Ie,"function","listener callback must be a function");var Ne;switch(pe){case"frame":return dr(Ie);case"lost":Ne=ge;break;case"restore":Ne=Ae;break;case"destroy":Ne=te;break;default:i.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ne.push(Ie),{cancel:function(){for(var tr=0;tr<Ne.length;++tr)if(Ne[tr]===Ie){Ne[tr]=Ne[Ne.length-1],Ne.pop();return}}}}var je=b(cr,{clear:lr,prop:ir.define.bind(null,io),context:ir.define.bind(null,Oc),this:ir.define.bind(null,Rc),draw:cr({}),buffer:function(pe){return $.create(pe,Lc,!1,!1)},elements:function(pe){return ie.create(pe,!1)},texture:me.create2D,cube:me.createCube,renderbuffer:D.create,framebuffer:F.create,framebufferCube:F.createCube,vao:M.createVAO,attributes:S,frame:dr,on:gr,limits:O,hasExtension:function(pe){return O.extensions.indexOf(pe.toLowerCase())>=0},read:Z,destroy:Ce,_gl:d,_refresh:rr,poll:function(){xr(),Y&&Y.update()},now:Se,stats:V});return a.onDone(null,je),je}return Ic})})(go);var tl=go.exports;const Ll=rl(tl);function Ol(n,r,s,b){function L(P){return P instanceof s?P:new s(function(B){B(P)})}return new(s||(s=Promise))(function(P,B){function U(Oe){try{ce(b.next(Oe))}catch(Pe){B(Pe)}}function fe(Oe){try{ce(b.throw(Oe))}catch(Pe){B(Pe)}}function ce(Oe){Oe.done?P(Oe.value):L(Oe.value).then(U,fe)}ce((b=b.apply(n,r||[])).next())})}function ho(n){var r=typeof Symbol=="function"&&Symbol.iterator,s=r&&n[r],b=0;if(s)return s.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&b>=n.length&&(n=void 0),{value:n&&n[b++],done:!n}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function fa(n){return this instanceof fa?(this.v=n,this):new fa(n)}function Rl(n,r,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b=s.apply(n,r||[]),L,P=[];return L={},B("next"),B("throw"),B("return"),L[Symbol.asyncIterator]=function(){return this},L;function B(xe){b[xe]&&(L[xe]=function(Me){return new Promise(function(Ye,Ke){P.push([xe,Me,Ye,Ke])>1||U(xe,Me)})})}function U(xe,Me){try{fe(b[xe](Me))}catch(Ye){Pe(P[0][3],Ye)}}function fe(xe){xe.value instanceof fa?Promise.resolve(xe.value.v).then(ce,Oe):Pe(P[0][2],xe)}function ce(xe){U("next",xe)}function Oe(xe){U("throw",xe)}function Pe(xe,Me){xe(Me),P.shift(),P.length&&U(P[0][0],P[0][1])}}function Il(n){var r,s;return r={},b("next"),b("throw",function(L){throw L}),b("return"),r[Symbol.iterator]=function(){return this},r;function b(L,P){r[L]=n[L]?function(B){return(s=!s)?{value:fa(n[L](B)),done:!1}:P?P(B):B}:P}}function Cl(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n[Symbol.asyncIterator],s;return r?r.call(n):(n=typeof ho=="function"?ho(n):n[Symbol.iterator](),s={},b("next"),b("throw"),b("return"),s[Symbol.asyncIterator]=function(){return this},s);function b(P){s[P]=n[P]&&function(B){return new Promise(function(U,fe){B=n[P](B),L(U,fe,B.done,B.value)})}}function L(P,B,U,fe){Promise.resolve(fe).then(function(ce){P({value:ce,done:U})},B)}}const ui=2,tt=4,ot=4,nl=4,Et=new Int32Array(2),mo=new Float32Array(Et.buffer),vo=new Float64Array(Et.buffer),ia=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var ci;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(ci||(ci={}));class oa{constructor(r){this.bytes_=r,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(r){return new oa(new Uint8Array(r))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(r){this.position_=r}capacity(){return this.bytes_.length}readInt8(r){return this.readUint8(r)<<24>>24}readUint8(r){return this.bytes_[r]}readInt16(r){return this.readUint16(r)<<16>>16}readUint16(r){return this.bytes_[r]|this.bytes_[r+1]<<8}readInt32(r){return this.bytes_[r]|this.bytes_[r+1]<<8|this.bytes_[r+2]<<16|this.bytes_[r+3]<<24}readUint32(r){return this.readInt32(r)>>>0}readInt64(r){return BigInt.asIntN(64,BigInt(this.readUint32(r))+(BigInt(this.readUint32(r+4))<<BigInt(32)))}readUint64(r){return BigInt.asUintN(64,BigInt(this.readUint32(r))+(BigInt(this.readUint32(r+4))<<BigInt(32)))}readFloat32(r){return Et[0]=this.readInt32(r),mo[0]}readFloat64(r){return Et[ia?0:1]=this.readInt32(r),Et[ia?1:0]=this.readInt32(r+4),vo[0]}writeInt8(r,s){this.bytes_[r]=s}writeUint8(r,s){this.bytes_[r]=s}writeInt16(r,s){this.bytes_[r]=s,this.bytes_[r+1]=s>>8}writeUint16(r,s){this.bytes_[r]=s,this.bytes_[r+1]=s>>8}writeInt32(r,s){this.bytes_[r]=s,this.bytes_[r+1]=s>>8,this.bytes_[r+2]=s>>16,this.bytes_[r+3]=s>>24}writeUint32(r,s){this.bytes_[r]=s,this.bytes_[r+1]=s>>8,this.bytes_[r+2]=s>>16,this.bytes_[r+3]=s>>24}writeInt64(r,s){this.writeInt32(r,Number(BigInt.asIntN(32,s))),this.writeInt32(r+4,Number(BigInt.asIntN(32,s>>BigInt(32))))}writeUint64(r,s){this.writeUint32(r,Number(BigInt.asUintN(32,s))),this.writeUint32(r+4,Number(BigInt.asUintN(32,s>>BigInt(32))))}writeFloat32(r,s){mo[0]=s,this.writeInt32(r,Et[0])}writeFloat64(r,s){vo[0]=s,this.writeInt32(r,Et[ia?0:1]),this.writeInt32(r+4,Et[ia?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+tt+ot)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let r="";for(let s=0;s<ot;s++)r+=String.fromCharCode(this.readInt8(this.position_+tt+s));return r}__offset(r,s){const b=r-this.readInt32(r);return s<this.readInt16(b)?this.readInt16(b+s):0}__union(r,s){return r.bb_pos=s+this.readInt32(s),r.bb=this,r}__string(r,s){r+=this.readInt32(r);const b=this.readInt32(r);r+=tt;const L=this.bytes_.subarray(r,r+b);return s===ci.UTF8_BYTES?L:this.text_decoder_.decode(L)}__union_with_string(r,s){return typeof r=="string"?this.__string(s):this.__union(r,s)}__indirect(r){return r+this.readInt32(r)}__vector(r){return r+this.readInt32(r)+tt}__vector_len(r){return this.readInt32(r+this.readInt32(r))}__has_identifier(r){if(r.length!=ot)throw new Error("FlatBuffers: file identifier must be length "+ot);for(let s=0;s<ot;s++)if(r.charCodeAt(s)!=this.readInt8(this.position()+tt+s))return!1;return!0}createScalarList(r,s){const b=[];for(let L=0;L<s;++L){const P=r(L);P!==null&&b.push(P)}return b}createObjList(r,s){const b=[];for(let L=0;L<s;++L){const P=r(L);P!==null&&b.push(P.unpack())}return b}}class To{constructor(r){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let s;r?s=r:s=1024,this.bb=oa.allocate(s),this.space=s}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(r){this.force_defaults=r}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(r,s){r>this.minalign&&(this.minalign=r);const b=~(this.bb.capacity()-this.space+s)+1&r-1;for(;this.space<b+r+s;){const L=this.bb.capacity();this.bb=To.growByteBuffer(this.bb),this.space+=this.bb.capacity()-L}this.pad(b)}pad(r){for(let s=0;s<r;s++)this.bb.writeInt8(--this.space,0)}writeInt8(r){this.bb.writeInt8(this.space-=1,r)}writeInt16(r){this.bb.writeInt16(this.space-=2,r)}writeInt32(r){this.bb.writeInt32(this.space-=4,r)}writeInt64(r){this.bb.writeInt64(this.space-=8,r)}writeFloat32(r){this.bb.writeFloat32(this.space-=4,r)}writeFloat64(r){this.bb.writeFloat64(this.space-=8,r)}addInt8(r){this.prep(1,0),this.writeInt8(r)}addInt16(r){this.prep(2,0),this.writeInt16(r)}addInt32(r){this.prep(4,0),this.writeInt32(r)}addInt64(r){this.prep(8,0),this.writeInt64(r)}addFloat32(r){this.prep(4,0),this.writeFloat32(r)}addFloat64(r){this.prep(8,0),this.writeFloat64(r)}addFieldInt8(r,s,b){(this.force_defaults||s!=b)&&(this.addInt8(s),this.slot(r))}addFieldInt16(r,s,b){(this.force_defaults||s!=b)&&(this.addInt16(s),this.slot(r))}addFieldInt32(r,s,b){(this.force_defaults||s!=b)&&(this.addInt32(s),this.slot(r))}addFieldInt64(r,s,b){(this.force_defaults||s!==b)&&(this.addInt64(s),this.slot(r))}addFieldFloat32(r,s,b){(this.force_defaults||s!=b)&&(this.addFloat32(s),this.slot(r))}addFieldFloat64(r,s,b){(this.force_defaults||s!=b)&&(this.addFloat64(s),this.slot(r))}addFieldOffset(r,s,b){(this.force_defaults||s!=b)&&(this.addOffset(s),this.slot(r))}addFieldStruct(r,s,b){s!=b&&(this.nested(s),this.slot(r))}nested(r){if(r!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(r){this.vtable!==null&&(this.vtable[r]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(r){const s=r.capacity();if(s&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const b=s<<1,L=oa.allocate(b);return L.setPosition(b-s),L.bytes().set(r.bytes(),b-s),L}addOffset(r){this.prep(tt,0),this.writeInt32(this.offset()-r+tt)}startObject(r){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=r;for(let s=0;s<r;s++)this.vtable[s]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const r=this.offset();let s=this.vtable_in_use-1;for(;s>=0&&this.vtable[s]==0;s--);const b=s+1;for(;s>=0;s--)this.addInt16(this.vtable[s]!=0?r-this.vtable[s]:0);const L=2;this.addInt16(r-this.object_start);const P=(b+L)*ui;this.addInt16(P);let B=0;const U=this.space;e:for(s=0;s<this.vtables.length;s++){const fe=this.bb.capacity()-this.vtables[s];if(P==this.bb.readInt16(fe)){for(let ce=ui;ce<P;ce+=ui)if(this.bb.readInt16(U+ce)!=this.bb.readInt16(fe+ce))continue e;B=this.vtables[s];break}}return B?(this.space=this.bb.capacity()-r,this.bb.writeInt32(this.space,B-r)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-r,this.offset()-r)),this.isNested=!1,r}finish(r,s,b){const L=b?nl:0;if(s){const P=s;if(this.prep(this.minalign,tt+ot+L),P.length!=ot)throw new Error("FlatBuffers: file identifier must be length "+ot);for(let B=ot-1;B>=0;B--)this.writeInt8(P.charCodeAt(B))}this.prep(this.minalign,tt+L),this.addOffset(r),L&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(r,s){this.finish(r,s,!0)}requiredField(r,s){const b=this.bb.capacity()-r,L=b-this.bb.readInt32(b);if(!(s<this.bb.readInt16(L)&&this.bb.readInt16(L+s)!=0))throw new Error("FlatBuffers: field "+s+" must be set")}startVector(r,s,b){this.notNested(),this.vector_num_elems=s,this.prep(tt,r*s),this.prep(b,r*s)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(r){if(!r)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(r))return this.string_maps.get(r);const s=this.createString(r);return this.string_maps.set(r,s),s}createString(r){if(r==null)return 0;let s;r instanceof Uint8Array?s=r:s=this.text_encoder.encode(r),this.addInt8(0),this.startVector(1,s.length,1),this.bb.setPosition(this.space-=s.length);for(let b=0,L=this.space,P=this.bb.bytes();b<s.length;b++)P[L++]=s[b];return this.endVector()}createObjectOffset(r){return r===null?0:typeof r=="string"?this.createString(r):r.pack(this)}createObjectOffsetList(r){const s=[];for(let b=0;b<r.length;++b){const L=r[b];if(L!==null)s.push(this.createObjectOffset(L));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return s}createStructOffsetList(r,s){return s(this,r.length),this.createObjectOffsetList(r.slice().reverse()),this.endVector()}}export{Pc as A,To as B,ol as C,uo as D,Fc as E,bl as F,il as G,al as H,yl as I,nl as S,Rl as _,fa as a,Il as b,Cl as c,Ol as d,oa as e,Tl as f,ul as g,sl as h,cl as i,hl as j,ml as k,ll as l,Ll as m,vl as n,xl as o,El as p,dl as q,xo as r,Sl as s,wl as t,gl as u,fl as v,Al as w,_l as x,pl as y,Pt as z};
